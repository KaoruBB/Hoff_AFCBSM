<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>標準ベイズ統計学 演習問題 解答例</title>
<meta name="author" content="馬場先 薫" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" href="css/custom.css">
<!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z3P7FTH247"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Z3P7FTH247'); </script>
<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
// @license-end
</script>
<script>
  window.MathJax = {
    loader: {
      load: ['[tex]/mathtools'],
    },
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em',
      packages: {'[+]': ['mathtools']},
      macros: {
        RR: ['\\ifstrempty{#1}{\\mathbb{R}}{\\mathbb{R}^{#1}}', 1, ''],
        NN: ['\\ifstrempty{#1}{\\mathbb{N}}{\\mathbb{N}^{#1}}', 1, ''],
        ZZ: ['\\ifstrempty{#1}{\\mathbb{Z}}{\\mathbb{Z}^{#1}}', 1, ''],
        QQ: ['\\ifstrempty{#1}{\\mathbb{Q}}{\\mathbb{Q}^{#1}}', 1, ''],
        CC: ['\\ifstrempty{#1}{\\mathbb{C}}{\\mathbb{C}^{#1}}', 1, ''],
        bm: ['\\boldsymbol{#1}', 1],
        EE: '\\mathbb{E}',
        Lap: '\\operatorname{\\mathcal{L}}',
        Var: '\\operatorname{Var}',
        Cor: '\\operatorname{Cor}',
        E: '\\operatorname{E}',
      },
      mathtools: {
        pairedDelimiters: {
          abs: ['\\lvert', '\\rvert'],
          norm: ['\\lVert', '\\rVert'],
          ceil: ['\\lceil', '\\rceil'],
          floor: ['\\lfloor', '\\rfloor'],
          round: ['\\lfloor', '\\rceil'],
        }
      }
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">標準ベイズ統計学 演習問題 解答例</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org680f4fe">このサイトについて</a></li>
<li><a href="#org83ba70d">Chapter 2</a>
<ul>
<li><a href="#org4baa3f3">2.1</a></li>
<li><a href="#org694c7dd">2.2</a></li>
<li><a href="#org76e86c6">2.3</a></li>
<li><a href="#orgdcfe8fd">2.4</a></li>
<li><a href="#org0849fba">2.5</a></li>
<li><a href="#orgc38b86c">2.6</a></li>
<li><a href="#org6507454">2.7</a></li>
<li><a href="#orgdaf6c76">2.8</a></li>
</ul>
</li>
<li><a href="#orgc2a5528">Chapter 3</a>
<ul>
<li><a href="#org86ca187">3.1</a></li>
<li><a href="#orgb2adb4d">3.2</a></li>
<li><a href="#orged29c8b">3.3</a></li>
<li><a href="#org6042380">3.4</a></li>
<li><a href="#orge62e52b">3.5</a></li>
<li><a href="#orgf81e038">3.6</a></li>
<li><a href="#orga423bb2">3.7</a></li>
<li><a href="#org77f5c75">3.8</a></li>
<li><a href="#orgf1c5c44">3.9</a></li>
<li><a href="#orgb94144c">3.10</a></li>
<li><a href="#orgafad0a9">3.12(和訳は 3.11)</a></li>
<li><a href="#org8787c66">3.13</a></li>
<li><a href="#orgf5a84b8">3.14</a></li>
</ul>
</li>
<li><a href="#org653bab6">Chapter 4</a>
<ul>
<li><a href="#orgff18856">4.1</a></li>
<li><a href="#org198c220">4.2</a></li>
<li><a href="#org7ec470c">4.3</a></li>
<li><a href="#orga3b1fbf">4.4</a></li>
<li><a href="#orgb49282d">4.5</a></li>
<li><a href="#org67d2120">4.6</a></li>
<li><a href="#org79ac863">4.7</a></li>
<li><a href="#org6334b0d">4.8</a></li>
</ul>
</li>
<li><a href="#org46ef922">Chapter 5</a>
<ul>
<li><a href="#orgb424b1b">5.1</a></li>
<li><a href="#orgee48805">5.2</a></li>
<li><a href="#orgc89835a">5.3</a></li>
<li><a href="#orgb20bc3b">5.4</a></li>
<li><a href="#org5b78487">5.5</a></li>
</ul>
</li>
<li><a href="#org1ffc95b">Chapter 6</a>
<ul>
<li><a href="#orgdc94f5c">6.1</a></li>
<li><a href="#orgb547a00">6.2</a></li>
<li><a href="#org8f65c70">6.3</a></li>
</ul>
</li>
<li><a href="#org2be65ef">Chapter 7</a>
<ul>
<li><a href="#org48b9ce4">7.1</a></li>
<li><a href="#org906275a">7.2</a></li>
<li><a href="#org34f5f73">7.3</a></li>
<li><a href="#org2502d9b">7.4</a></li>
<li><a href="#org2995317">7.5</a></li>
<li><a href="#org7a00f8a">7.6</a></li>
</ul>
</li>
<li><a href="#orge9b5f70">Chapter 8</a>
<ul>
<li><a href="#orgfe55f52">8.1</a></li>
<li><a href="#org3311b5d">8.2</a></li>
<li><a href="#org719b5fa">8.3</a></li>
</ul>
</li>
<li><a href="#org2bac6f5">Chapter 9</a>
<ul>
<li><a href="#orgb2b225e">9.1</a></li>
<li><a href="#org46611e1">9.2</a></li>
<li><a href="#org8148340">9.3</a></li>
</ul>
</li>
<li><a href="#org45e04e7">Chapter 9</a>
<ul>
<li><a href="#orgd3f6a54">9.1</a></li>
<li><a href="#org291ba71">9.2</a></li>
<li><a href="#org5b52b8a">9.3</a></li>
</ul>
</li>
<li><a href="#org80b5799">Chapter 10</a>
<ul>
<li><a href="#org883b5d5">10.1</a></li>
<li><a href="#orgfdcee9c">10.2</a></li>
<li><a href="#org5d5ee12">10.3</a></li>
<li><a href="#orgb76b548">10.4</a></li>
</ul>
</li>
<li><a href="#org7b23e33">間違いを見つけたら</a></li>
</ul>
</div>
</div>
<div id="outline-container-org680f4fe" class="outline-2">
<h2 id="org680f4fe">このサイトについて</h2>
<div class="outline-text-2" id="text-org680f4fe">
<p>
For English site, please visit <a href="./index.html">here</a>.
</p>

<p>
このサイトは
</p>
<ul class="org-ul">
<li><a href="https://pdhoff.github.io/book/">Peter Hoff, A First Course in Bayesian Statistical Methods</a></li>
<li><a href="https://www.asakura.co.jp/detail.php?book_code=12267">標準ベイズ統計学</a></li>
</ul>
<p>
の Exercise を解いたものです。
</p>

<p>
もし、間違いなどありましたら、<a href="#org7b23e33">こちら</a>をご覧いただき、ご指摘いただけると幸いです。
</p>
</div>
</div>
<div id="outline-container-org83ba70d" class="outline-2">
<h2 id="org83ba70d">Chapter 2</h2>
<div class="outline-text-2" id="text-org83ba70d">
</div>
<div id="outline-container-org4baa3f3" class="outline-3">
<h3 id="org4baa3f3">2.1</h3>
<div class="outline-text-3" id="text-org4baa3f3">
<p>
(a)
</p>

\begin{align*}
Pr (Y_1 = \text{farm})
& = Pr(Y_1 = \text{farm} | Y_2 = \text{farm})+
Pr(Y_1 = \text{farm} | Y_2 = \text{operatives})\\ &+
Pr(Y_1 = \text{farm} | Y_2 = \text{craftsman}) \\&+
Pr(Y_1 = \text{farm} | Y_2 = \text{sales}) \\&+
Pr(Y_1 = \text{farm} | Y_2 = \text{professinonal})\\
&= 0.018 + 0.035 + 0.031 + 0.008 + 0.018 \\
&= 0.110
\end{align*}

<p>
同様にして、
</p>
\begin{align*}
& Pr (Y_1 = \text{operatives})
= 0.002 + 0.112 + 0.064 + 0.032 + 0.069
= 0.279\\
& Pr (Y_1 = \text{craftsman})
= 0.001 + 0.066 + 0.094 + 0.032 + 0.084
= 0.277\\
& Pr (Y_1 = \text{sales})
= 0.001 + 0.018 + 0.019 + 0.010 + 0.051
= 0.099\\
& Pr (Y_1 = \text{professional})
= 0.001 + 0.029 + 0.032 + 0.043 + 0.130
= 0.235
\end{align*}

<p>
(b)
</p>

\begin{align*}
&\text{Pr}(Y_2 = \text{farm}) = 0.018 + 0.002 + 0.001 + 0.001 + 0.001 = 0.023\\
&\text{Pr}(Y_2 = \text{operatives}) = 0.035 + 0.112 + 0.066 + 0.018 + 0.029 = 0.26\\
&\text{Pr}(Y_2 = \text{craftsman}) = 0.031 + 0.064 + 0.094 + 0.019 + 0.032 = 0.24\\
&\text{Pr}(Y_2 = \text{sales}) = 0.008 + 0.032 + 0.032 + 0.010 + 0.043 = 0.125\\
&\text{Pr}(Y_2 = \text{professional}) = 0.018 + 0.069 + 0.084 + 0.051 + 0.130 = 0.352
\end{align*}

<p>
(c)
the conditional distribution of a son&rsquo;s occupation, given that the father is a farmer;
</p>

\begin{align*}
&\text{Pr}(Y_2 = \text{farm} | Y_1 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{farm} , Y_2 = \text{farm}) }{ \text{Pr}(Y_1 = \text{farm}) }
 = \frac{0.018}{0.110} = 0.164\\
&\text{Pr}(Y_2 = \text{operatives} | Y_1 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{farm} , Y_2 = \text{operatives}) }{ \text{Pr}(Y_1 = \text{farm}) }
 = \frac{0.035}{0.110} = 0.318\\
&\text{Pr}(Y_2 = \text{craftsman} | Y_1 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{farm} , Y_2 = \text{craftsman}) }{ \text{Pr}(Y_1 = \text{farm}) }
 = \frac{0.031}{0.110} = 0.282\\
&\text{Pr}(Y_2 = \text{sales} | Y_1 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{farm} , Y_2 = \text{sales}) }{ \text{Pr}(Y_1 = \text{farm}) }
 = \frac{0.008}{0.110} = 0.073\\
&\text{Pr}(Y_2 = \text{professional} | Y_1 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{farm} , Y_2 = \text{professional}) }{ \text{Pr}(Y_1 = \text{farm}) }
 = \frac{0.018}{0.110} = 0.164
\end{align*}

<p>
(d)
the conditional distribution of a father&rsquo;s occupation, given that the son is a farmer;
</p>

\begin{align*}
&\text{Pr}(Y_1 = \text{farm} | Y_2 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{farm} , Y_2 = \text{farm}) }{ \text{Pr}(Y_2 = \text{farm}) }
 = \frac{0.018}{0.023} = 0.783\\
&\text{Pr}(Y_1 = \text{operatives} | Y_2 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{operatives} , Y_2 = \text{farm}) }{ \text{Pr}(Y_2 = \text{farm}) }
 = \frac{0.002}{0.023} = 0.087\\
&\text{Pr}(Y_1 = \text{craftsman} | Y_2 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{craftsman} , Y_2 = \text{farm}) }{ \text{Pr}(Y_2 = \text{farm}) }
 = \frac{0.001}{0.023} = 0.043\\
&\text{Pr}(Y_1 = \text{sales} | Y_2 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{sales} , Y_2 = \text{farm}) }{ \text{Pr}(Y_2 = \text{farm}) }
 = \frac{0.001}{0.023} = 0.043\\
&\text{Pr}(Y_1 = \text{professional} | Y_2 = \text{farm})
= \frac{ \text{Pr}(Y_1 = \text{professional} , Y_2 = \text{farm}) }{ \text{Pr}(Y_2 = \text{farm}) }
 = \frac{0.001}{0.023} = 0.043
\end{align*}
</div>
</div>
<div id="outline-container-org694c7dd" class="outline-3">
<h3 id="org694c7dd">2.2</h3>
<div class="outline-text-3" id="text-org694c7dd">
</div>
<div id="outline-container-org142ee38" class="outline-4">
<h4 id="org142ee38">a</h4>
<div class="outline-text-4" id="text-org142ee38">
\begin{align*}
\text{E} [a_1 Y_1 + a_2 Y_2] &= a_1 \text{E} [Y_1] + a_2 \text{E} [Y_2] \\
& = a_1 \mu_1 + a_2 \mu_2 \\
\\
\text{Var} [a_1 Y_1 + a_2 Y_2]
&= \text{E} [(a_1 Y_1 + a_2 Y_2)^2] - \text{E} [a_1 Y_1 + a_2 Y_2]^2 \\
&= \text{E} [a_1^2 Y_1^2 + a_2^2 Y_2^2 + 2 a_1 a_2 Y_1 Y_2] - \text{E} [a_1 Y_1 + a_2 Y_2]^2 \\
&= a_1^2 \text{E} [Y_1^2] + a_2^2 \text{E} [Y_2^2] + 2 a_1 a_2 \text{E} [Y_1 Y_2]
- (a_1 \mu_1 + a_2 \mu_2)^2\\
&= a_1^2 (\text{E} [Y_1^2] - \mu_1^2) + a_2^2 (\text{E} [Y_2^2] - \mu_2^2) + 2 a_1 a_2 \text{E} [Y_1] \text{E} [Y_2] - 2 a_1 a_2 \mu_1 \mu_2 \\
& \qquad \qquad ( \because Y_1 \text{ and } Y_2 \text{ are independent })\\
&= a_1^2 \sigma_1^2 + a_2^2 \sigma_2^2
\end{align*}
</div>
</div>
<div id="outline-container-orgbb55868" class="outline-4">
<h4 id="orgbb55868">b</h4>
<div class="outline-text-4" id="text-orgbb55868">
\begin{align*}
\text{E} [a_1 Y_1 - a_2 Y_2]
&= a_1 \text{E} [Y_1] - a_2 \text{E} [Y_2] \\
&= a_1 \mu_1 - a_2 \mu_2 \\
\\
\text{Var} [a_1 Y_1 - a_2 Y_2]
&= \text{E} [(a_1 Y_1 - a_2 Y_2)^2] - \text{E} [a_1 Y_1 - a_2 Y_2]^2 \\
&= \text{E} [a_1^2 Y_1^2 + a_2^2 Y_2^2 - 2 a_1 a_2 Y_1 Y_2] - \text{E} [a_1 Y_1 - a_2 Y_2]^2 \\
&= a_1^2 \text{E} [Y_1^2] + a_2^2 \text{E} [Y_2^2] - 2 a_1 a_2 \text{E} [Y_1 Y_2]
- (a_1 \mu_1 - a_2 \mu_2)^2\\
&= a_1^2 (\text{E} [Y_1^2] - \mu_1^2) + a_2^2 (\text{E} [Y_2^2] - \mu_2^2) - 2 a_1 a_2 \text{E} [Y_1] \text{E} [Y_2] + 2 a_1 a_2 \mu_1 \mu_2 \\
& \qquad \qquad ( \because Y_1 \text{ and } Y_2 \text{ are independent })\\
&= a_1^2 \sigma_1^2 + a_2^2 \sigma_2^2
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org76e86c6" class="outline-3">
<h3 id="org76e86c6">2.3</h3>
<div class="outline-text-3" id="text-org76e86c6">
</div>
<div id="outline-container-org234e369" class="outline-4">
<h4 id="org234e369">a</h4>
<div class="outline-text-4" id="text-org234e369">
\begin{align*}
p(x \mid y, z) &= \frac{p(x, y, z)}{p(y, z)} \\
&= \frac{p(x, y, z)}{\int p(x, y, z) \; dx} \\
&= \frac{f(x, z) g(y, z) h(z)}{\int f(x, z) g(y, z) h(z) \; dx} \\
& \qquad (\because \text{ 仮定より } p(x, y, z) = Const \times f(x, z) g(y, z) h(z)) \text{ となるが、定数はインテグラルの外に出て打ち消されるから。}\\
&= \frac{f(x, z) g(y, z) h(z)}{g(y, z) h(z) \int f(x, z) \; dx} \\
&= \frac{f(x, z)}{\int f(x, z) \; dx}
\end{align*}
</div>
</div>
<div id="outline-container-org8ce8599" class="outline-4">
<h4 id="org8ce8599">b</h4>
<div class="outline-text-4" id="text-org8ce8599">
\begin{align*}
p( y \mid x, z)
& = \frac{p(x, y, z)}{p(x, z)} \\
&= \frac{p(x, y, z)}{\int p(x, y, z) \; dy} \\
&= \frac{f(x, z) g(y, z) h(z)}{\int f(x, z) g(y, z) h(z) \; dy} \\
&= \frac{f(x, z) g(y, z) h(z)}{ f(x, z) h(z) \int g(y, z) \; dy} \\
&= \frac{g(y, z)}{\int g(y, z) \; dy}
\end{align*}
</div>
</div>
<div id="outline-container-org849d0bc" class="outline-4">
<h4 id="org849d0bc">c</h4>
<div class="outline-text-4" id="text-org849d0bc">
<p>
\(p(x, y \mid z) = p(x \mid z) \times p(y \mid z) \) を示せばよい。
</p>

<p>
\(p(x,y \mid z) = p(x \mid y, z) p(y \mid z)\)
は常に成り立つことから、\(p(x \mid z) = p(x \mid y, z)\)を示す。
</p>

\begin{align*}
p(x \mid z) &= \frac{p(x, z)}{p(z)} \\
&= \frac{\int p(x, y, z) \; dy}{\int \int p(x, y, z) \; dy \; dx} \\
&= \frac{\int f(x, z) g(y, z) h(z) \; dy}{\int \int f(x, z) g(y, z) h(z) \; dy \; dx} \\
&= \frac{f(x, z) h(z) \int g(y, z) \; dy}{h(z)  \int \int g(y, z)  f(x, z) \; dy \; dx } \\
&= \frac{f(x, z) h(z) \int g(y, z) \; dy}{h(z) \int f(x, z) \left( \int g(y, z)  \; dy \right) \; dx } \\
&= \frac{f(x, z) h(z) \int g(y, z) \; dy}{h(z) \left( \int g(y, z) \; dy \right) \left( \int f(x, z) \; dx \right)} \\
&= \frac{f(x, z)}{\int f(x, z) \; dx} \\
&= p(x \mid y, z) \qquad ( \because \text{ a })
\end{align*}

<p>
よって、\(p(x \mid z) = p(x \mid y, z)\)が成り立つ。
</p>
</div>
</div>
</div>
<div id="outline-container-orgdcfe8fd" class="outline-3">
<h3 id="orgdcfe8fd">2.4</h3>
<div class="outline-text-3" id="text-orgdcfe8fd">
</div>
<div id="outline-container-org6b0546a" class="outline-4">
<h4 id="org6b0546a">Answer</h4>
<div class="outline-text-4" id="text-org6b0546a">
</div>
<div id="outline-container-org0a0740a" class="outline-5">
<h5 id="org0a0740a">a</h5>
<div class="outline-text-5" id="text-org0a0740a">
\begin{align*}
\text{Pr}(H_j \mid E) \text{Pr}(E)
&= \text{Pr}(H_j \mid E \cap (E \text{ or not} E)) \text{Pr}(E \mid E \text{ or not} E) \\
&= \text{Pr}(H_j \cap E \mid E \text{ or not} E)
\qquad (\because \text{P3}) \\
\\
\text{Pr}(E \mid H_j) \text{Pr}(H_j)
&= \text{Pr}(E \mid H_j \cap (E \text{ or not} E)) \text{Pr}(H_j \mid E \text{ or not} E) \\
&= \text{Pr}(E \cap H_j \mid E \text{ or not} E)
\qquad (\because \text{P3}) \\
\\
\therefore \text{Pr}(H_j \mid E) \text{Pr}(E)
&= \text{Pr}(E \mid H_j) \text{Pr}(H_j)
\end{align*}
</div>
</div>
<div id="outline-container-orgb5615fe" class="outline-5">
<h5 id="orgb5615fe">b</h5>
<div class="outline-text-5" id="text-orgb5615fe">
<p>
\(\text{Pr}( \bigcup^K_{k=1} H_k ) = 1\)
と仮定する。
</p>

\begin{align*}
\text{Pr}(E)
&= \text{Pr}\left(E \cap \bigcup_{k=1}^K H_k\right) \\
&= \text{Pr}\left( \left(E \cap H_1 \right) \cup \left( E \cap \left\{\bigcup_{k=2}^K H_k \right\} \right) \right)\\
&= \text{Pr}\left( E \cap H_1 \right) + \text{Pr}\left( E \cap \left\{ \bigcup_{k=2}^K H_k \right\} \right)
\qquad (\because \{H_1, \dots , H_K\} \text{ is a partition and P2})
\end{align*}
</div>
</div>
<div id="outline-container-org6870e41" class="outline-5">
<h5 id="org6870e41">c</h5>
<div class="outline-text-5" id="text-org6870e41">
\begin{align*}
\text{Pr}(E)
&= \text{Pr}\left(E \cap H_1 \right)+
\text{Pr}\left( E \cap \left\{ \bigcup_{k=2}^K H_k \right\} \right) \\
&= \text{Pr}\left( E \cap H_1 \right) +
\text{Pr}\left( E \cap H_2 \right) +
\text{Pr}\left( E \cap \left\{ \bigcup_{k=3}^K H_k \right\} \right) \\
&= \cdots \\
&= \text{Pr}\left( E \cap H_1 \right) +
\text{Pr}\left( E \cap H_2 \right) +
\cdots + \text{Pr}\left( E \cap H_K \right) \\
&= \sum_{k=1}^K \text{Pr}\left( E \cap H_k \right)
\end{align*}
</div>
</div>
<div id="outline-container-orged30320" class="outline-5">
<h5 id="orged30320">d</h5>
<div class="outline-text-5" id="text-orged30320">
\begin{align*}
\text{Pr}(H_j \mid E)
&= \frac{\text{Pr}(E \mid H_j) \text{Pr}(H_j)}{\text{Pr}(E)}
\qquad (\because \text{a}) \\
&= \frac{\text{Pr}(E \mid H_j) \text{Pr}(H_j)}{\sum_{k=1}^K \text{Pr}(E \cap H_k)}
\qquad (\because \text{c})\\
&= \frac{\text{Pr}(E \mid H_j) \text{Pr}(H_j)}{\sum_{k=1}^K \text{Pr}(E \mid H_k) \text{Pr}(H_k)}
\qquad (\because \text{P3})\\
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-org0849fba" class="outline-3">
<h3 id="org0849fba">2.5</h3>
<div class="outline-text-3" id="text-org0849fba">
</div>
<div id="outline-container-org9d56d57" class="outline-4">
<h4 id="org9d56d57">Answer</h4>
<div class="outline-text-4" id="text-org9d56d57">
</div>
<div id="outline-container-orgb5ade43" class="outline-5">
<h5 id="orgb5ade43">a</h5>
<div class="outline-text-5" id="text-orgb5ade43">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">X = 0</th>
<th scope="col" class="org-right">X = 1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Y = 0</td>
<td class="org-right">0.2</td>
<td class="org-right">0.3</td>
</tr>

<tr>
<td class="org-left">Y = 1</td>
<td class="org-right">0.3</td>
<td class="org-right">0.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org42b251d" class="outline-5">
<h5 id="org42b251d">b</h5>
<div class="outline-text-5" id="text-org42b251d">
<p>
上の表を用いて、
</p>
\begin{align*}
\text{E}\left[Y\right]
&= \text{Pr}(Y = 0) \cdot 0 + \text{Pr}(Y = 1) \cdot 1 \\
&= (0.2 + 0.3) \cdot 0 + (0.3 + 0.2) \cdot 1 \\
&= 0.5
\end{align*}
</div>
</div>
<div id="outline-container-orgf265a29" class="outline-5">
<h5 id="orgf265a29">c</h5>
<div class="outline-text-5" id="text-orgf265a29">
\begin{align*}
\text{Var}\left[Y \mid X = 0\right]
&= \text{Pr}(Y = 0 \mid X = 0) \cdot (0 - \text{E}\left[Y \mid X = 0\right])^2 +
\text{Pr}(Y = 1 \mid X = 0) \cdot (1 - \text{E}\left[Y \mid X = 0\right])^2 \\
&= 0.4 \cdot (0- 0.6)^2 + 0.6 \cdot (1 - 0.6)^2 \\
&= 0.24 \\
\\
\text{Var}\left[Y \mid X = 1\right]
&= \text{Pr}(Y = 0 \mid X = 1) \cdot (0 - \text{E}\left[Y \mid X = 1\right])^2 +
\text{Pr}(Y = 1 \mid X = 1) \cdot (1 - \text{E}\left[Y \mid X = 1\right])^2 \\
&= 0.6 \cdot (0- 0.4)^2 + 0.4 \cdot (1 - 0.4)^2 \\
&= 0.24 \\
\\
\text{Var}\left[Y\right]
&= \text{Pr}(Y = 0) \cdot (0 - \text{E}\left[Y\right])^2 +
\text{Pr}(Y = 1) \cdot (1 - \text{E}\left[Y\right])^2 \\
&= 0.5 \cdot (0- 0.5)^2 + 0.5 \cdot (1 - 0.5)^2 \\
&= 0.25
\end{align*}

<p>
Var[Y]が Var[\(Y \mid X = 0\)] と Var[\(Y \mid X = 1\)]よりも大きいのは、どちらの壺からボールを選ぶか決まっていない分不確実性が大きくなるから。
</p>
</div>
</div>
<div id="outline-container-org05dbca3" class="outline-5">
<h5 id="org05dbca3">d</h5>
<div class="outline-text-5" id="text-org05dbca3">
\begin{align*}
\text{Pr}(X = 0 \mid Y = 1)
&= \frac{\text{Pr}(Y = 1 \mid X = 0) \text{Pr}(X = 0)}{\text{Pr}(Y = 1)} \\
&= \frac{0.6 \cdot 0.5}{0.5} \\
&= 0.6
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-orgc38b86c" class="outline-3">
<h3 id="orgc38b86c">2.6</h3>
<div class="outline-text-3" id="text-orgc38b86c">
</div>
<div id="outline-container-org6029f09" class="outline-4">
<h4 id="org6029f09">Answer</h4>
<div class="outline-text-4" id="text-org6029f09">
<p>
\( A \perp B \mid C \)は、
</p>
\begin{equation}
\label{2.6condition}
\text{Pr}(A\cap B \mid C) = \text{Pr}(A \mid C) \text{Pr}(B \mid C)
\end{equation}
<p>
を満たすことを意味する。
</p>

<p>
また、
</p>
\begin{equation}
\label{2.6condition2}
\text{Pr}(B \mid C) = \text{Pr}(A \cap B \mid C) + \text{Pr}(A^c \cap B \mid C)
\end{equation}

<p>
より、
</p>
\begin{equation}
\label{2.6ans1}
    \begin{aligned}
    \text{Pr}(A^c \cap B \mid C)
    &= \text{Pr}(B \mid C) - \text{Pr}(A \cap B \mid C)
    \qquad  (\because \eqref{2.6condition2})\\
    &= \text{Pr}(B \mid C) - \text{Pr}(A \mid C) \text{Pr}(B \mid C)
    \qquad  (\because \eqref{2.6condition})\\
    &= \text{Pr}(B \mid C) \left(1 - \text{Pr}(A \mid C)\right) \\
    &= \text{Pr}(A^c \mid C) \text{Pr}(B \mid C) \\
    \end{aligned}
\end{equation}
<p>
これは、\( A^c \perp B \mid C \)を意味する。
</p>

<p>
同様に、
</p>
\begin{equation}
\label{2.6ans2}
    \begin{aligned}
        \text{Pr}(A \cap B^c \mid C)
        &= \text{Pr}(A \mid C) - \text{Pr}(A \cap B \mid C) \\
        &= \text{Pr}(A \mid C) - \text{Pr}(A \mid C) \text{Pr}(B \mid C)
        \qquad (\because \eqref{2.6condition})\\
        &= \text{Pr}(A \mid C) \left(1 - \text{Pr}(B \mid C)\right) \\
        &= \text{Pr}(A \mid C) \text{Pr}(B^c \mid C) \\
    \end{aligned}
\end{equation}
<p>
これは、\( A \perp B^c \mid C \)を意味する。
</p>

\begin{align*}
\text{Pr}(A^c \cap B^c \mid C)
&= \text{Pr}(A^c \mid C) - \text{Pr}(A^c \cap B \mid C) \\
&= \text{Pr}(A^c \mid C) - \text{Pr}(A^c \mid C) \text{Pr}(B \mid C)
\qquad (\because \eqref{2.6ans1})\\
&= \text{Pr}(A^c \mid C) \left(1 - \text{Pr}(B \mid C)\right) \\
&= \text{Pr}(A^c \mid C) \text{Pr}(B^c \mid C)
\end{align*}
<p>
これは、\( A^c \perp B^c \mid C \)を意味する。
</p>
</div>
</div>
</div>
<div id="outline-container-org6507454" class="outline-3">
<h3 id="org6507454">2.7</h3>
<div class="outline-text-3" id="text-org6507454">
</div>
<div id="outline-container-orgd8bd3b9" class="outline-4">
<h4 id="orgd8bd3b9">Answer</h4>
<div class="outline-text-4" id="text-orgd8bd3b9">
</div>
<div id="outline-container-orgeb916f4" class="outline-5">
<h5 id="orgeb916f4">a</h5>
<div class="outline-text-5" id="text-orgeb916f4">
<p>
もし\(p(E) > 1\)なら、収支は
\(E\)が起こると、\(1 - p(E) < 0\)、
E が起こらないと、\(-p(E) < 0 \)となる。
</p>

<p>
一方、\(p(E) \le 1\)のとき、収支は
\(E\)が起こると、\(1 - p(E) \ge 0 \)、
\(E\)が起こらないと、\( -p(E) \le 0\)となる。
</p>

<p>
よって、合理的な選択の結果は、\(p(E) \le 1\)となる。
</p>
</div>
</div>
<div id="outline-container-org6eefea9" class="outline-5">
<h5 id="org6eefea9">b</h5>
<div class="outline-text-5" id="text-org6eefea9">
<p>
\(p(E) \le 1\) を任意に固定する。このとき、参加者の収支は、
\(E\)が起こると、\(1 - p(E) \ge 0 \)、
\(E\)が起こらないと、\(-p(E) \le 0 \)となる。
</p>

<p>
ここで、新たに、\(E^c\)を誰かに支払い、もし\(E^c\)が起こった場合は$1 もらえるという賭けをするとき、参加者の収支は、
</p>
<ul class="org-ul">
<li>\(E\)が起こると、\(-p(E^c) \le 0 \)、</li>
<li>\(E\)が起こらないと、\(1 - p(E^c) \ge 0 \)となる。</li>
</ul>
<p>
以上より、1 つ目と 2 つ目の賭けの合計の収支は、
</p>
<ul class="org-ul">
<li>\(E\)が起こると、\(1 - p(E) - p(E^c)\)</li>
<li>\(E\)が起こらないと、\(-p(E) + 1 - p(E^c)\)となり、</li>
</ul>
<p>
どちらにしろ収支は\(1 - p(E) - p(E^c)\)。
</p>

<p>
合理的な人間は、収支がゼロになるギリギリのところまでなら参加するので、
\(1 - p(E) - p(E^c) = 0\)となる\( p(E^c) \)
すなわち、
\[p(E^c) = 1 - p(E)\]
が選択される。よって、
\[p(E) + p(E^c) = 1\]
\(p(E)\)は任意であったので、題意は示せた。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdaf6c76" class="outline-3">
<h3 id="orgdaf6c76">2.8</h3>
<div class="outline-text-3" id="text-orgdaf6c76">
</div>
<div id="outline-container-org7dde012" class="outline-4">
<h4 id="org7dde012">Answer</h4>
<div class="outline-text-4" id="text-org7dde012">
</div>
<div id="outline-container-org983f3c5" class="outline-5">
<h5 id="org983f3c5">a</h5>
<div class="outline-text-5" id="text-org983f3c5">
</div>
<div id="outline-container-org7865720" class="outline-6">
<h6 id="org7865720">i</h6>
<div class="outline-text-6" id="text-org7865720">
<p>
K を無限大に近づけたときの標本中のヒンズー教徒の割合。
(観測されたヒンズー教徒の人数を K で割ったもの)
</p>
</div>
</div>
<div id="outline-container-org1a578aa" class="outline-6">
<h6 id="org1a578aa">ii</h6>
<div class="outline-text-6" id="text-org1a578aa">
<p>
1 から K の中から x を無限回復元抽出したとき、xが 6452859 である割合。
</p>
</div>
</div>
<div id="outline-container-orga99810b" class="outline-6">
<h6 id="orga99810b">iii</h6>
<div class="outline-text-6" id="text-orga99810b">
<p>
1 から K の中から x を無限回復元抽出したときに
x が 6452859 であるという事象のうち、
x がヒンズー教徒である割合。
</p>
</div>
</div>
</div>
<div id="outline-container-orgafefe36" class="outline-5">
<h5 id="orgafefe36">b</h5>
<div class="outline-text-5" id="text-orgafefe36">
</div>
<div id="outline-container-orge5bc44e" class="outline-6">
<h6 id="orge5bc44e">i</h6>
<div class="outline-text-6" id="text-orge5bc44e">
\begin{align*}
&Pr(\theta, \text{the long-run relative frequency of heads, equals }1/3 ) \\
= &Pr(\theta | \text{the long-run relative frequency of heads, equals }1/3 ) \\
& \quad \times Pr(\text{the long-run relative frequency of heads, equals }1/3 )
\end{align*}
<p>
が成り立つ。よって、長期的にコイン投げを行った試行を無限個集める。そのサンプルのうち、相対頻度が 1/3 であり、なおかつ相対頻度が 1/3 サンプル内の相対頻度が\(\theta\)である割合。
</p>

<p>
(すなわち、\(\theta \neq \frac{1}{3}\)で \(0\)となる。 )
</p>
</div>
</div>
<div id="outline-container-orga5a4fc3" class="outline-6">
<h6 id="orga5a4fc3">ii</h6>
<div class="outline-text-6" id="text-orga5a4fc3">
<p>
コインを無限回投げたときの、表が出た割合。
</p>
</div>
</div>
<div id="outline-container-org43e7742" class="outline-6">
<h6 id="org43e7742">iii</h6>
<div class="outline-text-6" id="text-org43e7742">
<p>
i で\(\theta\)が 1/3 であったサンプルを m 個集めたとき、
m 個のサンプルのうち、
1 回目で表が出たサンプルの割合。
</p>
</div>
</div>
</div>
<div id="outline-container-orgf6087c7" class="outline-5">
<h5 id="orgf6087c7">c</h5>
<div class="outline-text-5" id="text-orgf6087c7">
<p>
コインを無限回投げたときの、表が出た割合。
(c-ii) と同じ。
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc2a5528" class="outline-2">
<h2 id="orgc2a5528">Chapter 3</h2>
<div class="outline-text-2" id="text-orgc2a5528">
</div>
<div id="outline-container-org86ca187" class="outline-3">
<h3 id="org86ca187">3.1</h3>
<div class="outline-text-3" id="text-org86ca187">
</div>
<div id="outline-container-org2e603ee" class="outline-4">
<h4 id="org2e603ee">a</h4>
<div class="outline-text-4" id="text-org2e603ee">
</div>
<div id="outline-container-org4c1c950" class="outline-5">
<h5 id="org4c1c950">Answer</h5>
<div class="outline-text-5" id="text-org4c1c950">
\begin{align*}
& \text{Pr}(Y_1 = y_1, \dots , Y_{100}=y_{100} \mid \theta) \\
= &\text{Pr}(Y_1 = y_1 \mid \theta) \cdot \text{Pr}(Y_2 = y_2 \mid \theta) \cdot \dots \cdot \text{Pr}(Y_{100} = y_{100} \mid \theta)
\qquad (\because \text{conditionally i.i.d.}) \\
= &\prod_{i=1}^{100} \text{Pr}(Y_i = y_i \mid \theta) \\
= &\theta^{\sum_{i=1}^{100} y_i} (1 - \theta)^{100 - \sum_{i=1}^{100} y_i}
\end{align*}

\begin{align*}
\text{Pr}\left(\sum Y_i = y \mid \theta\right)
&= \begin{pmatrix} 100 \\ y \end{pmatrix} \theta^y (1-\theta)^{100-y}
\end{align*}
</div>
</div>
</div>
<div id="outline-container-3.1B" class="outline-4">
<h4 id="3.1B">b</h4>
<div class="outline-text-4" id="text-3.1B">
</div>
<div id="outline-container-org28897d7" class="outline-5">
<h5 id="org28897d7">Answer</h5>
<div class="outline-text-5" id="text-org28897d7">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">begin</span>
<span style="color: #51afef;">using</span> Plots
<span style="color: #51afef;">using</span> Plots.PlotMeasures
<span style="color: #51afef;">using</span> Distributions

&#952; = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
n = <span style="color: #e69055; font-weight: bold;">100</span>
y = <span style="color: #e69055; font-weight: bold;">57</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">&#20840;&#12390;&#12398;&#952;&#12391;&#35336;&#31639;</span>
pdf_for_&#952;s = map<span style="color: #51afef;">(</span>&#952; <span style="color: #FCCE7B;">-&gt;</span> pdf<span style="color: #C57BDB;">(</span>Binomial<span style="color: #7bc275;">(</span>n, &#952;<span style="color: #7bc275;">)</span>, y<span style="color: #C57BDB;">)</span>, &#952;<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<pre class="example" id="orgde51505">
11-element Vector{Float64}:
 0.0
 4.107156919234531e-31
 3.7384586685675986e-16
 1.3068947992216428e-8
 0.000228579175709527
 0.03006864264421479
 0.06672894967432967
 0.0018531715480875613
 1.0035348574340773e-7
 9.39585764212832e-18
 0.0
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">plot</span>
bar<span style="color: #51afef;">(</span>
    &#952;, pdf_for_&#952;s,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = <span style="color: #7bc275;">"p(y|&#952;)"</span>,
    title = <span style="color: #7bc275;">"p(y=$y|&#952;) for each &#952;"</span>,
    label = <span style="color: #7bc275;">"p(y=$y|&#952;)"</span>,
    legend = <span style="color: #a991f1;">:topleft</span>,
    size = <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">600</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>
    , margin = <span style="color: #e69055; font-weight: bold;">5</span>mm
    , xticks = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org47b2c2e" class="figure">
<p><img src="fig/ch3/3.1bbar.jpg" alt="3.1bbar.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdaba0f2" class="outline-4">
<h4 id="orgdaba0f2">c</h4>
<div class="outline-text-4" id="text-orgdaba0f2">
</div>
<div id="outline-container-orge1f8200" class="outline-5">
<h5 id="orge1f8200">Answer</h5>
<div class="outline-text-5" id="text-orge1f8200">
\begin{align*}
p(\theta \mid \sum_{i=1}^{100} Y_i = 57)
&= \frac{p(\sum_{i=1}^{100} Y_i = 57 \mid \theta) p(\theta)}{p(\sum_{i=1}^{100} Y_i = 57)} \\
&= \frac{p(\sum_{i=1}^{100} Y_i = 57 \mid \theta) p(\theta)}{\sum_{\theta} p(\sum_{i=1}^{100} Y_i = 57 \mid \theta) p(\theta)} \\
&= \frac{\text{Pr}\left(\sum Y_i = 57 \mid \theta\right) p(\theta)}{\sum_{\theta} \text{Pr}\left(\sum Y_i = 57 \mid \theta\right) p(\theta)} \\
&= \frac{\text{Pr}\left(\sum Y_i = 57 \mid \theta\right) \frac{1}{11} }{\sum_{\theta} \text{Pr}\left(\sum Y_i = 57 \mid \theta\right) \frac{1}{11} } \\
&= \frac{\text{Pr}\left(\sum Y_i = 57 \mid \theta\right) }{\sum_{\theta} \text{Pr}\left(\sum Y_i = 57 \mid \theta\right) } \\
\end{align*}

<p>
<a href="#3.1B">b</a> で求めたものを使うと以下のように簡単に計算できる。
</p>


<div class="org-src-container">
<pre class="src src-julia">posterior_for_&#952;s = pdf_for_&#952;s <span style="color: #FCCE7B;">./</span> sum<span style="color: #51afef;">(</span>pdf_for_&#952;s<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org3e52c1e">
11-element Vector{Float64}:
 0.0
 4.153700946664936e-30
 3.780824452548815e-15
 1.3217050800508843e-7
 0.0023116953094392757
 0.30409393133068335
 0.6748515016170306
 0.018741724664998797
 1.0149073359758722e-6
 9.502335447682657e-17
 0.0
</pre>

<div class="org-src-container">
<pre class="src src-julia">bar<span style="color: #51afef;">(</span>
    &#952;, posterior_for_&#952;s,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = <span style="color: #7bc275;">"p(&#952;|y)"</span>,
    title = <span style="color: #7bc275;">"p(&#952;|y=$y) for each &#952;"</span>,
    label = <span style="color: #7bc275;">"p(&#952;|y=$y)"</span>,
    legend = <span style="color: #a991f1;">:topleft</span>,
    size = <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">600</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>
    , margin = <span style="color: #e69055; font-weight: bold;">5</span>mm
    , xticks = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
<span style="color: #51afef;">)</span>
</pre>
</div>



<div id="org9a717f6" class="figure">
<p><img src="fig/ch3/ex3.1cplot.jpg" alt="ex3.1cplot.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org76762cb" class="outline-4">
<h4 id="org76762cb">d</h4>
<div class="outline-text-4" id="text-org76762cb">
</div>
<div id="outline-container-org899dbda" class="outline-5">
<h5 id="org899dbda">Answer</h5>
<div class="outline-text-5" id="text-org899dbda">
\begin{align*}
p(\theta) \times \text{Pr}(\sum_{i=1}^n Y_i = 57 \mid \theta)
&= \text{Pr}(\sum_{i=1}^n Y_i = 57 \mid \theta)
\qquad (\because \text{Pr}(\theta) = 1) \\
&= \begin{pmatrix} 100 \\ 57 \end{pmatrix} \theta^{57} (1-\theta)^{43} \\
&= \text{dbinom}(57, 100, \theta)
\end{align*}

<p>
よって、以下のように計算できる。
</p>

<div class="org-src-container">
<pre class="src src-julia">posterior = x <span style="color: #FCCE7B;">-&gt;</span> pdf<span style="color: #51afef;">(</span>Binomial<span style="color: #C57BDB;">(</span>n, x<span style="color: #C57BDB;">)</span>, y<span style="color: #51afef;">)</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">plot</span>
xs = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.01</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
plot<span style="color: #51afef;">(</span>
    xs, posterior.<span style="color: #C57BDB;">(</span>xs<span style="color: #C57BDB;">)</span>,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = L<span style="color: #7bc275;">"p(\theta) \times Pr(\sum_{i=1}^n Y_i = 57 \mid \theta)"</span>,
    title = L<span style="color: #7bc275;">"p(\theta) \times Pr(\sum_{i=1}^n Y_i = 57 \mid \theta)"</span>,
    label = <span style="color: #7bc275;">"p(&#952;|y=$y)"</span>,
    legend = <span style="color: #a991f1;">:topleft</span>,
    size = <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">600</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>
    , margin = <span style="color: #e69055; font-weight: bold;">5</span>mm
    , xticks = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orge3bf240" class="figure">
<p><img src="fig/ch3/hoffexercise3.1dplot.jpg" alt="hoffexercise3.1dplot.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd6859ec" class="outline-4">
<h4 id="orgd6859ec">e</h4>
<div class="outline-text-4" id="text-orgd6859ec">
</div>
<div id="outline-container-org2093740" class="outline-5">
<h5 id="org2093740">Answer</h5>
<div class="outline-text-5" id="text-org2093740">
<div class="org-src-container">
<pre class="src src-julia">plot<span style="color: #51afef;">(</span>
    Beta<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">+</span>y, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">+</span>n<span style="color: #FCCE7B;">-</span>y<span style="color: #C57BDB;">)</span>,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = <span style="color: #7bc275;">"p(&#952;|y)"</span>,
    title = <span style="color: #7bc275;">"Beta(1+$y, 1+$n-$y)"</span>,
    label = <span style="color: #a991f1;">nothing</span>
    , size = <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">600</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>
    , margin = <span style="color: #e69055; font-weight: bold;">5</span>mm
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgfaa9777" class="figure">
<p><img src="fig/ch3/exercise3.1eplot.jpg" alt="exercise3.1eplot.jpg" width="500" />
</p>
</div>

<p>
d と e は同じ形状で、dを正規化したのが e。また、c, b のグラフは、パラメータ\(\theta\)を 11 個の値をとる離散変数として扱っているもので、同じ形状をしている。コードを見ればわかるように、それぞれの確率の和が 1 になるように正規化しているのが c である。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb2adb4d" class="outline-3">
<h3 id="orgb2adb4d">3.2</h3>
<div class="outline-text-3" id="text-orgb2adb4d">
</div>
<div id="outline-container-org4eaedcb" class="outline-4">
<h4 id="org4eaedcb">Answer</h4>
<div class="outline-text-4" id="text-org4eaedcb">
<div class="org-src-container">
<pre class="src src-julia">&#952;&#8320;_list = <span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">0.9</span>
n&#8320;_list = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">16</span>, <span style="color: #e69055; font-weight: bold;">32</span><span style="color: #51afef;">]</span>
n = <span style="color: #e69055; font-weight: bold;">100</span>
y = <span style="color: #e69055; font-weight: bold;">57</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">get_half_cdf</span><span style="color: #51afef;">(</span>&#952;&#8320;, n&#8320;<span style="color: #51afef;">)</span>
    postrior = Beta<span style="color: #51afef;">(</span>&#952;&#8320; <span style="color: #FCCE7B;">*</span> n&#8320; <span style="color: #FCCE7B;">+</span> y, <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> &#952;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> n&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">-</span> y<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> cdf<span style="color: #51afef;">(</span>postrior, <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

contour<span style="color: #51afef;">(</span>
    &#952;&#8320;_list, n&#8320;_list, <span style="color: #C57BDB;">(</span>&#952;&#8320;_list, n&#8320;_list<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-&gt;</span> get_half_cdf<span style="color: #C57BDB;">(</span>&#952;&#8320;_list, n&#8320;_list<span style="color: #C57BDB;">)</span>
    , clabels=<span style="color: #a991f1;">true</span>
    , xlabel=<span style="color: #7bc275;">"&#952;&#8320;"</span>, ylabel=<span style="color: #7bc275;">"n&#8320;"</span>
    , title = L<span style="color: #7bc275;">"Pr(\theta &gt; 0.5 | \sum Y_i = 57,)"</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orga760cc6" class="figure">
<p><img src="fig/ch3/exercise3.2contour.jpg" alt="exercise3.2contour.jpg" width="500" />
</p>
</div>

<p>
\(\theta_0\)は\(\theta\)に関する事前の信念、
\(n_0\)は\(\theta\)の事前の信念の強さを表している。
\(\theta_0\)が大きいほど、\(\theta > 0.5\)の事後確率も大きくなり、同じ\(\theta_0\)で比べた時は、だいたい\(\theta_0 < 0.5\)で\(n_0\)が大きいほど、\(\theta > 0.5\)の事後確率が小さくなり、
\(\theta_0 > 0.5\)で\(n_0\)が大きいほど、\(\theta > 0.5\)の事後確率が大きくなる。
</p>

<p>
よって、事前の知識などを参考にしながら、\(\theta_0\)はどれくらいか、またその信念の強さはどの程度なのかを考えたうえで、それに応じて上のプロットを見ながら\(\theta > 0.5\)の信念をアップデートすることができる。
</p>
</div>
</div>
</div>
<div id="outline-container-orged29c8b" class="outline-3">
<h3 id="orged29c8b">3.3</h3>
<div class="outline-text-3" id="text-orged29c8b">
</div>
<div id="outline-container-org603ec00" class="outline-4">
<h4 id="org603ec00">a)</h4>
<div class="outline-text-4" id="text-org603ec00">
</div>
<div id="outline-container-org60eae7d" class="outline-5">
<h5 id="org60eae7d">answer</h5>
<div class="outline-text-5" id="text-org60eae7d">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
y_A = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">12</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">12</span>, <span style="color: #e69055; font-weight: bold;">14</span>, <span style="color: #e69055; font-weight: bold;">13</span>, <span style="color: #e69055; font-weight: bold;">13</span>, <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">6</span><span style="color: #51afef;">]</span>
y_B = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">11</span>, <span style="color: #e69055; font-weight: bold;">11</span>, <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">7</span>, <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">6</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">7</span><span style="color: #51afef;">]</span>

n_A, sy_A = length<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span> , sum<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span>
n_B, sy_B = length<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span> , sum<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span>

a&#8320;_A = <span style="color: #e69055; font-weight: bold;">120</span>
b&#8320;_A = <span style="color: #e69055; font-weight: bold;">10</span>
a&#8320;_B = <span style="color: #e69055; font-weight: bold;">12</span>
b&#8320;_B = <span style="color: #e69055; font-weight: bold;">1</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_A = Gamma<span style="color: #51afef;">(</span>a&#8320;_A <span style="color: #FCCE7B;">+</span> sy_A, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320;_A <span style="color: #FCCE7B;">+</span> n_A<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_B = Gamma<span style="color: #51afef;">(</span>a&#8320;_B <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320;_B <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">mean_A = <span style="color: #51afef;">(</span>a&#8320;_A <span style="color: #FCCE7B;">+</span> sy_A<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>b&#8320;_A <span style="color: #FCCE7B;">+</span> n_A<span style="color: #51afef;">)</span>
mean_B = <span style="color: #51afef;">(</span>a&#8320;_B <span style="color: #FCCE7B;">+</span> sy_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>b&#8320;_B <span style="color: #FCCE7B;">+</span> n_B<span style="color: #51afef;">)</span>
<span style="color: #51afef;">[</span><span style="color: #7bc275;">"Posterior mean of A:  $mean_A"</span>
 , <span style="color: #7bc275;">"Posterior mean of B:  $mean_B"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Posterior mean of A:  11.85</td>
</tr>

<tr>
<td class="org-left">Posterior mean of B:  8.928571428571429</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia">var_A = <span style="color: #51afef;">(</span>a&#8320;_A <span style="color: #FCCE7B;">+</span> sy_A<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>b&#8320;_A <span style="color: #FCCE7B;">+</span> n_A<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>
var_B = <span style="color: #51afef;">(</span>a&#8320;_B <span style="color: #FCCE7B;">+</span> sy_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>b&#8320;_B <span style="color: #FCCE7B;">+</span> n_B<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>
<span style="color: #51afef;">[</span><span style="color: #7bc275;">"Posterior variance of A:  $var_A"</span>
 , <span style="color: #7bc275;">"Posterior variance of B:  $var_B"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Posterior variance of A:  0.5925</td>
</tr>

<tr>
<td class="org-left">Posterior variance of B:  0.6377551020408163</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">95% quantile-based confidence intervals</span>
quantile_A = quantile.<span style="color: #51afef;">(</span>dist_A, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile_B = quantile.<span style="color: #51afef;">(</span>dist_B, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">[</span><span style="color: #7bc275;">"Posterior 95% quantile of A:  $quantile_A"</span>
 , <span style="color: #7bc275;">"Posterior 95% quantile of B:  $quantile_B"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Posterior 95% quantile of A:  [10.389238190941795, 13.405448325642006]</td>
</tr>

<tr>
<td class="org-left">Posterior 95% quantile of B:  [7.432064219464302, 10.560308149242365]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orga1d706b" class="outline-4">
<h4 id="orga1d706b">b</h4>
<div class="outline-text-4" id="text-orga1d706b">
</div>
<div id="outline-container-orga6f39d0" class="outline-5">
<h5 id="orga6f39d0">answer</h5>
<div class="outline-text-5" id="text-orga6f39d0">
<div class="org-src-container">
<pre class="src src-julia">list_n&#8320; = <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">50</span>
exp_&#952;_B = n <span style="color: #FCCE7B;">-&gt;</span> <span style="color: #51afef;">(</span>a&#8320;_B<span style="color: #FCCE7B;">*</span>n <span style="color: #FCCE7B;">+</span> sy_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n <span style="color: #FCCE7B;">+</span> n_B <span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Plot</span>
plot<span style="color: #51afef;">(</span>
    list_n&#8320;, exp_&#952;_B.<span style="color: #C57BDB;">(</span>list_n&#8320;<span style="color: #C57BDB;">)</span>, label=<span style="color: #7bc275;">"Expected value of &#952;_B"</span>,
    xlabel=<span style="color: #7bc275;">"n&#8320;"</span>, ylabel=L<span style="color: #7bc275;">"\theta_B"</span>, legend=<span style="color: #a991f1;">nothing</span>,
    title=<span style="color: #7bc275;">"Expected value of &#952;_B as a function of n&#8320;"</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org8c234a8" class="figure">
<p><img src="fig/ch3/exercise3.3bplot.jpg" alt="exercise3.3bplot.jpg" width="500" />
</p>
</div>


<p>
\(n_0 = 35\)くらいで、\(\theta_B\)の期待値が\(\theta_A\)の期待値を上回る。この時の\(\theta_B\)の事前分布のプロットは以下の通り。
</p>

<div class="org-src-container">
<pre class="src src-julia">n = <span style="color: #e69055; font-weight: bold;">35</span>
plot<span style="color: #51afef;">(</span>
    Gamma<span style="color: #C57BDB;">(</span>a&#8320;_B<span style="color: #FCCE7B;">*</span>n <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span>n <span style="color: #FCCE7B;">+</span> n_B<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    , label=L<span style="color: #7bc275;">"Prior distribution of \theta_B when n_0 = $n"</span>
    , legend=<span style="color: #a991f1;">false</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgc656ea1" class="figure">
<p><img src="fig/ch3/exercise3.3b2plot.jpg" alt="exercise3.3b2plot.jpg" width="500" />
</p>
</div>

<p>
上の分布を見ればわかるように、
\(\theta_B\)の事後期待値が\(\theta_A\)の事後期待値と同じくらいになるためには、
\(\theta_B\)がかなりの確率で 11 の近くに分布しているという信念を反映した事前分布が必要。
</p>
</div>
</div>
</div>
<div id="outline-container-org2d6702c" class="outline-4">
<h4 id="org2d6702c">c</h4>
<div class="outline-text-4" id="text-org2d6702c">
</div>
<div id="outline-container-org1469400" class="outline-5">
<h5 id="org1469400">answer</h5>
<div class="outline-text-5" id="text-org1469400">
<p>
B 系統のマウスは A 系統のマウスと関連性があるとされているので、
A 系統のマウスについての腫瘍数の情報は B 系統のマウスについての腫瘍数の事前情報になり得る。よって、\(p(\theta_A, \theta_B) = p(\theta_A) \times p(\theta_B)\)という仮定は妥当ではなく、
B 系統のマウスと A 系統のマウスの関連の度合いに関する信念のパラメータ\(n_0\)を導入し、
\(p(\theta_B | \theta_A, n_0) = \text{gamma}(E[\theta_A] \times n_0, n_0)\)
などという形でモデル化するのが妥当であると考えられる。また、A系統のマウスに関するデータが観測されたあとに B 系統のマウスに関する推測を行う場合には、
\(\theta_B\)の事前期待値に\(\theta_A\)の事後期待値を用いるようなモデリングも可能。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org6042380" class="outline-3">
<h3 id="org6042380">3.4</h3>
<div class="outline-text-3" id="text-org6042380">
</div>
<div id="outline-container-orgc0355ef" class="outline-4">
<h4 id="orgc0355ef">a</h4>
<div class="outline-text-4" id="text-orgc0355ef">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> Plots
<span style="color: #51afef;">using</span> StatsPlots
<span style="color: #51afef;">using</span> LaTeXStrings
a&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
b&#8320; = <span style="color: #e69055; font-weight: bold;">8</span>
n = <span style="color: #e69055; font-weight: bold;">43</span>
y = <span style="color: #e69055; font-weight: bold;">15</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">prior</span>
plot<span style="color: #51afef;">(</span>
    Beta<span style="color: #C57BDB;">(</span>a&#8320;, b&#8320;<span style="color: #C57BDB;">)</span>,
    title=L<span style="color: #7bc275;">"p(\theta)"</span>,
    xlabel=L<span style="color: #7bc275;">"\theta"</span>,
    ylabel=L<span style="color: #7bc275;">"p(\theta)"</span>,
    legend=<span style="color: #a991f1;">false</span>,
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgbbc9a20" class="figure">
<p><img src="fig/ch3/exercise3.4aplot1.jpg" alt="exercise3.4aplot1.jpg" width="500" />
</p>
</div>

<p>
\(y \sim \text{binomial}(43, \theta)\)より、\(p(\theta \mid y)\)を\(\theta\)の関数としてプロットすると以下のようになる。
</p>

<div class="org-src-container">
<pre class="src src-julia">&#952; = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.01</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">&#20840;&#12390;&#12398;&#952;&#12391;&#35336;&#31639;</span>
pdf_for_&#952;s = map<span style="color: #51afef;">(</span>&#952; <span style="color: #FCCE7B;">-&gt;</span> pdf<span style="color: #C57BDB;">(</span>Binomial<span style="color: #7bc275;">(</span>n, &#952;<span style="color: #7bc275;">)</span>, y<span style="color: #C57BDB;">)</span>, &#952;<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">plot</span>
plot<span style="color: #51afef;">(</span>
    &#952;, pdf_for_&#952;s,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = <span style="color: #7bc275;">"p(y|&#952;)"</span>,
    title = <span style="color: #7bc275;">"p(y=$y|&#952;) as a function of &#952;"</span>,
    legend = <span style="color: #a991f1;">false</span>,
    size = <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">600</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>
    , margin = <span style="color: #e69055; font-weight: bold;">5</span>mm
    , xticks = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgf543dda" class="figure">
<p><img src="fig/ch3/exercise3.4aplot2.jpg" alt="exercise3.4aplot2.jpg" width="500" />
</p>
</div>

\begin{align*}
p(\theta \mid y)
&= \frac{1}{p(y)} p(y \mid \theta) p(\theta) \\
&= \frac{1}{p(y)} \begin{pmatrix} 43 \\ 15 \end{pmatrix} \theta^{15} (1-\theta)^{28} \frac{\Gamma(2+8)}{\Gamma(2)\Gamma(8)} \theta^{2-1} (1-\theta)^{8-1} \\
&= \frac{1}{p(y)} \begin{pmatrix} 43 \\ 15 \end{pmatrix}
\frac{\Gamma(2+8)}{\Gamma(2)\Gamma(8)} \theta^{17-1} (1-\theta)^{36-1} \\
&= const \times \theta^{17-1} (1-\theta)^{36-1} \\
&= dbeta(\theta, 17, 36)
\end{align*}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior</span>
posterior_dist = Beta<span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> y, b&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">-</span> y<span style="color: #51afef;">)</span>
plot<span style="color: #51afef;">(</span>
    posterior_dist,
    title=L<span style="color: #7bc275;">"p(\theta|y)"</span>,
    xlabel=L<span style="color: #7bc275;">"\theta"</span>,
    ylabel=L<span style="color: #7bc275;">"p(\theta|y)"</span>,
    legend=<span style="color: #a991f1;">false</span>,
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgf827620" class="figure">
<p><img src="fig/ch3/exercise3.4aposterior.jpg" alt="exercise3.4aposterior.jpg" width="500" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean</span>
mean<span style="color: #51afef;">(</span>posterior_dist<span style="color: #51afef;">)</span>
&#956; = <span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> y<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> b&#8320; <span style="color: #FCCE7B;">+</span> n<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.32075471698113206
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mode</span>
mode<span style="color: #51afef;">(</span>posterior_dist<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> y <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> b&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.3137254901960784
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior standard deviation</span>
std<span style="color: #51afef;">(</span>posterior_dist<span style="color: #51afef;">)</span>
var = <span style="color: #51afef;">(</span>&#956;<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> &#956;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> b&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
sqrt<span style="color: #51afef;">(</span>var<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.0635188989834093
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior 95% interval</span>
quantile<span style="color: #51afef;">(</span>posterior_dist, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">

2-element Vector{Float64}:
 0.2032977878191033
 0.45102398221663165
</pre>
</div>
</div>
<div id="outline-container-org927340a" class="outline-4">
<h4 id="org927340a">b</h4>
<div class="outline-text-4" id="text-org927340a">
<div class="org-src-container">
<pre class="src src-julia">a&#8320;_b = <span style="color: #e69055; font-weight: bold;">8</span>
b&#8320;_b = <span style="color: #e69055; font-weight: bold;">2</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">prior</span>
plot<span style="color: #51afef;">(</span>
    Beta<span style="color: #C57BDB;">(</span>a&#8320;_b, b&#8320;_b<span style="color: #C57BDB;">)</span>,
    title=L<span style="color: #7bc275;">"p(\theta)"</span>,
    xlabel=L<span style="color: #7bc275;">"\theta"</span>,
    ylabel=L<span style="color: #7bc275;">"p(\theta)"</span>,
    legend=<span style="color: #a991f1;">false</span>,
<span style="color: #51afef;">)</span>
</pre>
</div>



<div id="orgc5a03ef" class="figure">
<p><img src="fig/ch3/exercise3.4bprior.jpg" alt="exercise3.4bprior.jpg" width="500" />
</p>
</div>


\begin{align*}
p(\theta \mid y)
&= \frac{1}{p(y)} p(y \mid \theta) p(\theta) \\
&= \frac{1}{p(y)} \begin{pmatrix} 43 \\ 15 \end{pmatrix} \theta^{15} (1-\theta)^{28} \frac{\Gamma(2+8)}{\Gamma(2)\Gamma(8)} \theta^{8-1} (1-\theta)^{2-1} \\
&= \frac{1}{p(y)} \begin{pmatrix} 43 \\ 15 \end{pmatrix}
\frac{\Gamma(2+8)}{\Gamma(2)\Gamma(8)} \theta^{23-1} (1-\theta)^{30-1} \\
&= const \times \theta^{23-1} (1-\theta)^{30-1} \\
&= dbeta(\theta, 23, 30)
\end{align*}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior</span>
posterior_dist_b = Beta<span style="color: #51afef;">(</span>a&#8320;_b <span style="color: #FCCE7B;">+</span> y, b&#8320;_b <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">-</span> y<span style="color: #51afef;">)</span>
plot<span style="color: #51afef;">(</span>
    posterior_dist_b,
    title=L<span style="color: #7bc275;">"p(\theta|y)"</span>,
    xlabel=L<span style="color: #7bc275;">"\theta"</span>,
    ylabel=L<span style="color: #7bc275;">"p(\theta|y)"</span>,
    legend=<span style="color: #a991f1;">false</span>,
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgcd1c716" class="figure">
<p><img src="fig/ch3/exercise3.4bposterior.jpg" alt="exercise3.4bposterior.jpg" width="500" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean</span>
mean<span style="color: #51afef;">(</span>posterior_dist_b<span style="color: #51afef;">)</span>
&#956;_b = <span style="color: #51afef;">(</span>a&#8320;_b <span style="color: #FCCE7B;">+</span> y<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>a&#8320;_b <span style="color: #FCCE7B;">+</span> b&#8320;_b <span style="color: #FCCE7B;">+</span> n<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.4339622641509434
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mode</span>
mode<span style="color: #51afef;">(</span>posterior_dist_b<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>a&#8320;_b <span style="color: #FCCE7B;">+</span> y <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>a&#8320;_b <span style="color: #FCCE7B;">+</span> b&#8320;_b <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.43137254901960786
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior standard deviation</span>
std<span style="color: #51afef;">(</span>posterior_dist_b<span style="color: #51afef;">)</span>
var_b = <span style="color: #51afef;">(</span>&#956;_b<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> &#956;_b<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>a&#8320;_b <span style="color: #FCCE7B;">+</span> b&#8320;_b <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
sqrt<span style="color: #51afef;">(</span>var_b<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.06744531631926798
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior 95% interval</span>
quantile<span style="color: #51afef;">(</span>posterior_dist_b, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">

2-element Vector{Float64}:
 0.30469562471174694
 0.5679527959964581
</pre>
</div>
</div>
<div id="outline-container-org8c8db87" class="outline-4">
<h4 id="org8c8db87">c</h4>
<div class="outline-text-4" id="text-org8c8db87">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> SpecialFunctions
prior_mix = &#952; <span style="color: #FCCE7B;">-&gt;</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">//</span><span style="color: #e69055; font-weight: bold;">4</span> <span style="color: #FCCE7B;">*</span> gamma<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">10</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>gamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> gamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">8</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">3</span> <span style="color: #FCCE7B;">*</span> &#952; <span style="color: #FCCE7B;">*</span> <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> &#952;<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">7</span> <span style="color: #FCCE7B;">+</span> &#952;<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">7</span> <span style="color: #FCCE7B;">*</span> <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> &#952;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">xs = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.01</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
plot<span style="color: #51afef;">(</span>
    xs, prior_mix.<span style="color: #C57BDB;">(</span>xs<span style="color: #C57BDB;">)</span>,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = <span style="color: #7bc275;">"p(&#952;)"</span>,
    title = <span style="color: #7bc275;">"mixture of a beta(2,8) and a beta(8,2) prior distribution"</span>,
    titlefontsize = <span style="color: #e69055; font-weight: bold;">12</span>,
    legend = <span style="color: #a991f1;">false</span>,
    size = <span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">600</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>
    , margin = <span style="color: #e69055; font-weight: bold;">5</span>mm
    , xticks = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org4dacbbc" class="figure">
<p><img src="fig/ch3/exercise3.4cmixprior.jpg" alt="exercise3.4cmixprior.jpg" width="500" />
</p>
</div>

<p>
<a href="#orgc0355ef">a</a>や<a href="#org927340a">b</a>の事前分布と異なり、上の分布は 2 つの山を持った形状になっている。この事前分布は、再犯率は高いか低いかのどちらかに偏っているという信念を表している。
</p>
</div>
</div>
<div id="outline-container-org313131e" class="outline-4">
<h4 id="org313131e">d</h4>
<div class="outline-text-4" id="text-org313131e">
<p>
For the prior in c):
</p>
</div>
<div id="outline-container-orgc5bba0c" class="outline-5">
<h5 id="orgc5bba0c">i</h5>
<div class="outline-text-5" id="text-orgc5bba0c">
<p>
Write out mathematically \(p(\theta) \times p(y \mid \theta)\) and simplify as much as possible.
</p>

<p>
Answer:
</p>

\begin{align*}
p(\theta) \times p(y \mid \theta)
&= \frac{1}{4} \frac{\Gamma(10)}{\Gamma(2)\Gamma(8)} [3 \theta (1-\theta)^7 + \theta^7 (1-\theta)] \times \begin{pmatrix} 43 \\ 15 \end{pmatrix} \theta^{15} (1-\theta)^{28} \\
&= \frac{1}{4} \frac{\Gamma(10)}{\Gamma(2)\Gamma(8)} \begin{pmatrix} 43 \\ 15 \end{pmatrix} \left[3 \theta^{1+15} (1-\theta)^{7+28} + \theta^{7+15} (1-\theta)^{1+28}\right] \\
&= \frac{1}{4} \frac{\Gamma(10) \Gamma(44)}{\Gamma(2)\Gamma(8) \Gamma(16) \Gamma(29)} \left[3 \theta^{16} (1-\theta)^{35} + \theta^{22} (1-\theta)^{29}\right] \\
\end{align*}
</div>
</div>
<div id="outline-container-orgc0bea0e" class="outline-5">
<h5 id="orgc0bea0e">ii</h5>
<div class="outline-text-5" id="text-orgc0bea0e">
<p>
The posterior distribution is a mixture of two distributions you know.
Identify these distributions.
</p>

<p>
Answer:
</p>

<p>
Beta(17, 36) and Beta(23, 30)
</p>
</div>
</div>
<div id="outline-container-orgf61d625" class="outline-5">
<h5 id="orgf61d625">iii</h5>
<div class="outline-text-5" id="text-orgf61d625">
<p>
On a computer, calculate and plot \(p(\theta) \times p(y \mid \theta)\)
for a variety of \(\theta\) values.
Also find (approximately) the posterior mode, and discuss its relation to the modes in <a href="#orgc0355ef">a)</a> and <a href="#org927340a">b)</a>.
</p>

<p>
Answer:
</p>

<div class="org-src-container">
<pre class="src src-julia">cond_prob = &#952; <span style="color: #FCCE7B;">-&gt;</span> pdf<span style="color: #51afef;">(</span>Binomial<span style="color: #C57BDB;">(</span>n, &#952;<span style="color: #C57BDB;">)</span>, y<span style="color: #51afef;">)</span>
prior_times_cond_prob = &#952; <span style="color: #FCCE7B;">-&gt;</span> prior_mix<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> cond_prob<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
xs = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.001</span>:<span style="color: #e69055; font-weight: bold;">1.0</span>
plot<span style="color: #51afef;">(</span>
    xs, prior_times_cond_prob.<span style="color: #C57BDB;">(</span>xs<span style="color: #C57BDB;">)</span>,
    xlabel = <span style="color: #7bc275;">"&#952;"</span>, ylabel = <span style="color: #7bc275;">"p(&#952;) &#215; p(&#952;|y)"</span>,
    title = <span style="color: #7bc275;">"p(&#952;) &#215; p(&#952;|y)"</span>,
    legend = <span style="color: #a991f1;">false</span>,
<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org200ed41" class="figure">
<p><img src="fig/ch3/exercise3.4diiiplot.jpg" alt="exercise3.4diiiplot.jpg" width="500" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">prior_times_cond_prob&#12364;&#26368;&#22823;&#12395;&#12394;&#12427;&#952;</span>
xs<span style="color: #51afef;">[</span>argmax<span style="color: #C57BDB;">(</span>prior_times_cond_prob.<span style="color: #7bc275;">(</span>xs<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span>
</pre>
</div>

<p>
<a href="#orgc0355ef">a)</a> の mode が 0.313,<a href="#org927340a">b)</a>の mode が 0.431 であったので、この事後 mode はその中間（かなり a より)に位置している。
</p>
</div>
</div>
</div>
<div id="outline-container-orgb8aa502" class="outline-4">
<h4 id="orgb8aa502">e</h4>
<div class="outline-text-4" id="text-orgb8aa502">
<p>
Find a general formula for the weights of the mixture distribution in <a href="#orgc0bea0e">d)ii</a>,
and provide an interpretation for their values.
</p>

<p>
Answer:
</p>

<p>
\(n ,y\)一般に対し、事後分布は
</p>

\begin{align*}
p(\theta \mid y)
&= \frac{p(y \mid \theta) p(\theta)}{p(y)} \\
& \propto p(y \mid \theta) p(\theta) \\
&= \begin{pmatrix} n \\ y \end{pmatrix} \theta^y (1-\theta)^{n-y} \times
\frac{1}{4} \frac{\Gamma(10)}{\Gamma(2)\Gamma(8)} \left[3 \theta (1-\theta)^7 + \theta^7 (1-\theta)\right] \\
& \propto 3 \theta^{y+1} (1-\theta)^{n-y+7} + \theta^{y+7} (1-\theta)^{n-y+1} \\
& \propto \frac{3}{4} \theta^{y+2-1} (1-\theta)^{n-y+8-1} + \frac{1}{4} \theta^{y+8-1} (1-\theta)^{n-y+2-1} \\
&= \frac{3}{4} \text{dbeta}(y+2, n-y+8) + \frac{1}{4} \text{dbeta}(y+8, n-y+2)
\end{align*}

<p>
となる。よって事後分布は、Beta(y+2, n-y+8) と Beta(y+8, n-y+2)を 3 対 1 の重みをつけて混合させたものが事後分布となる。
</p>
</div>
</div>
</div>
<div id="outline-container-orge62e52b" class="outline-3">
<h3 id="orge62e52b">3.5</h3>
<div class="outline-text-3" id="text-orge62e52b">
</div>
<div id="outline-container-org1408e9a" class="outline-4">
<h4 id="org1408e9a">Answer</h4>
<div class="outline-text-4" id="text-org1408e9a">
</div>
<div id="outline-container-orgaf99fc6" class="outline-5">
<h5 id="orgaf99fc6">a)</h5>
<div class="outline-text-5" id="text-orgaf99fc6">
\begin{align*}
p(\theta \mid y_1, \dots, y_n)
&\propto \tilde{p}(\theta) p(y_1, \dots, y_n \mid \theta) \\
&= \sum_{k=1}^K w_k p_k(\theta \mid n_k, n_k t_k) \prod_{i=1}^n p(y_i \mid \theta) \\
&= \sum_{k=1}^K w_k \kappa_k(n_k, t_k) c(\theta)^{n_k} e^{n_k t_k \theta} \times \prod_{i=1}^n c(\theta) h(y_i) \exp \{\theta t(y_i)\} \\
&= \sum_{k=1}^K w_k \kappa_k(n_k, t_k) c(\theta)^{n_k} e^{n_k t_k \theta} \times \left( c(\theta)^n \times \prod_{i=1}^n h(y_i) \times \exp \{\theta \sum_{i=1}^n t(y_i)\} \right) \\
&\propto \sum_{k=1}^K w_k \kappa_k(n_k, t_k) c(\theta)^{n_k} e^{n_k t_k \theta} \times \left( c(\theta)^n \times \exp \{\theta \sum_{i=1}^n t(y_i)\} \right) \\
&= \sum_{k=1}^K w_k \kappa_k(n_k, t_k) c(\theta)^{n_k + n} \exp \left\{ \theta \times \left[ n_k t_k + \sum_{i=1}^n t(y_i) \right] \right\} \\
&\propto \sum_{k=1}^K w_k p_k (\theta \mid n_k + n, \frac{n_k t_k + n \bar{t}(\boldsymbol{y})}{n_k + n})
\end{align*}

<p>
where \(\bar{t}(\boldsymbol{y}) = \frac{\sum t(y_i)}{n}\)
</p>
</div>
</div>
<div id="outline-container-org70463ad" class="outline-5">
<h5 id="org70463ad">b)</h5>
<div class="outline-text-5" id="text-org70463ad">
\begin{align*}
p(\theta \mid y_1, \dots, y_n)
&\propto \tilde{p}(\theta) p(y_1, \dots, y_n \mid \theta) \\
&= \sum_{k=1}^K w_k p_k(\theta \mid a_k, b_k) \times \prod_{i=1}^n p(y_i \mid \theta) \\
&= \sum_{k=1}^K w_k \frac{b_k^{a_k}}{\Gamma(a_k)} \theta^{a_k-1}
\exp \left( - b_k \theta \right)
\times \prod_{i=1}^n \frac{\theta^{y_i} e^{- \theta } }{y_i!} \\
&\propto \sum_{k=1}^K w_k \frac{b_k^{a_k}}{\Gamma(a_k)} \theta^{a_k-1}
\exp \left( - b_k \theta \right)
\times \theta^{\sum_{i=1}^n y_i} \exp \left( - n \theta \right) \\
&= \sum_{k=1}^K w_k \frac{b_k^{a_k}}{\Gamma(a_k)} \theta^{a_k + \sum y_i - 1}
\exp \left( - (b_k + n) \theta \right) \\
&\propto \sum_{k=1}^K w_k \text{dgamma}(\theta \mid a_k + \sum y_i, b_k + n)
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-orgf81e038" class="outline-3">
<h3 id="orgf81e038">3.6</h3>
<div class="outline-text-3" id="text-orgf81e038">
</div>
<div id="outline-container-orgff185be" class="outline-4">
<h4 id="orgff185be">Answer</h4>
<div class="outline-text-4" id="text-orgff185be">
</div>
<div id="outline-container-org3dc009e" class="outline-5">
<h5 id="org3dc009e">a)</h5>
<div class="outline-text-5" id="text-org3dc009e">
<p>
\( \int p(y \mid \theta) dy = 1 \) の両辺を \(\phi\) で微分すると左辺は、
</p>
\begin{align*}
\frac{d}{d \phi } \int p(y \mid \theta) dy
&= \int \frac{d}{d \phi } p(y \mid \theta) dy \\
&= \int \frac{d}{d \phi } c(\phi) h(y) \exp\{\phi t(y) \} dy \\
&= \int h(y) \left( c(\phi) \frac{d \exp \{\phi t(y) \} }{ d \phi } +
\frac{d c(\phi)}{d \phi } \exp \{\phi t(y) \} \right) dy \\
&= \int h(y) \left( c(\phi) t(y) \exp \{\phi t(y) \} +
c'(\phi) \exp \{\phi t(y) \} \right) dy \\
&= \int h(y) c(\phi) t(y) \exp \{\phi t(y) \} dy + \int h(y) c'(\phi) \exp \{\phi t(y) \} dy \\
&= E[ t(y) \mid \phi] +
\frac{c'(\phi)}{c(\phi)} \int c(\phi) h(y) \exp \{\phi t(y) \} dy \\
&\quad (\because c(\phi) \neq 0 \text{ because } p(y \mid \theta) \text{ is a probability density}) \\
&= E[ t(y) \mid \phi] + \frac{c'(\phi)}{c(\phi)} \int p(y \mid \theta) dy \\
&= E[ t(y) \mid \phi] + \frac{c'(\phi)}{c(\phi)} \\
\end{align*}

<p>
右辺は 0 なので、
\[ E[ t(y) \mid \phi] = - \frac{c'(\phi)}{c(\phi)} \]
</p>
</div>
</div>
<div id="outline-container-org0f39ec9" class="outline-5">
<h5 id="org0f39ec9">b)</h5>
<div class="outline-text-5" id="text-org0f39ec9">
\begin{align*}
\frac{d p(\phi)}{d \phi}
&= \frac{d}{d \phi} \left( \kappa(n_0, t_0) c(\phi)^{n_0} \exp \{ n_0 t_0 \phi \} \right) \\
&= \kappa(n_0, t_0) \left(
\frac{d \ c(\phi)^{n_0} }{d \phi}  \exp \{ n_0 t_0 \phi \} +
c(\phi)^{n_0} \frac{d}{d \phi} \exp \{ n_0 t_0 \phi \} \right)  \\
&= \kappa(n_0, t_0) \left(
n_0 c(\phi)^{n_0 - 1} c'(\phi) \exp \{ n_0 t_0 \phi \} +
c(\phi)^{n_0} n_0 t_0 \exp \{ n_0 t_0 \phi \} \right) \\
&= \frac{c'(\phi)}{c(\phi)} n_0  \kappa(n_0, t_0) c(\phi)^{n_0} \exp \{ n_0 t_0 \phi \} +
n_0 t_0 \kappa(n_0, t_0) c(\phi)^{n_0} \exp \{ n_0 t_0 \phi \} \\
&= \frac{c'(\phi)}{c(\phi)} n_0 p(\phi) + n_0 t_0 p(\phi) \\
\end{align*}

<p>
ここで、両辺を \(\phi\)について積分すると左辺は
</p>
\begin{align*}
\int \frac{d p(\phi)}{d \phi} d \phi
&= \frac{d}{d \phi} \int p(\phi) d \phi \\
&= \frac{d}{d \phi} 1 \\
&= 0 \\
\end{align*}

<p>
右辺は
</p>
\begin{align*}
n_0 \int \frac{c'(\phi)}{c(\phi)} p(\phi) d \phi + n_0 t_0 \int p(\phi) d \phi
& = n_0 E \left[ \frac{c'(\phi)}{c(\phi)} \right] + n_0 t_0
\end{align*}

<p>
以上より、
\[ E \left[- \frac{c'(\phi)}{c(\phi)} \right] = t_0 \]
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga423bb2" class="outline-3">
<h3 id="orga423bb2">3.7</h3>
<div class="outline-text-3" id="text-orga423bb2">
</div>
<div id="outline-container-orgcff452b" class="outline-4">
<h4 id="orgcff452b">answer: a)</h4>
<div class="outline-text-4" id="text-orgcff452b">
<p>
事前分布は一様分布 Beta(1, 1)より、事後分布は Beta(3, 14)となる。
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">begin</span>
a, b = <span style="color: #e69055; font-weight: bold;">1</span> , <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">prior parameters</span>
n&#8321;, y&#8321; = <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">data</span>
mean = <span style="color: #51afef;">(</span>a <span style="color: #FCCE7B;">+</span> y&#8321;<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>a <span style="color: #FCCE7B;">+</span> b <span style="color: #FCCE7B;">+</span> n&#8321;<span style="color: #51afef;">)</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean</span>
<span style="color: #7bc275;">"Posterior mean :  $mean"</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<pre class="example">
Posterior mean :  0.17647058823529413
</pre>


<div class="org-src-container">
<pre class="src src-julia">mode = <span style="color: #51afef;">(</span>a <span style="color: #FCCE7B;">+</span> y&#8321; <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>a <span style="color: #FCCE7B;">+</span> b <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mode</span>
<span style="color: #7bc275;">"Posterior mode :  $mode"</span>
</pre>
</div>

<pre class="example">
Posterior mode :  0.13333333333333333
</pre>


<div class="org-src-container">
<pre class="src src-julia">var = mean <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> mean<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>a <span style="color: #FCCE7B;">+</span> b <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">posterior variance</span>
std = sqrt<span style="color: #51afef;">(</span>var<span style="color: #51afef;">)</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">posterior standard deviation</span>
<span style="color: #7bc275;">"Posterior standard deviation :  $std"</span>
</pre>
</div>

<pre class="example">
Posterior standard deviation :  0.08985442539129099
</pre>



<div id="org05078cf" class="figure">
<p><img src="fig/ch3/exercise3.7aposteriorplot.jpg" alt="exercise3.7aposteriorplot.jpg" width="500" />
</p>
</div>
</div>
</div>
<div id="outline-container-org94e577c" class="outline-4">
<h4 id="org94e577c">b)</h4>
<div class="outline-text-4" id="text-org94e577c">
</div>
<div id="outline-container-orgf056207" class="outline-5">
<h5 id="orgf056207">answer: b) i.</h5>
<div class="outline-text-5" id="text-orgf056207">
\begin{equation}
\label{org433564e}
\text{Pr}\left(Y_1 \in A_1, Y_2 \in A_2 \mid \theta \right)
= \text{Pr}\left(Y_1 \in A_1 \mid \theta \right) \text{Pr}\left(Y_2 \in A_2 \mid \theta \right)
\end{equation}

<p>
Proof:
</p>

\begin{align*}
\text{Pr}\left( Y_2 = y_2 \mid Y_1 = 2 \right)
&= \int_0^1 \text{Pr}\left( Y_2 = y_2, \theta \mid Y_1 = 2 \right) d \theta \\
&= \int_0^1 \text{Pr}\left( Y_2 = y_2 \mid \theta , Y_1 = 2 \right) \text{Pr}\left( \theta \mid Y_1 = 2 \right) d \theta \\
\end{align*}

<p>
より、等式が成り立つための条件は、
</p>

\begin{align*}
& \text{Pr}\left( Y_2 = y_2, \mid \theta,  Y_1 = 2 \right)
= \text{Pr}\left( Y_2 = y_2 \mid \theta \right) \\
\Leftrightarrow \quad
&\text{Pr}\left(Y_1 = 2 \mid \theta \right) \text{Pr}\left(Y_2 = y_2 \mid \theta ,  Y_1 = 2\right)
= \text{Pr}\left(Y_1 = 2 \mid \theta \right) \text{Pr}\left(Y_2 = y_2 \mid \theta \right) \\
\Leftrightarrow \quad
&\text{Pr}\left(Y_1 = 2 , Y_2 = y_2 \mid \theta \right)
= \text{Pr}\left(Y_1 = 2 \mid \theta \right) \text{Pr}\left(Y_2 = y_2 \mid \theta \right)
\end{align*}

<p>
これを\((Y_1, Y_2)\)の同時分布について一般化すると、(\eqref{org433564e})が導かれる。
</p>
</div>
</div>
<div id="outline-container-org03391cc" class="outline-5">
<h5 id="org03391cc">answer: b) ii.</h5>
<div class="outline-text-5" id="text-org03391cc">
\begin{align*}
\text{Pr}\left( Y_2 = y_2 \mid Y_1 = 2 \right)
&= \int_0^1 \text{Pr}\left( Y_2 = y_2 \mid \theta \right) p(\theta \mid Y_1 = 2) d \theta \\
&= \int_0^1 \begin{pmatrix} 278 \\ y_2 \end{pmatrix} \theta^{y_2} (1 - \theta)^{278 - y_2} \frac{\Gamma(3 + 14)}{\Gamma(3) \Gamma(14)} \theta^2 (1 - \theta)^{13} d \theta \\
&= \frac{\Gamma(3 + 14)}{\Gamma(3) \Gamma(14)} \begin{pmatrix} 278 \\ y_2 \end{pmatrix}
\int_0^1 \theta^{y_2 + 3 - 1} (1 - \theta)^{292 - y_2 - 1} d \theta \\
\end{align*}
</div>
</div>
<div id="outline-container-org209ecef" class="outline-5">
<h5 id="org209ecef">answer: b) iii.</h5>
<div class="outline-text-5" id="text-org209ecef">
\begin{align*}
\int_0^1 \theta^{y_2 + 3 - 1} (1 - \theta)^{292 - y_2 - 1} d \theta
&= \frac{\Gamma(y_2 + 3) \Gamma(292 - y_2)}{\Gamma((y_2 + 3) + (292-y_2) )}  \\
&= \frac{\Gamma(y_2 + 3) \Gamma(292 - y_2)}{\Gamma(295)} \\
\end{align*}
<p>
より、
</p>
\begin{align*}
\text{Pr}\left( Y_2 = y_2 \mid Y_1 = 2 \right)
&= \frac{\Gamma(3 + 14)}{\Gamma(3) \Gamma(14)} \begin{pmatrix} 278 \\ y_2 \end{pmatrix}
\frac{\Gamma(y_2 + 3) \Gamma(292 - y_2)}{\Gamma(295)} \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orgb9b151a" class="outline-4">
<h4 id="orgb9b151a">c)</h4>
<div class="outline-text-4" id="text-orgb9b151a">
</div>
<div id="outline-container-org75d4ef6" class="outline-5">
<h5 id="org75d4ef6">answer</h5>
<div class="outline-text-5" id="text-org75d4ef6">
<p>
<a href="#org209ecef">b)iiiの答え</a>に\(y_2 = 0, 1, \dots\) を代入することもできるが、
</p>

\begin{align*}
\text{Pr}\left( Y_2 = y_2 \mid Y_1 = 2 \right)
&= \frac{\Gamma(3 + 14)}{\Gamma(3) \Gamma(14)} \begin{pmatrix} 278 \\ y_2 \end{pmatrix}
\frac{\Gamma(y_2 + 3) \Gamma(292 - y_2)}{\Gamma(295)} \\
&= \begin{pmatrix} 278 \\ y_2 \end{pmatrix} \frac{B(y_2 + 3, 292 - y_2)}{B(3, 14)} \\
&= \begin{pmatrix} 278 \\ y_2 \end{pmatrix} \frac{B(y_2 + 3, 278 - y_2 + 14)}{B(3, 14)} \\
&= \text{dbetabinomial}(y_2, 278, 3, 14)
\end{align*}

<p>
より、
\(y_2\)はベータ二項分布に従うことがわかる。これを利用してプロットすると、以下のようになる。
</p>

<div class="org-src-container">
<pre class="src src-julia">n&#8322; = <span style="color: #e69055; font-weight: bold;">278</span>
plot<span style="color: #51afef;">(</span>BetaBinomial<span style="color: #C57BDB;">(</span>n&#8322;, a <span style="color: #FCCE7B;">+</span> y&#8321;, a <span style="color: #FCCE7B;">+</span> b <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span> y&#8321;<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">278</span>, label=<span style="color: #a991f1;">nothing</span><span style="color: #51afef;">)</span>
xlabel!<span style="color: #51afef;">(</span><span style="color: #7bc275;">"y&#8322;"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgf43d2e7" class="figure">
<p><img src="fig/ch3/3.7cbetabinomial.jpg" alt="3.7cbetabinomial.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org111351e" class="outline-4">
<h4 id="org111351e">d)</h4>
<div class="outline-text-4" id="text-org111351e">
</div>
<div id="outline-container-org00e46b1" class="outline-5">
<h5 id="org00e46b1">answer:</h5>
<div class="outline-text-5" id="text-org00e46b1">
<div class="org-src-container">
<pre class="src src-julia">&#952;&#770; = <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">//</span> <span style="color: #e69055; font-weight: bold;">15</span>
plot<span style="color: #51afef;">(</span>Binomial<span style="color: #C57BDB;">(</span>n&#8322;, &#952;&#770;<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">278</span>, label=<span style="color: #a991f1;">nothing</span>, xlabel=<span style="color: #7bc275;">"y&#8322;"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org0adc0bb" class="figure">
<p><img src="fig/ch3/exercise3.7dbinomial.jpg" alt="exercise3.7dbinomial.jpg" width="500" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia">mean2 = n&#8322; <span style="color: #FCCE7B;">*</span> &#952;&#770;
var2 = n&#8322; <span style="color: #FCCE7B;">*</span> &#952;&#770; <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> &#952;&#770;<span style="color: #51afef;">)</span>
std2 = sqrt<span style="color: #51afef;">(</span>var2<span style="color: #51afef;">)</span>
<span style="color: #7bc275;">"mean: $mean2, std: $std2"</span>
</pre>
</div>

<pre class="example">
mean: 37.06666666666666, std: 5.667843015155276
</pre>



<p>
<a href="#orgb9b151a">c)</a> との比較:
</p>

<p>
mode は <a href="#orgb9b151a">c)</a> が 34, で上の分布が 37 と、かなり近いが、cの分布の方がかなり裾の広い分布（分散が大きい分布）となっていることがわかる。これは、1回目のデータが得られたあとの\(\theta\)の事後分布の不確実性が c)の分布に反映されているためである。逆に、上の分布には 1 回目のデータのサンプルサイズ（データの妥当性）が反映されていないため、予測には c の分布を使うのがよいと考えられる。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org77f5c75" class="outline-3">
<h3 id="org77f5c75">3.8</h3>
<div class="outline-text-3" id="text-org77f5c75">
</div>
<div id="outline-container-org5c766b3" class="outline-4">
<h4 id="org5c766b3">a)</h4>
<div class="outline-text-4" id="text-org5c766b3">
</div>
<div id="outline-container-org5a071aa" class="outline-5">
<h5 id="org5a071aa">answer</h5>
<div class="outline-text-5" id="text-org5a071aa">
<div class="org-src-container">
<pre class="src src-julia">a&#8320;_sym, b&#8320;_sym = <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">15</span>
sym = Beta<span style="color: #51afef;">(</span>a&#8320;_sym, b&#8320;_sym<span style="color: #51afef;">)</span>
a&#8320;_asym, b&#8320;_asym = <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">20</span>
asym = Beta<span style="color: #51afef;">(</span>a&#8320;_asym, b&#8320;_asym<span style="color: #51afef;">)</span>
plot<span style="color: #51afef;">(</span>sym, <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.01</span>:<span style="color: #e69055; font-weight: bold;">1</span>, label=<span style="color: #7bc275;">"symmetric"</span><span style="color: #51afef;">)</span>
plot!<span style="color: #51afef;">(</span>asym, <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">0.01</span>:<span style="color: #e69055; font-weight: bold;">1</span>, label=<span style="color: #7bc275;">"asymmetric"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org1b3f53d" class="figure">
<p><img src="fig/ch3/exercise3.8apriors.jpg" alt="exercise3.8apriors.jpg" width="500" />
</p>
</div>

<p>
上の mixture model は、以下のようになる。
</p>
<div class="org-src-container">
<pre class="src src-julia">mm = MixtureModel<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span>sym, asym<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.2</span>, <span style="color: #e69055; font-weight: bold;">0.8</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
histogram<span style="color: #51afef;">(</span>rand<span style="color: #C57BDB;">(</span>mm, <span style="color: #e69055; font-weight: bold;">100000</span><span style="color: #C57BDB;">)</span>, label=<span style="color: #7bc275;">"mixture model prior"</span>, bins=<span style="color: #e69055; font-weight: bold;">100</span>, normalize=<span style="color: #a991f1;">:pdf</span>, xlabel=<span style="color: #7bc275;">"&#952;"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgdbc8d01" class="figure">
<p><img src="fig/ch3/exercise3.8amixturemodelprior.jpg" alt="exercise3.8amixturemodelprior.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org4d91f9b" class="outline-4">
<h4 id="org4d91f9b">b)</h4>
<div class="outline-text-4" id="text-org4d91f9b">
</div>
<div id="outline-container-org2c0e72d" class="outline-5">
<h5 id="org2c0e72d">answer</h5>
<div class="outline-text-5" id="text-org2c0e72d">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">num</th>
<th scope="col" class="org-right">front</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">23</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">24</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">25</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">26</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">27</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">28</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">29</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">30</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">31</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">32</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">33</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">34</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">35</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">36</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">37</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">38</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">39</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">40</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">41</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">42</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">43</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">44</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">45</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">46</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">47</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">48</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">49</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">50</td>
<td class="org-right">1</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">Total</td>
<td class="org-right">23</td>
</tr>
</tbody>
</table>

<p>
平成 26 年 100 円玉
</p>
</div>
</div>
</div>
<div id="outline-container-org8281834" class="outline-4">
<h4 id="org8281834">c)</h4>
<div class="outline-text-4" id="text-org8281834">
</div>
<div id="outline-container-org9d292f2" class="outline-5">
<h5 id="org9d292f2">answer</h5>
<div class="outline-text-5" id="text-org9d292f2">
<div class="org-src-container">
<pre class="src src-julia">y&#8321;, n&#8321; = <span style="color: #e69055; font-weight: bold;">23</span> , <span style="color: #e69055; font-weight: bold;">50</span>
sym&#8321; = Beta<span style="color: #51afef;">(</span>a&#8320;_sym <span style="color: #FCCE7B;">+</span> y&#8321;, b&#8320;_sym <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span> y&#8321;<span style="color: #51afef;">)</span>
asym&#8321; = Beta<span style="color: #51afef;">(</span>a&#8320;_asym <span style="color: #FCCE7B;">+</span> y&#8321;, b&#8320;_asym <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span> y&#8321;<span style="color: #51afef;">)</span>
mm&#8321; = MixtureModel<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span>sym&#8321;, asym&#8321;<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.2</span>, <span style="color: #e69055; font-weight: bold;">0.8</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
histogram<span style="color: #51afef;">(</span>rand<span style="color: #C57BDB;">(</span>mm&#8321;, <span style="color: #e69055; font-weight: bold;">100000</span><span style="color: #C57BDB;">)</span>, label=<span style="color: #7bc275;">"posterior distribution"</span>, bins=<span style="color: #e69055; font-weight: bold;">100</span>, normalize=<span style="color: #a991f1;">:pdf</span>, xlabel=<span style="color: #7bc275;">"&#952;"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgff78c1f" class="figure">
<p><img src="fig/ch3/exercise3.8cposterior.jpg" alt="exercise3.8cposterior.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org8cc0f84" class="outline-4">
<h4 id="org8cc0f84">d)</h4>
<div class="outline-text-4" id="text-org8cc0f84">
</div>
<div id="outline-container-org7eba844" class="outline-5">
<h5 id="org7eba844">answer</h5>
<div class="outline-text-5" id="text-org7eba844">
<p>
今回は、令和元年 100 円玉を使う。
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">num</th>
<th scope="col" class="org-right">front</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">23</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">24</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">25</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">26</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">27</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">28</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">29</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">30</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">31</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">32</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">33</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">34</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">35</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">36</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">37</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">38</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">39</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">40</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">41</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">42</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">43</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">44</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">45</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">46</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">47</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">48</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">49</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">50</td>
<td class="org-right">1</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">Total</td>
<td class="org-right">20</td>
</tr>
</tbody>
</table>

<p>
同じ 100 円玉なので、 <a href="#org8281834">c)</a> で得た事後分布を事前分布として用いると、事後分布は以下のようになる。
</p>

<div class="org-src-container">
<pre class="src src-julia">n&#8322;, y&#8322; = <span style="color: #e69055; font-weight: bold;">50</span>, <span style="color: #e69055; font-weight: bold;">20</span>
sym&#8322; = Beta<span style="color: #51afef;">(</span>a&#8320;_sym <span style="color: #FCCE7B;">+</span> y&#8321; <span style="color: #FCCE7B;">+</span> y&#8322;, b&#8320;_sym <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span> y&#8321; <span style="color: #FCCE7B;">+</span> n&#8322; <span style="color: #FCCE7B;">-</span> y&#8322;<span style="color: #51afef;">)</span>
asym&#8322; = Beta<span style="color: #51afef;">(</span>a&#8320;_asym <span style="color: #FCCE7B;">+</span> y&#8321; <span style="color: #FCCE7B;">+</span> y&#8322;, b&#8320;_asym <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span> y&#8321; <span style="color: #FCCE7B;">+</span> n&#8322; <span style="color: #FCCE7B;">-</span> y&#8322;<span style="color: #51afef;">)</span>
mm&#8322; = MixtureModel<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span>sym&#8322;, asym&#8322;<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.2</span>, <span style="color: #e69055; font-weight: bold;">0.8</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
histogram<span style="color: #51afef;">(</span>rand<span style="color: #C57BDB;">(</span>mm&#8322;, <span style="color: #e69055; font-weight: bold;">100000</span><span style="color: #C57BDB;">)</span>, label=<span style="color: #7bc275;">"posterior distribution"</span>, bins=<span style="color: #e69055; font-weight: bold;">100</span>, normalize=<span style="color: #a991f1;">:pdf</span>, xlabel=<span style="color: #7bc275;">"&#952;"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org9bf9026" class="figure">
<p><img src="fig/ch3/exercise3.8dposterior.jpg" alt="exercise3.8dposterior.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf1c5c44" class="outline-3">
<h3 id="orgf1c5c44">3.9</h3>
<div class="outline-text-3" id="text-orgf1c5c44">
</div>
<div id="outline-container-org580115f" class="outline-4">
<h4 id="org580115f">a)</h4>
<div class="outline-text-4" id="text-org580115f">
</div>
<div id="outline-container-org856c829" class="outline-5">
<h5 id="org856c829">answer</h5>
<div class="outline-text-5" id="text-org856c829">
<p>
データ\(y_1, y_2, \dots, y_n\)を観測したとき、
y_1, y_2, &hellip;, y_n &sim; \text{i.i.d. Galenshore}(a, &theta;)
とすると、
\(\theta\)の\(a\)の条件付き事後分布は、
</p>
\begin{align*}
p(\theta | y_1, \dots, y_n, a)
&\propto p(y_1, \dots, y_n | \theta, a) p(\theta | a) \\
&\propto \theta^{2a n} \exp \left( - \theta^2 \sum_{i=1}^n y_i^2 \right)
\times p(\theta | a) \\
\end{align*}
<p>
となる。上の計算より、
\(p(\theta | a)\)が共役事前分布であるためには、
\(\theta^{2 c_1} \exp(- \theta^2) \)
のような項を含む分布である必要があるが、そのような分布としては、sampling model と同じ Galenshore 分布がある。
</p>

<p>
また、\(f(\theta) = - \theta^2 =: \phi\)とおくと、
\(\phi\)は\(\theta > 0\)で\(\theta\)の全単射の写像であり、
</p>
\begin{align*}
p(\theta | y_1, \dots, y_n, a)
&\propto \phi^{an} \exp \left( \phi \sum_{i=1}^n y_i^2 \right)
\times p(\theta | a) \\
\end{align*}
<p>
と問題を置き換えて
\(\phi\)の事前分布として、ガンマ分布を考えることもできる。
</p>

<p>
以下では、\(\theta\)の事前分布として、Galenshore 分布を用いる。
</p>

<div class="org-src-container">
<pre class="src src-julia">plot<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">3</span>,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span>, label=<span style="color: #7bc275;">"Normal(3,2)"</span><span style="color: #51afef;">)</span>
plot!<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span>,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span>, label=<span style="color: #7bc275;">"Gamma(1,1)"</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org1a38d37" class="figure">
<p><img src="fig/ch3/Exercise3_9a.png" alt="Exercise3_9a.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orge050615" class="outline-4">
<h4 id="orge050615">b)</h4>
<div class="outline-text-4" id="text-orge050615">
</div>
<div id="outline-container-org413b50a" class="outline-5">
<h5 id="org413b50a">answer</h5>
<div class="outline-text-5" id="text-org413b50a">
<p>
\(\theta\)の prior を Galenshore\((b, \phi)\) に設定すると、posterior は以下のように計算できる。
</p>

\begin{align*}
p(\theta | y_1, \dots, y_n, a)
&\propto p(y_1, \dots, y_n | \theta, a) p(\theta | a) \\
&\propto \theta^{2a n} \exp \left( - \theta^2 \sum_{i=1}^n y_i^2 \right)
\times \theta^{2b-1} e^{-\phi^2 \theta^2} \\
&= \theta^{2(an+b) - 1} \exp \left( - \left( \sum_{i=1}^n y_i^2 + \phi^2 \right) \theta^2 \right) \\
\end{align*}

<p>
以上より、
\[\theta | y_1, \dots, y_n, a \sim \text{Galenshore}(an+b, \sqrt{\sum_{i=1}^n y_i^2 + \phi^2}\]
</p>
</div>
</div>
</div>
<div id="outline-container-org2f1cb08" class="outline-4">
<h4 id="org2f1cb08">c)</h4>
<div class="outline-text-4" id="text-org2f1cb08">
</div>
<div id="outline-container-orgd717679" class="outline-5">
<h5 id="orgd717679">answer</h5>
<div class="outline-text-5" id="text-orgd717679">
\begin{align*}
\frac{p(\theta_a | Y_1 , \dots, Y_n)}{p(\theta_b | Y_1 , \dots, Y_n)}
&= \frac{ \frac{2}{\Gamma(an + b)} \left( \sum_{i=1}^n y_i^2 + \phi^2 \right)^{(an+b)}
\theta_a^{2(an+b)-1} e^{- \left( \sum_{i=1}^n y_i^2 + \phi^2 \right) \theta_a^2} }
{ \frac{2}{\Gamma(an + b)} \left( \sum_{i=1}^n y_i^2 + \phi^2 \right)^{(an+b)}
\theta_b^{2(an+b)-1} e^{- \left( \sum_{i=1}^n y_i^2 + \phi^2 \right) \theta_b^2} } \\
&= \left( \frac{\theta_a}{\theta_b} \right)^{2(an+b)-1} \times
e^{- \left( \sum_{i=1}^n y_i^2 + \phi^2 \right) (\theta_a^2 - \theta_b^2)} \\
\end{align*}

<p>
上式から、十分統計量は、
\(\sum_{i=1}^n y_i^2\)であることが分かる。
</p>
</div>
</div>
</div>
<div id="outline-container-org0ef0209" class="outline-4">
<h4 id="org0ef0209">d)</h4>
<div class="outline-text-4" id="text-org0ef0209">
</div>
<div id="outline-container-orgec331fa" class="outline-5">
<h5 id="orgec331fa">answer</h5>
<div class="outline-text-5" id="text-orgec331fa">
\begin{align*}
E[\theta | y_1, \dots, y_n]
= \frac{ \Gamma(an+b + \frac{1}{2}) }{ \Gamma(an+b)\sqrt{\sum_{i=1}^n y_i^2 + \phi^2} }
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org037dd9a" class="outline-4">
<h4 id="org037dd9a">e)</h4>
<div class="outline-text-4" id="text-org037dd9a">
</div>
<div id="outline-container-org0f46f41" class="outline-5">
<h5 id="org0f46f41">answer</h5>
<div class="outline-text-5" id="text-org0f46f41">
<p>
Galenshore 分布は確率分布であることから、
</p>
\begin{equation}
\label{eq:galenshore}
\begin{aligned}[b]
& \int_0^{\infty} \frac{2}{\Gamma(a)} \theta^{2a} y^{2a-1} e^{-\theta^2 y^2} dy
= 1 \\
\Leftrightarrow \quad
& \frac{2}{\Gamma(a)} \theta^{2a} \int_0^{\infty} y^{2a-1} e^{-\theta^2 y^2} dy = 1 \\
\Leftrightarrow \quad
& \int_0^{\infty} y^{2a-1} e^{-\theta^2 y^2} dy
= \frac{\Gamma(a)}{2} \theta^{-2a}
\end{aligned}
\end{equation}
<p>
であることを用いると、
</p>

\begin{align*}
p(\tilde{y} | y_1, \dots, y_n)
&= \int_0^{\infty} p(\tilde{y} | \theta) p(\theta | y_1, \dots, y_n) d\theta \\
&= \int_0^{\infty} \frac{2}{\Gamma(a)} \theta^{2a} \tilde{y}^{2a-1} e^{-\theta^2 \tilde{y}^2}
\times \frac{2}{\Gamma(an+b)} \left( \sum_{i=1}^n y_i^2 + \phi^2 \right)^{an+b}
\theta^{2(an+b)-1} e^{- \left( \sum_{i=1}^n y_i^2 + \phi^2 \right) \theta^2} d\theta \\
&= \frac{4}{\Gamma(a) \Gamma(an+b)} \left( \sum_{i=1}^n y_i^2 + \phi^2 \right)^{an+b}
\tilde{y}^{2a-1} \int_0^{\infty} \theta^{2(a + an+b)-1} e^{-(\tilde{y}^2 + \sum_{i=1}^n y_i^2 + \phi^2)\theta^2 } d\theta \\
&= \frac{4}{\Gamma(a) \Gamma(an+b)} \left( \sum_{i=1}^n y_i^2 + \phi^2 \right)^{an+b} \tilde{y}^{2a-1}
\frac{\Gamma(a + an+b)}{2(\tilde{y}^2 + \sum_{i=1}^n y_i^2 + \phi^2)^{a + an+b}}
\quad (\because \eqref{eq:galenshore})  \\
&= \frac{2}{B(a, an+b)} \left( \sum_{i=1}^n y_i^2 + \phi^2 \right)^{an+b}
\tilde{y}^{2a-1} (\tilde{y}^2 + \sum_{i=1}^n y_i^2 + \phi^2)^{-(a + an+b)} \\
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-orgb94144c" class="outline-3">
<h3 id="orgb94144c">3.10</h3>
<div class="outline-text-3" id="text-orgb94144c">
</div>
<div id="outline-container-org20f3d5e" class="outline-4">
<h4 id="org20f3d5e">a)</h4>
<div class="outline-text-4" id="text-org20f3d5e">
</div>
<div id="outline-container-org7674e72" class="outline-5">
<h5 id="org7674e72">answer</h5>
<div class="outline-text-5" id="text-org7674e72">
\begin{align*}
&\psi = \log \left[ \frac{\theta}{1 - \theta} \right] \\
\Leftrightarrow \quad & e^{\psi} = \frac{\theta}{1 - \theta} \\
\Leftrightarrow \quad & \theta = \frac{e^{\psi}}{1 + e^{\psi} }
=: h(\psi) \\
\end{align*}

<p>
また、
</p>
\begin{align*}
\frac{d h(\psi)}{d \psi}
&= \frac{e^{\psi} (1+e^{\psi}) - e^{\psi} e^{\psi} }{(1+e^{\psi})^2} \\
&= \frac{e^{\psi} (1+e^{\psi} - e^{\psi} )}{(1+e^{\psi})^2} \\
&= \frac{e^{\psi}}{(1+e^{\psi})^2} \quad ( > 0)\\
\end{align*}

<p>
よって、
</p>

\begin{align*}
p_{\psi} (\psi)
&= p_{\theta}(h(\psi)) \times \mid \frac{d h(\psi)}{d \psi} \mid \\
&= \frac{1}{B(a,b)} h(\psi)^{a-1} (1-h(\psi))^{b-1} \times \frac{e^{\psi}}{(1+e^{\psi})^2} \\
&= \frac{1}{B(a,b)} \left( \frac{e^{\psi}}{1 + e^{\psi} } \right)^{a-1} \left( \frac{1}{1 + e^{\psi} } \right)^{b-1} \times \frac{e^{\psi}}{(1+e^{\psi})^2} \\
&= \frac{1}{B(a,b)} \left( \frac{e^{\psi}}{1 + e^{\psi} } \right)^a \left( \frac{1}{1 + e^{\psi} } \right)^b
\end{align*}


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Plots
<span style="color: #51afef;">using</span> SpecialFunctions
a, b = <span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">1</span>
p_&#968; = &#968; <span style="color: #FCCE7B;">-&gt;</span> exp<span style="color: #51afef;">(</span>&#968;<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span>a <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">+</span> exp<span style="color: #C57BDB;">(</span>&#968;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #51afef;">(</span><span style="color: #FCCE7B;">-</span>b<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> beta<span style="color: #51afef;">(</span>a,b<span style="color: #51afef;">)</span>
&#968;s = range<span style="color: #51afef;">(</span><span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">10</span>, length=<span style="color: #e69055; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
p = plot<span style="color: #51afef;">(</span>&#968;s, p_&#968;.<span style="color: #C57BDB;">(</span>&#968;s<span style="color: #C57BDB;">)</span>, xlabel=<span style="color: #7bc275;">"&#968;"</span>, ylabel=<span style="color: #7bc275;">"p(&#968;)"</span>, label=<span style="color: #7bc275;">"p(&#968;)"</span><span style="color: #51afef;">)</span>
savefig<span style="color: #51afef;">(</span>p, <span style="color: #7bc275;">"../../fig/ch3/excersise3-10a.png"</span><span style="color: #51afef;">)</span>
<span style="color: #7bc275;">"../../fig/ch3/excersise3-10a.png"</span>
</pre>
</div>


<div id="org1be63c4" class="figure">
<p><img src="fig/ch3/excersise3-10a.png" alt="excersise3-10a.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga6cc1ed" class="outline-4">
<h4 id="orga6cc1ed">b)</h4>
<div class="outline-text-4" id="text-orga6cc1ed">
</div>
<div id="outline-container-orgca27e18" class="outline-5">
<h5 id="orgca27e18">answer</h5>
<div class="outline-text-5" id="text-orgca27e18">
\begin{align*}
&\psi = \log \theta \\
\Leftrightarrow \quad & \theta = e^{\psi} =: h(\psi)
\end{align*}

<p>
また、
</p>
\begin{align*}
\frac{d h(\psi)}{d \psi}
&= e^{\psi} \quad ( > 0)
\end{align*}

<p>
よって、
</p>

\begin{align*}
p_{\psi} (\psi)
&= p_{\theta}(h(\psi)) \times \mid \frac{d h(\psi)}{d \psi} \mid \\
&= \frac{b^a}{\Gamma(a)} h(\psi)^{a-1} e^{-b h(\psi)} \times e^{\psi} \\
&= \frac{b^a}{\Gamma(a)} e^{\psi (a-1)} e^{-b e^{\psi}} \times e^{\psi} \\
&= \frac{b^a}{\Gamma(a)} e^{\psi a -b e^{\psi} } \\
\end{align*}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Plots
<span style="color: #51afef;">using</span> SpecialFunctions
a, b = <span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">1</span>
p_&#968; = &#968; <span style="color: #FCCE7B;">-&gt;</span> b<span style="color: #FCCE7B;">^</span>a<span style="color: #FCCE7B;">/</span>gamma<span style="color: #51afef;">(</span>a<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> exp<span style="color: #51afef;">(</span>&#968;<span style="color: #FCCE7B;">*</span>a <span style="color: #FCCE7B;">-</span> b<span style="color: #FCCE7B;">*</span>exp<span style="color: #C57BDB;">(</span>&#968;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
&#968;s = range<span style="color: #51afef;">(</span><span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">10</span>, length=<span style="color: #e69055; font-weight: bold;">100</span><span style="color: #51afef;">)</span>
p = plot<span style="color: #51afef;">(</span>&#968;s, p_&#968;.<span style="color: #C57BDB;">(</span>&#968;s<span style="color: #C57BDB;">)</span>, xlabel=<span style="color: #7bc275;">"&#968;"</span>, ylabel=<span style="color: #7bc275;">"p(&#968;)"</span>, label=<span style="color: #7bc275;">"p(&#968;)"</span><span style="color: #51afef;">)</span>
savefig<span style="color: #51afef;">(</span>p, <span style="color: #7bc275;">"../../fig/ch3/excersise3-10b.png"</span><span style="color: #51afef;">)</span>
<span style="color: #7bc275;">"../../fig/ch3/excersise3-10b.png"</span>
</pre>
</div>


<div id="org02ec35d" class="figure">
<p><img src="fig/ch3/excersise3-10b.png" alt="excersise3-10b.png" width="500" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgafad0a9" class="outline-3">
<h3 id="orgafad0a9">3.12(和訳は 3.11)</h3>
<div class="outline-text-3" id="text-orgafad0a9">
</div>
<div id="outline-container-org2d6ec6a" class="outline-4">
<h4 id="org2d6ec6a">a)</h4>
<div class="outline-text-4" id="text-org2d6ec6a">
</div>
<div id="outline-container-org7cbcf15" class="outline-5">
<h5 id="org7cbcf15">answer</h5>
<div class="outline-text-5" id="text-org7cbcf15">
\begin{align*}
\log p(Y \mid \theta)
&= \log \left[ \begin{pmatrix} n \\ Y \end{pmatrix} \theta^Y (1-\theta)^{n-Y} \right]\\
&= Y \log \theta + (n-Y) \log (1-\theta) + \log \begin{pmatrix} n \\ Y \end{pmatrix} \\
\end{align*}
<p>
より、
</p>

\begin{align*}
\frac{\partial^2 \log p(Y \mid \theta)}{\partial \theta^2}
&= \frac{\partial}{\partial \theta}
\left( \frac{Y}{\theta} - \frac{n-Y}{1-\theta} \right)\\
&= - \frac{n-Y}{(1-\theta)^2} - \frac{Y}{\theta^2} \\
\end{align*}

<p>
よって、
</p>

\begin{align*}
I(\theta)
&= - E \left[ \frac{\partial^2 \log p(Y \mid \theta)}{\partial \theta^2} \middle| \theta \right] \\
&= - E \left[ - \frac{n-Y}{(1-\theta)^2} - \frac{Y}{\theta^2} \middle| \theta \right] \\
&= \frac{n-E[Y \mid \theta]}{(1-\theta)^2} + \frac{E[Y \mid \theta]}{\theta^2} \\
&= \frac{n - n \theta}{(1-\theta)^2} + \frac{n \theta}{\theta^2} \\
&= \frac{n}{1-\theta} + \frac{n}{\theta} \\
&= \frac{n}{\theta (1-\theta)}
\end{align*}
<p>
が得られる。また、
</p>
\begin{align*}
p_J(\theta)
&\propto \sqrt{\frac{n}{\theta (1-\theta)}} \\
&= \sqrt{n} \theta^{-\frac{1}{2}} (1-\theta)^{-\frac{1}{2}} \\
&\propto \theta^{ \frac{1}{2} - 1} (1-\theta)^{\frac{1}{2} - 1} \\
&\propto \text{dbeta}(\theta, \frac{1}{2}, \frac{1}{2})
\end{align*}
<p>
より、Jeffreys&rsquo; prior distribution は、
Beta\((\frac{1}{2}, \frac{1}{2})\)となる。
</p>
</div>
</div>
</div>
<div id="outline-container-org77ee82b" class="outline-4">
<h4 id="org77ee82b">b)</h4>
<div class="outline-text-4" id="text-org77ee82b">
</div>
<div id="outline-container-orgf5f39f1" class="outline-5">
<h5 id="orgf5f39f1">answer</h5>
<div class="outline-text-5" id="text-orgf5f39f1">
<p>
これは <a href="#org20f3d5e">3.10 a)</a> と同じ変換であることに注意。
</p>

\begin{align*}
\log p(Y \mid \psi)
&= \log \left[ \begin{pmatrix} n \\ Y \end{pmatrix} e^{\psi Y} (1+e^{\psi})^{-n} \right]\\
&= Y \psi + \log \begin{pmatrix} n \\ Y \end{pmatrix} - n \log (1+e^{\psi}) \\
\end{align*}

<p>
より、
</p>

\begin{align*}
\frac{\partial^2 \log p(Y \mid \psi)}{\partial \psi^2}
&= \frac{\partial}{\partial \psi}
\left( Y - \frac{n e^{\psi} }{1+e^{\psi} } \right)\\
&= - \frac{n e^{\psi} (1 + e^{\psi}) - e^{\psi} n e^{\psi} }{(1+e^{\psi})^2} \\
&= - \frac{n e^{\psi} }{(1+e^{\psi})^2} \\
\end{align*}

<p>
よって、
</p>

\begin{align*}
I(\psi)
&= - E \left[ \frac{\partial^2 \log p(Y \mid \psi)}{\partial \psi^2} \middle| \psi \right] \\
&= - E \left[ - \frac{n e^{\psi} }{(1+e^{\psi})^2} \middle| \psi \right] \\
&= \frac{n e^{\psi} }{(1+e^{\psi})^2} \\
\end{align*}

<p>
したがって、prior distribution は、
</p>

\begin{align*}
p_J(\psi)
= c \times \frac{\sqrt{e^{\psi} } }{1 + e^{\psi} }
\qquad \text{where } c = \frac{1}{\int_{-\infty}^{\infty} \sqrt{ e^{\psi} } (1 + e^{\psi} )^{-1} d\psi} \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org6ec1273" class="outline-4">
<h4 id="org6ec1273">c)</h4>
<div class="outline-text-4" id="text-org6ec1273">
</div>
<div id="outline-container-orge7966ed" class="outline-5">
<h5 id="orge7966ed">answer</h5>
<div class="outline-text-5" id="text-orge7966ed">
\begin{align*}
p_{J, \psi}(\psi)
&= p_{J, \theta}(h(\psi)) \times \left| \frac{\partial h(\psi)}{\partial \psi} \right| \\
&\propto h(\psi)^{-\frac{1}{2}} (1-h(\psi))^{-\frac{1}{2}} \times \frac{e^{\psi}}{(1+e^{\psi})^2} \\
&= \left( \frac{e^{\psi} }{1 + e^{\psi} } \right)^{- \frac{1}{2} }
\left(1-\frac{e^{\psi} }{1 + e^{\psi} }\right)^{-\frac{1}{2} } \times
\frac{e^{\psi}}{(1+e^{\psi})^2} \\
&= \left( \frac{e^{\psi} }{(1 + e^{\psi})^2 } \right)^{- \frac{1}{2} }
\frac{e^{\psi}}{(1+e^{\psi})^2} \\
&= \left( \frac{e^{\psi} }{(1 + e^{\psi})^2 } \right)^{ \frac{1}{2} } \\
&= \frac{\sqrt{e^{\psi} } }{1 + e^{\psi} } \\
\end{align*}


<p>
よって、
<a href="#org77ee82b">b)</a> と一致することがわかる。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org8787c66" class="outline-3">
<h3 id="org8787c66">3.13</h3>
<div class="outline-text-3" id="text-org8787c66">
</div>
<div id="outline-container-org7426b8d" class="outline-4">
<h4 id="org7426b8d">a)</h4>
<div class="outline-text-4" id="text-org7426b8d">
</div>
<div id="outline-container-org36be3ab" class="outline-5">
<h5 id="org36be3ab">answer</h5>
<div class="outline-text-5" id="text-org36be3ab">
\begin{align*}
\log p(Y \mid \theta)
&= \log \left[ \frac{\theta^Y e^{-\theta}}{Y!} \right] \\
&= Y \log \theta - \theta - \log Y! \\
\end{align*}

<p>
より、
</p>

\begin{align*}
\frac{\partial^2 \log p(Y \mid \theta)}{\partial \theta^2}
&= \frac{\partial}{\partial \theta}
\left( \frac{Y}{\theta} - 1 \right) \\
&= - \frac{Y}{\theta^2} \\
\end{align*}

<p>
よって、
</p>

\begin{align*}
I(\theta)
&= - E \left[ \frac{\partial^2 \log p(Y \mid \theta)}{\partial \theta^2} \middle| \theta \right] \\
&= E \left[ \frac{Y}{\theta^2} \middle| \theta \right] \\
&= \frac{E[Y \mid \theta]}{\theta^2} \\
&= \frac{\theta}{\theta^2} \\
&= \frac{1}{\theta} \\
\end{align*}

<p>
したがって、prior distribution は、
</p>

\begin{align*}
p_J(\theta)
\propto \times \frac{1}{\sqrt{\theta}}
\end{align*}

<p>
となるが、
</p>

<p>
\(\int_{0}^{\infty} \frac{1}{\sqrt{\theta}} d\theta \)は無限大に発散するので、確率分布とはならない。
</p>
</div>
</div>
</div>
<div id="outline-container-orgcc86d65" class="outline-4">
<h4 id="orgcc86d65">b)</h4>
<div class="outline-text-4" id="text-orgcc86d65">
</div>
<div id="outline-container-org41e394e" class="outline-5">
<h5 id="org41e394e">answer</h5>
<div class="outline-text-5" id="text-org41e394e">
\begin{align*}
f(\theta, y)
&= \sqrt{I(\theta)} \times p(y \mid \theta) \\
&= \sqrt{\frac{1}{\theta}} \times \frac{\theta^y e^{-\theta}}{y!} \\
&= \frac{\theta^{y - \frac{1}{2} } e^{-\theta} }{y!}
\end{align*}

\begin{align*}
f(\theta \mid y)
&= \frac{\theta^{y - \frac{1}{2} } e^{-\theta} }{y!} \\
&\propto \theta^{y - \frac{1}{2} } e^{-\theta} \\
&= \theta^{y + \frac{1}{2} -1 } e^{-\theta} \\
&\propto \text{dgamma}(\theta, y + \frac{1}{2}, 1)
\end{align*}

<p>
Probably yes because we are interested in only the shape of the distribution.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf5a84b8" class="outline-3">
<h3 id="orgf5a84b8">3.14</h3>
<div class="outline-text-3" id="text-orgf5a84b8">
</div>
<div id="outline-container-orgf765c46" class="outline-4">
<h4 id="orgf765c46">a)</h4>
<div class="outline-text-4" id="text-orgf765c46">
</div>
<div id="outline-container-org4810e7a" class="outline-5">
<h5 id="org4810e7a">answer</h5>
<div class="outline-text-5" id="text-org4810e7a">
\begin{align*}
l(\theta \mid \boldsymbol{y})
&= \sum_{i=1}^n \log p(y_i \mid \theta) \\
&= \sum_{i=1}^n \log \theta^{y_i} (1 - \theta)^{1 - y_i} \\
&= \sum_{i=1}^n y_i \log \theta + (1 - y_i) \log (1 - \theta) \\
&= \left( \sum_{i=1}^n y_i \right) \log \theta + \left( n - \sum_{i=1}^n y_i \right) \log (1 - \theta) \\
\end{align*}

<p>
一階の条件は、
</p>

\begin{align*}
& \frac{\sum_{i=1}^n y_i}{\theta} = \frac{n - \sum_{i=1}^n y_i}{1 - \theta} \\
\Leftrightarrow \quad & (1 - \theta) \sum_{i=1}^n y_i = \theta (n - \sum_{i=1}^n y_i) \\
\therefore \quad & \hat{\theta} = \frac{\sum_{i=1}^n y_i}{n} \\
\end{align*}

<p>
また、
</p>

\begin{align*}
J(\theta)
&= - \frac{\partial^2 l(\theta \mid \boldsymbol{y})}{\partial \theta^2} \\
&= \frac{\partial^2}{\partial \theta^2} \left( \left( \sum_{i=1}^n y_i \right) \log \theta + \left( n - \sum_{i=1}^n y_i \right) \log (1 - \theta) \right) \\
&= \frac{\partial}{\partial \theta} \left( \left( \sum_{i=1}^n y_i \right) \theta^{-1}
- \left( n - \sum_{i=1}^n y_i \right) (1 - \theta)^{-1} \right) \\
&= - \left( \sum_{i=1}^n y_i \right) \theta^{-2} - \left( n - \sum_{i=1}^n y_i \right) (1 - \theta)^{-2} \\
\end{align*}

<p>
より、上で求めた \(\hat{\theta}\) を代入すると、
</p>

\begin{align*}
J(\hat{\theta})
&= - \left( \sum_{i=1}^n y_i \right) \hat{\theta}^{-2} - \left( n - \sum_{i=1}^n y_i \right) (1 - \hat{\theta})^{-2} \\
&= - \left( \sum_{i=1}^n y_i \right) \left( \frac{\sum_{i=1}^n y_i}{n} \right)^{-2} - \left( n - \sum_{i=1}^n y_i \right) \left(1 - \frac{\sum_{i=1}^n y_i}{n} \right)^{-2} \\
&= - \frac{n^2}{\sum_{i=1}^n y_i} - \frac{n^2}{n - \sum_{i=1}^n y_i} \\
\end{align*}

<p>
よって、
</p>

\begin{align*}
\frac{J(\hat{\theta})}{n}
&= - \frac{n}{\sum_{i=1}^n y_i} - \frac{n}{n - \sum_{i=1}^n y_i} \\
&= -n \left( \frac{1}{\sum_{i=1}^n y_i} + \frac{1}{n - \sum_{i=1}^n y_i} \right) \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org24bd1bb" class="outline-4">
<h4 id="org24bd1bb">b)</h4>
<div class="outline-text-4" id="text-org24bd1bb">
</div>
<div id="outline-container-org3061273" class="outline-5">
<h5 id="org3061273">answer</h5>
<div class="outline-text-5" id="text-org3061273">
\begin{align*}
& \log p_U (\theta) = \frac{l(\theta \mid \boldsymbol{y})}{n} + c \\
\Leftrightarrow \quad & \log p_U (\theta) = \frac{\left( \sum_{i=1}^n y_i \right) \log \theta + \left( n - \sum_{i=1}^n y_i \right) \log (1 - \theta) }{n} + c \\
\Leftrightarrow \quad & \log p_U (\theta) = \frac{\sum_{i=1}^n y_i}{n} \log \theta + (1 - \frac{\sum_{i=1}^n y_i}{n}) \log (1 - \theta) + c \\
\Leftrightarrow \quad & p_U (\theta) = \theta^{\frac{\sum_{i=1}^n y_i}{n}} (1 - \theta)^{\frac{n - \sum_{i=1}^n y_i}{n}} e^c\\
\end{align*}

<p>
\(p_U(\theta)\)は probability density なので、
</p>

\begin{align*}
& \int_0^1 p_U (\theta) d\theta = 1 \\
\Leftrightarrow \quad & \int_0^1 \theta^{\frac{\sum_{i=1}^n y_i}{n}} (1 - \theta)^{\frac{n - \sum_{i=1}^n y_i}{n}} e^c d\theta = 1 \\
\Leftrightarrow \quad & e^c
= \left( \int_0^1 \theta^{\frac{\sum_{i=1}^n y_i}{n}} (1 - \theta)^{\frac{n - \sum_{i=1}^n y_i}{n}}  d\theta \right)^{-1} \\
& = B\left(\frac{\sum_{i=1}^n y_i}{n} +1, 2 - \frac{\sum_{i=1}^n y_i}{n} \right)^{-1} \\
\therefore \quad & c = - \log B\left(\frac{\sum_{i=1}^n y_i}{n} +1, 2 - \frac{\sum_{i=1}^n y_i}{n} \right) \\
\end{align*}

<p>
また、
</p>

\begin{align*}
- \frac{\partial^2 \log p_U (\theta)}{\partial \theta^2}
&= n^{-1} \times
\left( - \frac{\partial^2 l(\theta \mid \boldsymbol{y})}{\partial \theta^2 }\right) \\
&= n^{-1} \times J(\theta) \\
&= - \left( \frac{\sum_{i=1}^n y_i}{n} \right) \theta^{-2} - \left( 1 - \frac{\sum_{i=1}^n y_i}{n} \right) (1 - \theta)^{-2} \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orgea2fcd9" class="outline-4">
<h4 id="orgea2fcd9">c)</h4>
<div class="outline-text-4" id="text-orgea2fcd9">
</div>
<div id="outline-container-org05b3333" class="outline-5">
<h5 id="org05b3333">answer</h5>
<div class="outline-text-5" id="text-org05b3333">
\begin{align*}
p_U (\theta) \times p(y_1, \dots, y_n \mid \theta )
&\propto \theta^{\frac{\sum_{i=1}^n y_i}{n} + \sum_{i=1}^n y_i}
(1 - \theta)^{\frac{n - \sum_{i=1}^n y_i}{n} + n - \sum_{i=1}^n y_i}  \\
&= \theta^{(1 + n^{-1}) \sum_{i=1}^n y_i}
(1 - \theta)^{(1 + n^{-1}) (n - \sum_{i=1}^n y_i)} \\
&= \text{dbeta}\left(\theta, (1 + n^{-1}) \sum_{i=1}^n y_i + 1, (1 + n^{-1}) (n - \sum_{i=1}^n y_i) + 1 \right) \\
\end{align*}

<p>
これは posterior distribution とみなすことができる。
</p>
</div>
</div>
</div>
<div id="outline-container-orgca3815d" class="outline-4">
<h4 id="orgca3815d">d)</h4>
<div class="outline-text-4" id="text-orgca3815d">
</div>
<div id="outline-container-org7e042ff" class="outline-5">
<h5 id="org7e042ff">answer</h5>
<div class="outline-text-5" id="text-org7e042ff">
</div>
<div id="outline-container-org665cf44" class="outline-6">
<h6 id="org665cf44">a&rsquo;)</h6>
<div class="outline-text-6" id="text-org665cf44">
\begin{align*}
l(\theta \mid \boldsymbol{y})
&= \sum_{i=1}^n \log p(y_i \mid \theta) \\
&= \sum_{i=1}^n \log \frac{\theta^{y_i} e^{- \theta} }{y_i!} \\
&= \sum_{i=1}^n \left( y_i \log \theta - \theta - \log y_i! \right) \\
& = \log \theta \sum_{i=1}^n y_i - n \theta - \sum_{i=1}^n \log y_i! \\
\end{align*}

<p>
一階の条件は、
</p>

\begin{align*}
& \theta^{-1} \sum_{i=1}^n y_i - n = 0 \\
\therefore \quad & \hat{\theta} = \frac{\sum_{i=1}^n y_i}{n} \\
\end{align*}

<p>
また、
</p>

\begin{align*}
J(\theta)
&= - \frac{\partial^2 l(\theta \mid \boldsymbol{y})}{\partial \theta^2} \\
&= \frac{\partial^2}{\partial \theta^2} \left( \log \theta \sum_{i=1}^n y_i - n \theta - \sum_{i=1}^n \log y_i! \right) \\
&= \frac{\partial}{\partial \theta} \left( \left( \sum_{i=1}^n y_i \right) \theta^{-1}
- n \right) \\
&= - \left( \sum_{i=1}^n y_i \right) \theta^{-2}  \\
\end{align*}

<p>
より、上で求めた \(\hat{\theta}\) を代入すると、
</p>

\begin{align*}
J(\hat{\theta})
&= - \left( \sum_{i=1}^n y_i \right) \hat{\theta}^{-2} \\
&= - \left( \sum_{i=1}^n y_i \right) \left( \frac{\sum_{i=1}^n y_i}{n} \right)^{-2}  \\
&= - \frac{n^2}{\sum_{i=1}^n y_i} \\
\end{align*}

<p>
よって、
</p>

\begin{align*}
\frac{J(\hat{\theta})}{n}
&= - \frac{n}{\sum_{i=1}^n y_i} \\
\end{align*}
</div>
</div>
<div id="outline-container-org020c6d7" class="outline-6">
<h6 id="org020c6d7">b&rsquo;)</h6>
<div class="outline-text-6" id="text-org020c6d7">
\begin{align*}
& \log p_U (\theta) = \frac{l(\theta \mid \boldsymbol{y})}{n} + c \\
\Leftrightarrow \quad & \log p_U (\theta) = \frac{\log \theta \sum_{i=1}^n y_i - n \theta - \sum_{i=1}^n \log y_i!}{n} + c \\
\Leftrightarrow \quad & \log p_U (\theta)
= \frac{\sum_{i=1}^n y_i }{n} \log \theta - \theta - \frac{\sum_{i=1}^n \log y_i!}{n} + c \\
\therefore \quad & p_U (\theta)
= \theta^{\frac{\sum_{i=1}^n y_i}{n} } e^{c - \theta} \left( \prod_{i=1}^n y_i! \right)^{-n}
\end{align*}

<p>
\(p_U(\theta)\)は probability density なので、
</p>

\begin{align*}
& \int_0^{\infty} p_U (\theta) d \theta = 1 \\
\Leftrightarrow \quad & \int_0^{\infty} \theta^{\frac{\sum_{i=1}^n y_i }{n} } e^{c - \theta} \left( \prod_{i=1}^n y_i! \right)^{-n} d \theta = 1 \\
\Leftrightarrow \quad & e^c
= \left( \prod_{i=1}^n y_i! \right)^n \left( \int_0^{\infty} \theta^{\frac{\sum_{i=1}^n y_i}{n} } e^{- \theta} d \theta \right)^{-1} \\
& = \left( \prod_{i=1}^n y_i! \right)^n \Gamma \left( \frac{\sum_{i=1}^n y_i}{n} + 1 \right)^{-1} \\
\end{align*}

<p>
また、
</p>

\begin{align*}
- \frac{\partial^2 \log p_U (\theta)}{\partial \theta^2}
&= n^{-1} \times
\left( - \frac{\partial^2 l(\theta \mid \boldsymbol{y})}{\partial \theta^2 }\right) \\
&= n^{-1} \times J(\theta) \\
&= - \left( \frac{\sum_{i=1}^n y_i}{n} \right) \theta^{-2}
\end{align*}
</div>
</div>
<div id="outline-container-orgca1d024" class="outline-6">
<h6 id="orgca1d024">c&rsquo;)</h6>
<div class="outline-text-6" id="text-orgca1d024">
\begin{align*}
p_U (\theta) \times p(y_1, \dots, y_n \mid \theta )
&\propto \theta^{\frac{\sum_{i=1}^n y_i}{n} } e^{- \theta}
\times \theta^{\sum_{i=1}^n y_i} e^{-n \theta} \\
&= \theta^{(1 + n^{-1}) \sum_{i=1}^n y_i} e^{-(1 + n) \theta} \\
&= \text{dgamma} \left( \theta, (1 + n^{-1}) \sum_{i=1}^n y_i + 1, 1 + n \right) \\
\end{align*}

<p>
これは posterior distribution とみなすことができる。
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org653bab6" class="outline-2">
<h2 id="org653bab6">Chapter 4</h2>
<div class="outline-text-2" id="text-org653bab6">
</div>
<div id="outline-container-orgff18856" class="outline-3">
<h3 id="orgff18856">4.1</h3>
<div class="outline-text-3" id="text-orgff18856">
</div>
<div id="outline-container-org36874f0" class="outline-4">
<h4 id="org36874f0">answer</h4>
<div class="outline-text-4" id="text-org36874f0">
<p>
\(\theta_1, \theta_2\)それぞれの事後分布は、
</p>

\begin{align*}
& \theta_1 \sim \text{Beta}(1 +57, 1 + 43) \\
& \theta_2 \sim \text{Beta}(1 + 30, 1 + 20) \\
\end{align*}

<p>
である。
Pr(\(\theta_1 < \theta_2 \mid\) the data and prior)
は、以下のように計算できる。
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> Random
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>
a, b = <span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">1</span>
sy&#8321;, n&#8321; = <span style="color: #e69055; font-weight: bold;">57</span>, <span style="color: #e69055; font-weight: bold;">100</span>
sy&#8322;, n&#8322; = <span style="color: #e69055; font-weight: bold;">30</span>, <span style="color: #e69055; font-weight: bold;">50</span>

&#952;&#8321;_mc = rand<span style="color: #51afef;">(</span>Beta<span style="color: #C57BDB;">(</span>a <span style="color: #FCCE7B;">+</span> sy&#8321;, b <span style="color: #FCCE7B;">+</span> n&#8321; <span style="color: #FCCE7B;">-</span>sy&#8321;<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
&#952;&#8322;_mc = rand<span style="color: #51afef;">(</span>Beta<span style="color: #C57BDB;">(</span>a <span style="color: #FCCE7B;">+</span> sy&#8322;, b <span style="color: #FCCE7B;">+</span> n&#8322; <span style="color: #FCCE7B;">-</span>sy&#8322;<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>

mean<span style="color: #51afef;">(</span>&#952;&#8321;_mc .<span style="color: #FCCE7B;">&lt;</span> &#952;&#8322;_mc<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.626
</pre>


<p>
よって、事後分布の比較により、\(\theta_2\)の方が大きい事後確率は約 63%である。
</p>
</div>
</div>
</div>
<div id="outline-container-org198c220" class="outline-3">
<h3 id="org198c220">4.2</h3>
<div class="outline-text-3" id="text-org198c220">
</div>
<div id="outline-container-org72a472d" class="outline-4">
<h4 id="org72a472d">a)</h4>
<div class="outline-text-4" id="text-org72a472d">
</div>
<div id="outline-container-org60706e6" class="outline-5">
<h5 id="org60706e6">answer</h5>
<div class="outline-text-5" id="text-org60706e6">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> Random
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>
y_A = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">12</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">12</span>, <span style="color: #e69055; font-weight: bold;">14</span>, <span style="color: #e69055; font-weight: bold;">13</span>, <span style="color: #e69055; font-weight: bold;">13</span>, <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">6</span><span style="color: #51afef;">]</span>
y_B = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">11</span>, <span style="color: #e69055; font-weight: bold;">11</span>, <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">7</span>, <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">6</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">7</span><span style="color: #51afef;">]</span>

n_A, sy_A = length<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span> , sum<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span>
n_B, sy_B = length<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span> , sum<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span>

a&#8320;_A = <span style="color: #e69055; font-weight: bold;">120</span>
b&#8320;_A = <span style="color: #e69055; font-weight: bold;">10</span>
a&#8320;_B = <span style="color: #e69055; font-weight: bold;">12</span>
b&#8320;_B = <span style="color: #e69055; font-weight: bold;">1</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_A = Gamma<span style="color: #51afef;">(</span>a&#8320;_A <span style="color: #FCCE7B;">+</span> sy_A, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320;_A <span style="color: #FCCE7B;">+</span> n_A<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_B = Gamma<span style="color: #51afef;">(</span>a&#8320;_B <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320;_B <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

&#952;_A_mc = rand<span style="color: #51afef;">(</span>dist_A, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
&#952;_B_mc = rand<span style="color: #51afef;">(</span>dist_B, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>

mean<span style="color: #51afef;">(</span>&#952;_B_mc .<span style="color: #FCCE7B;">&lt;</span> &#952;_A_mc<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.996
</pre>


<p>
以上より、
\[
\text{Pr}(\theta_B < \theta_A \mid \boldsymbol{y}_A, \boldsymbol{y}_B)
\fallingdotseq 0.997
\]
</p>
</div>
</div>
</div>
<div id="outline-container-orgf5ba81d" class="outline-4">
<h4 id="orgf5ba81d">b)</h4>
<div class="outline-text-4" id="text-orgf5ba81d">
</div>
<div id="outline-container-org37c4c09" class="outline-5">
<h5 id="org37c4c09">answer</h5>
<div class="outline-text-5" id="text-org37c4c09">
<div class="org-src-container">
<pre class="src src-julia">dist_&#952;_B = n <span style="color: #FCCE7B;">-&gt;</span> Gamma<span style="color: #51afef;">(</span>a&#8320;_B<span style="color: #FCCE7B;">*</span>n <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>n <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span> <span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
t_mc = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> n&#8320; <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">50</span>
    &#952;_B_mc = rand<span style="color: #51afef;">(</span>dist_&#952;_B<span style="color: #C57BDB;">(</span>n&#8320;<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
    append!<span style="color: #51afef;">(</span>t_mc, mean<span style="color: #C57BDB;">(</span>&#952;_B_mc .<span style="color: #FCCE7B;">&lt;</span> &#952;_A_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>



<div id="org3bb1b1e" class="figure">
<p><img src="fig/ch4/exercise4-2b.png" alt="exercise4-2b.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdfa29e1" class="outline-4">
<h4 id="orgdfa29e1">c)</h4>
<div class="outline-text-4" id="text-orgdfa29e1">
</div>
<div id="outline-container-orgc64da43" class="outline-5">
<h5 id="orgc64da43">answer a&rsquo;</h5>
<div class="outline-text-5" id="text-orgc64da43">
<div class="org-src-container">
<pre class="src src-julia">&#952;_A_mc = rand<span style="color: #51afef;">(</span>dist_A, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>
&#952;_B_mc = rand<span style="color: #51afef;">(</span>dist_B, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>
y_A_mc = rand.<span style="color: #51afef;">(</span>Poisson.<span style="color: #C57BDB;">(</span>&#952;_A_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
y_B_mc = rand.<span style="color: #51afef;">(</span>Poisson.<span style="color: #C57BDB;">(</span>&#952;_B_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

mean<span style="color: #51afef;">(</span>y_A_mc .<span style="color: #FCCE7B;">&gt;</span> y_B_mc<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.6953
</pre>


<p>
以上より、
\[
\text{Pr}(\tilde{Y}_B < \tilde{Y}_A \mid \boldsymbol{y}_A, \boldsymbol{y}_B)
\fallingdotseq 0.695
\]
</p>
</div>
</div>
<div id="outline-container-org66b8428" class="outline-5">
<h5 id="org66b8428">answer b&rsquo;</h5>
<div class="outline-text-5" id="text-org66b8428">
<div class="org-src-container">
<pre class="src src-julia">t_mc = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> n&#8320; <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">50</span>
    &#952;_B_mc = rand<span style="color: #51afef;">(</span>dist_&#952;_B<span style="color: #C57BDB;">(</span>n&#8320;<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>
    y_B_mc = rand.<span style="color: #51afef;">(</span>Poisson.<span style="color: #C57BDB;">(</span>&#952;_B_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    append!<span style="color: #51afef;">(</span>t_mc, mean<span style="color: #C57BDB;">(</span>&#952;_B_mc .<span style="color: #FCCE7B;">&lt;</span> &#952;_A_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>


<div id="org17e934e" class="figure">
<p><img src="fig/ch4/exercise4-2c.png" alt="exercise4-2c.png" width="500" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org7ec470c" class="outline-3">
<h3 id="org7ec470c">4.3</h3>
<div class="outline-text-3" id="text-org7ec470c">
</div>
<div id="outline-container-orgf9fe84b" class="outline-4">
<h4 id="orgf9fe84b">a)</h4>
<div class="outline-text-4" id="text-orgf9fe84b">
</div>
<div id="outline-container-org6eea841" class="outline-5">
<h5 id="org6eea841">answer</h5>
<div class="outline-text-5" id="text-org6eea841">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> Random
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>
y_A = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">12</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">12</span>, <span style="color: #e69055; font-weight: bold;">14</span>, <span style="color: #e69055; font-weight: bold;">13</span>, <span style="color: #e69055; font-weight: bold;">13</span>, <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">15</span>, <span style="color: #e69055; font-weight: bold;">6</span><span style="color: #51afef;">]</span>
y_B = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">11</span>, <span style="color: #e69055; font-weight: bold;">11</span>, <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">7</span>, <span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">6</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">8</span>, <span style="color: #e69055; font-weight: bold;">9</span>, <span style="color: #e69055; font-weight: bold;">7</span><span style="color: #51afef;">]</span>

n_A, sy_A = length<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span> , sum<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span>
n_B, sy_B = length<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span> , sum<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span>

a&#8320;_A = <span style="color: #e69055; font-weight: bold;">120</span>
b&#8320;_A = <span style="color: #e69055; font-weight: bold;">10</span>
a&#8320;_B = <span style="color: #e69055; font-weight: bold;">12</span>
b&#8320;_B = <span style="color: #e69055; font-weight: bold;">1</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_A = Gamma<span style="color: #51afef;">(</span>a&#8320;_A <span style="color: #FCCE7B;">+</span> sy_A, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320;_A <span style="color: #FCCE7B;">+</span> n_A<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_B = Gamma<span style="color: #51afef;">(</span>a&#8320;_B <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320;_B <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

n_A = <span style="color: #e69055; font-weight: bold;">10</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
t_mc = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">1000</span>
    &#952;_A = rand<span style="color: #51afef;">(</span>dist_A<span style="color: #51afef;">)</span>
    y_A_mc = rand<span style="color: #51afef;">(</span>Poisson<span style="color: #C57BDB;">(</span>&#952;_A<span style="color: #C57BDB;">)</span>, n_A<span style="color: #51afef;">)</span>
    avg = mean<span style="color: #51afef;">(</span>y_A_mc<span style="color: #51afef;">)</span>
    sd = std<span style="color: #51afef;">(</span>y_A_mc<span style="color: #51afef;">)</span>
    append!<span style="color: #51afef;">(</span>t_mc, avg<span style="color: #FCCE7B;">/</span>sd <span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>

<div id="orgbb68968" class="figure">
<p><img src="fig/ch4/exercise4-3a.png" alt="exercise4-3a.png" width="500" />
</p>
</div>

<p>
You can see that the observed value of \(t\) is in the middle of the distribution of \(t^{(s)}\).
From this, we can conclude that the Poisson model is a good fit for the population of this data.
</p>
</div>
</div>
</div>
<div id="outline-container-orgb074bac" class="outline-4">
<h4 id="orgb074bac">b)</h4>
<div class="outline-text-4" id="text-orgb074bac">
</div>
<div id="outline-container-orgd65eaab" class="outline-5">
<h5 id="orgd65eaab">answer</h5>
<div class="outline-text-5" id="text-orgd65eaab">
<div class="org-src-container">
<pre class="src src-julia">t_mc = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">1000</span>
    &#952;_B = rand<span style="color: #51afef;">(</span>dist_B<span style="color: #51afef;">)</span>
    y_B_mc = rand<span style="color: #51afef;">(</span>Poisson<span style="color: #C57BDB;">(</span>&#952;_B<span style="color: #C57BDB;">)</span>, n_B<span style="color: #51afef;">)</span>
    avg = mean<span style="color: #51afef;">(</span>y_B_mc<span style="color: #51afef;">)</span>
    sd = std<span style="color: #51afef;">(</span>y_B_mc<span style="color: #51afef;">)</span>
    append!<span style="color: #51afef;">(</span>t_mc, avg<span style="color: #FCCE7B;">/</span>sd <span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>

<div id="org24868f4" class="figure">
<p><img src="fig/ch4/exercise4-3b.png" alt="exercise4-3b.png" width="500" />
</p>
</div>


<p>
You can see that the observed value of \(t\) is located at the quite edge of the distribution.
From this, we can conclude that the Poisson model cannot reflect the feature of the population.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga3b1fbf" class="outline-3">
<h3 id="orga3b1fbf">4.4</h3>
<div class="outline-text-3" id="text-orga3b1fbf">
</div>
<div id="outline-container-org9f4187f" class="outline-4">
<h4 id="org9f4187f">a)</h4>
<div class="outline-text-4" id="text-org9f4187f">
</div>
<div id="outline-container-orgaf3a090" class="outline-5">
<h5 id="orgaf3a090">answer</h5>
<div class="outline-text-5" id="text-orgaf3a090">
<p>
<a href="#orgc0bea0e">3.4 d) ii</a> の結果より、
mixture prior distribution を用いたときの posterior distribution は
\(\frac{3}{4} \text{Beta}(17, 36) + \frac{1}{4} \text{Beta}(23, 30)\)
に従う。プロットは以下の通り。
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> Random
<span style="color: #51afef;">using</span> LaTeXStrings
<span style="color: #51afef;">using</span> Plots
mm = MixtureModel<span style="color: #51afef;">(</span>
    <span style="color: #C57BDB;">[</span>Beta<span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">17</span>, <span style="color: #e69055; font-weight: bold;">36</span><span style="color: #7bc275;">)</span>, Beta<span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">23</span>, <span style="color: #e69055; font-weight: bold;">30</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span>,
    <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.75</span>, <span style="color: #e69055; font-weight: bold;">0.25</span><span style="color: #C57BDB;">]</span>
<span style="color: #51afef;">)</span>
mm_samples = rand<span style="color: #51afef;">(</span>mm, <span style="color: #e69055; font-weight: bold;">10</span>_000_000<span style="color: #51afef;">)</span>
histogram<span style="color: #51afef;">(</span>
    mm_samples, label=<span style="color: #7bc275;">"mixture model posterior"</span>
    , bins=<span style="color: #e69055; font-weight: bold;">1000</span>, normalize=<span style="color: #a991f1;">:pdf</span>, xlabel=<span style="color: #7bc275;">"&#952;"</span>, ylabel=L<span style="color: #7bc275;">"p(\theta \mid y)"</span>
<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>

<div id="org1f9b6b3" class="figure">
<p><img src="fig/ch4/exercise4-4a.png" alt="exercise4-4a.png" width="500" />
</p>
</div>

<p>
95% quantile-based posterior confidence interval は以下のように、サンプルの quantile を用いて近似値を求めることができる。
</p>

<div class="org-src-container">
<pre class="src src-julia">quantile<span style="color: #51afef;">(</span>mm_samples, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{Float64}:
 0.2098971517541345
 0.5230478539666719
</pre>
</div>
</div>
</div>
<div id="outline-container-orge3f9b02" class="outline-4">
<h4 id="orge3f9b02">b)</h4>
<div class="outline-text-4" id="text-orge3f9b02">
</div>
<div id="outline-container-orga60f9b3" class="outline-5">
<h5 id="orga60f9b3">answer</h5>
<div class="outline-text-5" id="text-orga60f9b3">
<div class="org-src-container">
<pre class="src src-julia">w = <span style="color: #e69055; font-weight: bold;">0.75</span>

z_mc = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">10</span>_000_000
    x = rand<span style="color: #51afef;">(</span>Bernoulli<span style="color: #C57BDB;">(</span>w<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    dist = x <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #51afef;">?</span> Beta<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">17</span>, <span style="color: #e69055; font-weight: bold;">36</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">:</span> Beta<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">23</span>, <span style="color: #e69055; font-weight: bold;">30</span><span style="color: #51afef;">)</span>
    z = rand<span style="color: #51afef;">(</span>dist<span style="color: #51afef;">)</span>
    append!<span style="color: #51afef;">(</span>z_mc, z<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>

<div id="org2e949ce" class="figure">
<p><img src="fig/ch4/exercise4-4b.png" alt="exercise4-4b.png" width="500" />
</p>
</div>

<p>
どちらも同じ形状の分布になる！
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb49282d" class="outline-3">
<h3 id="orgb49282d">4.5</h3>
<div class="outline-text-3" id="text-orgb49282d">
</div>
<div id="outline-container-org2e3c22c" class="outline-4">
<h4 id="org2e3c22c">a)</h4>
<div class="outline-text-4" id="text-org2e3c22c">
</div>
<div id="outline-container-org0543c06" class="outline-5">
<h5 id="org0543c06">answer</h5>
<div class="outline-text-5" id="text-org0543c06">
<p>
\(Y_i \sim \text{Poisson}(\theta X_i)\)より、尤度は
</p>
\begin{align*}
p((Y_1, X_1), \dots, (Y_n, X_n) \mid \theta )
&= \prod_{i=1}^n p(Y_i, X_i \mid \theta )
\quad (\because \text{ i.i.d. })\\
&= \prod_{i=1}^n p(Y_i \mid X_i, \theta ) p(X_i \mid \theta ) \\
&\propto \prod_{i=1}^n p(Y_i \mid X_i, \theta )
\quad (\because  X_i \text{ is independent from } \theta) \\
&= \prod_{i=1}^n \frac{(\theta X_i)^{Y_i} e^{-\theta X_i}}{Y_i!} \\
&\propto \theta^{ \sum_{i=1}^n Y_i } e^{-\theta \sum_{i=1}^n X_i}
\end{align*}

<p>
また、\(\theta \sim \text{gamma}(a, b)\)より、事前分布は、
</p>
\begin{align*}
p(\theta)
&= \frac{b^a}{\Gamma(a)} \theta^{a-1} e^{-b \theta} \\
&\propto \theta^{a-1} e^{-b \theta}
\end{align*}

<p>
ベイズの定理より、事後分布は、
</p>
\begin{align*}
p(\theta \mid (Y_1, X_1), \dots, (Y_n, X_n))
&\propto \theta^{ \sum_{i=1}^n Y_i } e^{-\theta \sum_{i=1}^n X_i}
\times \theta^{a-1} e^{-b \theta} \\
&\propto \theta^{ a-1 + \sum_{i=1}^n Y_i } e^{ - \theta (b + \sum_{i=1}^n X_i) }
\end{align*}

<p>
以上より、事後分布は、
Gamma(\(a + \sum_{i=1}^n Y_i, b + \sum_{i=1}^n X_i\))
に従う。
</p>
</div>
</div>
</div>
<div id="outline-container-org4b93e8e" class="outline-4">
<h4 id="org4b93e8e">b)</h4>
<div class="outline-text-4" id="text-org4b93e8e">
</div>
<div id="outline-container-orgfd50e44" class="outline-5">
<h5 id="orgfd50e44">answer</h5>
<div class="outline-text-5" id="text-orgfd50e44">
<div class="org-src-container">
<pre class="src src-julia">cancer_noreact=DataFrame<span style="color: #51afef;">(</span>readdlm<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"./Exercises/cancer_noreact.dat"</span>, skipstart=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span>, <span style="color: #a991f1;">:auto</span><span style="color: #51afef;">)</span>;
sx&#8321;, sy&#8321; = sum.<span style="color: #51afef;">(</span>eachcol<span style="color: #C57BDB;">(</span>cancer_noreact<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">cancer_react=DataFrame<span style="color: #51afef;">(</span>readdlm<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"./Exercises/cancer_react.dat"</span>, skipstart=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span>, <span style="color: #a991f1;">:auto</span><span style="color: #51afef;">)</span>;
sx&#8322;, sy&#8322; = sum.<span style="color: #51afef;">(</span>eachcol<span style="color: #C57BDB;">(</span>cancer_react<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
nuclear reactors に近い地域では、
</p>
\begin{align*}
\sum_{i=1}^n X_i &= 95 \\
\sum_{i=1}^n Y_i &= 256
\end{align*}

<p>
nuclear reactors に近くない地域では、
</p>
\begin{align*}
\sum_{i=1}^n X_i &= 1037 \\
\sum_{i=1}^n Y_i &= 2285
\end{align*}

<p>
であることから、\(\theta_1, \theta_2\)それぞれの事後分布は、
</p>
\begin{align*}
\theta_1 &\sim \text{Gamma}(a_1 + 2285, b_1 + 1037) \\
\theta_2 &\sim \text{Gamma}(a_2 + 256, b_2 + 95)
\end{align*}
<p>
である。
</p>
</div>
</div>
</div>
<div id="outline-container-org1c56151" class="outline-4">
<h4 id="org1c56151">c)</h4>
<div class="outline-text-4" id="text-org1c56151">
</div>
<div id="outline-container-org0ece572" class="outline-5">
<h5 id="org0ece572">i</h5>
<div class="outline-text-5" id="text-org0ece572">
</div>
<div id="outline-container-org08d92e7" class="outline-6">
<h6 id="org08d92e7">answer</h6>
<div class="outline-text-6" id="text-org08d92e7">
<div class="org-src-container">
<pre class="src src-julia">a&#8321;, b&#8321; = <span style="color: #e69055; font-weight: bold;">2.2</span> <span style="color: #FCCE7B;">*</span> <span style="color: #e69055; font-weight: bold;">100</span>, <span style="color: #e69055; font-weight: bold;">100</span>
a&#8322;, b&#8322; = <span style="color: #e69055; font-weight: bold;">2.2</span> <span style="color: #FCCE7B;">*</span> <span style="color: #e69055; font-weight: bold;">100</span>, <span style="color: #e69055; font-weight: bold;">100</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_1 = Gamma<span style="color: #51afef;">(</span>a&#8321; <span style="color: #FCCE7B;">+</span> sy&#8321;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8321; <span style="color: #FCCE7B;">+</span> sx&#8321;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_2 = Gamma<span style="color: #51afef;">(</span>a&#8322; <span style="color: #FCCE7B;">+</span> sy&#8322;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8322; <span style="color: #FCCE7B;">+</span> sx&#8322;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

mean_1 = round<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>a&#8321; <span style="color: #FCCE7B;">+</span> sy&#8321;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8321; <span style="color: #FCCE7B;">+</span> sx&#8321;<span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
mean_2 = round<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>a&#8322; <span style="color: #FCCE7B;">+</span> sy&#8322;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8322; <span style="color: #FCCE7B;">+</span> sx&#8322;<span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">[</span><span style="color: #7bc275;">"Posterior mean of Group 1:  $mean_1"</span>
 , <span style="color: #7bc275;">"Posterior mean of Group 2:  $mean_2"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Posterior mean of Group 1:  2.2</td>
</tr>

<tr>
<td class="org-left">Posterior mean of Group 2:  2.44</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">95% quantile-based confidence intervals</span>
ci_1 = round.<span style="color: #51afef;">(</span>quantile.<span style="color: #C57BDB;">(</span>dist_1, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
ci_2 = round.<span style="color: #51afef;">(</span>quantile.<span style="color: #C57BDB;">(</span>dist_2, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">[</span><span style="color: #7bc275;">"95% CI of Group 1:  $ci_1"</span>
    , <span style="color: #7bc275;">"95% CI of Group 2:  $ci_2"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">95% CI of Group 1:  [2.12, 2.29]</td>
</tr>

<tr>
<td class="org-left">95% CI of Group 2:  [2.23, 2.67]</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia">&#952;&#8321;_mc = rand<span style="color: #51afef;">(</span>dist_1, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>;
&#952;&#8322;_mc = rand<span style="color: #51afef;">(</span>dist_2, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>;
<span style="color: #7bc275;">"Pr(&#952;&#8322;&gt;&#952;&#8321;|data) = $(mean(&#952;&#8321;_mc .&lt; &#952;&#8322;_mc))"</span>
</pre>
</div>

<pre class="example">
"Pr(θ₂&gt;θ₁|data) = 0.9788"
</pre>



<div id="org741448b" class="figure">
<p><img src="fig/ch4/exercise4_5ci.png" alt="exercise4_5ci.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga64ba7d" class="outline-5">
<h5 id="orga64ba7d">ii.</h5>
<div class="outline-text-5" id="text-orga64ba7d">
</div>
<div id="outline-container-orgf882e53" class="outline-6">
<h6 id="orgf882e53">answer</h6>
<div class="outline-text-6" id="text-orgf882e53">
<div class="org-src-container">
<pre class="src src-julia">a&#8321;, b&#8321; = <span style="color: #e69055; font-weight: bold;">2.2</span> <span style="color: #FCCE7B;">*</span> <span style="color: #e69055; font-weight: bold;">100</span>, <span style="color: #e69055; font-weight: bold;">100</span>
a&#8322;, b&#8322; = <span style="color: #e69055; font-weight: bold;">2.2</span> , <span style="color: #e69055; font-weight: bold;">1</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_1 = Gamma<span style="color: #51afef;">(</span>a&#8321; <span style="color: #FCCE7B;">+</span> sy&#8321;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8321; <span style="color: #FCCE7B;">+</span> sx&#8321;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_2 = Gamma<span style="color: #51afef;">(</span>a&#8322; <span style="color: #FCCE7B;">+</span> sy&#8322;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8322; <span style="color: #FCCE7B;">+</span> sx&#8322;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

mean_1 = round<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>a&#8321; <span style="color: #FCCE7B;">+</span> sy&#8321;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8321; <span style="color: #FCCE7B;">+</span> sx&#8321;<span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
mean_2 = round<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>a&#8322; <span style="color: #FCCE7B;">+</span> sy&#8322;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8322; <span style="color: #FCCE7B;">+</span> sx&#8322;<span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">[</span><span style="color: #7bc275;">"Posterior mean of Group 1:  $mean_1"</span>
 , <span style="color: #7bc275;">"Posterior mean of Group 2:  $mean_2"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Posterior mean of Group 1:  2.2</td>
</tr>

<tr>
<td class="org-left">Posterior mean of Group 2:  2.69</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">95% quantile-based confidence intervals</span>
ci_1 = round.<span style="color: #51afef;">(</span>quantile.<span style="color: #C57BDB;">(</span>dist_1, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
ci_2 = round.<span style="color: #51afef;">(</span>quantile.<span style="color: #C57BDB;">(</span>dist_2, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">[</span><span style="color: #7bc275;">"95% CI of Group 1:  $ci_1"</span>
    , <span style="color: #7bc275;">"95% CI of Group 2:  $ci_2"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">95% CI of Group 1:  [2.12, 2.29]</td>
</tr>

<tr>
<td class="org-left">95% CI of Group 2:  [2.37, 3.03]</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia">&#952;&#8321;_mc = rand<span style="color: #51afef;">(</span>dist_1, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>;
&#952;&#8322;_mc = rand<span style="color: #51afef;">(</span>dist_2, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>;
<span style="color: #7bc275;">"Pr(&#952;&#8322;&gt;&#952;&#8321;|data) = $(mean(&#952;&#8321;_mc .&lt; &#952;&#8322;_mc))"</span>
</pre>
</div>

<pre class="example">
"Pr(θ₂&gt;θ₁|data) = 0.9992"
</pre>



<div id="orge3ad119" class="figure">
<p><img src="fig/ch4/exercise4_5cii.png" alt="exercise4_5cii.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga8de494" class="outline-5">
<h5 id="orga8de494">iii.</h5>
<div class="outline-text-5" id="text-orga8de494">
</div>
<div id="outline-container-org6dcb38f" class="outline-6">
<h6 id="org6dcb38f">answer</h6>
<div class="outline-text-6" id="text-org6dcb38f">
<div class="org-src-container">
<pre class="src src-julia">a&#8321;, b&#8321; = <span style="color: #e69055; font-weight: bold;">2.2</span> , <span style="color: #e69055; font-weight: bold;">1</span>
a&#8322;, b&#8322; = <span style="color: #e69055; font-weight: bold;">2.2</span> , <span style="color: #e69055; font-weight: bold;">1</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_1 = Gamma<span style="color: #51afef;">(</span>a&#8321; <span style="color: #FCCE7B;">+</span> sy&#8321;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8321; <span style="color: #FCCE7B;">+</span> sx&#8321;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_2 = Gamma<span style="color: #51afef;">(</span>a&#8322; <span style="color: #FCCE7B;">+</span> sy&#8322;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8322; <span style="color: #FCCE7B;">+</span> sx&#8322;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

mean_1 = round<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>a&#8321; <span style="color: #FCCE7B;">+</span> sy&#8321;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8321; <span style="color: #FCCE7B;">+</span> sx&#8321;<span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
mean_2 = round<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>a&#8322; <span style="color: #FCCE7B;">+</span> sy&#8322;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8322; <span style="color: #FCCE7B;">+</span> sx&#8322;<span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">[</span><span style="color: #7bc275;">"Posterior mean of Group 1:  $mean_1"</span>
 , <span style="color: #7bc275;">"Posterior mean of Group 2:  $mean_2"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Posterior mean of Group 1:  2.2</td>
</tr>

<tr>
<td class="org-left">Posterior mean of Group 2:  2.69</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">95% quantile-based confidence intervals</span>
ci_1 = round.<span style="color: #51afef;">(</span>quantile.<span style="color: #C57BDB;">(</span>dist_1, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
ci_2 = round.<span style="color: #51afef;">(</span>quantile.<span style="color: #C57BDB;">(</span>dist_2, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">[</span><span style="color: #7bc275;">"95% CI of Group 1:  $ci_1"</span>
    , <span style="color: #7bc275;">"95% CI of Group 2:  $ci_2"</span><span style="color: #51afef;">]</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">95% CI of Group 1:  [2.11, 2.29]</td>
</tr>

<tr>
<td class="org-left">95% CI of Group 2:  [2.37, 3.03]</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-julia">&#952;&#8321;_mc = rand<span style="color: #51afef;">(</span>dist_1, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>;
&#952;&#8322;_mc = rand<span style="color: #51afef;">(</span>dist_2, <span style="color: #e69055; font-weight: bold;">10000</span><span style="color: #51afef;">)</span>;
<span style="color: #7bc275;">"Pr(&#952;&#8322;&gt;&#952;&#8321;|data) = $(mean(&#952;&#8321;_mc .&lt; &#952;&#8322;_mc))"</span>
</pre>
</div>

<pre class="example">
"Pr(θ₂&gt;θ₁|data) = 0.9984"
</pre>



<div id="orgffbc5e8" class="figure">
<p><img src="fig/ch4/exercise4_5ciii.png" alt="exercise4_5ciii.png" width="500" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orge87a22c" class="outline-4">
<h4 id="orge87a22c">d)</h4>
<div class="outline-text-4" id="text-orge87a22c">
</div>
<div id="outline-container-orgad760c4" class="outline-5">
<h5 id="orgad760c4">answer</h5>
<div class="outline-text-5" id="text-orgad760c4">
<p>
「人口が多い地域は、人口が少ない地域よりも医療が充実しており、がんになった場合の生存率が高い可能性がある」など考えることもできるので、人口規模と致死率が独立していると考えるのは必ずしも合理的であると言えない。
</p>

<p>
そこで、
\( \theta_i \sim \exp(\beta_0 + \beta_1 X_i) \)
などとして、階層モデルを考えるなどする。
</p>
</div>
</div>
</div>
<div id="outline-container-orgbff32f0" class="outline-4">
<h4 id="orgbff32f0">e)</h4>
<div class="outline-text-4" id="text-orgbff32f0">
</div>
<div id="outline-container-orgbcfbeb0" class="outline-5">
<h5 id="orgbcfbeb0">Answer</h5>
<div class="outline-text-5" id="text-orgbcfbeb0">
\begin{align*}
\theta_1 &\sim w \times \text{Beta}(a_1, b_1) + (1-w) \times \text{Beta}(a_2, b_2) \\
\theta_2 &\sim w \times \text{Beta}(a_2, b_2) + (1-w) \times \text{Beta}(a_1, b_1)
\end{align*}

<p>
のような形で、それぞれの事前分布を重み付きの混合分布にすることで、事前従属にできる。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org67d2120" class="outline-3">
<h3 id="org67d2120">4.6</h3>
<div class="outline-text-3" id="text-org67d2120">
</div>
<div id="outline-container-orgd090069" class="outline-4">
<h4 id="orgd090069">answer</h4>
<div class="outline-text-4" id="text-orgd090069">
<div class="org-src-container">
<pre class="src src-julia">a, b = <span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">1</span>
&#952;_prior_mc = rand<span style="color: #51afef;">(</span>Beta<span style="color: #C57BDB;">(</span>a, b<span style="color: #C57BDB;">)</span>, <span style="color: #e69055; font-weight: bold;">1000000</span><span style="color: #51afef;">)</span>
&#947;_prior_mc = map<span style="color: #51afef;">(</span>&#952; <span style="color: #FCCE7B;">-&gt;</span> log<span style="color: #C57BDB;">(</span>&#952;<span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">-</span>&#952;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, &#952;_prior_mc<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org78d99e2" class="figure">
<p><img src="fig/ch4/exercise4_6.png" alt="exercise4_6.png" width="500" />
</p>
</div>

<p>
This prior is informative about \( \gamma \) because this gives us information that \( \gamma \) is symmetrically distributed around 0.
</p>
</div>
</div>
</div>
<div id="outline-container-org79ac863" class="outline-3">
<h3 id="org79ac863">4.7</h3>
<div class="outline-text-3" id="text-org79ac863">
</div>
<div id="outline-container-org83cc727" class="outline-4">
<h4 id="org83cc727">a)</h4>
<div class="outline-text-4" id="text-org83cc727">
</div>
<div id="outline-container-orge5a0f48" class="outline-5">
<h5 id="orge5a0f48">answer</h5>
<div class="outline-text-5" id="text-orge5a0f48">
<div class="org-src-container">
<pre class="src src-julia">Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>
dist_inv_&#963;&#178; = Gamma<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2.5</span><span style="color: #51afef;">)</span>
dist_&#952; = &#963;&#178; <span style="color: #FCCE7B;">-&gt;</span> Normal<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">4.1</span>, &#963;&#178;<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">20</span><span style="color: #51afef;">)</span>

&#960; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">0.31</span>, <span style="color: #e69055; font-weight: bold;">0.46</span>, <span style="color: #e69055; font-weight: bold;">0.23</span><span style="color: #51afef;">]</span>
t = Multinomial<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>, &#960;<span style="color: #51afef;">)</span>
dist_list = <span style="color: #51afef;">(</span>&#952;, &#963;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">-&gt;</span> <span style="color: #51afef;">[</span>Normal<span style="color: #C57BDB;">(</span>&#952;, &#963;<span style="color: #C57BDB;">)</span>, Normal<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">2</span>&#952;, <span style="color: #e69055; font-weight: bold;">2</span>&#963;<span style="color: #C57BDB;">)</span>, Normal<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">3</span>&#952;, <span style="color: #e69055; font-weight: bold;">3</span>&#963;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span>
y_mc = Array<span style="color: #51afef;">{</span>Float64, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">}()</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">5000</span>
    inv_&#963;&#178; = rand<span style="color: #51afef;">(</span>dist_inv_&#963;&#178;<span style="color: #51afef;">)</span>
    &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> inv_&#963;&#178;
    &#963; = sqrt<span style="color: #51afef;">(</span>&#963;&#178;<span style="color: #51afef;">)</span>
    &#952; = rand<span style="color: #51afef;">(</span>dist_&#952;<span style="color: #C57BDB;">(</span>&#963;&#178;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    w = rand<span style="color: #51afef;">(</span>t<span style="color: #51afef;">)</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span>
    dist_pred = dist_list<span style="color: #51afef;">(</span>&#952;, &#963;<span style="color: #51afef;">)[</span>w<span style="color: #51afef;">][</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
    y = rand<span style="color: #51afef;">(</span>dist_pred<span style="color: #51afef;">)</span>
    append!<span style="color: #51afef;">(</span>y_mc, y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>


<div id="orgd894c2d" class="figure">
<p><img src="fig/ch4/exercise4_7a.png" alt="exercise4_7a.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org2a9e828" class="outline-4">
<h4 id="org2a9e828">b)</h4>
<div class="outline-text-4" id="text-org2a9e828">
</div>
<div id="outline-container-orgec1d520" class="outline-5">
<h5 id="orgec1d520">answer</h5>
<div class="outline-text-5" id="text-orgec1d520">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">75% quantile</span>
prob = <span style="color: #e69055; font-weight: bold;">0.75</span>
lower = <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> prob<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>
upper = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> lower
ci_quantile = quantile<span style="color: #51afef;">(</span>y_mc, <span style="color: #C57BDB;">[</span>lower, upper<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{Float64}:
  3.954945418674755
 12.059043291517227
</pre>
</div>
</div>
</div>
<div id="outline-container-org61a09b8" class="outline-4">
<h4 id="org61a09b8">c)</h4>
<div class="outline-text-4" id="text-org61a09b8">
</div>
<div id="outline-container-orgd6cbd67" class="outline-5">
<h5 id="orgd6cbd67">answer</h5>
<div class="outline-text-5" id="text-orgd6cbd67">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">i</span>
sorted_y_mc = sort<span style="color: #51afef;">(</span>y_mc<span style="color: #51afef;">)</span>
y_density = kerneldensity<span style="color: #51afef;">(</span>y_mc<span style="color: #51afef;">)</span>
y_density_normalized = y_density <span style="color: #FCCE7B;">./</span> sum<span style="color: #51afef;">(</span>y_density<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">ii</span>
y_density_sorted = sort<span style="color: #51afef;">(</span>y_density_normalized, rev=<span style="color: #a991f1;">true</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">iii</span>
y_density_sorted_cumsum = cumsum<span style="color: #51afef;">(</span>y_density_sorted<span style="color: #51afef;">)</span>
threshhold_cumsum_idx = findfirst<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x <span style="color: #FCCE7B;">&gt;</span> prob, y_density_sorted_cumsum<span style="color: #51afef;">)</span>
y_density_sorted_cumsum<span style="color: #51afef;">[</span>threshhold_cumsum_idx<span style="color: #51afef;">]</span>
threshhold_prob = y_density_sorted<span style="color: #51afef;">[</span>threshhold_cumsum_idx<span style="color: #51afef;">]</span>
</pre>
</div>


<div id="org3037ac2" class="figure">
<p><img src="fig/ch4/exercise4_7c.png" alt="exercise4_7c.png" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orge585d17" class="outline-4">
<h4 id="orge585d17">d)</h4>
<div class="outline-text-4" id="text-orge585d17">
</div>
<div id="outline-container-org52b9e88" class="outline-5">
<h5 id="org52b9e88">answer</h5>
<div class="outline-text-5" id="text-org52b9e88">
<p>
The model is as follows:
</p>
\begin{align*}
\boldsymbol{w} = \begin{pmatrix} w_1 \\ w_2 \\ w_3 \end{pmatrix} &\sim \text{Multinomial}(0.31, 0.46, 0.23) \\
\sigma^2 &\sim \text{InverseGamma}(10, 2.5) \\
\theta | \sigma^2 &\sim \text{Normal}(4.1, \sigma^2/20) \\
y | \theta, \sigma^2, \boldsymbol{w}
&\sim w_1 \mathcal{N}(\theta, \sigma^2) + w_2 \mathcal{N}(2 \theta, 2 \sigma^2) + w_3 \mathcal{N}(3 \theta, 3 \sigma^2)
\end{align*}

<p>
Then the marginal distribution of \(Y\) is
</p>
\begin{align*}
p(y)
&= \int \int \int p(y, \theta, \sigma^2, \boldsymbol{w}) d\theta d\sigma^2 d\boldsymbol{w} \\
&= \int \int \int p(y | \theta, \sigma^2, \boldsymbol{w}) p(\theta | \sigma^2) p(\sigma^2) p(\boldsymbol{w}) d\theta d\sigma^2 d\boldsymbol{w}. \\
\end{align*}
<p>
Therefore, \(Y\) can be sampled from the following procedure:
</p>
<ol class="org-ol">
<li>Sample \(\sigma^{2(s)} \sim p(\sigma^2) \).</li>
<li>Sample \(\theta^{(s)} \sim p(\theta | \sigma^{2(s)}) \).</li>
<li>Sample \(\boldsymbol{w}^{(s)} \sim p(\boldsymbol{w})\).</li>
<li>Sample \(y^{(s)} \sim p(y | \theta^{(s)}, \sigma^{2(s)}, \boldsymbol{w}^{(s)})\).</li>
</ol>

<p>
Then, the empirical distribution of
\(\{y^{(1)}, \dots, y^{(s)}\} \to p(y)\) as \(s \to \infty\).
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org6334b0d" class="outline-3">
<h3 id="org6334b0d">4.8</h3>
<div class="outline-text-3" id="text-org6334b0d">
</div>
<div id="outline-container-orgbe3772a" class="outline-4">
<h4 id="orgbe3772a">a)</h4>
<div class="outline-text-4" id="text-orgbe3772a">
</div>
<div id="outline-container-orgc4830c5" class="outline-5">
<h5 id="orgc4830c5">answer</h5>
<div class="outline-text-5" id="text-orgc4830c5">
<div class="org-src-container">
<pre class="src src-julia">menchild_bach = <span style="color: #51afef;">[]</span>
open<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/menchild30bach.dat"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">do</span> file
    <span style="color: #51afef;">for</span> line <span style="color: #51afef;">in</span> eachline<span style="color: #51afef;">(</span>file<span style="color: #51afef;">)</span>
        append!<span style="color: #51afef;">(</span>menchild_bach, parse.<span style="color: #C57BDB;">(</span>Int, split<span style="color: #7bc275;">(</span>line<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

menchild_nobach = <span style="color: #51afef;">[]</span>
open<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/menchild30nobach.dat"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">do</span> file
    <span style="color: #51afef;">for</span> line <span style="color: #51afef;">in</span> eachline<span style="color: #51afef;">(</span>file<span style="color: #51afef;">)</span>
        append!<span style="color: #51afef;">(</span>menchild_nobach, parse.<span style="color: #C57BDB;">(</span>Int, split<span style="color: #7bc275;">(</span>line<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">data</span>
sy_A = sum<span style="color: #51afef;">(</span>menchild_bach<span style="color: #51afef;">)</span>
n_A = length<span style="color: #51afef;">(</span>menchild_bach<span style="color: #51afef;">)</span>

sy_B = sum<span style="color: #51afef;">(</span>menchild_nobach<span style="color: #51afef;">)</span>
n_B = length<span style="color: #51afef;">(</span>menchild_nobach<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">prior parameters</span>
a&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
b&#8320; = <span style="color: #e69055; font-weight: bold;">1</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Posterior distributions</span>
dist_&#952;_A = Gamma<span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> sy_A, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320; <span style="color: #FCCE7B;">+</span> n_A<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
dist_&#952;_B = Gamma<span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b&#8320; <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Monte Carlo samples</span>
&#952;_A_mc = rand<span style="color: #51afef;">(</span>dist_&#952;_A, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
&#952;_B_mc = rand<span style="color: #51afef;">(</span>dist_&#952;_B, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
y_A_mc = rand.<span style="color: #51afef;">(</span>Poisson.<span style="color: #C57BDB;">(</span>&#952;_A_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
y_B_mc = rand.<span style="color: #51afef;">(</span>Poisson.<span style="color: #C57BDB;">(</span>&#952;_B_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

</pre>
</div>


<div id="org313d10d" class="figure">
<p><img src="fig/ch4/exercise4_8a.jpg" alt="exercise4_8a.jpg" width="500" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf3e480a" class="outline-4">
<h4 id="orgf3e480a">b)</h4>
<div class="outline-text-4" id="text-orgf3e480a">
</div>
<div id="outline-container-org6c30338" class="outline-5">
<h5 id="org6c30338">answer</h5>
<div class="outline-text-5" id="text-org6c30338">
<p>
for \(\theta_B - \theta_A\):
</p>

<div class="org-src-container">
<pre class="src src-julia">quantile<span style="color: #51afef;">(</span>&#952;_B_mc .<span style="color: #FCCE7B;">-</span> &#952;_A_mc, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{Float64}:
 0.14453032216400238
 0.7359150252471184
</pre>



<p>
for \(\hat{Y}_B - \hat{Y}_A\):
</p>

<div class="org-src-container">
<pre class="src src-julia">quantile<span style="color: #51afef;">(</span>y_B_mc .<span style="color: #FCCE7B;">-</span> y_A_mc, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{Float64}:
 -2.0
  4.0
</pre>
</div>
</div>
</div>
<div id="outline-container-org29c0eea" class="outline-4">
<h4 id="org29c0eea">c)</h4>
<div class="outline-text-4" id="text-org29c0eea">
</div>
<div id="outline-container-org86d7ac7" class="outline-5">
<h5 id="org86d7ac7">answer</h5>
<div class="outline-text-5" id="text-org86d7ac7">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">(</span>a&#8320; <span style="color: #FCCE7B;">+</span> sy_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>b&#8320; <span style="color: #FCCE7B;">+</span> n_B<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
1.4018264840182648
</pre>


<p>
\(\hat{\theta} = 1.4 \)はほぼ\(\theta_B\)の事後平均。
</p>


<div id="org06cfda1" class="figure">
<p><img src="fig/ch4/exercise4_8_c.png" alt="exercise4_8_c.png" width="500" />
</p>
</div>


<p>
モデルはデータに比べて、子供の数が 1 人の人の割合が多く、0人と 2 人の割合が少ない。
Poisson モデルは峰が２つあるような分布を表現できないので、もし母集団の分布が上の empirical distribution のように、0と 2 の２点でピークを持つような分布であれば、Poisson モデルは適切ではないと考えられる。
</p>
</div>
</div>
</div>
<div id="outline-container-org08bd0b1" class="outline-4">
<h4 id="org08bd0b1">d)</h4>
<div class="outline-text-4" id="text-org08bd0b1">
</div>
<div id="outline-container-org31b5a25" class="outline-5">
<h5 id="org31b5a25">answer</h5>
<div class="outline-text-5" id="text-org31b5a25">
<div class="org-src-container">
<pre class="src src-julia">obs_zero = sum<span style="color: #51afef;">(</span>menchild_nobach .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
obs_one = sum<span style="color: #51afef;">(</span>menchild_nobach .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
num_zero = <span style="color: #51afef;">[]</span>
num_one = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> &#952; <span style="color: #51afef;">in</span> &#952;_B_mc
    y_mc = rand<span style="color: #51afef;">(</span>Poisson<span style="color: #C57BDB;">(</span>&#952;<span style="color: #C57BDB;">)</span>, n_B<span style="color: #51afef;">)</span>
    push!<span style="color: #51afef;">(</span>num_zero, sum<span style="color: #C57BDB;">(</span>y_mc .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    push!<span style="color: #51afef;">(</span>num_one, sum<span style="color: #C57BDB;">(</span>y_mc .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>


<div id="orgefc12b9" class="figure">
<p><img src="fig/ch4/exercise4_8d.png" alt="exercise4_8d.png" width="500" />
</p>
</div>

<p>
上図より、Poisson モデルが母集団の真の分布であると仮定すると、今回の標本が観測される可能性は極めて低いことがわかる。よって、Poisson モデルは適切ではないと考えられる。
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org46ef922" class="outline-2">
<h2 id="org46ef922">Chapter 5</h2>
<div class="outline-text-2" id="text-org46ef922">
</div>
<div id="outline-container-orgb424b1b" class="outline-3">
<h3 id="orgb424b1b">5.1</h3>
<div class="outline-text-3" id="text-orgb424b1b">
</div>
<div id="outline-container-org63f49a1" class="outline-4">
<h4 id="org63f49a1">a)</h4>
<div class="outline-text-4" id="text-org63f49a1">
</div>
<div id="outline-container-org3b9d521" class="outline-5">
<h5 id="org3b9d521">answer</h5>
<div class="outline-text-5" id="text-org3b9d521">
<div class="org-src-container">
<pre class="src src-julia">school1 = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"./Exercises/school1.dat"</span><span style="color: #51afef;">)</span>
school2 = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"./Exercises/school2.dat"</span><span style="color: #51afef;">)</span>
school3 = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"./Exercises/school3.dat"</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
&#956;&#8320; = <span style="color: #e69055; font-weight: bold;">5</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">4</span>
&#954;&#8320; = <span style="color: #e69055; font-weight: bold;">1</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
n1 = length<span style="color: #51afef;">(</span>school1<span style="color: #51afef;">)</span>
n2 = length<span style="color: #51afef;">(</span>school2<span style="color: #51afef;">)</span>
n3 = length<span style="color: #51afef;">(</span>school3<span style="color: #51afef;">)</span>

y&#772;&#8321; = mean<span style="color: #51afef;">(</span>school1<span style="color: #51afef;">)</span>
y&#772;&#8322; = mean<span style="color: #51afef;">(</span>school2<span style="color: #51afef;">)</span>
y&#772;&#8323; = mean<span style="color: #51afef;">(</span>school3<span style="color: #51afef;">)</span>

s&#8321;&#178; = var<span style="color: #51afef;">(</span>school1<span style="color: #51afef;">)</span>
s&#8322;&#178; = var<span style="color: #51afef;">(</span>school2<span style="color: #51afef;">)</span>
s&#8323;&#178; = var<span style="color: #51afef;">(</span>school3<span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">calc_posterior_param</span><span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;<span style="color: #51afef;">)</span>
    &#954;n = &#954;&#8320; <span style="color: #FCCE7B;">+</span> n
    &#957;n = &#957;&#8320; <span style="color: #FCCE7B;">+</span> n
    &#956;n =  <span style="color: #51afef;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">*</span> &#956;&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> y&#772;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> &#954;n
    &#963;&#178;n = <span style="color: #51afef;">(</span>&#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>n<span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> s&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">*</span> n <span style="color: #FCCE7B;">*</span> <span style="color: #7bc275;">(</span>y&#772; <span style="color: #FCCE7B;">-</span> &#956;&#8320;<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">/</span> &#954;n <span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> &#957;n

    <span style="color: #51afef;">return</span> &#954;n, &#957;n, &#956;n, &#963;&#178;n
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">calc_mc</span><span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, n_mc<span style="color: #51afef;">)</span>
    &#954;n, &#957;n, &#956;n, &#963;&#178;n = calc_posterior_param<span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;<span style="color: #51afef;">)</span>
    dist_inverse_&#963;&#178; = Gamma<span style="color: #51afef;">(</span>&#957;n<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>&#957;n <span style="color: #FCCE7B;">*</span> &#963;&#178;n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    &#963;&#178;_mc = rand<span style="color: #51afef;">(</span>dist_inverse_&#963;&#178;, n_mc<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">.^</span> <span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span>

    calc_&#952;_mc = &#963;&#178; <span style="color: #FCCE7B;">-&gt;</span> rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#956;n, sqrt<span style="color: #7bc275;">(</span>&#963;&#178;<span style="color: #FCCE7B;">/</span>&#954;n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    &#952;_mc = calc_&#952;_mc.<span style="color: #51afef;">(</span>&#963;&#178;_mc<span style="color: #51afef;">)</span>

    <span style="color: #51afef;">return</span> &#952;_mc, sqrt.<span style="color: #51afef;">(</span>&#963;&#178;_mc<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">write_quantile_ci</span><span style="color: #51afef;">(</span>&#952;_mc, &#963;_mc, ci<span style="color: #51afef;">)</span>
    lower = <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> ci<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>
    upper = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> lower
    &#952;_quantile = round.<span style="color: #51afef;">(</span>quantile<span style="color: #C57BDB;">(</span>&#952;_mc, <span style="color: #7bc275;">[</span>lower, upper<span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
    &#963;_quantile = round.<span style="color: #51afef;">(</span>quantile<span style="color: #C57BDB;">(</span>&#963;_mc, <span style="color: #7bc275;">[</span>lower, upper<span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, digits=<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">)</span>

    res = <span style="color: #51afef;">[</span><span style="color: #7bc275;">"$(&#952;_quantile[1]) &lt; &#952; &lt; $(&#952;_quantile[2])"</span>
            ,<span style="color: #7bc275;">"$(&#963;_quantile[1]) &lt; &#963; &lt; $(&#963;_quantile[2])"</span><span style="color: #51afef;">]</span>
    <span style="color: #51afef;">return</span> res
<span style="color: #51afef;">end</span>

</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">School 1</span>
&#952;&#8321;_mc, &#963;&#8321;_mc = calc_mc<span style="color: #51afef;">(</span>n1, y&#772;&#8321;, s&#8321;&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>;
write_quantile_ci<span style="color: #51afef;">(</span>&#952;&#8321;_mc, &#963;&#8321;_mc, <span style="color: #e69055; font-weight: bold;">0.95</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{String}:
 "7.746 &lt; θ &lt; 10.814"
 "2.985 &lt; σ &lt; 5.181"
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">School 2</span>
&#952;&#8322;_mc, &#963;&#8322;_mc = calc_mc<span style="color: #51afef;">(</span>n2, y&#772;&#8322;, s&#8322;&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>;
write_quantile_ci<span style="color: #51afef;">(</span>&#952;&#8322;_mc, &#963;&#8322;_mc, <span style="color: #e69055; font-weight: bold;">0.95</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{String}:
 "5.24 &lt; θ &lt; 8.753"
 "3.356 &lt; σ &lt; 5.91"
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">School 3</span>
&#952;&#8323;_mc, &#963;&#8323;_mc = calc_mc<span style="color: #51afef;">(</span>n3, y&#772;&#8323;, s&#8323;&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, <span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>;
write_quantile_ci<span style="color: #51afef;">(</span>&#952;&#8323;_mc, &#963;&#8323;_mc, <span style="color: #e69055; font-weight: bold;">0.95</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{String}:
 "6.129 &lt; θ &lt; 9.421"
 "2.818 &lt; σ &lt; 5.114"
</pre>
</div>
</div>
</div>
<div id="outline-container-org3bb760c" class="outline-4">
<h4 id="org3bb760c">b)</h4>
<div class="outline-text-4" id="text-org3bb760c">
</div>
<div id="outline-container-org062aea4" class="outline-5">
<h5 id="org062aea4">answer</h5>
<div class="outline-text-5" id="text-org062aea4">
<div class="org-src-container">
<pre class="src src-julia">&#952;_mcs = <span style="color: #51afef;">[</span>&#952;&#8321;_mc, &#952;&#8322;_mc, &#952;&#8323;_mc<span style="color: #51afef;">]</span>
<span style="color: #5cEfFF;">perms</span><span style="color: #51afef;">(</span>l<span style="color: #51afef;">)</span> = isempty<span style="color: #51afef;">(</span>l<span style="color: #51afef;">)</span> <span style="color: #51afef;">?</span> <span style="color: #51afef;">[</span>l<span style="color: #51afef;">]</span> <span style="color: #51afef;">:</span> <span style="color: #51afef;">[</span><span style="color: #C57BDB;">[</span>x; y<span style="color: #C57BDB;">]</span> <span style="color: #51afef;">for</span> x in l <span style="color: #51afef;">for</span> y <span style="color: #51afef;">in</span> perms<span style="color: #C57BDB;">(</span>setdiff<span style="color: #7bc275;">(</span>l, x<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span>
<span style="color: #51afef;">for</span> perm <span style="color: #51afef;">in</span> perms<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>,<span style="color: #e69055; font-weight: bold;">2</span>,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    i, j, k = perm
    p = mean<span style="color: #51afef;">(</span>&#952;_mcs<span style="color: #C57BDB;">[</span>i<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">&lt;</span> &#952;_mcs<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">&lt;</span> &#952;_mcs<span style="color: #C57BDB;">[</span>k<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"p(&#952;$i &lt; &#952;$j &lt; &#952;$k) = $p"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<pre class="example">
p(θ1 &lt; θ2 &lt; θ3) = 0.0084
p(θ1 &lt; θ3 &lt; θ2) = 0.005
p(θ2 &lt; θ1 &lt; θ3) = 0.0904
p(θ2 &lt; θ3 &lt; θ1) = 0.6506
p(θ3 &lt; θ1 &lt; θ2) = 0.02
p(θ3 &lt; θ2 &lt; θ1) = 0.2256
</pre>
</div>
</div>
</div>
<div id="outline-container-org94dc3bc" class="outline-4">
<h4 id="org94dc3bc">c)</h4>
<div class="outline-text-4" id="text-org94dc3bc">
</div>
<div id="outline-container-org4c152f3" class="outline-5">
<h5 id="org4c152f3">answer</h5>
<div class="outline-text-5" id="text-org4c152f3">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">sample_posterior_predictive</span><span style="color: #51afef;">(</span>&#952;_mc, &#963;_mc<span style="color: #51afef;">)</span>
    y&#771;_mc = rand.<span style="color: #51afef;">(</span>Normal.<span style="color: #C57BDB;">(</span>&#952;_mc, &#963;_mc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> y&#771;_mc
<span style="color: #51afef;">end</span>

y&#771;&#8321;_mc = sample_posterior_predictive<span style="color: #51afef;">(</span>&#952;&#8321;_mc, &#963;&#8321;_mc<span style="color: #51afef;">)</span>
y&#771;&#8322;_mc = sample_posterior_predictive<span style="color: #51afef;">(</span>&#952;&#8322;_mc, &#963;&#8322;_mc<span style="color: #51afef;">)</span>
y&#771;&#8323;_mc = sample_posterior_predictive<span style="color: #51afef;">(</span>&#952;&#8323;_mc, &#963;&#8323;_mc<span style="color: #51afef;">)</span>

y&#771;_mcs = <span style="color: #51afef;">[</span>y&#771;&#8321;_mc, y&#771;&#8322;_mc, y&#771;&#8323;_mc<span style="color: #51afef;">]</span>

<span style="color: #51afef;">for</span> perm <span style="color: #51afef;">in</span> perms<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>,<span style="color: #e69055; font-weight: bold;">2</span>,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    i, j, k = perm
    p = mean<span style="color: #51afef;">(</span>y&#771;_mcs<span style="color: #C57BDB;">[</span>i<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">&lt;</span> y&#771;_mcs<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">&lt;</span> y&#771;_mcs<span style="color: #C57BDB;">[</span>k<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"p(y&#771;$i &lt; y&#771;$j &lt; y&#771;$k) = $p"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<pre class="example">
p(ỹ1 &lt; ỹ2 &lt; ỹ3) = 0.109
p(ỹ1 &lt; ỹ3 &lt; ỹ2) = 0.1008
p(ỹ2 &lt; ỹ1 &lt; ỹ3) = 0.1882
p(ỹ2 &lt; ỹ3 &lt; ỹ1) = 0.2634
p(ỹ3 &lt; ỹ1 &lt; ỹ2) = 0.1498
p(ỹ3 &lt; ỹ2 &lt; ỹ1) = 0.1888
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc0a3c31" class="outline-4">
<h4 id="orgc0a3c31">d)</h4>
<div class="outline-text-4" id="text-orgc0a3c31">
</div>
<div id="outline-container-org3400585" class="outline-5">
<h5 id="org3400585">answer</h5>
<div class="outline-text-5" id="text-org3400585">
<p>
上の計算結果を用いて、
</p>
\begin{align*}
Pr(\theta_1 > \theta_2, \theta_1 > \theta_3 | \text{data})
&= Pr(\theta_1 > \theta_2 > \theta_3 | \text{data}) + Pr(\theta_1 > \theta_3 > \theta_2 | \text{data}) \\
&= 0.6506 + 0.2256 = 0.8762 \\
\\
Pr(\tilde{Y}_1 > \tilde{Y}_2, \tilde{Y}_1 > \tilde{Y}_3 | \text{data})
&= Pr(\tilde{Y}_1 > \tilde{Y}_2 > \tilde{Y}_3 | \text{data}) + Pr(\tilde{Y}_1 > \tilde{Y}_3 > \tilde{Y}_2 | \text{data}) \\
&= 0.2634 + 0.1888 = 0.4522
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-orgee48805" class="outline-3">
<h3 id="orgee48805">5.2</h3>
<div class="outline-text-3" id="text-orgee48805">
</div>
<div id="outline-container-org706501d" class="outline-4">
<h4 id="org706501d">answer</h4>
<div class="outline-text-4" id="text-org706501d">
<div class="org-src-container">
<pre class="src src-julia">&#956;&#8320; = <span style="color: #e69055; font-weight: bold;">75</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">100</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
n_A = <span style="color: #e69055; font-weight: bold;">16</span>
n_B = <span style="color: #e69055; font-weight: bold;">16</span>

y&#772;_A = <span style="color: #e69055; font-weight: bold;">75.2</span>
y&#772;_B = <span style="color: #e69055; font-weight: bold;">77.5</span>

s_A = <span style="color: #e69055; font-weight: bold;">7.3</span>
s_B = <span style="color: #e69055; font-weight: bold;">8.1</span>

calc_&#956;n = <span style="color: #51afef;">(</span>n, y&#772;, &#956;&#8320;, &#954;&#8320;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">-&gt;</span> <span style="color: #51afef;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">*</span> &#956;&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> y&#772;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">+</span> n<span style="color: #51afef;">)</span>
calc_&#963;&#178;n = <span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">-&gt;</span> <span style="color: #51afef;">(</span>&#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>n<span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> s&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">*</span> n <span style="color: #FCCE7B;">*</span> <span style="color: #7bc275;">(</span>y&#772; <span style="color: #FCCE7B;">-</span> &#956;&#8320;<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #C57BDB;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">+</span> n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>&#957;&#8320; <span style="color: #FCCE7B;">+</span> n<span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">calc_posterior_param</span><span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;<span style="color: #51afef;">)</span>
    &#954;n = &#954;&#8320; <span style="color: #FCCE7B;">+</span> n
    &#957;n = &#957;&#8320; <span style="color: #FCCE7B;">+</span> n
    &#956;n =  <span style="color: #51afef;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">*</span> &#956;&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> y&#772;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> &#954;n
    &#963;&#178;n = <span style="color: #51afef;">(</span>&#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>n<span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> s&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>&#954;&#8320; <span style="color: #FCCE7B;">*</span> n <span style="color: #FCCE7B;">*</span> <span style="color: #7bc275;">(</span>y&#772; <span style="color: #FCCE7B;">-</span> &#956;&#8320;<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">/</span> &#954;n <span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> &#957;n

    <span style="color: #51afef;">return</span> &#954;n, &#957;n, &#956;n, &#963;&#178;n
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">calc_mc</span><span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, n_mc<span style="color: #51afef;">)</span>
    &#954;n, &#957;n, &#956;n, &#963;&#178;n = calc_posterior_param<span style="color: #51afef;">(</span>n, y&#772;, s&#178;, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;<span style="color: #51afef;">)</span>
    dist_inverse_&#963;&#178; = Gamma<span style="color: #51afef;">(</span>&#957;n<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>&#957;n <span style="color: #FCCE7B;">*</span> &#963;&#178;n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    &#963;&#178;_mc = rand<span style="color: #51afef;">(</span>dist_inverse_&#963;&#178;, n_mc<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">.^</span> <span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span>

    calc_&#952;_mc = &#963;&#178; <span style="color: #FCCE7B;">-&gt;</span> rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#956;n, sqrt<span style="color: #7bc275;">(</span>&#963;&#178;<span style="color: #FCCE7B;">/</span>&#954;n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    &#952;_mc = calc_&#952;_mc.<span style="color: #51afef;">(</span>&#963;&#178;_mc<span style="color: #51afef;">)</span>

    <span style="color: #51afef;">return</span> &#952;_mc, sqrt.<span style="color: #51afef;">(</span>&#963;&#178;_mc<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

m = <span style="color: #e69055; font-weight: bold;">10000</span>
prob_A_lt_B = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> k in <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">^</span>i <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">5</span><span style="color: #51afef;">]</span>
    &#954;&#8320;, &#957;&#8320; = k, k
    &#952;_mc_A, &#963;_mc_A = calc_mc<span style="color: #51afef;">(</span>n_A, y&#772;_A, s_A<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, m<span style="color: #51afef;">)</span>
    &#952;_mc_B, &#963;_mc_B = calc_mc<span style="color: #51afef;">(</span>n_B, y&#772;_B, s_B<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, &#956;&#8320;, &#963;&#8320;&#178;, &#954;&#8320;, &#957;&#8320;, m<span style="color: #51afef;">)</span>

    prob = mean<span style="color: #51afef;">(</span>&#952;_mc_A .<span style="color: #FCCE7B;">&lt;</span> &#952;_mc_B<span style="color: #51afef;">)</span>
    push!<span style="color: #51afef;">(</span>prob_A_lt_B, prob<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>


<div id="org3693d05" class="figure">
<p><img src="fig/ch5/exercise5_2.png" alt="exercise5_2.png" width="600" />
</p>
</div>

<p>
prior のパラメータ \(\kappa_0, \nu_0\) を大きくとるほど、事後分布に対するデータの影響が相対的に小さくなり、
\(\theta_A < \theta_B\)の事後確率は減少していることがわかるが、同時に
\(\kappa_0, \nu_0\)の値を上の範囲でいくら変えても、
\(\theta_A < \theta_B\)の確率は 70%程度であることがいえる。
</p>
</div>
</div>
</div>
<div id="outline-container-orgc89835a" class="outline-3">
<h3 id="orgc89835a">5.3</h3>
<div class="outline-text-3" id="text-orgc89835a">
</div>
<div id="outline-container-orgadcb4e1" class="outline-4">
<h4 id="orgadcb4e1">answer</h4>
<div class="outline-text-4" id="text-orgadcb4e1">
</div>
<div id="outline-container-org833e014" class="outline-5">
<h5 id="org833e014">marginal posterior distribution of \(\theta\)</h5>
<div class="outline-text-5" id="text-org833e014">
\begin{align*}
p(\theta | y_1, \dots, y_n)
&= \int_0^{\infty} p(\theta, \sigma^2 | y_1, \dots, y_n) d\sigma^2 \\
&= \int_0^{\infty} p(\theta | \sigma^2, y_1, \dots, y_n) p(\sigma^2 | y_1, \dots, y_n) d\sigma^2 \\
&= \int_0^{\infty} \sqrt{ \frac{\kappa_n}{2 \pi \sigma^2 } } \exp \left( - \frac{\kappa_n (\theta - \mu_n)^2}{2 \sigma^2} \right)
\frac{ (\frac{\nu_n \sigma_n^2}{2})^{\frac{\nu_n}{2} } }{\Gamma(\frac{\nu_n}{2})} (\sigma^2)^{-(\frac{\nu_n}{2} + 1)} \exp \left( - \frac{\nu_n \sigma_n^2}{2 \sigma^2} \right) d\sigma^2 \\
&= \sqrt{ \frac{\kappa_n}{2 \pi} } \frac{ (\frac{\nu_n \sigma_n^2}{2})^{\frac{\nu_n}{2} } }{\Gamma(\frac{\nu_n}{2})}
\int_0^{\infty} (\sigma^2)^{-(\frac{\nu_n + 1}{2} + 1)} \exp \left( - \frac{\kappa_n (\theta - \mu_n)^2}{2 \sigma^2} - \frac{\nu_n \sigma_n^2}{2 \sigma^2} \right) d\sigma^2 \\
&= \sqrt{ \frac{\kappa_n}{2 \pi} } \frac{ (\frac{\nu_n \sigma_n^2}{2})^{\frac{\nu_n}{2} } }{\Gamma(\frac{\nu_n}{2})}
\int_0^{\infty} (\sigma^2)^{-(\frac{\nu_n + 1}{2} + 1)} \exp \left( - \frac{1}{2 \sigma^2} (\kappa_n (\theta - \mu_n)^2 + \nu_n \sigma_n^2) \right) d\sigma^2 \\
&= \sqrt{ \frac{\kappa_n}{2 \pi} } \frac{ (\frac{\nu_n \sigma_n^2}{2})^{\frac{\nu_n}{2} } }{\Gamma(\frac{\nu_n}{2})}
\Gamma(\frac{\nu_n + 1}{2}) \times (\frac{\kappa_n (\theta - \mu_n)^2 + \nu_n \sigma_n^2}{2})^{-\frac{\nu_n + 1}{2}} \\
&= \frac{ \Gamma(\frac{\nu_n + 1}{2}) }{ \Gamma(\frac{\nu_n}{2}) }
\sqrt{ \frac{\kappa_n}{2 \pi} }
\left(\frac{2}{\nu_n \sigma_n^2}\right)^{\frac{1}{2} }
\left(\frac{2}{\nu_n \sigma_n^2}\right)^{-\frac{\nu_n + 1}{2} }
\times (\frac{\kappa_n (\theta - \mu_n)^2 + \nu_n \sigma_n^2}{2})^{-\frac{\nu_n + 1}{2}} \\
&= \frac{ \Gamma(\frac{\nu_n + 1}{2}) }{ \Gamma(\frac{\nu_n}{2}) } \sqrt{ \frac{\kappa_n}{\pi \nu_n \sigma_n^2} }
\left( 1 + \frac{\kappa_n (\theta - \mu_n)^2}{\nu_n \sigma_n^2} \right)^{-\frac{\nu_n + 1}{2}} \\
&= \text{d-Student t}(\theta | \nu_n, \mu_n, \tau_n^2)
\end{align*}

<p>
where
</p>
\begin{align*}
\kappa_n &= \kappa_0 + n \\
\mu_n &= \frac{\kappa_0 \mu_0 + n \bar{y}}{\kappa_n} \\
\nu_n &= \nu_0 + n \\
\sigma_n^2 &= \frac{1}{\nu_n} \left( \nu_0 \sigma_0^2 + (n-1)s^2 + \frac{\kappa_0 n}{\kappa_n} (\bar{y} - \mu_0)^2 \right) \\
\tau_n^2 &= \frac{\nu_n \sigma_n^2}{\kappa_n} \\
\end{align*}
</div>
</div>
<div id="outline-container-orga53da6f" class="outline-5">
<h5 id="orga53da6f">marginal posterior distribution of \(\tilde{\sigma}^2\)</h5>
<div class="outline-text-5" id="text-orga53da6f">
<p>
\(\sigma^2\)の marginal posterior distribution は、
</p>

\begin{align*}
p(\sigma^2 | y_1, \dots, y_n)
& \propto p(\sigma^2) p(y_1, \dots, y_n | \sigma^2) \\
&= p(\sigma^2) \int p(y_1, \dots, y_n | \theta, \sigma^2) p(\theta | \sigma^2) d\theta \\
\end{align*}
<p>
となる。
</p>

<p>
ここで、
</p>


\begin{equation}
\label{eq:ex5-3.1}
\begin{aligned}[b]
\sum_{i=1}^n (y_i - \theta)^2
&= \sum_{i=1}^n (y_i - \bar{y} + \bar{y} - \theta)^2 \\
&= \sum_{i=1}^n (y_i - \bar{y})^2 + n (\bar{y} - \theta)^2 + 2 (\bar{y} - \theta) \sum_{i=1}^n (y_i - \bar{y}) \\
&= \sum_{i=1}^n (y_i - \bar{y})^2 + n (\bar{y} - \theta)^2 \\
&= n (\theta - \bar{y})^2 + (n-1)s^2 \\
\end{aligned}
\end{equation}

\begin{equation}
\label{eq:ex5-3.2}
\begin{aligned}
A(x - a)^2 + B(x - b)^2 &= (A + B)(x - c)^2 + \frac{AB}{A + B}(a - b)^2 \\
\text{where } c &= \frac{aA + bB}{A + B} \\
\end{aligned}
\end{equation}
<p>
を用いると、
</p>

\begin{align*}
p(y_1, \dots, y_n | \theta, \sigma^2) p(\theta | \sigma^2)
&= \prod_{i=1}^n p(y_i | \theta, \sigma^2) p(\theta | \sigma^2) \\
&= \prod_{i=1}^n \left( \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( - \frac{(y_i - \theta)^2}{2 \sigma^2} \right) \right)
\left( \frac{\sqrt{\kappa_0} }{\sqrt{2 \pi \sigma^2}} \exp \left( - \frac{ \kappa_0 (\theta - \mu_0)^2}{2 \sigma^2} \right) \right) \\
&= (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{1}{2 \sigma^2}  \sum_{i=1}^n (y_i - \theta)^2 \right)
\exp \left( - \frac{\kappa_0}{2 \sigma^2} (\theta - \mu_0)^2 \right) \\
&= (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{1}{2 \sigma^2}  ( n (\theta - \bar{y})^2 + (n-1)s^2 ) \right) \\
& \qquad \times
\exp \left( - \frac{\kappa_0}{2 \sigma^2} (\theta - \mu_0)^2 \right)
\quad (\because \eqref{eq:ex5-3.1}) \\
&= (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{1}{2 \sigma^2}  ( n(\theta - \bar{y})^2 + \kappa_0 (\theta - \mu_0)^2 ) \right)
\exp \left( - \frac{1}{2 \sigma^2} (n-1)s^2 \right) \\
&= (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{1}{2 \sigma^2}  ( (n + \kappa_0)(\theta - \theta^{\ast})^2 + r ) \right)
\exp \left( - \frac{1}{2 \sigma^2} (n-1)s^2 \right) \\
& \qquad \text{ where } \theta^{\ast} = \frac{n \bar{y} + \kappa_0 \mu_0}{n + \kappa_0}, \quad
r = \frac{n \kappa_0}{n + \kappa_0} (\bar{y} - \mu_0)^2
\qquad \qquad \qquad \qquad \qquad (\because \eqref{eq:ex5-3.2}) \\
&= (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{ n + \kappa_0}{2 \sigma^2} (\theta - \theta^{\ast})^2 \right)
\exp \left( - \frac{r}{2 \sigma^2} \right)
\exp \left( - \frac{1}{2 \sigma^2} (n-1)s^2 \right) \\
\end{align*}

<p>
となるので、
</p>

\begin{align*}
p(\sigma^2 | y_1, \dots, y_n)
& \propto p(\sigma^2) p(y_1, \dots, y_n | \sigma^2) \\
&= p(\sigma^2) \int p(y_1, \dots, y_n | \theta, \sigma^2) p(\theta | \sigma^2) d\theta \\
&= p(\sigma^2) \int (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{ n + \kappa_0}{2 \sigma^2} (\theta - \theta^{\ast})^2 \right)
\exp \left( - \frac{r}{2 \sigma^2} \right)
\exp \left( - \frac{1}{2 \sigma^2} (n-1)s^2 \right) d\theta \\
&= p(\sigma^2) (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{1}{2 \sigma^2} ( (n-1)s^2 + r) \right) \\
& \qquad \times
\left(2 \pi \frac{\sigma^2}{n + \kappa_0} \right)^{\frac{1}{2} }
\int \left(2 \pi \frac{\sigma^2}{n + \kappa_0} \right)^{-\frac{1}{2} }
\exp \left( - \frac{ n + \kappa_0}{2 \sigma^2} (\theta - \theta^{\ast})^2 \right) d\theta \\
&= p(\sigma^2) (2 \pi \sigma^2)^{-\frac{n + 1}{2} } \sqrt{\kappa_0}
\exp \left( - \frac{1}{2 \sigma^2} ( (n-1)s^2 + r) \right)
\left(2 \pi \frac{\sigma^2}{n + \kappa_0} \right)^{\frac{1}{2} } \\
& \propto p(\sigma^2) (\sigma^2)^{- \frac{n}{2} }
\exp \left( - \frac{1}{2 \sigma^2} ( (n-1)s^2 + r) \right) \\
& \propto (\sigma^2)^{- (\frac{ \nu_0 }{2} + 1 )} \exp \left( - \frac{\nu_0 \sigma_0^2}{2 \sigma^2} \right)
(\sigma^2)^{- \frac{n}{2} }
\exp \left( - \frac{1}{2 \sigma^2} ( (n-1)s^2 + r) \right) \\
&= (\sigma^2)^{- (\frac{ \nu_0 + n }{2} + 1 )} \exp \left( - \frac{\nu_0 \sigma_0^2 + (n-1)s^2 + r}{2 \sigma^2} \right) \\
&= (\sigma^2)^{- (\frac{ \nu_0 + n }{2} + 1 )} \exp \left( - \frac{\nu_0 + n}{2 \sigma^2}
\left( \frac{\nu_0 \sigma_0^2 + (n-1)s^2 + \frac{\kappa_0 n}{\kappa_0 + n} (\bar{y} - \mu_0)^2 }{\nu_0 + n} \right) \right) \\
&\propto \text{dinverse-gamma}(\sigma^2, \frac{\nu_n}{2}, \frac{\nu_n \sigma_n^2}{2}) \\
& \text{ where }
\nu_n = \nu_0 + n, \quad
\sigma_n^2 = \frac{1}{\nu_n}\left[ \nu_0 \sigma_0^2 + (n-1)s^2 + \frac{\kappa_0 n}{\kappa_n} (\bar{y} - \mu_0)^2 \right]
\end{align*}

<p>
よって、
</p>
\begin{equation*}
\left| \frac{d \sigma^2}{d \tilde{\sigma}^2} \right|  = (\tilde{\sigma}^2)^{-2}
\end{equation*}
<p>
より
</p>
\begin{align*}
p( \tilde{\sigma}^2 | y_1, \dots, y_n)
&= p( (\tilde{\sigma}^2)^{-1} | y_1, \dots, y_n) \left| \frac{d \sigma^2}{d \tilde{\sigma}^2} \right| \\
&= \text{dinverse-gamma}(\tilde{\sigma}^{-2} | \frac{\nu_n}{2}, \frac{\nu_n \sigma_n^2}{2}) \times (\tilde{\sigma}^2)^{-2} \\
&\propto (\tilde{\sigma}^2)^{(\frac{ \nu_0 + n }{2} + 1 )}
\exp \left( - \frac{\nu_n \sigma_n^2}{2 (\tilde{\sigma}^2)^{-1} } \right) \times (\tilde{\sigma}^2)^{-2} \\
&= (\tilde{\sigma}^2)^{(\frac{ \nu_0 + n }{2} - 1 )}
\exp \left( - \tilde{\sigma}^2 \frac{\nu_n \sigma_n^2}{2} \right) \\
&= \text{dgamma}(\tilde{\sigma}^2 | \frac{\nu_n}{2}, \frac{\nu_n \sigma_n^2}{2})
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-orgb20bc3b" class="outline-3">
<h3 id="orgb20bc3b">5.4</h3>
<div class="outline-text-3" id="text-orgb20bc3b">
</div>
<div id="outline-container-org5d4a382" class="outline-4">
<h4 id="org5d4a382">a)</h4>
<div class="outline-text-4" id="text-org5d4a382">
</div>
<div id="outline-container-org5451d90" class="outline-5">
<h5 id="org5451d90">answer</h5>
<div class="outline-text-5" id="text-org5451d90">
<p>
対数尤度は、
</p>
\begin{align*}
\ell(y | \theta, \sigma^2)
&= \log p(y | \theta, \sigma^2) \\
&= \log \left[ \prod_{i=1}^n \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( - \frac{(y_i - \theta)^2}{2 \sigma^2} \right) \right] \\
&= \log \left[ (2 \pi \sigma^2)^{-\frac{n}{2} } \exp \left( - \frac{1}{2 \sigma^2} \sum_{i=1}^n (y_i - \theta)^2 \right) \right] \\
&= - \frac{n}{2} \log (2 \pi ) - \frac{n}{2} \log (\sigma^2) - \frac{1}{2 \sigma^2} \sum_{i=1}^n (y_i - \theta)^2 \\
&= - \frac{n}{2} \log (2 \pi ) - \frac{n}{2} \log (\sigma^2) - \frac{1}{2 \sigma^2} \sum_{i=1}^n (y_i^2 - 2 y_i \theta + \theta^2) \\
&= - \frac{n}{2} \log (2 \pi ) - \frac{n}{2} \log (\sigma^2) - \frac{1}{2 \sigma^2} (\sum_{i=1}^n y_i^2 - 2 \theta \sum_{i=1}^n y_i + n \theta^2) \\
\end{align*}
<p>
と表せる。従って、\(\theta, \sigma^2\)による一回微分はそれぞれ、
</p>
\begin{align*}
\ell_{\theta}
&= - \frac{1}{2 \sigma^2} (- 2 \sum_{i=1}^n y_i + 2 n \theta) \\
&= \frac{1}{\sigma^2} (\sum_{i=1}^n y_i - n \theta) \\
\\
\ell_{\sigma^2}
&= - \frac{n}{2 \sigma^2} + \frac{1}{2 (\sigma^2)^2} (\sum_{i=1}^n y_i^2 - 2 \theta \sum_{i=1}^n y_i + n \theta^2) \\
\end{align*}
<p>
となる。よって、
</p>

\begin{align*}
I(\theta, \sigma^2)
&= \begin{pmatrix} - E[\ell_{\theta \theta}] & - E[\ell_{\theta \sigma^2}] \\ - E[\ell_{\sigma^2 \theta}] & - E[\ell_{\sigma^2 \sigma^2}] \end{pmatrix} \\
& = \begin{pmatrix} - E[- \frac{n}{\sigma^2}] & - E[\frac{n \theta - \sum y_i }{(\sigma^2)^2}] \\ - E[\frac{n \theta - \sum y_i }{(\sigma^2)^2}] & - E[\frac{n}{2 (\sigma^2)^2} - \frac{\sum (y_i - \theta)^2 }{ (\sigma^2)^3}] \end{pmatrix} \\
& = \begin{pmatrix}  \frac{n}{\sigma^2} & \frac{ \sum E[y_i] - n \theta }{(\sigma^2)^2} \\ \frac{\sum E[y_i] - n \theta }{(\sigma^2)^2} & - \frac{n}{2 (\sigma^2)^2} + \frac{\sum E [(y_i - \theta)^2] }{ (\sigma^2)^3} \end{pmatrix} \\
& = \begin{pmatrix}  \frac{n}{\sigma^2} & \frac{ n \theta - n \theta }{(\sigma^2)^2} \\ \frac{n \theta - n \theta }{(\sigma^2)^2} & - \frac{n}{2 (\sigma^2)^2} + \frac{n \sigma^2 }{(\sigma^2)^3} \end{pmatrix} \\
& = \begin{pmatrix}  \frac{n}{\sigma^2} & 0 \\ 0 &  \frac{n}{2 (\sigma^2)^2}  \end{pmatrix} \\
\\ |I(\theta, \sigma^2)|
&= \frac{n}{\sigma^2} \frac{n}{2 (\sigma^2)^2} \\
&= \frac{n^2}{2 (\sigma^2)^3} \\
\end{align*}
<p>
となるので、Jeffreys&rsquo; prior は、
</p>
\begin{align*}
p_J(\theta, \sigma^2)
&\propto \sqrt{ |I(\theta, \sigma^2)|} \\
&= \sqrt{ \frac{n^2}{2 (\sigma^2)^3} } \\
&= \frac{n}{\sqrt{2} } \times (\sigma^2)^{- \frac{3}{2} }  \\
&\propto (\sigma^2)^{- \frac{3}{2} }  \\
\end{align*}
<p>
であり、示せた。
</p>
</div>
</div>
</div>
<div id="outline-container-org98d245c" class="outline-4">
<h4 id="org98d245c">b)</h4>
<div class="outline-text-4" id="text-org98d245c">
</div>
<div id="outline-container-org5adc550" class="outline-5">
<h5 id="org5adc550">answer</h5>
<div class="outline-text-5" id="text-org5adc550">
\begin{align*}
p_J(\theta, \sigma^2 | \boldsymbol{y})
&= p_J(\theta, \sigma^2) p(\boldsymbol{y} | \theta, \sigma^2) \\
&\propto (\sigma^2)^{- \frac{3}{2} } \times \prod_{i=1}^n \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( - \frac{(y_i - \theta)^2}{2 \sigma^2} \right) \\
&\propto (\sigma^2)^{- \frac{3}{2} } \times (\sigma^2)^{- \frac{n}{2} } \exp \left( - \frac{1}{2 \sigma^2} \sum_{i=1}^n (y_i - \theta)^2 \right) \\
&= (\sigma^2)^{- \frac{3 + n}{2} } \exp \left( - \frac{1}{2 \sigma^2} \sum_{i=1}^n (y_i^2 - 2 y_i \theta + \theta^2) \right) \\
&= (\sigma^2)^{- \frac{3 + n}{2} }
\exp \left( - \frac{ n \bar{y^2} }{ 2 \sigma^2 } + \frac{ n \bar{y} \theta }{ \sigma^2 } - \frac{ n \theta^2 }{ 2 \sigma^2 } \right) \\
&= (\sigma^2)^{- \frac{3 + n}{2} }
\exp \left( - \frac{ n }{2 \sigma^2 } \left( \theta^2 - 2 \bar{y} \theta \right) \right)
\times \exp \left( - \frac{ n \bar{y^2} }{ 2 \sigma^2 } \right) \\
&= (\sigma^2)^{- \frac{3 + n}{2} }
\exp \left( - \frac{ n }{2 \sigma^2 } \left( \theta - \bar{y} \right)^2 + \frac{ n \bar{y}^2 }{ 2 \sigma^2 } \right)
\times \exp \left( - \frac{ n \bar{y^2} }{ 2 \sigma^2 } \right) \\
&= (\sigma^2)^{- \frac{1}{2} } \exp \left( - \frac{ n }{2 \sigma^2 } \left( \theta - \bar{y} \right)^2 \right)
\times (\sigma^2)^{- \left( \frac{n}{2} + 1 \right) } \exp \left( - \frac{ n ( \bar{y^2} - \bar{y}^2 )}{ 2 \sigma^2 } \right) \\
&= \left(\frac{\sigma^2}{n} \right)^{- \frac{1}{2} } \exp \left( - \frac{ n }{2 \sigma^2 } \left( \theta - \bar{y} \right)^2 \right)
\times (\sigma^2)^{- \left( \frac{n}{2} + 1 \right) } \exp \left( - \frac{ n s^2 }{ 2 \sigma^2 } \right) \\
&\propto \text{dnormal}(\theta, \bar{y}, \frac{\sigma^2}{n})
\times
\text{dinverse-gamma}(\sigma^2, \frac{n}{2}, \frac{n s^2}{ 2 } ),
\end{align*}
<p>
where \(\bar{y^2} = \frac{1}{n} \sum_{i=1}^n y_i^2\) and \(s^2 = \frac{1}{n-1} \sum_{i=1}^n (y_i - \bar{y})^2\).
</p>

<p>
上式より、joint density は posterior density になっていることが確認できた。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org5b78487" class="outline-3">
<h3 id="org5b78487">5.5</h3>
<div class="outline-text-3" id="text-org5b78487">
</div>
<div id="outline-container-org9c9319e" class="outline-4">
<h4 id="org9c9319e">a)</h4>
<div class="outline-text-4" id="text-org9c9319e">
</div>
<div id="outline-container-org4e0565c" class="outline-5">
<h5 id="org4e0565c">answer</h5>
<div class="outline-text-5" id="text-org4e0565c">
\begin{align*}
l(\theta, \psi | \boldsymbol{y})
&= \sum_{i=1}^n \log p(y_i | \theta, \psi) \\
&= \sum_{i=1}^n \log \left( (2\pi)^{ - \frac{1}{2} } \psi^{ \frac{1}{2} }
\exp \left( - \frac{\psi}{2}  (y_i - \theta )^2 \right) \right) \\
&= \sum_{i=1}^n \left\{ \log (2\pi)^{ - \frac{1}{2} } + \log \psi^{ \frac{1}{2} } - \frac{\psi}{2} (y_i - \theta )^2 \right\} \\
&= - \frac{n}{2} \log (2\pi) + \frac{n}{2} \log \psi - \frac{\psi}{2} \sum_{i=1}^n (y_i - \theta )^2 \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org8086c2f" class="outline-4">
<h4 id="org8086c2f">b)</h4>
<div class="outline-text-4" id="text-org8086c2f">
</div>
<div id="outline-container-orga850fc9" class="outline-5">
<h5 id="orga850fc9">answer</h5>
<div class="outline-text-5" id="text-orga850fc9">
\begin{align*}
l(\theta, \psi | \boldsymbol{y})
&= - \frac{n}{2} \log (2\pi) + \frac{n}{2} \log \psi - \frac{\psi}{2} \sum_{i=1}^n (y_i - \theta )^2 \\
&= - \frac{n}{2} \log (2\pi) + \frac{n}{2} \log \psi - \frac{\psi}{2} \left( \sum_{i=1}^n (y_i - \bar{y} )^2 + n (\bar{y} - \theta )^2 \right) \\
&= - \frac{n}{2} \log (2\pi) + \frac{n}{2} \log \psi -
\frac{\psi}{2} n s^2 - \frac{\psi}{2} n (\bar{y} - \theta )^2 \\
\end{align*}

<p>
従って、
</p>
\begin{align*}
\log p_U(\theta, \psi)
&= \frac{l(\theta, \psi | \boldsymbol{y})}{n} + c \\
&= - \frac{1}{2} \log (2\pi) + \frac{1}{2} \log \psi -
\frac{\psi}{2} s^2 - \frac{\psi}{2} (\bar{y} - \theta )^2 + c \\
\end{align*}
<p>
となるので、
</p>
\begin{align*}
p_U(\theta, \psi)
&= (2 \pi)^{- \frac{1}{2} } \psi^{ \frac{1}{2} }
\exp \left( - \frac{s^2}{2} \psi \right)
\exp \left( - \frac{\psi}{2} (\bar{y} - \theta )^2 \right)
\exp \left( c \right) \\
&\propto
\psi^{ \frac{1}{2} }
\exp \left( - \frac{\psi}{2} ( \theta - \bar{y} )^2 \right)
\times
\psi^{ 1 - 1} \exp \left( - \frac{s^2}{2} \psi \right) \\
&\propto
\text{dnormal}(\theta, \bar{y}, \psi^{-1})
\times
\text{dgamma}(\psi, 1, \frac{s^2}{2})
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orge4145d3" class="outline-4">
<h4 id="orge4145d3">c)</h4>
<div class="outline-text-4" id="text-orge4145d3">
</div>
<div id="outline-container-orge6fc15d" class="outline-5">
<h5 id="orge6fc15d">answer</h5>
<div class="outline-text-5" id="text-orge6fc15d">
\begin{align*}
p_U(\theta, \psi | \boldsymbol{y})
&\propto
p_U(\theta, \psi) \times p( y_1, \ldots, y_n | \theta, \psi) \\
&\propto
\exp \left( - \frac{\psi}{2} ( \theta - \bar{y} )^2 \right)
\times
\psi^{ \frac{3}{2} - 1} \exp \left( - \frac{s^2}{2} \psi \right)
\times
\psi^{ \frac{n}{2} } \exp \left( - \frac{\psi}{2} \sum_{i=1}^n (y_i - \theta )^2 \right) \\
&=
\exp \left( - \frac{\psi}{2} ( \theta - \bar{y} )^2 \right)
\times
\psi^{ \frac{3}{2} - 1} \exp \left( - \frac{s^2}{2} \psi \right)
\times
\psi^{ \frac{n}{2} } \exp \left( - \frac{\psi}{2} \left( \sum_{i=1}^n (y_i - \bar{y} )^2 + n (\bar{y} - \theta )^2 \right) \right) \\
&=
\exp \left( - \frac{\psi}{2} ( \theta - \bar{y} )^2 \right)
\times
\psi^{ \frac{n + 3}{2} - 1} \exp \left( - \frac{s^2}{2} \psi \right)
\times
\exp \left( - \frac{n s^2}{2} \psi \right) \times  \exp \left( - \frac{\psi}{2} n (\bar{y} - \theta )^2 \right) \\
&=
\exp \left( - \frac{ (n + 1) \psi}{2} ( \theta - \bar{y} )^2 \right)
\times
\psi^{ \frac{n + 3}{2} - 1} \exp \left( - \frac{(n + 1) s^2}{2} \psi \right) \\
&\propto
\text{dnormal}(\theta, \bar{y}, \frac{1}{(n + 1)\psi})
\times
\text{dgamma}(\psi, \frac{n + 3}{2}, \frac{(n + 1) s^2}{2})
\end{align*}

<p>
上式より、joint density は posterior density になっていることが確認できた。
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org1ffc95b" class="outline-2">
<h2 id="org1ffc95b">Chapter 6</h2>
<div class="outline-text-2" id="text-org1ffc95b">
</div>
<div id="outline-container-orgdc94f5c" class="outline-3">
<h3 id="orgdc94f5c">6.1</h3>
<div class="outline-text-3" id="text-orgdc94f5c">
</div>
<div id="outline-container-orgba94f02" class="outline-4">
<h4 id="orgba94f02">a)</h4>
<div class="outline-text-4" id="text-orgba94f02">
</div>
<div id="outline-container-org1b162bf" class="outline-5">
<h5 id="org1b162bf">answer</h5>
<div class="outline-text-5" id="text-org1b162bf">
\begin{align*}
E[\theta_A \theta_B]
&= E[\theta \theta \gamma] \\
&= E[\theta^2] E[\gamma] \quad (\because \theta \perp\kern-5pt\perp \gamma)\\
&= \frac{(a_{\theta} + 1) a_{\theta}}{b_{\theta}^2} \times \frac{a_{\gamma}}{b_{\gamma}} \\
\\
E[\theta_A] E[\theta_B]
&= E[\theta] E[\theta \gamma] \\
&= E[\theta] E[\theta] E[\gamma] \quad (\because \theta \perp\kern-5pt\perp \gamma)\\
&= \frac{a_{\theta}^2 }{b_{\theta}^2} \times \frac{a_{\gamma}}{b_{\gamma}} \\
\end{align*}

<p>
より、
\[ E[\theta_A \theta_B] \neq E[\theta_A] E[\theta_B] \]
となるが、もし\(\theta_A\)と\(\theta_B\)が独立ならば、
\( E[\theta_A \theta_B] = E[\theta_A] E[\theta_B] \)
が成り立つはずである。よって、\(\theta_A\)と\(\theta_B\)は独立ではない。
</p>

<p>
また、このような同時事前分布の設定は、B群の一人当たりの子供の数が A 群の一人当たりの子供の数の実数倍であるという事前の信念がある時に正当化される。
</p>
</div>
</div>
</div>
<div id="outline-container-org2ec20a4" class="outline-4">
<h4 id="org2ec20a4">b)</h4>
<div class="outline-text-4" id="text-org2ec20a4">
</div>
<div id="outline-container-org8ae5c71" class="outline-5">
<h5 id="org8ae5c71">answer</h5>
<div class="outline-text-5" id="text-org8ae5c71">
\begin{align*}
p(\theta | \boldsymbol{y}_A, \boldsymbol{y}_B, \gamma)
&\propto p( \boldsymbol{y}_A , \boldsymbol{y}_B, \theta, \gamma) \\
&= p( \boldsymbol{y}_A \boldsymbol{y}_B | \theta, \gamma) p(\theta , \gamma) \\
&\propto p( \boldsymbol{y}_A | \theta) p( \boldsymbol{y}_B | \theta, \gamma) p(\theta) \\
&\propto \theta^{ \sum y_{A,i} } \exp \left( - n_A \theta \right)
\times (\theta \gamma)^{ \sum y_{B,i} } \exp \left( - n_B \theta \gamma \right) \\
&\qquad \times \theta^{a_{\theta} - 1} \exp \left( - b_{\theta} \theta \right)  \\
&\propto \theta^{ a_{\theta} + n_A \bar{y}_A + n_B \bar{y}_B - 1 }
\times \exp \left( - \theta (b_{\theta} + n_A + n_B \gamma) \right) \\
&\propto \text{dgamma}( \theta, a_{\theta} + n_A \bar{y}_A + n_B \bar{y}_B, b_{\theta} + n_A + n_B \gamma )
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orgb134dc7" class="outline-4">
<h4 id="orgb134dc7">c)</h4>
<div class="outline-text-4" id="text-orgb134dc7">
</div>
<div id="outline-container-org442bbd9" class="outline-5">
<h5 id="org442bbd9">answer</h5>
<div class="outline-text-5" id="text-org442bbd9">
\begin{align*}
p(\gamma | \boldsymbol{y}_A, \boldsymbol{y}_B, \theta)
&\propto p( \boldsymbol{y}_A , \boldsymbol{y}_B, \theta, \gamma) \\
&= p( \boldsymbol{y}_A \boldsymbol{y}_B | \theta, \gamma) p(\theta , \gamma) \\
&\propto p( \boldsymbol{y}_B | \theta, \gamma) p(\gamma) \\
&\propto (\theta \gamma)^{ \sum y_{B,i} } \exp \left( - n_B \theta \gamma \right) \times \gamma^{a_{\gamma} - 1} \exp \left( - b_{\gamma} \gamma \right) \\
&\propto \gamma^{ a_{\gamma} + n_B \bar{y}_B - 1 }
\times \exp \left( - \gamma (b_{\gamma} + n_B \theta) \right) \\
&\propto \text{dgamma}( \gamma, a_{\gamma} + n_B \bar{y}_B, b_{\gamma} + n_B \theta )
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org075b76c" class="outline-4">
<h4 id="org075b76c">d)</h4>
<div class="outline-text-4" id="text-org075b76c">
</div>
<div id="outline-container-org798e4de" class="outline-5">
<h5 id="org798e4de">answer</h5>
<div class="outline-text-5" id="text-org798e4de">
<div class="org-src-container">
<pre class="src src-julia">menchild_bach = <span style="color: #51afef;">[]</span>
open<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/menchild30bach.dat"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">do</span> file
    <span style="color: #51afef;">for</span> line <span style="color: #51afef;">in</span> eachline<span style="color: #51afef;">(</span>file<span style="color: #51afef;">)</span>
        append!<span style="color: #51afef;">(</span>menchild_bach, parse.<span style="color: #C57BDB;">(</span>Int, split<span style="color: #7bc275;">(</span>line<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

menchild_nobach = <span style="color: #51afef;">[]</span>
open<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/menchild30nobach.dat"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">do</span> file
    <span style="color: #51afef;">for</span> line <span style="color: #51afef;">in</span> eachline<span style="color: #51afef;">(</span>file<span style="color: #51afef;">)</span>
        append!<span style="color: #51afef;">(</span>menchild_nobach, parse.<span style="color: #C57BDB;">(</span>Int, split<span style="color: #7bc275;">(</span>line<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

a_&#952; = <span style="color: #e69055; font-weight: bold;">2</span>
b_&#952; = <span style="color: #e69055; font-weight: bold;">1</span>
&#947;_prior_param = <span style="color: #51afef;">[</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">^</span>i <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">3</span>:<span style="color: #e69055; font-weight: bold;">7</span> <span style="color: #51afef;">]</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">get_&#952;_diff</span><span style="color: #51afef;">(</span>y_A, y_B, a_&#952;, b_&#952;, a_&#947;, b_&#947;, S<span style="color: #51afef;">)</span>
    sy_A = sum<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span>
    n_A = length<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span>
    mean_A = mean<span style="color: #51afef;">(</span>y_A<span style="color: #51afef;">)</span>

    sy_B = sum<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span>
    n_B = length<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span>
    mean_B = mean<span style="color: #51afef;">(</span>y_B<span style="color: #51afef;">)</span>

    &#952; = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>
    &#952;<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span> = t = mean_A
    &#947; = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>
    &#947;<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span> = g = mean_B<span style="color: #FCCE7B;">/</span>mean_A

    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">2</span>:S
        dist_&#952; = Gamma<span style="color: #51afef;">(</span>a_&#952; <span style="color: #FCCE7B;">+</span> sy_A <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b_&#952; <span style="color: #FCCE7B;">+</span> n_A <span style="color: #FCCE7B;">+</span> n_B <span style="color: #FCCE7B;">*</span> g<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        t = rand<span style="color: #51afef;">(</span>dist_&#952;<span style="color: #51afef;">)</span>

        dist_&#947; = Gamma<span style="color: #51afef;">(</span>a_&#947; <span style="color: #FCCE7B;">+</span> sy_B, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>b_&#947; <span style="color: #FCCE7B;">+</span> n_B <span style="color: #FCCE7B;">*</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        g = rand<span style="color: #51afef;">(</span>dist_&#947;<span style="color: #51afef;">)</span>

        &#952;<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = t
        &#947;<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = g
    <span style="color: #51afef;">end</span>
    &#952;_A_mc = &#952;
    &#952;_B_mc = &#952; <span style="color: #FCCE7B;">.*</span> &#947;
    <span style="color: #51afef;">return</span> mean<span style="color: #51afef;">(</span>&#952;_B_mc .<span style="color: #FCCE7B;">-</span> &#952;_A_mc<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">&#952;_diff_by_p</span><span style="color: #51afef;">(</span>p, S<span style="color: #51afef;">)</span>
    get_&#952;_diff<span style="color: #51afef;">(</span>menchild_bach, menchild_nobach, a_&#952;, b_&#952;, p, p, S<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

S = <span style="color: #e69055; font-weight: bold;">5000</span>
exp_diff = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> p <span style="color: #51afef;">in</span> &#947;_prior_param
    push!<span style="color: #51afef;">(</span>exp_diff, &#952;_diff_by_p<span style="color: #C57BDB;">(</span>p, S<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

exp_diff
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
5-element Vector{Any}:
 0.38839289030002194
 0.3301515531279979
 0.26360712597646224
 0.1972987037901306
 0.1332427833449685
</pre>



<div id="org528383f" class="figure">
<p><img src="fig/ch6/exercise6_1d.png" alt="exercise6_1d.png" width="600px" />
</p>
</div>

<p>
\( a_{\gamma} = b_{\gamma}\)に従うガンマ分布の期待値は 1 であり、この値が大きければ大きいほど\( \frac{\theta_B}{\theta_A} \)が 1
（すなわち、A群と B 群の子供の数の平均が等しい）という事前の信念が強いことになる。上のグラフからも、\(a_{\gamma} = b_{\gamma} \)が大きくなるにつれて、データの影響が小さくなり、事後期待値の差が小さくなっていることがわかる。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb547a00" class="outline-3">
<h3 id="orgb547a00">6.2</h3>
<div class="outline-text-3" id="text-orgb547a00">
</div>
<div id="outline-container-orgd28941b" class="outline-4">
<h4 id="orgd28941b">a)</h4>
<div class="outline-text-4" id="text-orgd28941b">
</div>
<div id="outline-container-org3abe726" class="outline-5">
<h5 id="org3abe726">answer</h5>
<div class="outline-text-5" id="text-org3abe726">

<div id="orgd070d52" class="figure">
<p><img src="fig/ch6/exercise6_2a.png" alt="exercise6_2a.png" width="600" />
</p>
</div>

<p>
ヒストグラム及び kernel density のプロットは、左右非対称で右裾が長いという点で、正規分布の形から逸脱している。
</p>
</div>
</div>
</div>
<div id="outline-container-org088f088" class="outline-4">
<h4 id="org088f088">b)</h4>
<div class="outline-text-4" id="text-org088f088">
</div>
<div id="outline-container-org83f0305" class="outline-5">
<h5 id="org83f0305">answer</h5>
<div class="outline-text-5" id="text-org83f0305">
<p>
同時分布は以下のように書ける。
</p>

\begin{equation}
\label{eq:6.2b-2}
\begin{aligned}[b]
&p( Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= &p( Y_1, \dots, Y_n | X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
&\quad \times p( X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= &p( Y_1, \dots, Y_n | X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
&\quad \times p(X_1, \dots, X_n | p) p(p) p(\theta_1) p(\theta_2) p(\sigma_1^2) p(\sigma_2^2) \\
= & \prod_{i=1}^n p(Y_i | X_i, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
&\quad \times \prod_{i=1}^n p(X_i | p) \times p(p) \times p(\theta_1) \times p(\theta_2) \times p(\sigma_1^2) \times p(\sigma_2^2) \\
= & \prod_{i; X_i = 1} p(Y_i | X_i=1, \theta_1, \sigma_1^2) \times
\prod_{i; X_i = 2} p(Y_i | X_i=2, \theta_2, \sigma_2^2) \\
&\quad \times \prod_{i=1}^n p(X_i | p) \times p(p) \times p(\theta_1) \times p(\theta_2) \times p(\sigma_1^2) \times p(\sigma_2^2) \\
\end{aligned}
\end{equation}

<p>
また、各\(i\)についての同時分布は以下のように書ける。
</p>

\begin{equation}
\label{eq:6.2b-1}
\begin{aligned}[b]
& p( Y_i, X_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= &p( Y_i | X_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2)
p(X_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= &p( Y_i | X_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2)
p(X_i | p) p(p) p(\theta_1) p(\theta_2) p(\sigma_1^2) p(\sigma_2^2) \\
\end{aligned}
\end{equation}
</div>
<div id="outline-container-orgea568fa" class="outline-6">
<h6 id="orgea568fa">the full conditional distribution of \( (X_1, \dots, X_n)\)</h6>
<div class="outline-text-6" id="text-orgea568fa">
\begin{align*}
& p(X_i = 1 | Y_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= & \frac{p(Y_i, X_i = 1, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) }{p(Y_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2)} \\
= & \frac{p(Y_i | X_i = 1, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) p(X_i = 1 | p)}{p(Y_i | X_i = 1, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) p(X_i = 1 | p) + p(Y_i | X_i = 2, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) p(X_i = 2 | p)} \\
= & \frac{p(Y_i| X_i = 1, \theta_1, \sigma_1^2) \times p}{p(Y_i| X_i = 1, \theta_1, \sigma_1^2) \times p + p(Y_i| X_i = 2, \theta_2, \sigma_2^2) \times (1 - p)} \\
= & \frac{ p \times \text{dnorm}(Y_i, \theta_1, \sigma_1) }{ p \times \text{dnorm}(Y_i, \theta_1, \sigma_1) + (1 - p) \times \text{dnorm}(Y_i, \theta_2, \sigma_2) } \\
\end{align*}


<p>
同様にして、
</p>

\begin{align*}
& p(X_i = 2 | Y_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= & \frac{p \times \text{dnorm}(Y_i, \theta_2, \sigma_2) }{ p \times \text{dnorm}(Y_i, \theta_1, \sigma_1) + (1 - p) \times \text{dnorm}(Y_i, \theta_2, \sigma_2) } \\
\end{align*}

<p>
従って、
</p>

\begin{align*}
& p( X_1, \dots, X_n | Y_1, \dots, Y_n p, \theta_1, \theta_2, \sigma_1^2,
\sigma_2^2) \\
= & \prod_{i=1}^n p( X_i | Y_i, \theta_1, \theta_2, \sigma_1^2) \\
= & \prod_{i, X_i = 1} p(X_i = 1 | Y_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \times \prod_{i, X_i = 2} p(X_i = 2 | Y_i, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
= & \prod_{i, X_i = 1} \frac{ p \times \text{dnorm}(Y_i, \theta_1, \sigma_1) }{ p \times \text{dnorm}(Y_i, \theta_1, \sigma_1) + (1 - p) \times \text{dnorm}(Y_i, \theta_2, \sigma_2) } \\
& \quad\times \prod_{i, X_i = 2} \frac{p \times \text{dnorm}(Y_i, \theta_2, \sigma_2) }{ p \times \text{dnorm}(Y_i, \theta_1, \sigma_1) + (1 - p) \times \text{dnorm}(Y_i, \theta_2, \sigma_2) } \\
\end{align*}
</div>
</div>
<div id="outline-container-org6986dec" class="outline-6">
<h6 id="org6986dec">the full conditional distribution of \(p\)</h6>
<div class="outline-text-6" id="text-org6986dec">
\begin{align*}
& p(p | Y_1, \dots, Y_n, X_1, \dots, X_n, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
\propto & p( Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, 
\sigma_2^2) \\
\propto & \prod_{i=1}^n p(X_i | p) \times p(p)
\quad (\because \eqref{eq:6.2b-2}) \\
\propto & p^{\sum (2 - X_i)} (1 - p)^{\sum (X_i - 1)} \times p^{a - 1} (1 - p)^{b - 1} \\
\propto & p^{\sum (2 - X_i) + a - 1} (1 - p)^{\sum (X_i - 1) + b -1} \\
\propto & \text{dbeta}(p, \sum (2 - X_i) + a, \sum (X_i - 1) + b) \\
\end{align*}
</div>
</div>
<div id="outline-container-orgef0df20" class="outline-6">
<h6 id="orgef0df20">the full conditional distribution of \(\theta_1\)</h6>
<div class="outline-text-6" id="text-orgef0df20">
\begin{align*}
& p(\theta_1 | Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_2, \sigma_1^2, \sigma_2^2) \\
\propto & p( Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
\propto & \prod_{i; X_i = 1} p(Y_i | X_i =1, \theta_1, 
\sigma_1^2)
\times p(\theta_1) 
\quad (\because \eqref{eq:6.2b-2}) \\
\propto & \prod_{i; X_i = 1} \exp \left\{ - \frac{1}{2 \sigma_1^2} \left( Y_i - \theta_1 \right)^2 \right\}
\times \exp \left\{ - \frac{1}{2 \tau_0^2} \left( \theta_1 - \mu_0 \right)^2 \right\} \\
= & \exp \left\{ - \frac{1}{2 \sigma_1^2} \sum_{i; X_i = 1} \left( Y_i - \theta_1 \right)^2 \right\}
\times \exp \left\{ - \frac{1}{2 \tau_0^2} \left( \theta_1 - \mu_0 \right)^2 \right\} \\
\propto & \text{dnormal}(\theta_1, \mu_1, \tau_1),
\quad \text{ where } \\
& \mu_1 = \frac{\frac{1}{\tau_0^2} \mu_0 + \frac{n_1}{\sigma_1^2} \bar{Y}_1}{\frac{1}{\tau_0^2} + \frac{n_1}{\sigma_1^2}},
\quad  \tau_1^2 = \left( \frac{1}{\tau_0^2} + \frac{n_1}{\sigma_1^2} \right)^{-1} \\
\end{align*}

<p>
なお、最後の式変形は教科書 p.70 を参照。
</p>
</div>
</div>
<div id="outline-container-org9b5c8be" class="outline-6">
<h6 id="org9b5c8be">the full conditional distribution of \(\theta_2\)</h6>
<div class="outline-text-6" id="text-org9b5c8be">
<p>
\(\theta_2\)についても同様に計算すると、
</p>
\begin{align*}
& p(\theta_2 | Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \sigma_1^2, \sigma_2^2) \\
\propto & \text{dnormal}(\theta_2, \mu_2, \tau_2),
\quad \text{ where } \\
& \mu_2 = \frac{\frac{1}{\tau_0^2} \mu_0 + \frac{n_2}{\sigma_2^2} \bar{Y}_2}{\frac{1}{\tau_0^2} + \frac{n_2}{\sigma_2^2}},
\quad  \tau_2^2 = \left( \frac{1}{\tau_0^2} + \frac{n_2}{\sigma_2^2} \right)^{-1} \\
\end{align*}
</div>
</div>
<div id="outline-container-org78fa970" class="outline-6">
<h6 id="org78fa970">the full conditional distribution of \(\sigma_1^2\)</h6>
<div class="outline-text-6" id="text-org78fa970">
\begin{align*}
& p(\sigma_1^2 | Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_2^2) \\
\propto & p( Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2, \sigma_2^2) \\
\propto & \prod_{i; X_i = 1} p(Y_i | X_i =1, \theta_1, \sigma_1^2) \times p(\sigma_1^2)
\quad (\because \eqref{eq:6.2b-2}) \\
\propto & \prod_{i; X_i = 1} (\sigma_1^2)^{ - \frac{1}{2} } \exp \left\{ - \frac{1}{2 \sigma_1^2} \left( Y_i - \theta_1 \right)^2 \right\}
\times \sigma_1^{- ( \frac{\nu_0}{2} + 1 )} \exp \left\{ - \frac{\nu_0 \sigma_0^2}{2 \sigma_1^2} \right\} \\
\propto & (\sigma_1^2)^{- ( \frac{\nu_0 + n_1}{2} + 1 )} \exp \left\{ - \frac{1}{2 \sigma_1^2} \left( \nu_0 \sigma_0^2 + \sum_{i; X_i = 1} \left( Y_i - \theta_1 \right)^2 \right) \right\} \\
\propto & \text{dinverse-gamma}(\sigma_1^2, \frac{\nu_1}{2}, \frac{\nu_1 \sigma_1^2(\theta_1)}{2}),
\quad \text{ where } \\
& \nu_1 = \nu_0 + n_1, \\
& \sigma_1^2(\theta_1) = \frac{1}{\nu_1} [ \nu_0 \sigma_0^2 + n_1 s_1^2(\theta_1) ] \\
\end{align*}
</div>
</div>
<div id="outline-container-org1472597" class="outline-6">
<h6 id="org1472597">the full conditional distribution of \(\sigma_2^2\)</h6>
<div class="outline-text-6" id="text-org1472597">
<p>
\(\sigma_2^2\)についても同様に計算すると、
</p>
\begin{align*}
& p(\sigma_2^2 | Y_1, \dots, Y_n, X_1, \dots, X_n, p, \theta_1, \theta_2, \sigma_1^2) \\
\propto & \text{dinverse-gamma}(\sigma_2^2, \frac{\nu_2}{2}, \frac{\nu_2 \sigma_2^2(\theta_2)}{2}),
\quad \text{ where } \\
& \nu_2 = \nu_0 + n_2, \\
& \sigma_2^2(\theta_2) = \frac{1}{\nu_2} [ \nu_0 \sigma_0^2 + n_2 s_2^2(\theta_2) ] \\
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-org6b39fb7" class="outline-4">
<h4 id="org6b39fb7">c)</h4>
<div class="outline-text-4" id="text-org6b39fb7">
</div>
<div id="outline-container-orgf3ed966" class="outline-5">
<h5 id="orgf3ed966">Answer</h5>
<div class="outline-text-5" id="text-orgf3ed966">
<div class="org-src-container">
<pre class="src src-julia">a = b = <span style="color: #e69055; font-weight: bold;">1</span>
&#956;&#8320; = <span style="color: #e69055; font-weight: bold;">120</span>
&#964;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">200</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">1000</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">10</span>
S = <span style="color: #e69055; font-weight: bold;">10000</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">rand_X</span><span style="color: #51afef;">(</span>y, p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">probability of Xi = 1</span>
    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">bin_prob</span><span style="color: #51afef;">(</span>yi, p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">)</span>
        p1 = p <span style="color: #FCCE7B;">*</span> pdf<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#952;&#8321;, sqrt<span style="color: #7bc275;">(</span>&#963;&#8321;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, yi<span style="color: #51afef;">)</span>
        p2 = <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">-</span> p<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> pdf<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#952;&#8322;, sqrt<span style="color: #7bc275;">(</span>&#963;&#8322;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, yi<span style="color: #51afef;">)</span>
        prob = p1<span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>p1 <span style="color: #FCCE7B;">+</span> p2<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>

    n = length<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
    X = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, n<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:n
        X<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span> =  <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">-</span> rand<span style="color: #51afef;">(</span>Bernoulli<span style="color: #C57BDB;">(</span>bin_prob<span style="color: #7bc275;">(</span>y<span style="color: #a991f1;">[</span>i<span style="color: #a991f1;">]</span>, p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">return</span> X
<span style="color: #51afef;">end</span>
<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">rand_p</span><span style="color: #51afef;">(</span>X, a, b<span style="color: #51afef;">)</span>
    n1 = sum<span style="color: #51afef;">(</span>X .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    n2 = sum<span style="color: #51afef;">(</span>X .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> rand<span style="color: #51afef;">(</span>Beta<span style="color: #C57BDB;">(</span>a <span style="color: #FCCE7B;">+</span> n1, b <span style="color: #FCCE7B;">+</span> n2<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">rand_&#952;</span><span style="color: #51afef;">(</span>&#956;&#8320;, &#964;&#8320;&#178;, &#963;&#178;, y<span style="color: #51afef;">)</span>
    n = length<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
    y&#772; = mean<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
    &#956;n = <span style="color: #51afef;">(</span>&#956;&#8320;<span style="color: #FCCE7B;">/</span>&#964;&#8320;&#178; <span style="color: #FCCE7B;">+</span> y&#772; <span style="color: #FCCE7B;">*</span> n<span style="color: #FCCE7B;">/</span>&#963;&#178;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span>&#964;&#8320;&#178; <span style="color: #FCCE7B;">+</span> n<span style="color: #FCCE7B;">/</span>&#963;&#178;<span style="color: #51afef;">)</span>
    &#964;n&#178; = <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span>&#964;&#8320;&#178; <span style="color: #FCCE7B;">+</span> n<span style="color: #FCCE7B;">/</span>&#963;&#178;<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#956;n, sqrt<span style="color: #7bc275;">(</span>&#964;n&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">rand_&#963;&#178;</span><span style="color: #51afef;">(</span>&#952;, &#957;&#8320;, &#963;&#8320;&#178;, y<span style="color: #51afef;">)</span>
    n = length<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
    y&#772; = mean<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
    s&#178; = var<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
    ns&#178; = <span style="color: #51afef;">(</span>n<span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> s&#178; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>y&#772; <span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>
    &#957;n = &#957;&#8320; <span style="color: #FCCE7B;">+</span> n
    &#963;n&#178; = <span style="color: #51afef;">(</span>&#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> ns&#178;<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">/</span>&#957;n
    &#945; = &#957;n<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>
    &#946; = &#957;n <span style="color: #FCCE7B;">*</span> &#963;n&#178;<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>
    <span style="color: #51afef;">return</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span>rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span>&#945;, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span>&#946;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
mean_y = mean<span style="color: #51afef;">(</span>data<span style="color: #51afef;">)</span>
var_y = var<span style="color: #51afef;">(</span>data<span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">Gibbs Sampler</span>

THETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
SIGMA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
P = <span style="color: #51afef;">[]</span>
X_MC = Matrix<span style="color: #51afef;">{</span>Int<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, length<span style="color: #C57BDB;">(</span>data<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
&#952;&#8321; = &#952;&#8322; = mean_y
&#963;&#8321;&#178; = &#963;&#8322;&#178; = var_y
p = <span style="color: #e69055; font-weight: bold;">0.5</span>

<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
    X_MC<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = rand_X<span style="color: #51afef;">(</span>data, p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">)</span>
    p = rand_p<span style="color: #51afef;">(</span>X_MC<span style="color: #C57BDB;">[</span>s, :<span style="color: #C57BDB;">]</span>, a, b<span style="color: #51afef;">)</span>
    &#952;&#8321; = rand_&#952;<span style="color: #51afef;">(</span>&#956;&#8320;, &#964;&#8320;&#178;, &#963;&#8321;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    &#952;&#8322; = rand_&#952;<span style="color: #51afef;">(</span>&#956;&#8320;, &#964;&#8320;&#178;, &#963;&#8322;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    &#963;&#8321;&#178; = rand_&#963;&#178;<span style="color: #51afef;">(</span>&#952;&#8321;, &#957;&#8320;, &#963;&#8320;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    &#963;&#8322;&#178; = rand_&#963;&#178;<span style="color: #51afef;">(</span>&#952;&#8322;, &#957;&#8320;, &#963;&#8320;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    THETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = <span style="color: #51afef;">[</span>&#952;&#8321;, &#952;&#8322;<span style="color: #51afef;">]</span>
    SIGMA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = <span style="color: #51afef;">[</span>&#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">]</span>
    push!<span style="color: #51afef;">(</span>P, p<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">if</span> s <span style="color: #FCCE7B;">%</span> <span style="color: #e69055; font-weight: bold;">1000</span> <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span>
        println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"Iteration: $s done"</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">get smaller one for each row</span>
THETA1 = mapslices<span style="color: #51afef;">(</span>minimum, THETA, dims = <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
THETA2 = mapslices<span style="color: #51afef;">(</span>maximum, THETA, dims = <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">autocorrelation plot</span>
lags = <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">100</span>
fig = plot<span style="color: #51afef;">(</span>
    lags, autocor<span style="color: #C57BDB;">(</span>THETA1, lags<span style="color: #C57BDB;">)</span>, label = L<span style="color: #7bc275;">"\theta_1^(s)"</span>,
    xlabel = <span style="color: #7bc275;">"Lag"</span>, ylabel = <span style="color: #7bc275;">"Autocorrelation"</span>, title = <span style="color: #7bc275;">"Autocorrelation Plot"</span>
<span style="color: #51afef;">)</span>
fig = plot!<span style="color: #51afef;">(</span>
    lags, autocor<span style="color: #C57BDB;">(</span>THETA2, lags<span style="color: #C57BDB;">)</span>, label = L<span style="color: #7bc275;">"\theta_2^(s)"</span>,
<span style="color: #51afef;">)</span>
fig
</pre>
</div>


<div id="org9cbd86e" class="figure">
<p><img src="fig/ch6/exercise6_2c.png" alt="exercise6_2c.png" width="600" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia">ess<span style="color: #51afef;">(</span>Chains<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span>THETA1 THETA2<span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
ESS
  parameters        ess      rhat
      Symbol    Float64   Float64

     param_1   464.2489    1.0002
     param_2   238.5754    1.0000
</pre>
</div>
</div>
</div>
<div id="outline-container-org3b66606" class="outline-4">
<h4 id="org3b66606">d)</h4>
<div class="outline-text-4" id="text-org3b66606">
</div>
<div id="outline-container-orgd7c9147" class="outline-5">
<h5 id="orgd7c9147">Answer</h5>
<div class="outline-text-5" id="text-orgd7c9147">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">sample y function</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">rand_y</span><span style="color: #51afef;">(</span>p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">)</span>
    x = <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">-</span> rand<span style="color: #51afef;">(</span>Bernoulli<span style="color: #C57BDB;">(</span>p<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">if</span> x <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span>
        <span style="color: #51afef;">return</span> rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#952;&#8321;, sqrt<span style="color: #7bc275;">(</span>&#963;&#8321;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">else</span>
        <span style="color: #51afef;">return</span> rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#952;&#8322;, sqrt<span style="color: #7bc275;">(</span>&#963;&#8322;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">Gibbs Sampler</span>

THETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
SIGMA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
P = <span style="color: #51afef;">[]</span>
X_MC = Matrix<span style="color: #51afef;">{</span>Int<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, length<span style="color: #C57BDB;">(</span>data<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
Y = <span style="color: #51afef;">[]</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
&#952;&#8321; = &#952;&#8322; = mean_y
&#963;&#8321;&#178; = &#963;&#8322;&#178; = var_y
p = <span style="color: #e69055; font-weight: bold;">0.5</span>

<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
    X_MC<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = rand_X<span style="color: #51afef;">(</span>data, p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">if</span> s <span style="color: #FCCE7B;">%</span> <span style="color: #e69055; font-weight: bold;">1000</span> <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span>
        println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"Iteration: $s"</span><span style="color: #51afef;">)</span>
        tmp = X_MC<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span>
        println<span style="color: #51afef;">(</span>sum<span style="color: #C57BDB;">(</span>tmp .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span>,<span style="color: #7bc275;">", "</span>, sum<span style="color: #C57BDB;">(</span>tmp .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    p = rand_p<span style="color: #51afef;">(</span>X_MC<span style="color: #C57BDB;">[</span>s, :<span style="color: #C57BDB;">]</span>, a, b<span style="color: #51afef;">)</span>
    &#952;&#8321; = rand_&#952;<span style="color: #51afef;">(</span>&#956;&#8320;, &#964;&#8320;&#178;, &#963;&#8321;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    &#952;&#8322; = rand_&#952;<span style="color: #51afef;">(</span>&#956;&#8320;, &#964;&#8320;&#178;, &#963;&#8322;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    &#963;&#8321;&#178; = rand_&#963;&#178;<span style="color: #51afef;">(</span>&#952;&#8321;, &#957;&#8320;, &#963;&#8320;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    &#963;&#8322;&#178; = rand_&#963;&#178;<span style="color: #51afef;">(</span>&#952;&#8322;, &#957;&#8320;, &#963;&#8320;&#178;, data<span style="color: #C57BDB;">[</span>X_MC<span style="color: #7bc275;">[</span>s, :<span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    THETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = <span style="color: #51afef;">[</span>&#952;&#8321;, &#952;&#8322;<span style="color: #51afef;">]</span>
    SIGMA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = <span style="color: #51afef;">[</span>&#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">]</span>
    push!<span style="color: #51afef;">(</span>P, p<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample y</span>
    y = rand_y<span style="color: #51afef;">(</span>p, &#952;&#8321;, &#952;&#8322;, &#963;&#8321;&#178;, &#963;&#8322;&#178;<span style="color: #51afef;">)</span>
    push!<span style="color: #51afef;">(</span>Y, y<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>


<div id="orge62e512" class="figure">
<p><img src="fig/ch6/exercise6_2d.png" alt="exercise6_2d.png" width="600" />
</p>
</div>


<p>
このモデルは、データの分布を割とうまく近似できてるんちゃうん。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org8f65c70" class="outline-3">
<h3 id="org8f65c70">6.3</h3>
<div class="outline-text-3" id="text-org8f65c70">
</div>
<div id="outline-container-orgcd95a8f" class="outline-4">
<h4 id="orgcd95a8f">a)</h4>
<div class="outline-text-4" id="text-orgcd95a8f">
</div>
<div id="outline-container-org2c1686c" class="outline-5">
<h5 id="org2c1686c">answer</h5>
<div class="outline-text-5" id="text-org2c1686c">
\begin{align*}
p(\beta | \boldsymbol{y}, \boldsymbol{x}, \boldsymbol{z}, c)
&\propto p(\boldsymbol{y}, \boldsymbol{x}, \boldsymbol{z}, c | \beta) p(\beta) \\
&= p(\boldsymbol{y} | \boldsymbol{x}, \boldsymbol{z}, c, \beta) p(\boldsymbol{x}, \boldsymbol{z}, c | \beta) p(\beta) \\
&= p(\boldsymbol{y} | \boldsymbol{x}, \boldsymbol{z}, c, \beta)
p(\boldsymbol{z} | \boldsymbol{x}, c, \beta) p(\boldsymbol{x}, c | \beta) p(\beta) \\
&= p(\boldsymbol{y} | \boldsymbol{z}, c) p(\boldsymbol{z} | \boldsymbol{x}, \beta) p(\boldsymbol{x}) p(c) p(\beta) \\
&\propto  p(\boldsymbol{z} | \boldsymbol{x},\beta) p(\beta) \\
&\propto \prod_{i=1}^n \exp \left( -\frac{1}{2} (z_i - \beta x_i)^2 \right) \exp \left( -\frac{1}{2 \tau_{\beta}^2} \beta^2 \right) \\
&= \exp \left( -\frac{1}{2} \sum_{i=1}^n (z_i - \beta x_i)^2 \right) \exp \left( -\frac{1}{2 \tau_{\beta}^2} \beta^2 \right) \\
&= \exp \left( -\frac{1}{2} \left( \sum_{i=1}^n z_i^2 - 2 \beta \sum_{i=1}^n x_i z_i + \beta^2 \sum_{i=1}^n x_i^2 \right) \right) \exp \left( -\frac{1}{2 \tau_{\beta}^2} \beta^2 \right) \\
\end{align*}

<p>
ここで、
</p>
\begin{align*}
\sum_{i=1}^n (z_i - \beta x_i)^2 + \frac{1}{\tau_{\beta}^2} \beta^2
&= \sum_{i=1}^n z_i^2 - 2 \beta \sum_{i=1}^n x_i z_i + \beta^2 \sum_{i=1}^n x_i^2 + \frac{1}{\tau_{\beta}^2} \beta^2 \\
&= a \beta^2 - 2 b \beta + \sum_{i=1}^n z_i^2 \\
\mathrm{where} \quad
a &= \sum_{i=1}^n x_i^2 + \frac{1}{\tau_{\beta}^2} \\
b &= \sum_{i=1}^n x_i z_i \\
\end{align*}

<p>
となるので、
</p>
\begin{align*}
p(\beta | \boldsymbol{y}, \boldsymbol{x}, \boldsymbol{z}, c)
&\propto \exp \left\{ -\frac{1}{2} \left( a \beta^2 - 2 b \beta \right) \right\} \\
&= \exp \left\{ -\frac{1}{2} a \left( \beta^2 - \frac{2 b}{a} \beta + \frac{b^2}{a^2} \right) + \frac{1}{2} \frac{b^2}{a} \right\} \\
&\propto \exp \left\{ -\frac{1}{2} a \left( \beta - \frac{b}{a} \right)^2 \right\} \\
&= \exp \left\{ - \frac{1}{2} \left( \frac{\beta - b/a}{1/ \sqrt{a} } \right) \right\} \\
&= \mathrm{dnorm}(\beta, b/a, 1/ \sqrt{a} ) \\
\end{align*}

<p>
よって、
</p>
\begin{align*}
\beta | \boldsymbol{y}, \boldsymbol{x}, \boldsymbol{z}, c \sim
\mathrm{Normal} \left( \frac{ \sum_{i=1}^n x_i z_i }{ \sum_{i=1}^n x_i^2 + \frac{1}{\tau_{\beta}^2} }, \frac{1}{  \sum_{i=1}^n x_i^2 + \frac{1}{\tau_{\beta}^2}  } \right)
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orgded2c75" class="outline-4">
<h4 id="orgded2c75">b)</h4>
<div class="outline-text-4" id="text-orgded2c75">
</div>
<div id="outline-container-org79e5a28" class="outline-5">
<h5 id="org79e5a28">answer</h5>
<div class="outline-text-5" id="text-org79e5a28">
\begin{align*}
p(c | y_i = 0, x_i, z_i, \beta)
&\propto p(y_i = 0 | z_i, c) p(c) \\
&= p(y_i = 0 | x_i, c, \beta) p(c) \\
&= \Phi(c - \beta x_i) p(c) \\
\end{align*}

\begin{align*}
p(c | \boldsymbol{y}, \boldsymbol{x}, \boldsymbol{z}, \beta)
&\propto p(\boldsymbol{y}, \boldsymbol{x}, \boldsymbol{z}, \beta | c) p(c) \\
&= p(\boldsymbol{y} | \boldsymbol{x}, \boldsymbol{z}, \beta, c) p(\boldsymbol{x}, \boldsymbol{z}, \beta | c) p(c) \\
&\propto p(\boldsymbol{y} | \boldsymbol{z}, c) p(c) \\
&= \left( 1 - \Phi() \right)
\end{align*}
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org2be65ef" class="outline-2">
<h2 id="org2be65ef">Chapter 7</h2>
<div class="outline-text-2" id="text-org2be65ef">
</div>
<div id="outline-container-org48b9ce4" class="outline-3">
<h3 id="org48b9ce4">7.1</h3>
<div class="outline-text-3" id="text-org48b9ce4">
</div>
<div id="outline-container-orgb473499" class="outline-4">
<h4 id="orgb473499">a)</h4>
<div class="outline-text-4" id="text-orgb473499">
</div>
<div id="outline-container-orgcd6cf7f" class="outline-5">
<h5 id="orgcd6cf7f">Answer</h5>
<div class="outline-text-5" id="text-orgcd6cf7f">
<p>
\(p_J\)が確率密度関数であるためには、
\(\int \int p_J(\boldsymbol{\theta}, \Sigma) d\boldsymbol{\theta} d\Sigma = 1\)
である必要があるが、
\(\int p_J(\boldsymbol{\theta}, \Sigma) d\boldsymbol{\theta} = \infty\)
であるため、\(p_J\)は確率密度関数ではない。
</p>
</div>
</div>
</div>
<div id="outline-container-orga68d3ed" class="outline-4">
<h4 id="orga68d3ed">b)</h4>
<div class="outline-text-4" id="text-orga68d3ed">
</div>
<div id="outline-container-org468b4b0" class="outline-5">
<h5 id="org468b4b0">Answer</h5>
<div class="outline-text-5" id="text-org468b4b0">
\begin{align*}
p_J(\boldsymbol{\theta}, \Sigma | \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n)
&\propto p_J(\boldsymbol{\theta}, \Sigma) \times p(\boldsymbol{y}_1, \ldots, \boldsymbol{y}_n | \boldsymbol{\theta}, \Sigma) \\
&\propto |\Sigma|^{-(p+2)/2} \times |\Sigma|^{-n/2} \exp \left\{ -\frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Sigma^{-1} (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
&= |\Sigma|^{-(p+n+2)/2} \exp \left\{ -\frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Sigma^{-1} (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
\\
p_J(\boldsymbol{\theta} | \Sigma, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n)
&\propto p_J(\boldsymbol{\theta}, \Sigma | \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n) \\
&\propto \exp\left\{ - \frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i^T - \boldsymbol{\theta}^T) \Sigma^{-1} (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
&= \exp\left\{ - \frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i^T \Sigma^{-1} - \boldsymbol{\theta}^T \Sigma^{-1}) (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
&= \exp\left\{ - \frac{1}{2} \sum_{i=1}^n \left( \boldsymbol{y}_i^T \Sigma^{-1} \boldsymbol{y}_i - \boldsymbol{y}_i^T \Sigma^{-1} \boldsymbol{\theta} - \boldsymbol{\theta}^T \Sigma^{-1} \boldsymbol{y}_i + \boldsymbol{\theta}^T \Sigma^{-1} \boldsymbol{\theta} \right) \right\} \\
&= \exp\left\{ - \frac{1}{2} \sum_{i=1}^n \left( \boldsymbol{y}_i^T \Sigma^{-1} \boldsymbol{y}_i - 2 \boldsymbol{\theta}^T \Sigma^{-1} \boldsymbol{y}_i + \boldsymbol{\theta}^T \Sigma^{-1} \boldsymbol{\theta} \right) \right\} \\
&\propto \exp\left\{ - \frac{1}{2} \boldsymbol{\theta}^T \boldsymbol{A}_1 \boldsymbol{\theta} + \boldsymbol{\theta}^T \boldsymbol{b}_1 \right\},
\quad \text{where} \quad
\boldsymbol{A}_1 = n \Sigma^{-1}, \
\boldsymbol{b}_1 = n \Sigma^{-1} \bar{\boldsymbol{y} }  \\
&\propto \text{dmultivariate normal}( \bar{\boldsymbol{y} }, \Sigma/n) \\
\\
p_J(\Sigma | \boldsymbol{\theta}, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n)
&\propto p_J(\boldsymbol{\theta}, \Sigma | \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n) \\
&\propto |\Sigma|^{-(p+n+2)/2} \exp \left\{ -\frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Sigma^{-1} (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
&\propto |\Sigma|^{-(n+1 + p + 1)/2}
\exp \left\{ -\frac{1}{2} \text{tr}(S_{\theta} \Sigma^{-1}) \right\} \quad
\text{where} \quad S_{\theta} = \sum_{i=1}^n (\boldsymbol{y}_i - \boldsymbol{\theta}) (\boldsymbol{y}_i - \boldsymbol{\theta})^T \\
&\propto \text{dinverse Wishart}(n+1, S_{\theta}^{-1})
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-org906275a" class="outline-3">
<h3 id="org906275a">7.2</h3>
<div class="outline-text-3" id="text-org906275a">
</div>
<div id="outline-container-org6b5b5d1" class="outline-4">
<h4 id="org6b5b5d1">Answer</h4>
<div class="outline-text-4" id="text-org6b5b5d1">
</div>
<div id="outline-container-org559c066" class="outline-5">
<h5 id="org559c066">a)</h5>
<div class="outline-text-5" id="text-org559c066">
\begin{align*}
l(\boldsymbol{\theta}, \Psi | \boldsymbol{Y})
&= \sum_{i=1}^n \log p(\boldsymbol{y}_i | \boldsymbol{\theta}, \Psi) \\
&= \sum_{i=1}^n \log \left\{ (2 \pi)^{-p/2} |\Psi|^{1/2} \exp \left( -\frac{1}{2} (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Psi (\boldsymbol{y}_i - \boldsymbol{\theta}) \right) \right\} \\
&= \sum_{i=1}^n \left\{ -\frac{p}{2} \log (2 \pi) + \frac{1}{2} \log |\Psi| -\frac{1}{2} (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Psi (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
&= -\frac{np}{2} \log (2 \pi) + \frac{n}{2} \log |\Psi| -\frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Psi (\boldsymbol{y}_i - \boldsymbol{\theta}) \\
&= -\frac{np}{2} \log (2 \pi) + \frac{n}{2} \log |\Psi| -\frac{1}{2} \sum_{i=1}^n \left\{ (\boldsymbol{y}_i - \bar{\boldsymbol{y} } + \bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\boldsymbol{y}_i - \bar{\boldsymbol{y} } + \bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\} \\
&= -\frac{np}{2} \log (2 \pi) + \frac{n}{2} \log |\Psi| -\frac{1}{2} \sum_{i=1}^n \left\{ ( (\boldsymbol{y}_i - \bar{\boldsymbol{y} })^T + ( \bar{\boldsymbol{y} } -  \boldsymbol{\theta})^T)  \Psi ((\boldsymbol{y}_i - \bar{\boldsymbol{y} }) + (\bar{\boldsymbol{y} } - \boldsymbol{\theta})) \right\} \\
&= -\frac{np}{2} \log (2 \pi) + \frac{n}{2} \log |\Psi| \\
&\qquad -\frac{1}{2} \sum_{i=1}^n \left\{ (\boldsymbol{y}_i - \bar{\boldsymbol{y} })^T \Psi (\boldsymbol{y}_i - \bar{\boldsymbol{y} }) + (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) + 2 (\boldsymbol{y}_i - \bar{\boldsymbol{y} })^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\} \\
&= -\frac{np}{2} \log (2 \pi) + \frac{n}{2} \log |\Psi| -\frac{1}{2} \sum_{i=1}^n \left\{ (\boldsymbol{y}_i - \bar{\boldsymbol{y} })^T \Psi (\boldsymbol{y}_i - \bar{\boldsymbol{y} }) + (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\} \\
&= -\frac{np}{2} \log (2 \pi) + \frac{n}{2} \log |\Psi| -\frac{n}{2}
\text{tr}(S \Psi) -\frac{n}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}), \\
&\qquad \qquad\text{where}
\quad S = \frac{1}{n} \sum_{i=1}^n (\boldsymbol{y}_i - \bar{\boldsymbol{y} }) (\boldsymbol{y}_i - \bar{\boldsymbol{y} })^T \\
\end{align*}
<p>
より、
</p>
\begin{align*}
\log p_U(\boldsymbol{\theta}, \Psi)
&= \frac{ l(\boldsymbol{\theta}, \Psi | \boldsymbol{Y}) }{n} + c \\
&= -\frac{p}{2} \log (2 \pi) + \frac{1}{2} \log |\Psi| -\frac{1}{2} \text{tr}(S \Psi) -\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) + c \\
\end{align*}
<p>
となる。よって
</p>
\begin{align*}
p_U(\boldsymbol{\theta}, \Psi)
&= \exp \left\{ -\frac{p}{2} \log (2 \pi) + \frac{1}{2} \log |\Psi| -\frac{1}{2} \text{tr}(S \Psi) -\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) + c \right\} \\
&= (2 \pi)^{- \frac{p}{2} } |\Psi|^{ \frac{1}{2} }
\exp \left\{ -\frac{1}{2} \text{tr}(S \Psi) \right\}
\exp \left\{-\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\exp(c)\\
&\propto
(2 \pi)^{- \frac{p}{2} } |\Psi^{-1}|^{- \frac{1}{2} }
\exp \left\{-\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\times |\Psi|^{ \frac{p+1-p-1}{2} }
\exp \left\{ -\frac{1}{2} \text{tr}(S \Psi) \right\} \\
&\propto
(2 \pi)^{- \frac{p}{2} } |\Psi^{-1}|^{- \frac{1}{2} }
\exp \left\{-\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Psi (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\times |\Psi|^{ \frac{p+1-p - 1}{2} }
\exp \left\{ -\frac{1}{2} \text{tr}(S \Psi) \right\} \\
&\propto \text{dmultivariate-normal}(\boldsymbol{\theta} | \bar{ \boldsymbol{y} } , \Psi^{-1})
\times \text{dWishart}(\Psi | p+1, S^{-1}) \\
\end{align*}
<p>
が成立。
</p>
</div>
</div>
<div id="outline-container-org55463e5" class="outline-5">
<h5 id="org55463e5">b)</h5>
<div class="outline-text-5" id="text-org55463e5">
\begin{align*}
p_U(\boldsymbol{\theta}, \boldsymbol{\Sigma} | \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n)
&\propto p_U(\boldsymbol{\theta} | \boldsymbol{\Sigma}) p_U(\boldsymbol{\Sigma})
p(\boldsymbol{y}_1, \ldots, \boldsymbol{y}_n | \boldsymbol{\theta}, \boldsymbol{\Sigma}) \\
&\propto |\boldsymbol{\Sigma}|^{- \frac{1}{2} }
\exp \left\{-\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \boldsymbol{\Sigma}^{-1} (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\times |\boldsymbol{\Sigma}^{-1}|^{ \frac{p+1-p - 1}{2} }
\exp \left\{ -\frac{1}{2} \text{tr}(S \boldsymbol{\Sigma}^{-1}) \right\} \\
& \qquad \times |\Sigma|^{ -\frac{n}{2} } \exp \left\{ -\frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i - \boldsymbol{\theta})^T \Sigma^{-1} (\boldsymbol{y}_i - \boldsymbol{\theta}) \right\} \\
&\propto |\boldsymbol{\Sigma}|^{- \frac{1}{2} }
\exp \left\{-\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \boldsymbol{\Sigma}^{-1} (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\times
\exp \left\{ -\frac{1}{2} \text{tr}(S \boldsymbol{\Sigma}^{-1}) \right\} \\
& \qquad \times |\Sigma|^{ -\frac{n}{2} } \exp \left\{ -\frac{1}{2} \sum_{i=1}^n (\boldsymbol{y}_i - \bar{y} + \bar{y} - \boldsymbol{\theta})^T \Sigma^{-1} (\boldsymbol{y}_i - \bar{y} + \bar{y} - \boldsymbol{\theta}) \right\} \\
&\propto |\boldsymbol{\Sigma}|^{- \frac{1}{2} }
\exp \left\{-\frac{1}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \boldsymbol{\Sigma}^{-1} (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\times
\exp \left\{ -\frac{1}{2} \text{tr}(S \boldsymbol{\Sigma}^{-1}) \right\} \\
& \qquad \times |\Sigma|^{ -\frac{n}{2} }
\exp \left\{ - \frac{n}{2} \text{tr}(S \boldsymbol{\Sigma}^{-1}) \right\}
\exp \left\{-\frac{n}{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \Sigma^{-1} (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\} \\
& \propto |\boldsymbol{\Sigma}|^{- \frac{n+1}{2} }
\exp \left\{-\frac{ n+1 }{2} (\bar{\boldsymbol{y} } - \boldsymbol{\theta})^T \boldsymbol{\Sigma}^{-1} (\bar{\boldsymbol{y} } - \boldsymbol{\theta}) \right\}
\times \exp \left\{ -\frac{n+1}{2} \text{tr}(S \boldsymbol{\Sigma}^{-1}) \right\} \\
& \propto |\boldsymbol{\Sigma}|^{- \frac{n+1}{2} }
\exp \left\{-\frac{1}{2} (\boldsymbol{\theta} - \bar{\boldsymbol{y} })^T (n+1) \boldsymbol{\Sigma}^{-1} (\boldsymbol{\theta} - \bar{\boldsymbol{y} }) \right\}
\times \exp \left\{ -\frac{1}{2} \text{tr}((n+1) S \boldsymbol{\Sigma}^{-1}) \right\} \\
& \propto | \frac{1}{n+1} \boldsymbol{\Sigma}|^{- \frac{1}{2} }
\exp \left\{-\frac{1}{2} (\boldsymbol{\theta} - \bar{\boldsymbol{y} })^T
( \frac{1}{n+1} \boldsymbol{\Sigma})^{-1} (\boldsymbol{\theta} - \bar{\boldsymbol{y} }) \right\} \\
&\qquad \times |\Sigma|^{- \frac{n-p-1+p+1}{2} }\exp \left\{ -\frac{1}{2} \text{tr}((n+1) S \boldsymbol{\Sigma}^{-1}) \right\} \\
& \propto \text{dmultivariate-normal}(\boldsymbol{\theta} | \bar{\boldsymbol{y} }, \frac{1}{n+1} \boldsymbol{\Sigma})
\times \text{dinverse-Wishart}(\boldsymbol{\Sigma} | n-p-1, \frac{1}{n+1} S^{-1}) \\
\end{align*}
<p>
上式より、
\(p_U(\boldsymbol{\theta}, \boldsymbol{\Sigma} | \boldsymbol{y}_1, \ldots, \boldsymbol{y}_n)\)
は、データと事前分布の情報が反映された分布であることがわかるので、事後分布とみなせる。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org34f5f73" class="outline-3">
<h3 id="org34f5f73">7.3</h3>
<div class="outline-text-3" id="text-org34f5f73">
</div>
<div id="outline-container-org6f3db2f" class="outline-4">
<h4 id="org6f3db2f">a)</h4>
<div class="outline-text-4" id="text-org6f3db2f">
</div>
<div id="outline-container-org506c517" class="outline-5">
<h5 id="org506c517">Answer</h5>
<div class="outline-text-5" id="text-org506c517">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">import</span> Pkg; Pkg.activate<span style="color: #51afef;">(</span><span style="color: #7bc275;">".."</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">using</span> DelimitedFiles
<span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> LinearAlgebra
<span style="color: #51afef;">using</span> StatsBase

bluecrab = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/bluecrab.dat"</span><span style="color: #51afef;">)</span>
orangecrap = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/orangecrab.dat"</span><span style="color: #51afef;">)</span>

&#956;_blue = mean<span style="color: #51afef;">(</span>bluecrab, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
&#956;_orange = mean<span style="color: #51afef;">(</span>orangecrap, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec

&#923;_blue = S_blue = cov<span style="color: #51afef;">(</span>bluecrab<span style="color: #51afef;">)</span>
&#923;_orange = S_orange = cov<span style="color: #51afef;">(</span>orangecrap<span style="color: #51afef;">)</span>

&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">4</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Gibbs sampler</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">bivariate_gibbs</span><span style="color: #51afef;">(</span>S, &#931;_init, &#956;&#8320;, &#923;&#8320;, S&#8320;, &#957;&#8320;, Y<span style="color: #51afef;">)</span>
    THETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    SIGMA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
    n = size<span style="color: #51afef;">(</span>Y, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    &#931; = &#931;_init
    y&#772; = mean<span style="color: #51afef;">(</span>Y, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#952;</span>
        &#923;n = inv<span style="color: #51afef;">(</span> inv<span style="color: #C57BDB;">(</span>&#923;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> inv<span style="color: #C57BDB;">(</span>&#931;<span style="color: #C57BDB;">)</span> <span style="color: #51afef;">)</span>
        &#956;n = &#923;n <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span> inv<span style="color: #C57BDB;">(</span>&#923;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> &#956;&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> inv<span style="color: #C57BDB;">(</span>&#931;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> y&#772; <span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
        dist = MvNormal<span style="color: #51afef;">(</span>&#956;n, Symmetric<span style="color: #C57BDB;">(</span>&#923;n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        &#952; = rand<span style="color: #51afef;">(</span>dist<span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#931;</span>
        Sn = S&#8320; <span style="color: #FCCE7B;">+</span> <span style="color: #51afef;">(</span>Y' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>Y' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span>'
        &#931; = rand<span style="color: #51afef;">(</span>InverseWishart<span style="color: #C57BDB;">(</span>n <span style="color: #FCCE7B;">+</span> &#957;&#8320;, Sn<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">save results</span>
        THETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
        SIGMA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#931;<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> THETA, SIGMA
<span style="color: #51afef;">end</span>

S = <span style="color: #e69055; font-weight: bold;">10000</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">Blue crab</span>
THETA_blue, SIGMA_blue = bivariate_gibbs<span style="color: #51afef;">(</span>S, &#923;_blue, &#956;_blue, &#923;_blue, S_blue, &#957;&#8320;, bluecrab<span style="color: #51afef;">)</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">Orange crab</span>
THETA_orange, SIGMA_orange = bivariate_gibbs<span style="color: #51afef;">(</span>S, &#923;_orange, &#956;_orange, &#923;_orange, S_orange, &#957;&#8320;, orangecrap<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3157cb3" class="outline-4">
<h4 id="org3157cb3">b)</h4>
<div class="outline-text-4" id="text-org3157cb3">
</div>
<div id="outline-container-org532e785" class="outline-5">
<h5 id="org532e785">Answer</h5>
<div class="outline-text-5" id="text-org532e785">

<div id="orgb286b73" class="figure">
<p><img src="fig/ch7/exercise7_3b.png" alt="exercise7_3b.png" width="600" />
</p>
</div>

<ul class="org-ul">
<li>両方の種で、\(\theta_1\) と \(\theta_2\) は正の相関を持つ。</li>
<li>orange crab の方が blue crab よりも幅、深さともに大きい。</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org8470d34" class="outline-4">
<h4 id="org8470d34">c)</h4>
<div class="outline-text-4" id="text-org8470d34">
</div>
<div id="outline-container-orga673b66" class="outline-5">
<h5 id="orga673b66">Answer</h5>
<div class="outline-text-5" id="text-orga673b66">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">get_pos_cor</span><span style="color: #51afef;">(</span>SIGMA, p, S<span style="color: #51afef;">)</span>
    COR = Array<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, p, p, S<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        Sig = reshape<span style="color: #51afef;">(</span>SIGMA<span style="color: #C57BDB;">[</span>s, :<span style="color: #C57BDB;">]</span>, p, p<span style="color: #51afef;">)</span>
        COR<span style="color: #51afef;">[</span>:, :, s<span style="color: #51afef;">]</span> = Sig <span style="color: #FCCE7B;">./</span> sqrt.<span style="color: #51afef;">(</span>diag<span style="color: #C57BDB;">(</span>Sig<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> diag<span style="color: #C57BDB;">(</span>Sig<span style="color: #C57BDB;">)</span>'<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> COR
<span style="color: #51afef;">end</span>
p = bluecrab <span style="color: #FCCE7B;">|&gt;</span> size <span style="color: #FCCE7B;">|&gt;</span> last
COR_mc_blue = get_pos_cor<span style="color: #51afef;">(</span>SIGMA_blue, p, S<span style="color: #51afef;">)</span>
COR_mc_orange = get_pos_cor<span style="color: #51afef;">(</span>SIGMA_orange, p, S<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgfc81ee6" class="figure">
<p><img src="fig/ch7/exercise7_3c.png" alt="exercise7_3c.png" width="600" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia">mean<span style="color: #51afef;">(</span>COR_mc_blue<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, :<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">&lt;</span> COR_mc_orange<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, :<span style="color: #C57BDB;">]</span> <span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.9893
</pre>


<ul class="org-ul">
<li>オレンジの方がブルーに比べて、幅と深さの相関が強い。</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org2502d9b" class="outline-3">
<h3 id="org2502d9b">7.4</h3>
<div class="outline-text-3" id="text-org2502d9b">
</div>
<div id="outline-container-org689292b" class="outline-4">
<h4 id="org689292b">a)</h4>
<div class="outline-text-4" id="text-org689292b">
</div>
<div id="outline-container-org0f1f525" class="outline-5">
<h5 id="org0f1f525">Answer</h5>
<div class="outline-text-5" id="text-org0f1f525">
<p>
自分のイメージでは、アメリカの平均的な夫婦の年齢は 50 歳くらいで、やや女性の方が若いと思うので、\(\mu_h = 51, \mu_h = 49\) とする。また、95%くらいで、25 歳から 75 歳くらいまでの範囲に収まると思うので、
\(\sigma_h = \sigma_w = 12.5\) とする。夫婦の年齢の相関はかなり大きいイメージなので、0.9 になるように、
</p>
\begin{align*}
&0.9
= \frac{\sigma_{hw}}{\sigma_h \sigma_w}
= \frac{\sigma_{hw}}{12.5^2} \\
\iff &\sigma_{hw} = 0.9 \times 12.5^2 = 140.625
\end{align*}
<p>
と設定する。まとめると、私の prior は以下のようになる。
</p>
\begin{align*}
\boldsymbol{\mu}_0 &= (51, 49)^T \\
\Lambda_0 &= \begin{pmatrix}
12.5^2 & 140.625 \\
140.625 & 12.5^2
\end{pmatrix} \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org281d86f" class="outline-4">
<h4 id="org281d86f">b)</h4>
<div class="outline-text-4" id="text-org281d86f">
</div>
<div id="outline-container-orgd675800" class="outline-5">
<h5 id="orgd675800">Answer</h5>
<div class="outline-text-5" id="text-orgd675800">
<div class="org-src-container">
<pre class="src src-julia">&#956;&#8320; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">51</span>, <span style="color: #e69055; font-weight: bold;">49</span><span style="color: #51afef;">]</span>
&#923;&#8320; = <span style="color: #51afef;">[</span>
    <span style="color: #e69055; font-weight: bold;">12.5</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #e69055; font-weight: bold;">140.625</span>
    <span style="color: #e69055; font-weight: bold;">140.625</span> <span style="color: #e69055; font-weight: bold;">12.5</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>
<span style="color: #51afef;">]</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
n = <span style="color: #e69055; font-weight: bold;">100</span>
prior_dist = MvNormal<span style="color: #51afef;">(</span>&#956;&#8320;, &#923;&#8320;<span style="color: #51afef;">)</span>
dataset1 = rand<span style="color: #51afef;">(</span>prior_dist, n<span style="color: #51afef;">)</span>
dataset2 = rand<span style="color: #51afef;">(</span>prior_dist, n<span style="color: #51afef;">)</span>
dataset3 = rand<span style="color: #51afef;">(</span>prior_dist, n<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgcba47a8" class="figure">
<p><img src="fig/ch7/exercise7_4b.png" alt="exercise7_4b.png" width="600" />
</p>
</div>

<ul class="org-ul">
<li>割とイメージ通りかなあ</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgef3e6e9" class="outline-4">
<h4 id="orgef3e6e9">c)</h4>
<div class="outline-text-4" id="text-orgef3e6e9">
</div>
<div id="outline-container-orge2ab360" class="outline-5">
<h5 id="orge2ab360">Answer</h5>
<div class="outline-text-5" id="text-orge2ab360">
</div>
<div id="outline-container-org117cef4" class="outline-6">
<h6 id="org117cef4">joint posterior distribution of \(\theta_h\) and \(\theta_w\)</h6>
<div class="outline-text-6" id="text-org117cef4">
<div class="org-src-container">
<pre class="src src-julia">agehw = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/agehw.dat"</span>, skipstart=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

p = size<span style="color: #51afef;">(</span>agehw,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
S = <span style="color: #e69055; font-weight: bold;">10000</span>
&#931;_init = cov<span style="color: #51afef;">(</span>agehw<span style="color: #51afef;">)</span>
S&#8320; = &#923;&#8320;
&#957;&#8320; = p<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">2</span>
THETA, SIGMA = bivariate_gibbs<span style="color: #51afef;">(</span>S, &#931;_init, &#956;&#8320;, &#923;&#8320;, S&#8320;, &#957;&#8320;, agehw<span style="color: #51afef;">)</span>
COR = get_pos_cor<span style="color: #51afef;">(</span>SIGMA, p, S<span style="color: #51afef;">)</span>
</pre>
</div>


<div id="orgde46cd3" class="figure">
<p><img src="fig/ch7/exercise7_4c_jointdist.png" alt="exercise7_4c_jointdist.png" width="600" />
</p>
</div>
</div>
</div>
<div id="outline-container-org9984ad8" class="outline-6">
<h6 id="org9984ad8">marginal posterior density of the correlation between \(Y_h\) and \(Y_w\)</h6>
<div class="outline-text-6" id="text-org9984ad8">

<div id="org09857c5" class="figure">
<p><img src="fig/ch7/exercise7_4c_correlation.png" alt="exercise7_4c_correlation.png" width="600" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgd68928d" class="outline-6">
<h6 id="orgd68928d">95% posterior confidence intervals for \(\theta_h\), \(\theta_w\), and the correlation coefficient</h6>
<div class="outline-text-6" id="text-orgd68928d">
<div class="org-src-container">
<pre class="src src-julia">quantile<span style="color: #51afef;">(</span>THETA<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>THETA<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>COR<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, :<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org54596ff">
2-element Vector{Float64}:
 41.82793288516493
 47.10559872633597

2-element Vector{Float64}:
 38.46175689329701
 43.44815317601299

2-element Vector{Float64}:
 0.8602554314182437
 0.9340079518830947
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbccec44" class="outline-4">
<h4 id="orgbccec44">d)</h4>
<div class="outline-text-4" id="text-orgbccec44">
</div>
<div id="outline-container-org603f0ac" class="outline-5">
<h5 id="org603f0ac">Answer</h5>
<div class="outline-text-5" id="text-org603f0ac">
</div>
<div id="outline-container-org9995298" class="outline-6">
<h6 id="org9995298">Jeffreys&rsquo; prior</h6>
<div class="outline-text-6" id="text-org9995298">
<div class="org-src-container">
<pre class="src src-julia">
THETA_J = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
SIGMA_J = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
n = size<span style="color: #51afef;">(</span>agehw, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
y&#772; = mean<span style="color: #51afef;">(</span>agehw, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec

<span style="color: #62686E;"># </span><span style="color: #62686E;">Gibbs sampler</span>
&#931; = cov<span style="color: #51afef;">(</span>agehw<span style="color: #51afef;">)</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">use the sample covariance matrix as initial value</span>
<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
    <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#952;</span>
    &#952; = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>y&#772;, Symmetric<span style="color: #7bc275;">(</span>&#931; <span style="color: #FCCE7B;">./</span> n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#931;</span>
    S_&#952; = <span style="color: #51afef;">(</span>agehw' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>agehw' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span>'
    &#931; = rand<span style="color: #51afef;">(</span>InverseWishart<span style="color: #C57BDB;">(</span>n<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span>, S_&#952;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">save results</span>
    THETA_J<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
    SIGMA_J<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#931;<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

COR_J = get_pos_cor<span style="color: #51afef;">(</span>SIGMA_J, p, S<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">95% credible interval</span>
quantile<span style="color: #51afef;">(</span>THETA_J<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>THETA_J<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>COR_J<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, :<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgd7cb931">
julia&gt; quantile(THETA_J[:, 1], [0.025, 0.975])
2-element Vector{Float64}:
 41.68056977372846
 47.14646200233917

julia&gt; quantile(THETA_J[:, 2], [0.025, 0.975])
2-element Vector{Float64}:
 38.3145806498635
 43.44817143945637

julia&gt; quantile(COR_J[1, 2, :], [0.025, 0.975])
2-element Vector{Float64}:
 0.861004578540727
 0.9345565686407257
</pre>
</div>
</div>
<div id="outline-container-org5b47894" class="outline-6">
<h6 id="org5b47894">the unit information prior</h6>
<div class="outline-text-6" id="text-org5b47894">
<div class="org-src-container">
<pre class="src src-julia">S_y = <span style="color: #51afef;">(</span>agehw' .<span style="color: #FCCE7B;">-</span> y&#772;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>agehw' .<span style="color: #FCCE7B;">-</span> y&#772;<span style="color: #51afef;">)</span>' <span style="color: #FCCE7B;">./</span> n
THETA_U = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
SIGMA_U = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample &#931;</span>
    &#931; = rand<span style="color: #51afef;">(</span>InverseWishart<span style="color: #C57BDB;">(</span>n<span style="color: #FCCE7B;">-</span>p<span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span>, S_y <span style="color: #FCCE7B;">.*</span> <span style="color: #7bc275;">(</span>n<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample &#952;</span>
    &#952; = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>y&#772;, Symmetric<span style="color: #7bc275;">(</span>&#931; <span style="color: #FCCE7B;">./</span> <span style="color: #a991f1;">(</span>n<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">save results</span>
    THETA_U<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
    SIGMA_U<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#931;<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

COR_U = get_pos_cor<span style="color: #51afef;">(</span>SIGMA_U, p, S<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">95% credible interval</span>
quantile<span style="color: #51afef;">(</span>THETA_U<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>THETA_U<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>COR_U<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, :<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org2193f8f">
julia&gt; quantile(THETA_U[:, 1], [0.025, 0.975])
2-element Vector{Float64}:

41.72596492912597
 47.1866768937701

julia&gt; quantile(THETA_U[:, 2], [0.025, 0.975])
2-element Vector{Float64}:
 38.33626197183087
 43.4809122415242

julia&gt; quantile(COR_U[1, 2, :], [0.025, 0.975])
2-element Vector{Float64}:
 0.8600180341629133
 0.9358050299774748
</pre>
</div>
</div>
<div id="outline-container-orga50462e" class="outline-6">
<h6 id="orga50462e">diffuse prior</h6>
<div class="outline-text-6" id="text-orga50462e">
<div class="org-src-container">
<pre class="src src-julia">&#956;&#8320; = zeros<span style="color: #51afef;">(</span>p<span style="color: #51afef;">)</span>
&#923;&#8320; = <span style="color: #e69055; font-weight: bold;">10</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">5</span> <span style="color: #FCCE7B;">.*</span> Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span>I, p, p<span style="color: #51afef;">)</span>
S&#8320; = <span style="color: #e69055; font-weight: bold;">1000</span> <span style="color: #FCCE7B;">.*</span> Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span>I, p, p<span style="color: #51afef;">)</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">3</span>
&#931;_init = cov<span style="color: #51afef;">(</span>agehw<span style="color: #51afef;">)</span>

THETA_D, SIGMA_D = bivariate_gibbs<span style="color: #51afef;">(</span>S, &#931;_init, &#956;&#8320;, &#923;&#8320;, S&#8320;, &#957;&#8320;, agehw<span style="color: #51afef;">)</span>

COR_D = get_pos_cor<span style="color: #51afef;">(</span>SIGMA_D, p, S<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">95% credible interval</span>
quantile<span style="color: #51afef;">(</span>THETA_D<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>THETA_D<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
quantile<span style="color: #51afef;">(</span>COR_D<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">2</span>, :<span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org5357cc2">
julia&gt; quantile(THETA_D[:, 1], [0.025, 0.975])

2-element Vector{Float64}:
 41.716486213023344
 47.116138763264516

julia&gt; quantile(THETA_D[:, 2], [0.025, 0.975])
2-element Vector{Float64}:
 38.335596688123054
 43.49771322728793

julia&gt; quantile(COR_D[1, 2, :], [0.025, 0.975])
2-element Vector{Float64}:
 0.7916370487843212
 0.9002008981233564
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8e4f05e" class="outline-4">
<h4 id="org8e4f05e">e)</h4>
<div class="outline-text-4" id="text-org8e4f05e">
</div>
<div id="outline-container-orgbbdfbfd" class="outline-5">
<h5 id="orgbbdfbfd">Answer</h5>
<div class="outline-text-5" id="text-orgbbdfbfd">
</div>
<div id="outline-container-org1564a3b" class="outline-6">
<h6 id="org1564a3b">Comparison of 95% Credible Intervals of couple age</h6>
<div class="outline-text-6" id="text-org1564a3b">
<p width="600">
<img src="fig/ch7/exercise7_4e_age.png" alt="exercise7_4e_age.png" width="600" />
<img src="fig/ch7/exercise7_4e_small.png" alt="exercise7_4e_small.png" />
</p>
</div>
</div>
<div id="outline-container-org3dedee5" class="outline-6">
<h6 id="org3dedee5">Comparison of 95% Credible Intervals of correlation coefficient</h6>
<div class="outline-text-6" id="text-org3dedee5">
<p width="600">
<img src="fig/ch7/exercise7_4e_cor.png" alt="exercise7_4e_cor.png" width="600" />
<img src="fig/ch7/exercise7_4e_small_cor.png" alt="exercise7_4e_small_cor.png" />
</p>
</div>
</div>
<div id="outline-container-org80891d9" class="outline-6">
<h6 id="org80891d9">Discussion</h6>
<div class="outline-text-6" id="text-org80891d9">
<p>
サンプルサイズが大きい場合\((n=100)\)、事前の情報は事後分布にほとんど影響を与えなていない。一方で、サンプルサイズが小さいと\((n=25)\)、相関係数の信用区間のプロットからもわかるように、事前の情報が事後分布に与える影響が大きくなるので、事前の情報が重要になる。
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org2995317" class="outline-3">
<h3 id="org2995317">7.5</h3>
<div class="outline-text-3" id="text-org2995317">
</div>
<div id="outline-container-org898591a" class="outline-4">
<h4 id="org898591a">a)</h4>
<div class="outline-text-4" id="text-org898591a">
</div>
<div id="outline-container-org0ff31e4" class="outline-5">
<h5 id="org0ff31e4">Answer</h5>
<div class="outline-text-5" id="text-org0ff31e4">
<div class="org-src-container">
<pre class="src src-julia">Y_src = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/interexp.dat"</span>, skipstart=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">parse_matrix</span><span style="color: #51afef;">(</span>input_matrix<span style="color: #51afef;">)</span>
    nrow, ncol = size<span style="color: #51afef;">(</span>input_matrix<span style="color: #51afef;">)</span>
    output_matrix = Matrix<span style="color: #51afef;">{</span>Union<span style="color: #C57BDB;">{</span>Missing, Float64<span style="color: #C57BDB;">}</span><span style="color: #51afef;">}(</span><span style="color: #a991f1;">missing</span>, nrow, ncol<span style="color: #51afef;">)</span>

    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:nrow
        <span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:ncol
            <span style="color: #51afef;">if</span> input_matrix<span style="color: #51afef;">[</span>i, j<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">==</span> <span style="color: #7bc275;">"NA"</span>
                output_matrix<span style="color: #51afef;">[</span>i, j<span style="color: #51afef;">]</span> = <span style="color: #a991f1;">missing</span>
            <span style="color: #51afef;">else</span>
                output_matrix<span style="color: #51afef;">[</span>i, j<span style="color: #51afef;">]</span> = Float64<span style="color: #51afef;">(</span>input_matrix<span style="color: #C57BDB;">[</span>i, j<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> output_matrix
<span style="color: #51afef;">end</span>
Y = parse_matrix<span style="color: #51afef;">(</span>Y_src<span style="color: #51afef;">)</span>
&#952;&#770;_A = mean<span style="color: #51afef;">(</span>skipmissing<span style="color: #C57BDB;">(</span>Y<span style="color: #7bc275;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
&#952;&#770;_B = mean<span style="color: #51afef;">(</span>skipmissing<span style="color: #C57BDB;">(</span>Y<span style="color: #7bc275;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
&#963;&#770;&#178;_A = var<span style="color: #51afef;">(</span>skipmissing<span style="color: #C57BDB;">(</span>Y<span style="color: #7bc275;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
&#963;&#770;&#178;_B = var<span style="color: #51afef;">(</span>skipmissing<span style="color: #C57BDB;">(</span>Y<span style="color: #7bc275;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">get index of not missing</span>
ind_A = ismissing.<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
ind_B = ismissing.<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
Y_comp = Y<span style="color: #51afef;">[</span>ind_A.<span style="color: #FCCE7B;">+</span>ind_B.<span style="color: #FCCE7B;">==</span><span style="color: #e69055; font-weight: bold;">0</span>, :<span style="color: #51afef;">]</span>
&#961;&#770; = cor<span style="color: #51afef;">(</span>Y_comp<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>, Y_comp<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">julia<span style="color: #FCCE7B;">&gt;</span> &#952;&#770;_A

<span style="color: #e69055; font-weight: bold;">24.200487804878044</span>

julia<span style="color: #FCCE7B;">&gt;</span> &#952;&#770;_B
<span style="color: #e69055; font-weight: bold;">24.805348837209298</span>

julia<span style="color: #FCCE7B;">&gt;</span> &#961;&#770;
<span style="color: #e69055; font-weight: bold;">0.6164509013184667</span>

julia<span style="color: #FCCE7B;">&gt;</span> &#963;&#770;&#178;_A
<span style="color: #e69055; font-weight: bold;">4.092799756097562</span>

julia<span style="color: #FCCE7B;">&gt;</span> &#963;&#770;&#178;_B
<span style="color: #e69055; font-weight: bold;">4.69157785160576</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge735565" class="outline-4">
<h4 id="orge735565">b)</h4>
<div class="outline-text-4" id="text-orge735565">
</div>
<div id="outline-container-org41c078f" class="outline-5">
<h5 id="org41c078f">Answer</h5>
<div class="outline-text-5" id="text-org41c078f">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">impute</span><span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>
    nrow = size<span style="color: #51afef;">(</span>Y, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    Y_imp = copy<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>

    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:nrow
        <span style="color: #51afef;">if</span> ismissing<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>i, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
            Y_imp<span style="color: #51afef;">[</span>i, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span> = &#952;&#770;_A <span style="color: #FCCE7B;">+</span> <span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>i, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> &#952;&#770;_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> &#961;&#770; <span style="color: #FCCE7B;">*</span> sqrt<span style="color: #51afef;">(</span>&#963;&#770;&#178;_A <span style="color: #FCCE7B;">/</span> &#963;&#770;&#178;_B<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">if</span> ismissing<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>i, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
            Y_imp<span style="color: #51afef;">[</span>i, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> = &#952;&#770;_B <span style="color: #FCCE7B;">+</span> <span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>i, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> &#952;&#770;_A<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> &#961;&#770; <span style="color: #FCCE7B;">*</span> sqrt<span style="color: #51afef;">(</span>&#963;&#770;&#178;_B <span style="color: #FCCE7B;">/</span> &#963;&#770;&#178;_A<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> Y_imp
<span style="color: #51afef;">end</span>

Y_imp = impute<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Do a paired sample t-test</span>
<span style="color: #51afef;">using</span> HypothesisTests
OneSampleTTest<span style="color: #51afef;">(</span>Y_imp<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">-</span> Y_imp<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:+RESULTS:
</p>
<pre class="example" id="org9538c49">
One sample t-test
-----------------
Population details:
    parameter of interest:   Mean
    value under h_0:         0
    point estimate:          -0.611704
    95% confidence interval: (-0.9851, -0.2383)

Test summary:
    outcome with 95% confidence: reject h_0
    two-sided p-value:           0.0018

Details:
    number of observations:   58
    t-statistic:              -3.280709515438293
    degrees of freedom:       57
    empirical standard error: 0.18645474208325274
</pre>
</div>
</div>
</div>
<div id="outline-container-orga4bf47d" class="outline-4">
<h4 id="orga4bf47d">c)</h4>
<div class="outline-text-4" id="text-orga4bf47d">
</div>
<div id="outline-container-org1199ef0" class="outline-5">
<h5 id="org1199ef0">Answer</h5>
<div class="outline-text-5" id="text-org1199ef0">
</div>
<div id="outline-container-org44a50b6" class="outline-6">
<h6 id="org44a50b6">Gibbs sampler</h6>
<div class="outline-text-6" id="text-org44a50b6">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">impute_Gibbs_Jeffreys</span><span style="color: #51afef;">(</span>S, Y, Y_full, &#931;_init<span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>
    O = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">.*</span> .!ismissing.<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>

    THETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    SIGMA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p <span style="color: #FCCE7B;">*</span> p<span style="color: #51afef;">)</span>
    Y_MISS = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, sum<span style="color: #C57BDB;">(</span>ismissing.<span style="color: #7bc275;">(</span>Y<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">initialize</span>
    &#931; = &#931;_init
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#952;</span>
        y&#772; = mean<span style="color: #51afef;">(</span>Y_full, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
        &#952; = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>y&#772;, Symmetric<span style="color: #7bc275;">(</span>&#931; <span style="color: #FCCE7B;">./</span> n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#931;</span>
        S_&#952; = <span style="color: #51afef;">(</span>Y_full' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>Y_full' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span>'
        &#931; = rand<span style="color: #51afef;">(</span>InverseWishart<span style="color: #C57BDB;">(</span>n <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">1</span>, S_&#952;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update missing data</span>
        <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:n
            b = <span style="color: #51afef;">(</span>O<span style="color: #C57BDB;">[</span>i, :<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
            a = <span style="color: #51afef;">(</span>O<span style="color: #C57BDB;">[</span>i, :<span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
            iSa = inv<span style="color: #51afef;">(</span>&#931;<span style="color: #C57BDB;">[</span>a, a<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
            &#946;j = &#931;<span style="color: #51afef;">[</span>b, a<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">*</span> iSa
            &#931;j = &#931;<span style="color: #51afef;">[</span>b, b<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">-</span> &#931;<span style="color: #51afef;">[</span>b, a<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">*</span> iSa <span style="color: #FCCE7B;">*</span> &#931;<span style="color: #51afef;">[</span>a, b<span style="color: #51afef;">]</span>
            &#952;j = &#952;<span style="color: #51afef;">[</span>b<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">+</span> &#946;j <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span> Y_full<span style="color: #C57BDB;">[</span>i, a<span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> &#952;<span style="color: #C57BDB;">[</span>a<span style="color: #C57BDB;">]</span> <span style="color: #51afef;">)</span>
            Y_full<span style="color: #51afef;">[</span>i, b<span style="color: #51afef;">]</span> = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>&#952;j, Symmetric<span style="color: #7bc275;">(</span>&#931;j<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">store</span>
        THETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
        SIGMA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#931;<span style="color: #51afef;">)</span>
        Y_MISS<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>Y_full<span style="color: #C57BDB;">[</span>O .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> THETA, SIGMA, Y_MISS
<span style="color: #51afef;">end</span>

S = <span style="color: #e69055; font-weight: bold;">10000</span>
Y_full = Float64.<span style="color: #51afef;">(</span>Y_imp<span style="color: #51afef;">)</span>
&#931;_init = cov<span style="color: #51afef;">(</span>Y_full<span style="color: #51afef;">)</span>

THETA, SIGMA, Y_MISS = impute_Gibbs_Jeffreys<span style="color: #51afef;">(</span>S, Y, Y_full, &#931;_init<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org1bbd24c" class="outline-6">
<h6 id="org1bbd24c">Posterior mean and confidence interval</h6>
<div class="outline-text-6" id="text-org1bbd24c">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean</span>
mean<span style="color: #51afef;">(</span>THETA<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">-</span> THETA<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
-0.6129730482663495
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence interval</span>
quantile<span style="color: #51afef;">(</span>THETA<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">-</span> THETA<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
2-element Vector{Float64}:
 -1.2864936536119458
  0.057091581482583
</pre>
</div>
</div>
<div id="outline-container-orgda501f5" class="outline-6">
<h6 id="orgda501f5">discussion</h6>
<div class="outline-text-6" id="text-orgda501f5">
<p>
b)で行った t 検定では、有意水準 5%で帰無仮説が棄却され、刺激 A と刺激 B の反応時間には有意な差があることが示唆される結果になったが、ベイズ推定による代入法では、差の事後分布の 95%信用区間が 0 を含んでおり、必ずしも刺激 A と刺激 B の反応時間に有意な差があるとは言えない結果になった。
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org7a00f8a" class="outline-3">
<h3 id="org7a00f8a">7.6</h3>
<div class="outline-text-3" id="text-org7a00f8a">
</div>
<div id="outline-container-org7831ebd" class="outline-4">
<h4 id="org7831ebd">a)</h4>
<div class="outline-text-4" id="text-org7831ebd">
</div>
<div id="outline-container-orgf1c3c69" class="outline-5">
<h5 id="orgf1c3c69">Answer</h5>
<div class="outline-text-5" id="text-orgf1c3c69">
</div>
<div id="outline-container-org511f760" class="outline-6">
<h6 id="org511f760">preprocess &amp; Gibbs sampler</h6>
<div class="outline-text-6" id="text-org511f760">
<div class="org-src-container">
<pre class="src src-julia">Y_src = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/azdiabetes.dat"</span>, header=<span style="color: #a991f1;">true</span><span style="color: #51afef;">)</span>
Y = Y_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
header = Y_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">|&gt;</span> vec
df = DataFrame<span style="color: #51afef;">(</span>Y, header<span style="color: #51afef;">)</span>

col_int = <span style="color: #51afef;">[</span><span style="color: #a991f1;">:npreg</span>, <span style="color: #a991f1;">:glu</span>, <span style="color: #a991f1;">:bp</span>, <span style="color: #a991f1;">:skin</span>, <span style="color: #a991f1;">:age</span><span style="color: #51afef;">]</span>
col_float = <span style="color: #51afef;">[</span><span style="color: #a991f1;">:bmi</span>, <span style="color: #a991f1;">:ped</span><span style="color: #51afef;">]</span>
col_str = <span style="color: #a991f1;">:diabetes</span>
df<span style="color: #51afef;">[</span>!,col_int<span style="color: #51afef;">]</span> = Int.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_int<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
df<span style="color: #51afef;">[</span>!,col_float<span style="color: #51afef;">]</span> = Float32.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_float<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
df<span style="color: #51afef;">[</span>!,col_str<span style="color: #51afef;">]</span> = String.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_str<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

df_d = filter<span style="color: #51afef;">(</span><span style="color: #a991f1;">:diabetes</span> <span style="color: #FCCE7B;">=&gt;</span> <span style="color: #FCCE7B;">==</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Yes"</span><span style="color: #C57BDB;">)</span>, df<span style="color: #51afef;">)</span>
df_n = filter<span style="color: #51afef;">(</span><span style="color: #a991f1;">:diabetes</span> <span style="color: #FCCE7B;">=&gt;</span> <span style="color: #FCCE7B;">==</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"No"</span><span style="color: #C57BDB;">)</span>, df<span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">getPosterior</span><span style="color: #51afef;">(</span>df, S<span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">select columns except for diabetes</span>
    Y = select<span style="color: #51afef;">(</span>df, Not<span style="color: #C57BDB;">(</span><span style="color: #a991f1;">:diabetes</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Matrix
    n, p = size<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>
    y&#772; = mean<span style="color: #51afef;">(</span>Y, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
    &#931;&#770; = cov<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">set prior</span>
    &#956;&#8320; = y&#772;
    &#923;&#8320; = &#931;&#770;
    S&#8320; = &#931;&#770;
    &#957;&#8320; = p <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">2</span>

    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">multivariateGibbs</span><span style="color: #51afef;">(</span>S, &#931;_init, &#956;&#8320;, &#923;&#8320;, S&#8320;, &#957;&#8320;, Y<span style="color: #51afef;">)</span>
        n, p = size<span style="color: #51afef;">(</span>Y<span style="color: #51afef;">)</span>
        THETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
        SIGMA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
        &#931; = &#931;_init
        y&#772; = mean<span style="color: #51afef;">(</span>Y, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
        <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
            <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#952;</span>
            &#923;n = inv<span style="color: #51afef;">(</span> inv<span style="color: #C57BDB;">(</span>&#923;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> inv<span style="color: #C57BDB;">(</span>&#931;<span style="color: #C57BDB;">)</span> <span style="color: #51afef;">)</span>
            &#956;n = &#923;n <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span> inv<span style="color: #C57BDB;">(</span>&#923;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> &#956;&#8320; <span style="color: #FCCE7B;">+</span> n <span style="color: #FCCE7B;">*</span> inv<span style="color: #C57BDB;">(</span>&#931;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> y&#772; <span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
            dist = MvNormal<span style="color: #51afef;">(</span>&#956;n, Symmetric<span style="color: #C57BDB;">(</span>&#923;n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
            &#952; = rand<span style="color: #51afef;">(</span>dist<span style="color: #51afef;">)</span>

            <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#931;</span>
            Sn = S&#8320; <span style="color: #FCCE7B;">+</span> <span style="color: #51afef;">(</span>Y' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>Y' .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #51afef;">)</span>'
            <span style="color: #62686E;"># </span><span style="color: #62686E;">&#931; = rand(InverseWishart(n + &#957;&#8320;, Sn))</span>
            &#931; = rand<span style="color: #51afef;">(</span>InverseWishart<span style="color: #C57BDB;">(</span>n <span style="color: #FCCE7B;">+</span> &#957;&#8320;, round.<span style="color: #7bc275;">(</span>Sn, digits=<span style="color: #e69055; font-weight: bold;">5</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

            <span style="color: #62686E;"># </span><span style="color: #62686E;">save results</span>
            THETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
            SIGMA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = vec<span style="color: #51afef;">(</span>&#931;<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">return</span> THETA, SIGMA
    <span style="color: #51afef;">end</span>

    THETA, SIGMA = multivariateGibbs<span style="color: #51afef;">(</span>S, &#931;&#770;, &#956;&#8320;, &#923;&#8320;, S&#8320;, &#957;&#8320;, Y<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> THETA, SIGMA
<span style="color: #51afef;">end</span>

S = <span style="color: #e69055; font-weight: bold;">10000</span>
THETA_d, SIGMA_d = getPosterior<span style="color: #51afef;">(</span>df_d, S<span style="color: #51afef;">)</span>
THETA_n, SIGMA_n = getPosterior<span style="color: #51afef;">(</span>df_n, S<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2f6a476" class="outline-6">
<h6 id="org2f6a476">marginal posterior distribution</h6>
<div class="outline-text-6" id="text-org2f6a476">

<div id="orgcc587c4" class="figure">
<p><img src="fig/ch7/exercise7-6a.png" alt="exercise7-6a.png" width="800" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-julia">p = size<span style="color: #51afef;">(</span>THETA_d, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:p
    theta_d = THETA_d<span style="color: #51afef;">[</span>:, i<span style="color: #51afef;">]</span>
    theta_n = THETA_n<span style="color: #51afef;">[</span>:, i<span style="color: #51afef;">]</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"Pr(&#952;d,$i &gt; &#952;n,$i) = "</span>, mean<span style="color: #C57BDB;">(</span>theta_d .<span style="color: #FCCE7B;">&gt;</span> theta_n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<pre class="example" id="orga2ad9dc">
Pr(θd,1 &gt; θn,1) = 1.0
Pr(θd,2 &gt; θn,2) = 1.0
Pr(θd,3 &gt; θn,3) = 1.0
Pr(θd,4 &gt; θn,4) = 1.0
Pr(θd,5 &gt; θn,5) = 1.0
Pr(θd,6 &gt; θn,6) = 1.0
Pr(θd,7 &gt; θn,7) = 1.0
</pre>

<ul class="org-ul">
<li>全ての変数で、糖尿病患者と非糖尿病患者間での平均値の差があると言える。</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdf07a62" class="outline-4">
<h4 id="orgdf07a62">b)</h4>
<div class="outline-text-4" id="text-orgdf07a62">
</div>
<div id="outline-container-org6e51fdf" class="outline-5">
<h5 id="org6e51fdf">Answer</h5>
<div class="outline-text-5" id="text-org6e51fdf">
</div>
<div id="outline-container-org542699a" class="outline-6">
<h6 id="org542699a">standard deviation</h6>
<div class="outline-text-6" id="text-org542699a">

<div id="orga5a0032" class="figure">
<p><img src="fig/ch7/exercise7-6b_sd.png" alt="exercise7-6b_sd.png" width="800" />
</p>
</div>
</div>
</div>
<div id="outline-container-org2b61c84" class="outline-6">
<h6 id="org2b61c84">correlation</h6>
<div class="outline-text-6" id="text-org2b61c84">

<div id="org9458024" class="figure">
<p><img src="fig/ch7/exercise7-6b_cor.png" alt="exercise7-6b_cor.png" width="800" />
</p>
</div>
</div>
</div>
<div id="outline-container-org984c952" class="outline-6">
<h6 id="org984c952">discussion</h6>
<div class="outline-text-6" id="text-org984c952">
<ul class="org-ul">
<li>標準偏差は、糖尿病患者群の方が、やや大きい</li>
<li>相関係数は diabetes pedigree 以外の変数に関して、非患者群の方が大きい。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orge9b5f70" class="outline-2">
<h2 id="orge9b5f70">Chapter 8</h2>
<div class="outline-text-2" id="text-orge9b5f70">
</div>
<div id="outline-container-orgfe55f52" class="outline-3">
<h3 id="orgfe55f52">8.1</h3>
<div class="outline-text-3" id="text-orgfe55f52">
</div>
<div id="outline-container-orgc839986" class="outline-4">
<h4 id="orgc839986">a)</h4>
<div class="outline-text-4" id="text-orgc839986">
</div>
<div id="outline-container-orgf2b925d" class="outline-5">
<h5 id="orgf2b925d">Answer</h5>
<div class="outline-text-5" id="text-orgf2b925d">
<p>
\( \text{Var}[y_{i,j}|\mu, \tau^2] \) is bigger because it includes both between-group and within-group variability while \( \text{Var}[y_{i,j}|\theta_j, \sigma^2] \) only includes within-group variability.
</p>
</div>
</div>
</div>
<div id="outline-container-org5f94812" class="outline-4">
<h4 id="org5f94812">b)</h4>
<div class="outline-text-4" id="text-org5f94812">
</div>
<div id="outline-container-org7e40496" class="outline-5">
<h5 id="org7e40496">Answer</h5>
<div class="outline-text-5" id="text-org7e40496">
<p>
I think \(\text{Cov}[y_{i_1, j}, y_{i_2,j}|\theta_j, \sigma^2]\) is zero because when \(\theta_j\) is known, \(y_{i_2,j}\) tells us nothing about \(y_{i_1,j}\) more than what we already know.
However, \(\text{Cov}[y_{i_1, j}, y_{i_2,j}|\mu, \tau^2]\) will be positive because \(y_{i_2,j}\) tells us something about group-specific information \(\theta_j\) which we do not know.
</p>
</div>
</div>
</div>
<div id="outline-container-org89cdc2c" class="outline-4">
<h4 id="org89cdc2c">c)</h4>
<div class="outline-text-4" id="text-org89cdc2c">
</div>
<div id="outline-container-orgaaa4670" class="outline-5">
<h5 id="orgaaa4670">Answer</h5>
<div class="outline-text-5" id="text-orgaaa4670">
\begin{align*}
\text{Var}[y_{i,j}|\theta_j, \sigma^2]
&= \sigma^2 \\
\text{Var}[\bar{y}_{\cdot, j}|\theta_j, \sigma^2]
&= \text{Var}[\frac{1}{n_j} \sum_{i=1}^{n_j} y_{i,j} | \theta_j, \sigma^2] \\
&= \frac{1}{n_j^2} \text{Var}[\sum_{i=1}^{n_j} y_{i,j} | \theta_j, \sigma^2] \\
&= \frac{ \sigma^2 }{n_j} \\
\text{Cov}[y_{i_1, j}, y_{i_2,j}|\theta_j, \sigma^2]
&= E[(y_{i_1, j} - \theta_j)(y_{i_2, j} - \theta_j) | \theta_j, \sigma^2] \\
&= E[y_{i_1, j}y_{i_2, j} - \theta_j y_{i_1, j} - \theta_j y_{i_2, j}) + \theta_j^2 | \theta_j, \sigma^2] \\
&= E[y_{i_1, j}y_{i_2, j} | \theta_j, \sigma^2] - \theta_j E[y_{i_1, j} | \theta_j, \sigma^2] - \theta_j E[y_{i_2, j} | \theta_j, \sigma^2] + \theta_j^2 \\
&= E[y_{i_1, j} | \theta_j, \sigma^2] E[y_{i_2, j} | \theta_j, \sigma^2] - \theta_j^2 - \theta_j^2 + \theta_j^2 \\
&\qquad (\because  y_{i_1, j} \text{ and } y_{i_2, j} \text{ are conditionally independent given} \theta_j, \sigma^2) \\
&= \theta_j^2 - \theta_j^2 \\
&= 0 \\
\end{align*}

\begin{align*}
\text{Var}[y_{i,j}|\mu, \tau^2]
&= E \left[\text{Var}[y_{i,j}|\theta_j, \sigma^2, \mu, \tau^2] | \mu, \tau^2\right] + \text{Var} \left[ E[y_{i,j}|\theta_j, \sigma^2, \mu, \tau^2] | \mu, \tau^2\right] \\
&= E[\text{Var}[y_{i,j}|\theta_j, \sigma^2] | \mu, \tau^2] + \text{Var}[E[y_{i,j}|\theta_j, \sigma^2] | \mu, \tau^2] \\
&= E[\sigma^2 | \mu, \tau^2] + \text{Var}[\theta_j | \mu, \tau^2] \\
&= \sigma^2 + \tau^2 \\
\text{Var}[\bar{y}_{\cdot, j}|\mu, \tau^2]
&= E \left[ \text{Var}[\bar{y}_{\cdot, j}|\theta_j, \sigma^2, \mu, \tau^2] | \mu, \tau^2 \right] + \text{Var} \left[ E[\bar{y}_{\cdot, j}|\theta_j, \sigma^2, \mu, \tau^2] | \mu, \tau^2 \right] \\
&= E[\text{Var}[\bar{y}_{\cdot, j}|\theta_j, \sigma^2] | \mu, \tau^2] + \text{Var}[E[\bar{y}_{\cdot, j}|\theta_j, \sigma^2] | \mu, \tau^2] \\
&= E[ \frac{ \sigma^2 }{n_j} | \mu, \tau^2] + \text{Var}[\theta_j | \mu, \tau^2] \\
&= \frac{ \sigma^2 }{n_j} + \tau^2 \\
\text{Cov}[y_{i_1, j}, y_{i_2,j}|\mu, \tau^2]
&= E \left[ \text{Cov}[y_{i_1, j}, y_{i_2,j}|\theta_j, \sigma^2, \mu, \tau^2] | \mu, \tau^2 \right] + \text{Cov} \left[ E[y_{i_1, j}|\theta_j, \sigma^2, \mu, \tau^2], E[y_{i_2, j}|\theta_j, \sigma^2, \mu, \tau^2] | \mu, \tau^2 \right] \\
&= E[\text{Cov}[y_{i_1, j}, y_{i_2,j}|\theta_j, \sigma^2] | \mu, \tau^2] + \text{Cov}[E[y_{i_1, j}|\theta_j, \sigma^2], E[y_{i_2, j}|\theta_j, \sigma^2] | \mu, \tau^2] \\
&= E[0 | \mu, \tau^2] + \text{Cov}[\theta_j, \theta_j | \mu, \tau^2] \\
&= 0 + \text{Var}[\theta_j | \mu, \tau^2] \\
&= \tau^2 \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org08fbede" class="outline-4">
<h4 id="org08fbede">d)</h4>
<div class="outline-text-4" id="text-org08fbede">
</div>
<div id="outline-container-orgcea31f9" class="outline-5">
<h5 id="orgcea31f9">Answer</h5>
<div class="outline-text-5" id="text-orgcea31f9">
\begin{align*}
p(\mu | \theta_1, \ldots, \theta_m, \sigma^2, \tau^2, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_m)
&= \frac{ p(\mu, \theta_1, \ldots, \theta_m, \sigma^2, \tau^2, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_m) }{ p(\theta_1, \ldots, \theta_m, \sigma^2, \tau^2, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_m) } \\
&= \frac{ p(\mu, \theta_1, \ldots, \theta_m, \sigma^2, \tau^2, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_m) }{ \int p( \mu, \theta_1, \ldots, \theta_m, \sigma^2, \tau^2, \boldsymbol{y}_1, \ldots, \boldsymbol{y}_m) d \mu } \\
&= \frac{ p(\boldsymbol{y}_1, \dots, \boldsymbol{y}_m | \theta_1, \ldots, \theta_m, \sigma^2) p(\theta_1, \ldots, \theta_m | \mu, \tau^2) p(\mu) p(\sigma^2) p(\tau^2) }{ \int p(\boldsymbol{y}_1, \dots, \boldsymbol{y}_m | \theta_1, \ldots, \theta_m, \sigma^2) p(\theta_1, \ldots, \theta_m | \mu, \tau^2) p(\mu) p(\sigma^2) p(\tau^2) d \mu } \\
&= \frac{ p(\boldsymbol{y}_1, \dots, \boldsymbol{y}_m | \theta_1, \ldots, \theta_m, \sigma^2) p(\theta_1, \ldots, \theta_m | \mu, \tau^2) p(\mu) p(\sigma^2) p(\tau^2) }{ p(\boldsymbol{y}_1, \dots, \boldsymbol{y}_m | \theta_1, \ldots, \theta_m, \sigma^2) p(\sigma^2)
\int  p(\theta_1, \ldots, \theta_m | \mu, \tau^2) p(\mu) p(\tau^2) d \mu } \\
&= \frac{ p(\theta_1, \ldots, \theta_m | \mu, \tau^2) p(\mu) p(\tau^2)}{ \int p(\theta_1, \ldots, \theta_m | \mu, \tau^2) p(\mu) p(\tau^2) d \mu } \\
&= \frac{ p(\mu, \theta_1, \ldots, \theta_m, \tau^2) }{ \int p(\mu, \theta_1, \ldots, \theta_m, \tau^2) d \mu } \\
&= \frac{ p(\mu, \theta_1, \ldots, \theta, \tau^2) }{ p(\theta_1, \ldots, \theta_m, \tau^2) } \\
&= p(\mu | \theta_1, \ldots, \theta_m, \tau^2) \\
\end{align*}

<p>
This means that the \(\sigma^2, \boldsymbol{y}_1, \dots, \boldsymbol{y}_2\) give us no additional information about \(\mu\) given \(\theta_1, \ldots, \theta_m, \tau^2\).
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org3311b5d" class="outline-3">
<h3 id="org3311b5d">8.2</h3>
<div class="outline-text-3" id="text-org3311b5d">
</div>
<div id="outline-container-org57f9a06" class="outline-4">
<h4 id="org57f9a06">a)</h4>
<div class="outline-text-4" id="text-org57f9a06">
</div>
<div id="outline-container-orgaf37d9e" class="outline-5">
<h5 id="orgaf37d9e">Answer</h5>
<div class="outline-text-5" id="text-orgaf37d9e">
<p>
The prior correlation of \(\theta_A\) and \(\theta_B\) is computed as follows:
</p>

\begin{align*}
\text{cov}(\theta_A, \theta_B)
&= \text{cov}(\mu + \delta, \mu - \delta) \\
&= E[(\mu + \delta)(\mu - \delta)] - E[\mu + \delta] E[\mu - \delta] \\
&= E[\mu^2 - \delta^2] - (E[\mu] + E[\delta]) (E[\mu] - E[\delta]) \\
&= E[\mu^2] - E[\delta^2] - (E[\mu]^2 - E[\delta]^2) \\
&= \text{var}(\mu) - \text{var}(\delta) \\
&= 100 - \tau^2_0 \\
\text{Var}[\theta_A]
&= \text{Var}[\mu + \delta] \\
&= \text{Var}[\mu] + \text{Var}[\delta] + 2 \text{cov}(\mu, \delta) \\
&= 100 + \tau^2_0 \\
\text{Var}[\theta_B]
&= \text{Var}[\mu - \delta] \\
&= \text{Var}[\mu] + \text{Var}[\delta] - 2 \text{cov}(\mu, \delta) \\
&= 100 + \tau^2_0 \\
\text{Corr}(\theta_A, \theta_B)
&= \frac{\text{cov}(\theta_A, \theta_B)}{\sqrt{\text{Var}[\theta_A] \text{Var}[\theta_B]}} \\
&= \frac{100 - \tau^2_0}{100 + \tau^2_0}
\end{align*}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
&#956;&#8320; = <span style="color: #e69055; font-weight: bold;">75</span>
&#947;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">100</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">100</span>
&#948;&#8320;_list = <span style="color: #51afef;">[</span><span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">4</span>, <span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">0</span>, <span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">]</span>
&#964;&#8320;&#178;_list = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">10</span>, <span style="color: #e69055; font-weight: bold;">50</span>, <span style="color: #e69055; font-weight: bold;">100</span>, <span style="color: #e69055; font-weight: bold;">500</span><span style="color: #51afef;">]</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set data</span>
n_A = <span style="color: #e69055; font-weight: bold;">16</span>
n_B = <span style="color: #e69055; font-weight: bold;">16</span>
y&#772;_A = <span style="color: #e69055; font-weight: bold;">75.2</span>
y&#772;_B = <span style="color: #e69055; font-weight: bold;">77.5</span>
s_A = <span style="color: #e69055; font-weight: bold;">7.3</span>
s_B = <span style="color: #e69055; font-weight: bold;">8.1</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">GibssSampling</span><span style="color: #51afef;">(</span>S, n_A, n_B,y&#772;_A, y&#772;_B, s_A, s_B, &#956;&#8320;, &#947;&#8320;&#178;, &#957;&#8320;, &#963;&#8320;&#178;, &#948;&#8320;, &#964;&#8320;&#178;<span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">Gibbs sampler</span>
    MU = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>
    DELTA = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>
    SIGMA = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>
    Y1 = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>
    Y2 = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
    &#956; = <span style="color: #51afef;">(</span>y&#772;_A <span style="color: #FCCE7B;">+</span> y&#772;_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>
    &#948; = <span style="color: #51afef;">(</span>y&#772;_A <span style="color: #FCCE7B;">-</span> y&#772;_B<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>

    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#963;&#178;</span>
        &#957;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">+</span> n_A <span style="color: #FCCE7B;">+</span> n_B
        &#957;&#8345;&#963;&#8345;&#178; = &#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span>
            n_A<span style="color: #FCCE7B;">*</span><span style="color: #51afef;">(</span>s_A<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">+</span> y&#772;_A<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">*</span>y&#772;_A<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>&#956; <span style="color: #FCCE7B;">+</span> &#948;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>&#956; <span style="color: #FCCE7B;">+</span> &#948;<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">+</span>
            n_B<span style="color: #FCCE7B;">*</span><span style="color: #51afef;">(</span>s_B<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">+</span> y&#772;_B<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">*</span>y&#772;_B<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>&#956; <span style="color: #FCCE7B;">-</span> &#948;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>&#956; <span style="color: #FCCE7B;">-</span> &#948;<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
        &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span>&#957;&#8345; <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">/</span> &#957;&#8345;&#963;&#8345;&#178;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#956;</span>
        &#947;&#8345;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> &#947;&#8320;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>n_A <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        &#956;&#8345; = &#947;&#8345;&#178; <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>&#956;&#8320; <span style="color: #FCCE7B;">/</span> &#947;&#8320;&#178; <span style="color: #FCCE7B;">+</span> n_A<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>y&#772;_A <span style="color: #FCCE7B;">-</span> &#948;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#963;&#178; <span style="color: #FCCE7B;">+</span> n_B<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>y&#772;_B <span style="color: #FCCE7B;">+</span> &#948;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        &#956; = rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#956;&#8345;, sqrt<span style="color: #7bc275;">(</span>&#947;&#8345;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#948;</span>
        &#964;&#8345;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> &#964;&#8320;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #C57BDB;">(</span>n_A <span style="color: #FCCE7B;">+</span> n_B<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        &#948;&#8345; = &#964;&#8345;&#178; <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>&#948;&#8320; <span style="color: #FCCE7B;">/</span> &#964;&#8320;&#178; <span style="color: #FCCE7B;">+</span> n_A<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>y&#772;_A <span style="color: #FCCE7B;">-</span> &#956;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#963;&#178; <span style="color: #FCCE7B;">-</span> n_B<span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>y&#772;_B <span style="color: #FCCE7B;">-</span> &#956;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        &#948; = rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#948;&#8345;, sqrt<span style="color: #7bc275;">(</span>&#964;&#8345;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">save parameter values</span>
        MU<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = &#956;
        DELTA<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = &#948;
        SIGMA<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = &#963;&#178;

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update Ys</span>
        Y1<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#956; .<span style="color: #FCCE7B;">+</span> &#948;, sqrt<span style="color: #7bc275;">(</span>&#963;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        Y2<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>&#956; .<span style="color: #FCCE7B;">-</span> &#948;, sqrt<span style="color: #7bc275;">(</span>&#963;&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> MU, DELTA, SIGMA, Y1, Y2
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">priorCorrelation</span><span style="color: #51afef;">(</span>&#947;&#8320;&#178;, &#964;&#8320;&#178;<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span>&#947;&#8320;&#178; <span style="color: #FCCE7B;">-</span> &#964;&#8320;&#178;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>&#947;&#8320;&#178; <span style="color: #FCCE7B;">+</span> &#964;&#8320;&#178;<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">getPosteriorValues</span><span style="color: #51afef;">(</span>
    S, n_A, n_B, y&#772;_A, y&#772;_B, s_A, s_B, &#956;&#8320;, &#947;&#8320;&#178;, &#957;&#8320;, &#963;&#8320;&#178;, &#948;&#8320;, &#964;&#8320;&#178;<span style="color: #51afef;">)</span>
    MU, DELTA, SIGMA, Y1, Y2 = GibssSampling<span style="color: #51afef;">(</span>
        S, n_A, n_B, y&#772;_A, y&#772;_B, s_A, s_B, &#956;&#8320;, &#947;&#8320;&#178;, &#957;&#8320;, &#963;&#8320;&#178;, &#948;&#8320;, &#964;&#8320;&#178;
    <span style="color: #51afef;">)</span>
    values = <span style="color: #51afef;">[</span>
        &#948;&#8320;, &#964;&#8320;&#178;,
        mean<span style="color: #C57BDB;">(</span>DELTA .<span style="color: #FCCE7B;">&lt;</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span>,
        quantile<span style="color: #C57BDB;">(</span>DELTA, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>,
        priorCorrelation<span style="color: #C57BDB;">(</span>&#947;&#8320;&#178;, &#964;&#8320;&#178;<span style="color: #C57BDB;">)</span>,
        cor<span style="color: #C57BDB;">(</span>MU .<span style="color: #FCCE7B;">+</span> DELTA, MU .<span style="color: #FCCE7B;">-</span> DELTA<span style="color: #C57BDB;">)</span>
    <span style="color: #51afef;">]</span>
    <span style="color: #51afef;">return</span> values
<span style="color: #51afef;">end</span>

S=<span style="color: #e69055; font-weight: bold;">5000</span>
storedf = DataFrame<span style="color: #51afef;">(</span>
    &#948;&#8320; = Float64<span style="color: #C57BDB;">[]</span>,
    &#964;&#8320;&#178; = Float64<span style="color: #C57BDB;">[]</span>,
    Pr_&#948;_lt_0 = Float64<span style="color: #C57BDB;">[]</span>,
    &#948;_CI = Vector<span style="color: #C57BDB;">{</span>Float64<span style="color: #C57BDB;">}[]</span>,
    prior_cor = Float64<span style="color: #C57BDB;">[]</span>,
    posterior_cor = Float64<span style="color: #C57BDB;">[]</span>
<span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> &#948;&#8320; <span style="color: #51afef;">in</span> &#948;&#8320;_list
    <span style="color: #51afef;">for</span> &#964;&#8320;&#178; <span style="color: #51afef;">in</span> &#964;&#8320;&#178;_list
        values = getPosteriorValues<span style="color: #51afef;">(</span>
            S, n_A, n_B, y&#772;_A, y&#772;_B, s_A, s_B, &#956;&#8320;, &#947;&#8320;&#178;, &#957;&#8320;, &#963;&#8320;&#178;, &#948;&#8320;, &#964;&#8320;&#178;
        <span style="color: #51afef;">)</span>
        push!<span style="color: #51afef;">(</span>storedf, values<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>
storedf
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="orgbfc92cc">
20×6 DataFrame
 Row │ δ₀       τ₀²      Pr_δ_lt_0  δ_CI                  prior_cor  posterior_cor 
     │ Float64  Float64  Float64    Array…                Float64    Float64       
─────┼─────────────────────────────────────────────────────────────────────────────
   1 │    -4.0     10.0     0.9004  [-4.40737, 0.960564]   0.818182     0.0832215
   2 │    -4.0     50.0     0.809   [-4.07596, 1.57355]    0.333333     0.0296429
   3 │    -4.0    100.0     0.7998  [-4.0521, 1.71576]     0.0         -0.00939503
   4 │    -4.0    500.0     0.7886  [-4.12576, 1.81624]   -0.666667    -0.0262716
   5 │    -2.0     10.0     0.837   [-3.92399, 1.32537]    0.818182     0.10129
   6 │    -2.0     50.0     0.8028  [-4.05612, 1.6224]     0.333333     0.00869293
   7 │    -2.0    100.0     0.8038  [-4.0379, 1.6864]      0.0         -0.00810778
   8 │    -2.0    500.0     0.7888  [-4.05015, 1.76565]   -0.666667    -0.0191756
   9 │     0.0     10.0     0.7576  [-3.48922, 1.67463]    0.818182     0.0929888
  10 │     0.0     50.0     0.7726  [-3.923, 1.72819]      0.333333     0.00904771
  11 │     0.0    100.0     0.7826  [-3.97522, 1.82757]    0.0         -0.0190771
  12 │     0.0    500.0     0.7928  [-4.0154, 1.72617]    -0.666667     0.0197301
  13 │     2.0     10.0     0.6736  [-3.22579, 2.10982]    0.818182     0.0825033
  14 │     2.0     50.0     0.763   [-3.85493, 1.81963]    0.333333    -0.00669629
  15 │     2.0    100.0     0.774   [-3.89927, 1.66101]    0.0         -0.0104147
  16 │     2.0    500.0     0.7908  [-4.0372, 1.75225]    -0.666667     0.00590126
  17 │     4.0     10.0     0.5678  [-2.83371, 2.36965]    0.818182     0.0925342
  18 │     4.0     50.0     0.7368  [-3.65975, 1.90021]    0.333333     0.0114906
  19 │     4.0    100.0     0.7718  [-3.86476, 1.78857]    0.0          0.0232417
  20 │     4.0    500.0     0.7924  [-4.17904, 1.72876]   -0.666667     0.00648826
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc5864a6" class="outline-4">
<h4 id="orgc5864a6">b)</h4>
<div class="outline-text-4" id="text-orgc5864a6">
</div>
<div id="outline-container-org4ee9c00" class="outline-5">
<h5 id="org4ee9c00">Answer</h5>
<div class="outline-text-5" id="text-org4ee9c00">
<p>
The posterior probability that
\(\theta_A \lt \theta_B \iff \delta \lt 0\)
is over 50% for all combinations of \(\delta_0\) and \(\tau_0^2\).
Even if we have a strong prior belief that \(\theta_A > \theta_B\),
the posterior probability that \(\theta_A \lt \theta_B\) is still over 50%.
(See the case of \(\delta_0 = 4\) and \(\tau_0^2 = 10\).)
In the case of <a href="#orgee48805">Exercise 5.2</a>, where each group was modeled independently, we could not provide such strong evidence.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org719b5fa" class="outline-3">
<h3 id="org719b5fa">8.3</h3>
<div class="outline-text-3" id="text-org719b5fa">
</div>
<div id="outline-container-org679e7e3" class="outline-4">
<h4 id="org679e7e3">a)</h4>
<div class="outline-text-4" id="text-org679e7e3">
</div>
<div id="outline-container-org3bf499b" class="outline-5">
<h5 id="org3bf499b">Answer</h5>
<div class="outline-text-5" id="text-org3bf499b">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> Random
<span style="color: #51afef;">using</span> LaTeXStrings
<span style="color: #51afef;">using</span> Plots, StatsPlots
<span style="color: #51afef;">using</span> Plots.Measures
<span style="color: #51afef;">using</span> CSV, DataFrames
<span style="color: #51afef;">using</span> DelimitedFiles
<span style="color: #51afef;">using</span> StatsBase
<span style="color: #51afef;">using</span> SpecialFunctions
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">read data</span>
Y = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, <span style="color: #e69055; font-weight: bold;">0</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">8</span>
    school = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/school$i.dat"</span><span style="color: #51afef;">)</span>
    Y = vcat<span style="color: #51afef;">(</span>Y, hcat<span style="color: #C57BDB;">(</span>repeat<span style="color: #7bc275;">(</span><span style="color: #a991f1;">[</span>i<span style="color: #a991f1;">]</span>, size<span style="color: #a991f1;">(</span>school, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span>, school<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
&#956;&#8320; = <span style="color: #e69055; font-weight: bold;">7</span>
&#947;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">5</span>
&#964;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">10</span>
&#951;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">10</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
m = length<span style="color: #51afef;">(</span>unique<span style="color: #C57BDB;">(</span>Y<span style="color: #7bc275;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
n = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, m<span style="color: #51afef;">)</span>
y&#772; = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, m<span style="color: #51afef;">)</span>
sv = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, m<span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:m
    y&#772;<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = mean<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>Y<span style="color: #7bc275;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> j, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    sv<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = var<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>Y<span style="color: #7bc275;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> j, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    n<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = length<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>Y<span style="color: #7bc275;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">==</span> j, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

&#952; = copy<span style="color: #51afef;">(</span>y&#772;<span style="color: #51afef;">)</span>
&#963;&#178; = mean<span style="color: #51afef;">(</span>sv<span style="color: #51afef;">)</span>
&#956; = mean<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>
&#964;&#178; = var<span style="color: #51afef;">(</span>&#952;<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">setup MCMC</span>
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
S = <span style="color: #e69055; font-weight: bold;">5000</span>
THETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, m<span style="color: #51afef;">)</span>
MST = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">MCMC algorithm</span>
<span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample new values of the &#952;s</span>
    <span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:m
        v_&#952; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">/</span> &#963;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> &#964;&#178;<span style="color: #51afef;">)</span>
        E_&#952; = v_&#952; <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>n<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span><span style="color: #FCCE7B;">*</span>y&#772;<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span><span style="color: #FCCE7B;">/</span>&#963;&#178; <span style="color: #FCCE7B;">+</span> &#956;<span style="color: #FCCE7B;">/</span>&#964;&#178;<span style="color: #51afef;">)</span>
        &#952;<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>E_&#952;, sqrt<span style="color: #7bc275;">(</span>v_&#952;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample new value of &#963;&#178;</span>
    &#957;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">+</span> sum<span style="color: #51afef;">(</span>n<span style="color: #51afef;">)</span>
    ss = &#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178;
    <span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:m
        ss <span style="color: #FCCE7B;">+=</span> sum<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>Y<span style="color: #7bc275;">[</span>Y<span style="color: #a991f1;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #a991f1;">]</span> .<span style="color: #FCCE7B;">==</span> j, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span> .<span style="color: #FCCE7B;">-</span> &#952;<span style="color: #7bc275;">[</span>j<span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span>&#957;&#8345; <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span>ss<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample a new value of &#956;</span>
    v_&#956; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>m<span style="color: #FCCE7B;">/</span>&#964;&#178; <span style="color: #FCCE7B;">+</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span>&#947;&#8320;&#178;<span style="color: #51afef;">)</span>
    E_&#956; = v_&#956; <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>m <span style="color: #FCCE7B;">*</span> mean<span style="color: #C57BDB;">(</span>&#952;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">/</span> &#964;&#178; <span style="color: #FCCE7B;">+</span> &#956;&#8320; <span style="color: #FCCE7B;">/</span> &#947;&#8320;&#178;<span style="color: #51afef;">)</span>
    &#956; = rand<span style="color: #51afef;">(</span>Normal<span style="color: #C57BDB;">(</span>E_&#956;, sqrt<span style="color: #7bc275;">(</span>v_&#956;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">sample a new value of &#964;&#178;</span>
    etam = &#951;&#8320; <span style="color: #FCCE7B;">+</span> m
    ss = &#951;&#8320; <span style="color: #FCCE7B;">*</span> &#964;&#8320;&#178; <span style="color: #FCCE7B;">+</span> sum<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>&#952; .<span style="color: #FCCE7B;">-</span> &#956;<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    &#964;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">/</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span>etam<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span>ss<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">store results</span>
    THETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = &#952;
    MST<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = <span style="color: #51afef;">[</span>&#956;, &#963;&#178;, &#964;&#178;<span style="color: #51afef;">]</span>
<span style="color: #51afef;">end</span>
</pre>
</div>


<div id="org659e03c" class="figure">
<p><img src="fig/ch8/ex8-3_stationarity.png" alt="ex8-3_stationarity.png" />
</p>
<p><span class="figure-number">Figure 1: </span>stationarity plot</p>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> MCMCDiagnosticTools
<span style="color: #51afef;">using</span> MCMCChains

ess<span style="color: #51afef;">(</span>MCMCChains.Chains<span style="color: #C57BDB;">(</span>MST<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
ESS
  parameters         ess   ess_per_sec
      Symbol     Float64       Missing

     param_1   4046.5607       missing
     param_2   4697.5784       missing
     param_3   3299.9524       missing
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd31460e" class="outline-4">
<h4 id="orgd31460e">b)</h4>
<div class="outline-text-4" id="text-orgd31460e">
</div>
<div id="outline-container-org4eef695" class="outline-5">
<h5 id="org4eef695">Answer</h5>
<div class="outline-text-5" id="text-org4eef695">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean and 95% confidence region for &#963;&#178;</span>
julia<span style="color: #FCCE7B;">&gt;</span> mean<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #e69055; font-weight: bold;">14.413317696499103</span>

julia<span style="color: #FCCE7B;">&gt;</span> quantile<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">-</span>element Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}</span>:
 <span style="color: #e69055; font-weight: bold;">11.733606090321313</span>
 <span style="color: #e69055; font-weight: bold;">17.92710379952854</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean and 95% confidence region for &#956;</span>
julia<span style="color: #FCCE7B;">&gt;</span> mean<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #e69055; font-weight: bold;">7.587311747784735</span>

julia<span style="color: #FCCE7B;">&gt;</span> quantile<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">-</span>element Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}</span>:
 <span style="color: #e69055; font-weight: bold;">5.910059688648781</span>
 <span style="color: #e69055; font-weight: bold;">9.160791496009686</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">julia<span style="color: #FCCE7B;">&gt;</span> mean<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #e69055; font-weight: bold;">5.478604048700004</span>

julia<span style="color: #FCCE7B;">&gt;</span> quantile<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span>, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">-</span>element Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}</span>:
  <span style="color: #e69055; font-weight: bold;">1.9240022529423977</span>
 <span style="color: #e69055; font-weight: bold;">14.101516261365546</span>
</pre>
</div>


<div id="org450e5fe" class="figure">
<p><img src="fig/ch8/ex8-3_posterior.png" alt="ex8-3_posterior.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Comparison of posterior and prior densities</p>
</div>

<p>
The following things were learned from the data:
</p>
<ul class="org-ul">
<li>\(\sigma^2\) is around 14.4, which is higher than the prior mean 10.0, and the variance is smaller than the prior variance 100.</li>
<li>\(\mu\) is around 7.6, which is higher than the prior mean 7.0, and the variance is smaller than the prior variance 10.0.</li>
<li>\(\tau^2\) is around 5.5, which is smaller than the prior mean 10.0, and the variance is smaller than the prior variance 100.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgcdd1f0b" class="outline-4">
<h4 id="orgcdd1f0b">c)</h4>
<div class="outline-text-4" id="text-orgcdd1f0b">
</div>
<div id="outline-container-org3c43a3d" class="outline-5">
<h5 id="org3c43a3d">Answer</h5>
<div class="outline-text-5" id="text-org3c43a3d">
<div class="org-src-container">
<pre class="src src-julia">&#963;&#178;_pri = rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span>&#963;&#8320;&#178;<span style="color: #FCCE7B;">/</span>&#957;&#8320;<span style="color: #C57BDB;">)</span>, S<span style="color: #51afef;">)</span>
&#964;&#178;_pri = rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span>&#951;&#8320;<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span>&#964;&#8320;&#178;<span style="color: #FCCE7B;">/</span>&#951;&#8320;<span style="color: #C57BDB;">)</span>, S<span style="color: #51afef;">)</span>
R_pri = &#964;&#178;_pri <span style="color: #FCCE7B;">./</span> <span style="color: #51afef;">(</span>&#963;&#178;_pri .<span style="color: #FCCE7B;">+</span> &#964;&#178;_pri<span style="color: #51afef;">)</span>
R_pos = MST<span style="color: #51afef;">[</span>:,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">./</span><span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">+</span> MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org51f3e84" class="figure">
<p><img src="fig/ch8/ex8-3_Rdensity.png" alt="ex8-3_Rdensity.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Prior and posterior densities of \(R\)</p>
</div>

<p>
The plot above shows that about 25% of the variance is due to between-school variation, and the rest is due to within-school variation.
</p>
</div>
</div>
</div>
<div id="outline-container-orgecd6add" class="outline-4">
<h4 id="orgecd6add">d)</h4>
<div class="outline-text-4" id="text-orgecd6add">
</div>
<div id="outline-container-orgc34639c" class="outline-5">
<h5 id="orgc34639c">Answer</h5>
<div class="outline-text-5" id="text-orgc34639c">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior probability that &#952;&#8327; is smaller than &#952;&#8326;</span>
mean<span style="color: #51afef;">(</span>THETA<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">7</span><span style="color: #C57BDB;">]</span> .<span style="color: #FCCE7B;">&lt;</span> THETA<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">6</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.5222
</pre>



<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior probability that &#952;&#8327; is the smallest of all the &#952;&#8217;s</span>
mean<span style="color: #51afef;">(</span>THETA<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">7</span><span style="color: #C57BDB;">]</span> .&#8804; minimum<span style="color: #C57BDB;">(</span>THETA, dims=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
0.325
</pre>
</div>
</div>
</div>
<div id="outline-container-org72cca60" class="outline-4">
<h4 id="org72cca60">e)</h4>
<div class="outline-text-4" id="text-org72cca60">
</div>
<div id="outline-container-org48bb41e" class="outline-5">
<h5 id="org48bb41e">Answer</h5>
<div class="outline-text-5" id="text-org48bb41e">
<div class="org-src-container">
<pre class="src src-julia">&#952;&#772; = mean<span style="color: #51afef;">(</span>THETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
fig_e = plot<span style="color: #51afef;">(</span>
    y&#772;, &#952;&#772;, seriestype=<span style="color: #a991f1;">:scatter</span>, xlabel=L<span style="color: #7bc275;">"\bar{y}_i"</span>, ylabel=L<span style="color: #7bc275;">"\theta_i"</span>, legend=<span style="color: #a991f1;">:none</span>,
    xlims=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">6</span>,<span style="color: #e69055; font-weight: bold;">11</span><span style="color: #C57BDB;">)</span>, ylims=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">6</span>,<span style="color: #e69055; font-weight: bold;">11</span><span style="color: #C57BDB;">)</span>, size=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">400</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>, margin=<span style="color: #e69055; font-weight: bold;">5</span>mm, alpha=<span style="color: #e69055; font-weight: bold;">0.5</span>
<span style="color: #51afef;">)</span>
fig_e = plot!<span style="color: #51afef;">(</span>fig_e, x<span style="color: #FCCE7B;">-&gt;</span>x, color=<span style="color: #a991f1;">:red</span>, linewidth=<span style="color: #e69055; font-weight: bold;">1</span>,alpha=<span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span>
fig_e
</pre>
</div>


<div id="orgc8faa79" class="figure">
<p><img src="fig/ch8/ex8-3e_scatter.png" alt="ex8-3e_scatter.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Sample averages and posterior expectations</p>
</div>

<p>
For the schools with large sample averages, the posterior expectations tend to be smaller than the sample averages.
For the schools with small sample averages, the posterior expectations tend to be larger than the sample averages.
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">sample mean of all observations</span>
mean<span style="color: #51afef;">(</span>Y<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
7.6912777777777785
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean of &#956;</span>
mean<span style="color: #51afef;">(</span>MST<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
7.587311747784735
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org2bac6f5" class="outline-2">
<h2 id="org2bac6f5">Chapter 9</h2>
<div class="outline-text-2" id="text-org2bac6f5">
</div>
<div id="outline-container-orgb2b225e" class="outline-3">
<h3 id="orgb2b225e">9.1</h3>
<div class="outline-text-3" id="text-orgb2b225e">
</div>
<div id="outline-container-orgd6bbff3" class="outline-4">
<h4 id="orgd6bbff3">a)</h4>
<div class="outline-text-4" id="text-orgd6bbff3">
</div>
<div id="outline-container-orgb08c534" class="outline-5">
<h5 id="orgb08c534">Answer</h5>
<div class="outline-text-5" id="text-orgb08c534">
<p>
The prior information means that the line \(\beta_1 + \beta_2 x\) should produce values between 22 and 24 when \(x\) is between 1 and 6.
A little algebra shows that we need a prior distribution on \((\beta_1, \beta_2)\) such that
\(\frac{98}{5} < \beta_1 < \frac{132}{5}\) and \(-\frac{2}{5} < \beta_2 < \frac{2}{5}\) with high probability.
This could be done by taking \(\boldsymbol{\beta}_0 = (23, 0) \) and \(\Sigma_0 = \text{diag}\left( \left(\frac{17}{5} \right)^2, \left(\frac{1}{5} \right)^2 \right)\).
For \(\nu_0\) and \(\sigma_0^2\), we could take \(\nu_0 = 2\) and \(\sigma_0^2 = 0.5\) so that the prior distribution of \(\sigma^2\) is concentrated around 0.5.
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">read data</span>
swim = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/swim.dat"</span>, header=<span style="color: #a991f1;">false</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">regressionSemiconjugatePrior</span><span style="color: #51afef;">(</span>y, X, &#946;&#8320;, &#931;&#8320;, &#957;&#8320;, &#963;&#8320;&#178;; S=<span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    BETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    SIGMA&#178; = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
    olsfit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    &#946; = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
    &#963;&#178; = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>olsfit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n <span style="color: #FCCE7B;">-</span> p<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">MCMC algorithm</span>
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#946;</span>
        V = inv<span style="color: #51afef;">(</span>inv<span style="color: #C57BDB;">(</span>&#931;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> X'X <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        E = V <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>inv<span style="color: #C57BDB;">(</span>&#931;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> &#946;&#8320; <span style="color: #FCCE7B;">+</span> X'y <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        &#946; = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>E, Symmetric<span style="color: #7bc275;">(</span>V<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#963;&#178;</span>
        &#957;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">+</span> n
        SSR = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, y <span style="color: #FCCE7B;">-</span> X<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        &#957;&#8345;&#963;&#178;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> SSR
        &#963;&#178; = rand<span style="color: #51afef;">(</span>InverseGamma<span style="color: #C57BDB;">(</span>&#957;&#8345; <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span>&#957;&#8345;&#963;&#178;&#8345;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">store</span>
        BETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = &#946;
        SIGMA&#178;<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = &#963;&#178;
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">return</span> BETA, SIGMA&#178;
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
&#946;&#8320; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">23</span>, <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">]</span>
&#931;&#8320; = diagm<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span><span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">17</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">5</span><span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">5</span><span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">0.5</span>

S = <span style="color: #e69055; font-weight: bold;">5000</span>

Y_PRED = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, size<span style="color: #C57BDB;">(</span>swim,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
fig = plot<span style="color: #51afef;">(</span>
    title=<span style="color: #7bc275;">"posterior predictive distribution"</span>, xlabel=<span style="color: #7bc275;">"time"</span>, ylabel=<span style="color: #7bc275;">"density"</span>
    , size=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">800</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>, margin=<span style="color: #e69055; font-weight: bold;">3</span>mm
<span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:size<span style="color: #51afef;">(</span>swim,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    y = swim<span style="color: #51afef;">[</span>i, :<span style="color: #51afef;">]</span>
    X = <span style="color: #51afef;">[</span>repeat<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span>, length<span style="color: #7bc275;">(</span>y<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #e69055; font-weight: bold;">1</span>:length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span>
    BETA, SIGMA&#178; = regressionSemiconjugatePrior<span style="color: #51afef;">(</span>y, X, &#946;&#8320;, &#931;&#8320;, &#957;&#8320;, &#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
    &#956;_ypred = BETA<span style="color: #51afef;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span> .<span style="color: #FCCE7B;">+</span> BETA<span style="color: #51afef;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    ypred = rand.<span style="color: #51afef;">(</span>Normal.<span style="color: #C57BDB;">(</span>&#956;_ypred, sqrt.<span style="color: #7bc275;">(</span>SIGMA&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    Y_PRED<span style="color: #51afef;">[</span>:, i<span style="color: #51afef;">]</span> = ypred
    fig = density!<span style="color: #51afef;">(</span>fig, ypred, label=<span style="color: #7bc275;">"swimmer $i"</span><span style="color: #51afef;">)</span>
    ypred_mean = ypred <span style="color: #FCCE7B;">|&gt;</span> mean <span style="color: #FCCE7B;">|&gt;</span> x <span style="color: #FCCE7B;">-&gt;</span> round<span style="color: #51afef;">(</span>x, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"swimmer $i: "</span>, ypred_mean<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
swimmer 1: 22.73
swimmer 2: 23.52
swimmer 3: 22.86
swimmer 4: 23.44
</pre>



<div id="orgb4bd230" class="figure">
<p><img src="fig/ch9/ex9-1_posterior_predictive.png" alt="ex9-1_posterior_predictive.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org09a6af1" class="outline-4">
<h4 id="org09a6af1">b)</h4>
<div class="outline-text-4" id="text-org09a6af1">
</div>
<div id="outline-container-org37c72c3" class="outline-5">
<h5 id="org37c72c3">Answer</h5>
<div class="outline-text-5" id="text-org37c72c3">
<div class="org-src-container">
<pre class="src src-julia">ind_fastest = mapslices<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x .<span style="color: #FCCE7B;">==</span> minimum<span style="color: #C57BDB;">(</span>x<span style="color: #C57BDB;">)</span>, Y_PRED, dims=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
mean<span style="color: #51afef;">(</span>ind_fastest, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
1×4 Matrix{Float64}:
 0.4184  0.1064  0.3504  0.1248
</pre>


<p>
The probability that each swimmer is the fastest is shown above.
Swimmer 1 will be the fastest with probability 0.4184, so I recommend that the coach choose swimmer 1.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org46611e1" class="outline-3">
<h3 id="org46611e1">9.2</h3>
<div class="outline-text-3" id="text-org46611e1">
</div>
<div id="outline-container-org38d379a" class="outline-4">
<h4 id="org38d379a">a)</h4>
<div class="outline-text-4" id="text-org38d379a">
</div>
<div id="outline-container-org06656c8" class="outline-5">
<h5 id="org06656c8">Answer</h5>
<div class="outline-text-5" id="text-org06656c8">
<div class="org-src-container">
<pre class="src src-julia">Y_src = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/azdiabetes.dat"</span>, header=<span style="color: #a991f1;">true</span><span style="color: #51afef;">)</span>
Y = Y_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
header = Y_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">|&gt;</span> vec
df = DataFrame<span style="color: #51afef;">(</span>Y, header<span style="color: #51afef;">)</span>

col_int = <span style="color: #51afef;">[</span><span style="color: #a991f1;">:npreg</span>, <span style="color: #a991f1;">:glu</span>, <span style="color: #a991f1;">:bp</span>, <span style="color: #a991f1;">:skin</span>, <span style="color: #a991f1;">:age</span><span style="color: #51afef;">]</span>
col_float = <span style="color: #51afef;">[</span><span style="color: #a991f1;">:bmi</span>, <span style="color: #a991f1;">:ped</span><span style="color: #51afef;">]</span>
col_str = <span style="color: #a991f1;">:diabetes</span>
df<span style="color: #51afef;">[</span>!,col_int<span style="color: #51afef;">]</span> = Int.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_int<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
df<span style="color: #51afef;">[</span>!,col_float<span style="color: #51afef;">]</span> = Float32.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_float<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
df<span style="color: #51afef;">[</span>!,col_str<span style="color: #51afef;">]</span> = String.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_str<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">ResidualSE</span><span style="color: #51afef;">(</span>y,X<span style="color: #51afef;">)</span>
    fit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>fit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">lmGprior</span><span style="color: #51afef;">(</span>y, X; g=length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span>, &#957;&#8320;=<span style="color: #e69055; font-weight: bold;">1</span>, &#963;&#8320;&#178;=ResidualSE<span style="color: #C57BDB;">(</span>y,X<span style="color: #C57BDB;">)</span>, S=<span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    Hg = <span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X'
    SSRg = y' <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>diagm<span style="color: #C57BDB;">(</span>ones<span style="color: #7bc275;">(</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> Hg<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> y
    &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">./</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#8320;&#178;<span style="color: #FCCE7B;">+</span>SSRg<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, S<span style="color: #51afef;">)</span>

    Vb = g <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    Eb = Vb <span style="color: #FCCE7B;">*</span> X' <span style="color: #FCCE7B;">*</span> y

    &#946; = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, <span style="color: #e69055; font-weight: bold;">0</span>, p<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        s = &#963;&#178;<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>
        &#946; = vcat<span style="color: #51afef;">(</span>&#946;, rand<span style="color: #C57BDB;">(</span>MvNormal<span style="color: #7bc275;">(</span>Eb, Symmetric<span style="color: #a991f1;">(</span>s <span style="color: #FCCE7B;">*</span> Vb<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>'<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> &#946;, &#963;&#178;
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
g = size<span style="color: #51afef;">(</span>df, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">1</span>

y = df<span style="color: #51afef;">[</span>:, <span style="color: #a991f1;">:glu</span><span style="color: #51afef;">]</span>
X = select<span style="color: #51afef;">(</span>df, Not<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span><span style="color: #a991f1;">:diabetes</span>, <span style="color: #a991f1;">:glu</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Matrix
X = <span style="color: #51afef;">[</span>ones<span style="color: #C57BDB;">(</span>size<span style="color: #7bc275;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> X<span style="color: #51afef;">]</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">add intercept</span>
S=<span style="color: #e69055; font-weight: bold;">5000</span>
BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y, X; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence intervals for &#963;&#178;</span>
ci_&#963;&#178; = quantile<span style="color: #51afef;">(</span>SIGMA&#178;, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence intervals for &#946;</span>
ci_&#946; = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, eachcol<span style="color: #C57BDB;">(</span>BETA<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="orgaa3c2c7">
8×4 DataFrame
 Row │ param      ci_lower    ci_upper    ci_length
     │ String     Float64     Float64     Float64
─────┼───────────────────────────────────────────────
   1 │ intercept   35.1914     69.5733     34.3819
   2 │ npreg       -1.64525     0.306686    1.95194
   3 │ bp          -0.01787     0.425742    0.443612
   4 │ skin        -0.112215    0.511       0.623215
   5 │ bmi          0.142702    1.129       0.986294
   6 │ ped          3.36953    17.7334     14.3639
   7 │ age          0.454045    1.09135     0.637302
   8 │ σ²         745.993     948.869     202.875
</pre>
</div>
</div>
</div>
<div id="outline-container-org62ec6ee" class="outline-4">
<h4 id="org62ec6ee">b)</h4>
<div class="outline-text-4" id="text-org62ec6ee">
</div>
<div id="outline-container-org45f9b13" class="outline-5">
<h5 id="org45f9b13">Answer</h5>
<div class="outline-text-5" id="text-org45f9b13">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">lpyX</span><span style="color: #51afef;">(</span>y, X; g=length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span>, &#957;&#8320;=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

    n = size<span style="color: #51afef;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    p = size<span style="color: #51afef;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">if</span> p <span style="color: #FCCE7B;">==</span><span style="color: #e69055; font-weight: bold;">0</span>
        &#963;&#770;&#178; = mean<span style="color: #51afef;">(</span>y<span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
        H0 = zeros<span style="color: #51afef;">(</span>n, n<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">else</span>
        fit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
        &#963;&#770;&#178; = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>fit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n <span style="color: #FCCE7B;">-</span> p<span style="color: #51afef;">)</span>
        H0 = <span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X'
    <span style="color: #51afef;">end</span>
    SS0 = y' <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>diagm<span style="color: #C57BDB;">(</span>ones<span style="color: #7bc275;">(</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> H0<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> y
    <span style="color: #51afef;">return</span><span style="color: #51afef;">(</span>
        <span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>n<span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">*</span>&#960;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> logabsgamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> logabsgamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>&#957;&#8320;<span style="color: #C57BDB;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>p<span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">+</span>g<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span>
            <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#770;&#178;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#770;&#178;<span style="color: #FCCE7B;">+</span>SS0<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">BayesianModelAveraging</span><span style="color: #51afef;">(</span>y, X; S=<span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>
    BETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    Z = Matrix<span style="color: #51afef;">{</span>Int64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    z = ones<span style="color: #51afef;">(</span>p<span style="color: #51afef;">)</span>
    lpy_c = lpyX<span style="color: #51afef;">(</span>y, X<span style="color: #C57BDB;">[</span>:, findall<span style="color: #7bc275;">(</span>z .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> shuffle<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>:p<span style="color: #51afef;">)</span>
            zp = copy<span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span>
            zp<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = <span style="color: #e69055; font-weight: bold;">1</span> .<span style="color: #FCCE7B;">-</span> zp<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span>
            lpy_p = lpyX<span style="color: #51afef;">(</span>y, X<span style="color: #C57BDB;">[</span>:, findall<span style="color: #7bc275;">(</span>zp .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
            r = <span style="color: #51afef;">(</span>lpy_p <span style="color: #FCCE7B;">-</span> lpy_c<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">*</span><span style="color: #51afef;">(</span><span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #51afef;">(</span>zp<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span><span style="color: #FCCE7B;">==</span><span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
            z<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = rand<span style="color: #51afef;">(</span>Bernoulli<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">+</span>exp<span style="color: #a991f1;">(</span><span style="color: #FCCE7B;">-</span>r<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Int
            <span style="color: #51afef;">if</span> z<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">==</span> zp<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span>
                lpy_c = lpy_p
            <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">end</span>

        &#946; = copy<span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">if</span> sum<span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">&gt;</span> <span style="color: #e69055; font-weight: bold;">0</span>
            &#946;<span style="color: #51afef;">[</span>findall<span style="color: #C57BDB;">(</span>z .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span> = lmGprior<span style="color: #51afef;">(</span>y, X<span style="color: #C57BDB;">[</span>:, findall<span style="color: #7bc275;">(</span>z .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span>, S=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
        <span style="color: #51afef;">end</span>
        Z<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = z
        BETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = &#946;

        <span style="color: #51afef;">if</span> s <span style="color: #FCCE7B;">%</span> <span style="color: #e69055; font-weight: bold;">10</span> <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span>
            bpm = mean<span style="color: #51afef;">(</span>BETA<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>:s, :<span style="color: #C57BDB;">]</span>, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
            mse = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y <span style="color: #FCCE7B;">-</span> X <span style="color: #FCCE7B;">*</span> bpm<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
            println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"s = "</span>, s, <span style="color: #7bc275;">", mse = "</span>, mse<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> BETA, Z
<span style="color: #51afef;">end</span>

BETA2, Z = BayesianModelAveraging<span style="color: #51afef;">(</span>y, X; S=<span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
z_prob = mean<span style="color: #51afef;">(</span>Z, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
ci_&#946;_bma = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, eachcol<span style="color: #C57BDB;">(</span>BETA2<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
df_ci_bma = DataFrame<span style="color: #51afef;">(</span>
    param = coef_name,
    prob = z_prob,
    ci_lower = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span>, ci_&#946;_bma<span style="color: #C57BDB;">)</span>,
    ci_upper = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span>, ci_&#946;_bma<span style="color: #C57BDB;">)</span>
<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="orgfa37352">
7×5 DataFrame
 Row │ param      prob     ci_lower   ci_upper   ci_length
     │ String     Float64  Float64    Float64    Float64
─────┼─────────────────────────────────────────────────────
   1 │ intercept   1.0     43.3728    76.389     33.0162
   2 │ npreg       0.0978  -1.00526    0.0        1.00526
   3 │ bp          0.168    0.0        0.32304    0.32304
   4 │ skin        0.0934   0.0        0.363007   0.363007
   5 │ bmi         0.9812   0.403414   1.34051    0.937095
   6 │ ped         0.6928   0.0       17.7104    17.7104
   7 │ age         1.0      0.480682   1.01743    0.536749
</pre>

<p>
\(\mathrm{Pr}(\beta_j \neq 0|\boldsymbol{y})\) is nearly 1 for intercept, bmi and age, and is around 0.1 for npreg, bp and skin.
Compared to the results in part a), the lengths of the confidence intervals tend to be shorter (except for ped) in part b).
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org8148340" class="outline-3">
<h3 id="org8148340">9.3</h3>
<div class="outline-text-3" id="text-org8148340">
</div>
<div id="outline-container-orgd7332a4" class="outline-4">
<h4 id="orgd7332a4">a)</h4>
<div class="outline-text-4" id="text-orgd7332a4">
</div>
<div id="outline-container-org703d93c" class="outline-5">
<h5 id="org703d93c">Answer</h5>
<div class="outline-text-5" id="text-org703d93c">
<p>
The result of bayesian regression using the <i>g</i>-prior is shown below:
</p>

<div class="org-src-container">
<pre class="src src-julia">crime_src = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/crime.dat"</span>, header=<span style="color: #a991f1;">true</span><span style="color: #51afef;">)</span>
crime = crime_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
header = crime_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">|&gt;</span> vec

df = DataFrame<span style="color: #51afef;">(</span>crime, header<span style="color: #51afef;">)</span>

<span style="color: #51afef;">using</span> GLM

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">ResidualSE</span><span style="color: #51afef;">(</span>y,X<span style="color: #51afef;">)</span>
    fit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>fit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">lmGprior</span><span style="color: #51afef;">(</span>y, X; g=length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span>, &#957;&#8320;=<span style="color: #e69055; font-weight: bold;">1</span>, &#963;&#8320;&#178;=ResidualSE<span style="color: #C57BDB;">(</span>y,X<span style="color: #C57BDB;">)</span>, S=<span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    Hg = <span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X'
    SSRg = y' <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>diagm<span style="color: #C57BDB;">(</span>ones<span style="color: #7bc275;">(</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> Hg<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> y
    &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">./</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#8320;&#178;<span style="color: #FCCE7B;">+</span>SSRg<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, S<span style="color: #51afef;">)</span>

    Vb = g <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    Eb = Vb <span style="color: #FCCE7B;">*</span> X' <span style="color: #FCCE7B;">*</span> y

    &#946; = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, <span style="color: #e69055; font-weight: bold;">0</span>, p<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        s = &#963;&#178;<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>
        &#946; = vcat<span style="color: #51afef;">(</span>&#946;, rand<span style="color: #C57BDB;">(</span>MvNormal<span style="color: #7bc275;">(</span>Eb, Symmetric<span style="color: #a991f1;">(</span>s <span style="color: #FCCE7B;">*</span> Vb<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>'<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> &#946;, &#963;&#178;
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
n = size<span style="color: #51afef;">(</span>df, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
g = n
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">1</span>

y = df<span style="color: #51afef;">[</span>:, <span style="color: #a991f1;">:y</span><span style="color: #51afef;">]</span>
X = select<span style="color: #51afef;">(</span>df, Not<span style="color: #C57BDB;">(</span><span style="color: #a991f1;">:y</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Matrix
X = <span style="color: #51afef;">[</span>ones<span style="color: #C57BDB;">(</span>size<span style="color: #7bc275;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> X<span style="color: #51afef;">]</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">add intercept</span>
p = size<span style="color: #51afef;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
S=<span style="color: #e69055; font-weight: bold;">5000</span>
BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y, X; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean for &#946;</span>
&#946;&#770;_gprior = mean<span style="color: #51afef;">(</span>BETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec

<span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence intervals for &#946;</span>
ci_gprior = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, eachcol<span style="color: #C57BDB;">(</span>BETA<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">store results</span>
coef_name = names<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>:, Not<span style="color: #7bc275;">(</span><span style="color: #a991f1;">:y</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
coef_name = <span style="color: #51afef;">[</span><span style="color: #7bc275;">"intercept"</span>, coef_name...<span style="color: #51afef;">]</span>
result_gprior = DataFrame<span style="color: #51afef;">(</span>
    param = coef_name,
    &#946;&#770; = &#946;&#770;_gprior,
    ci_lower = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span>, ci_gprior<span style="color: #C57BDB;">)</span>,
    ci_upper = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span>, ci_gprior<span style="color: #C57BDB;">)</span>
<span style="color: #51afef;">)</span>
<span style="color: #C57BDB; font-weight: bold;">@transform!</span><span style="color: #51afef;">(</span>result_gprior, <span style="color: #a991f1;">:ci_length</span> = <span style="color: #a991f1;">:ci_upper</span> <span style="color: #FCCE7B;">-</span> <span style="color: #a991f1;">:ci_lower</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="org79e9fdd">
16×5 DataFrame
 Row │ param      β̂             ci_lower    ci_upper    ci_length
     │ String     Float64       Float64     Float64     Float64
─────┼────────────────────────────────────────────────────────────
   1 │ intercept  -0.00138411   -0.145485    0.141785    0.28727
   2 │ M           0.280085      0.0326016   0.522226    0.489625
   3 │ So          0.000124904  -0.335994    0.326097    0.662091
   4 │ Ed          0.531345      0.213679    0.848809    0.63513
   5 │ Po1         1.4448        0.0578835   2.9098      2.85191
   6 │ Po2        -0.769673     -2.28756     0.708661    2.99622
   7 │ LF         -0.0649535    -0.345494    0.201018    0.546512
   8 │ M.F         0.128508     -0.147925    0.402133    0.550058
   9 │ Pop        -0.0704276    -0.301267    0.153849    0.455116
  10 │ NW          0.105647     -0.200629    0.416185    0.616814
  11 │ U1         -0.265548     -0.631514    0.103081    0.734594
  12 │ U2          0.359167      0.0283685   0.688258    0.659889
  13 │ GDP         0.239074     -0.213783    0.692641    0.906425
  14 │ Ineq        0.715697      0.299354    1.13272     0.83337
  15 │ Prob       -0.27993      -0.527327   -0.0344898   0.492837
  16 │ Time       -0.0602993    -0.288748    0.181236    0.469984
</pre>

<p>
The result of least square estimation is shown below:
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">least square estimates</span>
olsfit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>

tstat = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">./</span> stderror<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
pval = <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> .<span style="color: #FCCE7B;">-</span> cdf.<span style="color: #C57BDB;">(</span>Normal<span style="color: #7bc275;">()</span>, abs.<span style="color: #7bc275;">(</span>tstat<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

result_ols = DataFrame<span style="color: #51afef;">(</span>
    param = coef_name,
    &#946;&#770; = coef<span style="color: #C57BDB;">(</span>olsfit<span style="color: #C57BDB;">)</span>,
    pvalue = pval,
    ci_lower = confint<span style="color: #C57BDB;">(</span>olsfit<span style="color: #C57BDB;">)[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>,
    ci_upper = confint<span style="color: #C57BDB;">(</span>olsfit<span style="color: #C57BDB;">)[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>
<span style="color: #51afef;">)</span>
<span style="color: #C57BDB; font-weight: bold;">@transform!</span><span style="color: #51afef;">(</span>result_ols, <span style="color: #a991f1;">:ci_length</span> = <span style="color: #a991f1;">:ci_upper</span> <span style="color: #FCCE7B;">-</span> <span style="color: #a991f1;">:ci_lower</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org0c82968">
16×6 DataFrame
 Row │ param      β̂             pvalue      ci_lower     ci_upper    ci_length
     │ String     Float64       Float64     Float64      Float64     Float64
─────┼─────────────────────────────────────────────────────────────────────────
   1 │ intercept  -0.000458109  0.995369    -0.161444     0.160527    0.321971
   2 │ M           0.286518     0.0348684    0.00955607   0.56348     0.553924
   3 │ So         -0.000114046  0.999506    -0.375493     0.375265    0.750757
   4 │ Ed          0.544514     0.00243231   0.178196     0.910832    0.732636
   5 │ Po1         1.47162      0.0715397   -0.193934     3.13718     3.33111
   6 │ Po2        -0.78178      0.358608    -2.51862      0.955056    3.47367
   7 │ LF         -0.0659646    0.667281    -0.378923     0.246994    0.625917
   8 │ M.F         0.131298     0.397494    -0.185192     0.447788    0.63298
   9 │ Pop        -0.0702919    0.579692    -0.329144     0.18856     0.517704
  10 │ NW          0.109057     0.525852    -0.241574     0.459687    0.701261
  11 │ U1         -0.270536     0.168865    -0.671568     0.130495    0.802063
  12 │ U2          0.36873      0.0403534    0.00190637   0.735554    0.733648
  13 │ GDP         0.238059     0.357931    -0.290079     0.766198    1.05628
  14 │ Ineq        0.726292     0.00192334   0.24874      1.20384     0.955105
  15 │ Prob       -0.285226     0.033017    -0.558095    -0.0123574   0.545738
  16 │ Time       -0.0615769    0.638379    -0.328802     0.205648    0.534451
</pre>


<div id="org406651d" class="figure">
<p><img src="fig/ch9/ex_9-3a_coef.png" alt="ex_9-3a_coef.png" />
</p>
</div>

<p>
The point estimates and 95% confidence/credible intervals are very similar between bayesian regression and least square estimation.
The lengths of the intervals seem to be shorter in bayesian regression than in least square estimation.
Seeing the results of bayesian regression, the 95% credible intervals of coefficients of M, Ed, Po1, U2, Ineq and Prob do not include 0, so these variables seem strongly predictive of crime rates.
On the other hand, the results of least square estimation show that the p-values of M, Ed, U2 and Ineq are less than 0.05, so these variables seem strongly predictive of crime rates.
Using these types of criteria, the difference between the two results is that Po1 and Prob are predictive of crime rates in bayesian regression, but not in least square estimation.
</p>
</div>
</div>
</div>
<div id="outline-container-org2d7a756" class="outline-4">
<h4 id="org2d7a756">b)</h4>
<div class="outline-text-4" id="text-org2d7a756">
</div>
<div id="outline-container-orga9beef9" class="outline-5">
<h5 id="orga9beef9">Answer</h5>
<div class="outline-text-5" id="text-orga9beef9">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">split data into training and test set</span>
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>
i_te = sample<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>:n, div<span style="color: #C57BDB;">(</span>n, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span>, replace=<span style="color: #a991f1;">false</span><span style="color: #51afef;">)</span>
i_tr = setdiff<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>:n, i_te<span style="color: #51afef;">)</span>

y_tr = y<span style="color: #51afef;">[</span>i_tr<span style="color: #51afef;">]</span>
y_te = y<span style="color: #51afef;">[</span>i_te<span style="color: #51afef;">]</span>
X_tr = X<span style="color: #51afef;">[</span>i_tr, :<span style="color: #51afef;">]</span>
X_te = X<span style="color: #51afef;">[</span>i_te, :<span style="color: #51afef;">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">OLS</span>
olsfit = lm<span style="color: #51afef;">(</span>X_tr, y_tr<span style="color: #51afef;">)</span>
&#946;&#770;_ols = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
y&#770;_ols = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_ols
error_ols = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_ols<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
0.6155918321208247
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">Bayesian</span>
BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y_tr, X_tr; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
&#946;&#770;_bayes = mean<span style="color: #51afef;">(</span>BETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
y&#770;_bayes = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_bayes
error_bayes = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_bayes<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
0.6012597112455574
</pre>



<div id="org97154c8" class="figure">
<p><img src="fig/ch9/ex_9-3b.png" alt="ex_9-3b.png" />
</p>
</div>

<p>
From the above results, the least square regression and bayesian regression seem to yield very similar predictions for the test data.
For this time, the bayesian regression predict better than the least square regression, but the gap is very small.
</p>
</div>
</div>
</div>
<div id="outline-container-orge4176b7" class="outline-4">
<h4 id="orge4176b7">c)</h4>
<div class="outline-text-4" id="text-orge4176b7">
</div>
<div id="outline-container-org23e46a7" class="outline-5">
<h5 id="org23e46a7">Answer</h5>
<div class="outline-text-5" id="text-org23e46a7">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">computeMses</span><span style="color: #51afef;">(</span>y, X; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">split data into training and test set</span>
    y_tr, y_te, X_tr, X_te = splitData<span style="color: #51afef;">(</span>y, X<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">OLS</span>
    olsfit = lm<span style="color: #51afef;">(</span>X_tr, y_tr<span style="color: #51afef;">)</span>
    &#946;&#770;_ols = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
    y&#770;_ols = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_ols
    error_ols = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_ols<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">Bayesian</span>
    BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y_tr, X_tr; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
    &#946;&#770;_bayes = mean<span style="color: #51afef;">(</span>BETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
    y&#770;_bayes = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_bayes
    error_bayes = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_bayes<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">return</span> error_ols, error_bayes
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">compute MSEs</span>
n_sim = <span style="color: #e69055; font-weight: bold;">1000</span>
error_ols = zeros<span style="color: #51afef;">(</span>n_sim<span style="color: #51afef;">)</span>
error_bayes = zeros<span style="color: #51afef;">(</span>n_sim<span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:n_sim
    error_ols<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>, error_bayes<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span> = computeMses<span style="color: #51afef;">(</span>y, X<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">average MSEs</span>
mean<span style="color: #51afef;">(</span>error_ols<span style="color: #51afef;">)</span>, mean<span style="color: #51afef;">(</span>error_bayes<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
(1.12446194924989, 1.092206057122776)
</pre>



<div id="orge3b48b3" class="figure">
<p><img src="fig/ch9/ex_9-3c.png" alt="ex_9-3c.png" />
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org45e04e7" class="outline-2">
<h2 id="org45e04e7">Chapter 9</h2>
<div class="outline-text-2" id="text-org45e04e7">
</div>
<div id="outline-container-orgd3f6a54" class="outline-3">
<h3 id="orgd3f6a54">9.1</h3>
<div class="outline-text-3" id="text-orgd3f6a54">
</div>
<div id="outline-container-org7b2f379" class="outline-4">
<h4 id="org7b2f379">a)</h4>
<div class="outline-text-4" id="text-org7b2f379">
</div>
<div id="outline-container-org0a84325" class="outline-5">
<h5 id="org0a84325">Answer</h5>
<div class="outline-text-5" id="text-org0a84325">
<p>
The prior information means that the line \(\beta_1 + \beta_2 x\) should produce values between 22 and 24 when \(x\) is between 1 and 6.
A little algebra shows that we need a prior distribution on \((\beta_1, \beta_2)\) such that
\(\frac{98}{5} < \beta_1 < \frac{132}{5}\) and \(-\frac{2}{5} < \beta_2 < \frac{2}{5}\) with high probability.
This could be done by taking \(\boldsymbol{\beta}_0 = (23, 0) \) and \(\Sigma_0 = \text{diag}\left( \left(\frac{17}{5} \right)^2, \left(\frac{1}{5} \right)^2 \right)\).
For \(\nu_0\) and \(\sigma_0^2\), we could take \(\nu_0 = 2\) and \(\sigma_0^2 = 0.5\) so that the prior distribution of \(\sigma^2\) is concentrated around 0.5.
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">read data</span>
swim = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/swim.dat"</span>, header=<span style="color: #a991f1;">false</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">regressionSemiconjugatePrior</span><span style="color: #51afef;">(</span>y, X, &#946;&#8320;, &#931;&#8320;, &#957;&#8320;, &#963;&#8320;&#178;; S=<span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    BETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    SIGMA&#178; = Vector<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
    olsfit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    &#946; = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
    &#963;&#178; = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>olsfit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n <span style="color: #FCCE7B;">-</span> p<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">MCMC algorithm</span>
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#946;</span>
        V = inv<span style="color: #51afef;">(</span>inv<span style="color: #C57BDB;">(</span>&#931;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> X'X <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        E = V <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>inv<span style="color: #C57BDB;">(</span>&#931;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> &#946;&#8320; <span style="color: #FCCE7B;">+</span> X'y <span style="color: #FCCE7B;">/</span> &#963;&#178;<span style="color: #51afef;">)</span>
        &#946; = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>E, Symmetric<span style="color: #7bc275;">(</span>V<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">update &#963;&#178;</span>
        &#957;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">+</span> n
        SSR = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, y <span style="color: #FCCE7B;">-</span> X<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        &#957;&#8345;&#963;&#178;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> SSR
        &#963;&#178; = rand<span style="color: #51afef;">(</span>InverseGamma<span style="color: #C57BDB;">(</span>&#957;&#8345; <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span>&#957;&#8345;&#963;&#178;&#8345;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">store</span>
        BETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = &#946;
        SIGMA&#178;<span style="color: #51afef;">[</span>s<span style="color: #51afef;">]</span> = &#963;&#178;
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">return</span> BETA, SIGMA&#178;
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
&#946;&#8320; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">23</span>, <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">]</span>
&#931;&#8320; = diagm<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span><span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">17</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">5</span><span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">5</span><span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">0.5</span>

S = <span style="color: #e69055; font-weight: bold;">5000</span>

Y_PRED = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, size<span style="color: #C57BDB;">(</span>swim,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
fig = plot<span style="color: #51afef;">(</span>
    title=<span style="color: #7bc275;">"posterior predictive distribution"</span>, xlabel=<span style="color: #7bc275;">"time"</span>, ylabel=<span style="color: #7bc275;">"density"</span>
    , size=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">800</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>, margin=<span style="color: #e69055; font-weight: bold;">3</span>mm
<span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:size<span style="color: #51afef;">(</span>swim,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    y = swim<span style="color: #51afef;">[</span>i, :<span style="color: #51afef;">]</span>
    X = <span style="color: #51afef;">[</span>repeat<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span>, length<span style="color: #7bc275;">(</span>y<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #e69055; font-weight: bold;">1</span>:length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span>
    BETA, SIGMA&#178; = regressionSemiconjugatePrior<span style="color: #51afef;">(</span>y, X, &#946;&#8320;, &#931;&#8320;, &#957;&#8320;, &#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
    &#956;_ypred = BETA<span style="color: #51afef;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span> .<span style="color: #FCCE7B;">+</span> BETA<span style="color: #51afef;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    ypred = rand.<span style="color: #51afef;">(</span>Normal.<span style="color: #C57BDB;">(</span>&#956;_ypred, sqrt.<span style="color: #7bc275;">(</span>SIGMA&#178;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    Y_PRED<span style="color: #51afef;">[</span>:, i<span style="color: #51afef;">]</span> = ypred
    fig = density!<span style="color: #51afef;">(</span>fig, ypred, label=<span style="color: #7bc275;">"swimmer $i"</span><span style="color: #51afef;">)</span>
    ypred_mean = ypred <span style="color: #FCCE7B;">|&gt;</span> mean <span style="color: #FCCE7B;">|&gt;</span> x <span style="color: #FCCE7B;">-&gt;</span> round<span style="color: #51afef;">(</span>x, digits=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"swimmer $i: "</span>, ypred_mean<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
swimmer 1: 22.73
swimmer 2: 23.52
swimmer 3: 22.86
swimmer 4: 23.44
</pre>



<div id="org9d3a2b2" class="figure">
<p><img src="fig/ch9/ex9-1_posterior_predictive.png" alt="ex9-1_posterior_predictive.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org2df0767" class="outline-4">
<h4 id="org2df0767">b)</h4>
<div class="outline-text-4" id="text-org2df0767">
</div>
<div id="outline-container-org82e257d" class="outline-5">
<h5 id="org82e257d">Answer</h5>
<div class="outline-text-5" id="text-org82e257d">
<div class="org-src-container">
<pre class="src src-julia">ind_fastest = mapslices<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x .<span style="color: #FCCE7B;">==</span> minimum<span style="color: #C57BDB;">(</span>x<span style="color: #C57BDB;">)</span>, Y_PRED, dims=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
mean<span style="color: #51afef;">(</span>ind_fastest, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
1×4 Matrix{Float64}:
 0.4184  0.1064  0.3504  0.1248
</pre>


<p>
The probability that each swimmer is the fastest is shown above.
Swimmer 1 will be the fastest with probability 0.4184, so I recommend that the coach choose swimmer 1.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org291ba71" class="outline-3">
<h3 id="org291ba71">9.2</h3>
<div class="outline-text-3" id="text-org291ba71">
</div>
<div id="outline-container-orgc32150f" class="outline-4">
<h4 id="orgc32150f">a)</h4>
<div class="outline-text-4" id="text-orgc32150f">
</div>
<div id="outline-container-orgb3dba8f" class="outline-5">
<h5 id="orgb3dba8f">Answer</h5>
<div class="outline-text-5" id="text-orgb3dba8f">
<div class="org-src-container">
<pre class="src src-julia">Y_src = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/azdiabetes.dat"</span>, header=<span style="color: #a991f1;">true</span><span style="color: #51afef;">)</span>
Y = Y_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
header = Y_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">|&gt;</span> vec
df = DataFrame<span style="color: #51afef;">(</span>Y, header<span style="color: #51afef;">)</span>

col_int = <span style="color: #51afef;">[</span><span style="color: #a991f1;">:npreg</span>, <span style="color: #a991f1;">:glu</span>, <span style="color: #a991f1;">:bp</span>, <span style="color: #a991f1;">:skin</span>, <span style="color: #a991f1;">:age</span><span style="color: #51afef;">]</span>
col_float = <span style="color: #51afef;">[</span><span style="color: #a991f1;">:bmi</span>, <span style="color: #a991f1;">:ped</span><span style="color: #51afef;">]</span>
col_str = <span style="color: #a991f1;">:diabetes</span>
df<span style="color: #51afef;">[</span>!,col_int<span style="color: #51afef;">]</span> = Int.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_int<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
df<span style="color: #51afef;">[</span>!,col_float<span style="color: #51afef;">]</span> = Float32.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_float<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
df<span style="color: #51afef;">[</span>!,col_str<span style="color: #51afef;">]</span> = String.<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>!,col_str<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">ResidualSE</span><span style="color: #51afef;">(</span>y,X<span style="color: #51afef;">)</span>
    fit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>fit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">lmGprior</span><span style="color: #51afef;">(</span>y, X; g=length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span>, &#957;&#8320;=<span style="color: #e69055; font-weight: bold;">1</span>, &#963;&#8320;&#178;=ResidualSE<span style="color: #C57BDB;">(</span>y,X<span style="color: #C57BDB;">)</span>, S=<span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    Hg = <span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X'
    SSRg = y' <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>diagm<span style="color: #C57BDB;">(</span>ones<span style="color: #7bc275;">(</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> Hg<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> y
    &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">./</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#8320;&#178;<span style="color: #FCCE7B;">+</span>SSRg<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, S<span style="color: #51afef;">)</span>

    Vb = g <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    Eb = Vb <span style="color: #FCCE7B;">*</span> X' <span style="color: #FCCE7B;">*</span> y

    &#946; = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, <span style="color: #e69055; font-weight: bold;">0</span>, p<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        s = &#963;&#178;<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>
        &#946; = vcat<span style="color: #51afef;">(</span>&#946;, rand<span style="color: #C57BDB;">(</span>MvNormal<span style="color: #7bc275;">(</span>Eb, Symmetric<span style="color: #a991f1;">(</span>s <span style="color: #FCCE7B;">*</span> Vb<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>'<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> &#946;, &#963;&#178;
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
g = size<span style="color: #51afef;">(</span>df, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">1</span>

y = df<span style="color: #51afef;">[</span>:, <span style="color: #a991f1;">:glu</span><span style="color: #51afef;">]</span>
X = select<span style="color: #51afef;">(</span>df, Not<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span><span style="color: #a991f1;">:diabetes</span>, <span style="color: #a991f1;">:glu</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Matrix
X = <span style="color: #51afef;">[</span>ones<span style="color: #C57BDB;">(</span>size<span style="color: #7bc275;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> X<span style="color: #51afef;">]</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">add intercept</span>
S=<span style="color: #e69055; font-weight: bold;">5000</span>
BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y, X; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence intervals for &#963;&#178;</span>
ci_&#963;&#178; = quantile<span style="color: #51afef;">(</span>SIGMA&#178;, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence intervals for &#946;</span>
ci_&#946; = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, eachcol<span style="color: #C57BDB;">(</span>BETA<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="orga648559">
8×4 DataFrame
 Row │ param      ci_lower    ci_upper    ci_length
     │ String     Float64     Float64     Float64
─────┼───────────────────────────────────────────────
   1 │ intercept   35.1914     69.5733     34.3819
   2 │ npreg       -1.64525     0.306686    1.95194
   3 │ bp          -0.01787     0.425742    0.443612
   4 │ skin        -0.112215    0.511       0.623215
   5 │ bmi          0.142702    1.129       0.986294
   6 │ ped          3.36953    17.7334     14.3639
   7 │ age          0.454045    1.09135     0.637302
   8 │ σ²         745.993     948.869     202.875
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd0d44f3" class="outline-4">
<h4 id="orgd0d44f3">b)</h4>
<div class="outline-text-4" id="text-orgd0d44f3">
</div>
<div id="outline-container-org11e8308" class="outline-5">
<h5 id="org11e8308">Answer</h5>
<div class="outline-text-5" id="text-org11e8308">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">lpyX</span><span style="color: #51afef;">(</span>y, X; g=length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span>, &#957;&#8320;=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

    n = size<span style="color: #51afef;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    p = size<span style="color: #51afef;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">if</span> p <span style="color: #FCCE7B;">==</span><span style="color: #e69055; font-weight: bold;">0</span>
        &#963;&#770;&#178; = mean<span style="color: #51afef;">(</span>y<span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
        H0 = zeros<span style="color: #51afef;">(</span>n, n<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">else</span>
        fit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
        &#963;&#770;&#178; = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>fit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n <span style="color: #FCCE7B;">-</span> p<span style="color: #51afef;">)</span>
        H0 = <span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X'
    <span style="color: #51afef;">end</span>
    SS0 = y' <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>diagm<span style="color: #C57BDB;">(</span>ones<span style="color: #7bc275;">(</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> H0<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> y
    <span style="color: #51afef;">return</span><span style="color: #51afef;">(</span>
        <span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>n<span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">*</span>&#960;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span> logabsgamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> logabsgamma<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>&#957;&#8320;<span style="color: #C57BDB;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span> <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>p<span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">+</span>g<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">+</span>
            <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#770;&#178;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #C57BDB;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">*</span>log<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#770;&#178;<span style="color: #FCCE7B;">+</span>SS0<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">BayesianModelAveraging</span><span style="color: #51afef;">(</span>y, X; S=<span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>
    BETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    Z = Matrix<span style="color: #51afef;">{</span>Int64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, p<span style="color: #51afef;">)</span>
    z = ones<span style="color: #51afef;">(</span>p<span style="color: #51afef;">)</span>
    lpy_c = lpyX<span style="color: #51afef;">(</span>y, X<span style="color: #C57BDB;">[</span>:, findall<span style="color: #7bc275;">(</span>z .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        <span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> shuffle<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>:p<span style="color: #51afef;">)</span>
            zp = copy<span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span>
            zp<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = <span style="color: #e69055; font-weight: bold;">1</span> .<span style="color: #FCCE7B;">-</span> zp<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span>
            lpy_p = lpyX<span style="color: #51afef;">(</span>y, X<span style="color: #C57BDB;">[</span>:, findall<span style="color: #7bc275;">(</span>zp .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
            r = <span style="color: #51afef;">(</span>lpy_p <span style="color: #FCCE7B;">-</span> lpy_c<span style="color: #51afef;">)</span><span style="color: #FCCE7B;">*</span><span style="color: #51afef;">(</span><span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #FCCE7B;">^</span><span style="color: #51afef;">(</span>zp<span style="color: #C57BDB;">[</span>j<span style="color: #C57BDB;">]</span><span style="color: #FCCE7B;">==</span><span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
            z<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> = rand<span style="color: #51afef;">(</span>Bernoulli<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">+</span>exp<span style="color: #a991f1;">(</span><span style="color: #FCCE7B;">-</span>r<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Int
            <span style="color: #51afef;">if</span> z<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">==</span> zp<span style="color: #51afef;">[</span>j<span style="color: #51afef;">]</span>
                lpy_c = lpy_p
            <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">end</span>

        &#946; = copy<span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">if</span> sum<span style="color: #51afef;">(</span>z<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">&gt;</span> <span style="color: #e69055; font-weight: bold;">0</span>
            &#946;<span style="color: #51afef;">[</span>findall<span style="color: #C57BDB;">(</span>z .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span> = lmGprior<span style="color: #51afef;">(</span>y, X<span style="color: #C57BDB;">[</span>:, findall<span style="color: #7bc275;">(</span>z .<span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span>, S=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
        <span style="color: #51afef;">end</span>
        Z<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = z
        BETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = &#946;

        <span style="color: #51afef;">if</span> s <span style="color: #FCCE7B;">%</span> <span style="color: #e69055; font-weight: bold;">10</span> <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span>
            bpm = mean<span style="color: #51afef;">(</span>BETA<span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span>:s, :<span style="color: #C57BDB;">]</span>, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
            mse = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y <span style="color: #FCCE7B;">-</span> X <span style="color: #FCCE7B;">*</span> bpm<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
            println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"s = "</span>, s, <span style="color: #7bc275;">", mse = "</span>, mse<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> BETA, Z
<span style="color: #51afef;">end</span>

BETA2, Z = BayesianModelAveraging<span style="color: #51afef;">(</span>y, X; S=<span style="color: #e69055; font-weight: bold;">5000</span><span style="color: #51afef;">)</span>
z_prob = mean<span style="color: #51afef;">(</span>Z, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
ci_&#946;_bma = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, eachcol<span style="color: #C57BDB;">(</span>BETA2<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
df_ci_bma = DataFrame<span style="color: #51afef;">(</span>
    param = coef_name,
    prob = z_prob,
    ci_lower = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span>, ci_&#946;_bma<span style="color: #C57BDB;">)</span>,
    ci_upper = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span>, ci_&#946;_bma<span style="color: #C57BDB;">)</span>
<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="org1faed80">
7×5 DataFrame
 Row │ param      prob     ci_lower   ci_upper   ci_length
     │ String     Float64  Float64    Float64    Float64
─────┼─────────────────────────────────────────────────────
   1 │ intercept   1.0     43.3728    76.389     33.0162
   2 │ npreg       0.0978  -1.00526    0.0        1.00526
   3 │ bp          0.168    0.0        0.32304    0.32304
   4 │ skin        0.0934   0.0        0.363007   0.363007
   5 │ bmi         0.9812   0.403414   1.34051    0.937095
   6 │ ped         0.6928   0.0       17.7104    17.7104
   7 │ age         1.0      0.480682   1.01743    0.536749
</pre>

<p>
\(\mathrm{Pr}(\beta_j \neq 0|\boldsymbol{y})\) is nearly 1 for intercept, bmi and age, and is around 0.1 for npreg, bp and skin.
Compared to the results in part a), the lengths of the confidence intervals tend to be shorter (except for ped) in part b).
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org5b52b8a" class="outline-3">
<h3 id="org5b52b8a">9.3</h3>
<div class="outline-text-3" id="text-org5b52b8a">
</div>
<div id="outline-container-org3e47b9e" class="outline-4">
<h4 id="org3e47b9e">a)</h4>
<div class="outline-text-4" id="text-org3e47b9e">
</div>
<div id="outline-container-org9c9433a" class="outline-5">
<h5 id="org9c9433a">Answer</h5>
<div class="outline-text-5" id="text-org9c9433a">
<p>
The result of bayesian regression using the <i>g</i>-prior is shown below:
</p>

<div class="org-src-container">
<pre class="src src-julia">crime_src = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/crime.dat"</span>, header=<span style="color: #a991f1;">true</span><span style="color: #51afef;">)</span>
crime = crime_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
header = crime_src<span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span> <span style="color: #FCCE7B;">|&gt;</span> vec

df = DataFrame<span style="color: #51afef;">(</span>crime, header<span style="color: #51afef;">)</span>

<span style="color: #51afef;">using</span> GLM

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">ResidualSE</span><span style="color: #51afef;">(</span>y,X<span style="color: #51afef;">)</span>
    fit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">return</span> sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>fit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> size<span style="color: #C57BDB;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">lmGprior</span><span style="color: #51afef;">(</span>y, X; g=length<span style="color: #C57BDB;">(</span>y<span style="color: #C57BDB;">)</span>, &#957;&#8320;=<span style="color: #e69055; font-weight: bold;">1</span>, &#963;&#8320;&#178;=ResidualSE<span style="color: #C57BDB;">(</span>y,X<span style="color: #C57BDB;">)</span>, S=<span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    Hg = <span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">/</span><span style="color: #C57BDB;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> X'
    SSRg = y' <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>diagm<span style="color: #C57BDB;">(</span>ones<span style="color: #7bc275;">(</span>n<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> Hg<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">*</span> y
    &#963;&#178; = <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">./</span> rand<span style="color: #51afef;">(</span>Gamma<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">+</span>n<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">/</span><span style="color: #7bc275;">(</span>&#957;&#8320;<span style="color: #FCCE7B;">*</span>&#963;&#8320;&#178;<span style="color: #FCCE7B;">+</span>SSRg<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, S<span style="color: #51afef;">)</span>

    Vb = g <span style="color: #FCCE7B;">*</span> inv<span style="color: #51afef;">(</span>X'X<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span><span style="color: #51afef;">(</span>g<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
    Eb = Vb <span style="color: #FCCE7B;">*</span> X' <span style="color: #FCCE7B;">*</span> y

    &#946; = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, <span style="color: #e69055; font-weight: bold;">0</span>, p<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        s = &#963;&#178;<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>
        &#946; = vcat<span style="color: #51afef;">(</span>&#946;, rand<span style="color: #C57BDB;">(</span>MvNormal<span style="color: #7bc275;">(</span>Eb, Symmetric<span style="color: #a991f1;">(</span>s <span style="color: #FCCE7B;">*</span> Vb<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>'<span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> &#946;, &#963;&#178;
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
n = size<span style="color: #51afef;">(</span>df, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
g = n
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">2</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">1</span>

y = df<span style="color: #51afef;">[</span>:, <span style="color: #a991f1;">:y</span><span style="color: #51afef;">]</span>
X = select<span style="color: #51afef;">(</span>df, Not<span style="color: #C57BDB;">(</span><span style="color: #a991f1;">:y</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> Matrix
X = <span style="color: #51afef;">[</span>ones<span style="color: #C57BDB;">(</span>size<span style="color: #7bc275;">(</span>X, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> X<span style="color: #51afef;">]</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">add intercept</span>
p = size<span style="color: #51afef;">(</span>X, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
S=<span style="color: #e69055; font-weight: bold;">5000</span>
BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y, X; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">posterior mean for &#946;</span>
&#946;&#770;_gprior = mean<span style="color: #51afef;">(</span>BETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec

<span style="color: #62686E;"># </span><span style="color: #62686E;">posterior confidence intervals for &#946;</span>
ci_gprior = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">0.025</span>, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span>, eachcol<span style="color: #C57BDB;">(</span>BETA<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">store results</span>
coef_name = names<span style="color: #51afef;">(</span>df<span style="color: #C57BDB;">[</span>:, Not<span style="color: #7bc275;">(</span><span style="color: #a991f1;">:y</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
coef_name = <span style="color: #51afef;">[</span><span style="color: #7bc275;">"intercept"</span>, coef_name...<span style="color: #51afef;">]</span>
result_gprior = DataFrame<span style="color: #51afef;">(</span>
    param = coef_name,
    &#946;&#770; = &#946;&#770;_gprior,
    ci_lower = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">]</span>, ci_gprior<span style="color: #C57BDB;">)</span>,
    ci_upper = map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">]</span>, ci_gprior<span style="color: #C57BDB;">)</span>
<span style="color: #51afef;">)</span>
<span style="color: #C57BDB; font-weight: bold;">@transform!</span><span style="color: #51afef;">(</span>result_gprior, <span style="color: #a991f1;">:ci_length</span> = <span style="color: #a991f1;">:ci_upper</span> <span style="color: #FCCE7B;">-</span> <span style="color: #a991f1;">:ci_lower</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example" id="orgfcbbd49">
16×5 DataFrame
 Row │ param      β̂             ci_lower    ci_upper    ci_length
     │ String     Float64       Float64     Float64     Float64
─────┼────────────────────────────────────────────────────────────
   1 │ intercept  -0.00138411   -0.145485    0.141785    0.28727
   2 │ M           0.280085      0.0326016   0.522226    0.489625
   3 │ So          0.000124904  -0.335994    0.326097    0.662091
   4 │ Ed          0.531345      0.213679    0.848809    0.63513
   5 │ Po1         1.4448        0.0578835   2.9098      2.85191
   6 │ Po2        -0.769673     -2.28756     0.708661    2.99622
   7 │ LF         -0.0649535    -0.345494    0.201018    0.546512
   8 │ M.F         0.128508     -0.147925    0.402133    0.550058
   9 │ Pop        -0.0704276    -0.301267    0.153849    0.455116
  10 │ NW          0.105647     -0.200629    0.416185    0.616814
  11 │ U1         -0.265548     -0.631514    0.103081    0.734594
  12 │ U2          0.359167      0.0283685   0.688258    0.659889
  13 │ GDP         0.239074     -0.213783    0.692641    0.906425
  14 │ Ineq        0.715697      0.299354    1.13272     0.83337
  15 │ Prob       -0.27993      -0.527327   -0.0344898   0.492837
  16 │ Time       -0.0602993    -0.288748    0.181236    0.469984
</pre>

<p>
The result of least square estimation is shown below:
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">least square estimates</span>
olsfit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>

tstat = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">./</span> stderror<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
pval = <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> .<span style="color: #FCCE7B;">-</span> cdf.<span style="color: #C57BDB;">(</span>Normal<span style="color: #7bc275;">()</span>, abs.<span style="color: #7bc275;">(</span>tstat<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

result_ols = DataFrame<span style="color: #51afef;">(</span>
    param = coef_name,
    &#946;&#770; = coef<span style="color: #C57BDB;">(</span>olsfit<span style="color: #C57BDB;">)</span>,
    pvalue = pval,
    ci_lower = confint<span style="color: #C57BDB;">(</span>olsfit<span style="color: #C57BDB;">)[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span>,
    ci_upper = confint<span style="color: #C57BDB;">(</span>olsfit<span style="color: #C57BDB;">)[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>
<span style="color: #51afef;">)</span>
<span style="color: #C57BDB; font-weight: bold;">@transform!</span><span style="color: #51afef;">(</span>result_ols, <span style="color: #a991f1;">:ci_length</span> = <span style="color: #a991f1;">:ci_upper</span> <span style="color: #FCCE7B;">-</span> <span style="color: #a991f1;">:ci_lower</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgd98dc5f">
16×6 DataFrame
 Row │ param      β̂             pvalue      ci_lower     ci_upper    ci_length
     │ String     Float64       Float64     Float64      Float64     Float64
─────┼─────────────────────────────────────────────────────────────────────────
   1 │ intercept  -0.000458109  0.995369    -0.161444     0.160527    0.321971
   2 │ M           0.286518     0.0348684    0.00955607   0.56348     0.553924
   3 │ So         -0.000114046  0.999506    -0.375493     0.375265    0.750757
   4 │ Ed          0.544514     0.00243231   0.178196     0.910832    0.732636
   5 │ Po1         1.47162      0.0715397   -0.193934     3.13718     3.33111
   6 │ Po2        -0.78178      0.358608    -2.51862      0.955056    3.47367
   7 │ LF         -0.0659646    0.667281    -0.378923     0.246994    0.625917
   8 │ M.F         0.131298     0.397494    -0.185192     0.447788    0.63298
   9 │ Pop        -0.0702919    0.579692    -0.329144     0.18856     0.517704
  10 │ NW          0.109057     0.525852    -0.241574     0.459687    0.701261
  11 │ U1         -0.270536     0.168865    -0.671568     0.130495    0.802063
  12 │ U2          0.36873      0.0403534    0.00190637   0.735554    0.733648
  13 │ GDP         0.238059     0.357931    -0.290079     0.766198    1.05628
  14 │ Ineq        0.726292     0.00192334   0.24874      1.20384     0.955105
  15 │ Prob       -0.285226     0.033017    -0.558095    -0.0123574   0.545738
  16 │ Time       -0.0615769    0.638379    -0.328802     0.205648    0.534451
</pre>


<div id="org4d43113" class="figure">
<p><img src="fig/ch9/ex_9-3a_coef.png" alt="ex_9-3a_coef.png" />
</p>
</div>

<p>
The point estimates and 95% confidence/credible intervals are very similar between bayesian regression and least square estimation.
The lengths of the intervals seem to be shorter in bayesian regression than in least square estimation.
Seeing the results of bayesian regression, the 95% credible intervals of coefficients of M, Ed, Po1, U2, Ineq and Prob do not include 0, so these variables seem strongly predictive of crime rates.
On the other hand, the results of least square estimation show that the p-values of M, Ed, U2 and Ineq are less than 0.05, so these variables seem strongly predictive of crime rates.
Using these types of criteria, the difference between the two results is that Po1 and Prob are predictive of crime rates in bayesian regression, but not in least square estimation.
</p>
</div>
</div>
</div>
<div id="outline-container-orgd6852ce" class="outline-4">
<h4 id="orgd6852ce">b)</h4>
<div class="outline-text-4" id="text-orgd6852ce">
</div>
<div id="outline-container-orga5a06b5" class="outline-5">
<h5 id="orga5a06b5">Answer</h5>
<div class="outline-text-5" id="text-orga5a06b5">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">split data into training and test set</span>
Random.seed!<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1234</span><span style="color: #51afef;">)</span>
i_te = sample<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>:n, div<span style="color: #C57BDB;">(</span>n, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span>, replace=<span style="color: #a991f1;">false</span><span style="color: #51afef;">)</span>
i_tr = setdiff<span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span>:n, i_te<span style="color: #51afef;">)</span>

y_tr = y<span style="color: #51afef;">[</span>i_tr<span style="color: #51afef;">]</span>
y_te = y<span style="color: #51afef;">[</span>i_te<span style="color: #51afef;">]</span>
X_tr = X<span style="color: #51afef;">[</span>i_tr, :<span style="color: #51afef;">]</span>
X_te = X<span style="color: #51afef;">[</span>i_te, :<span style="color: #51afef;">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">OLS</span>
olsfit = lm<span style="color: #51afef;">(</span>X_tr, y_tr<span style="color: #51afef;">)</span>
&#946;&#770;_ols = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
y&#770;_ols = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_ols
error_ols = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_ols<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
0.6155918321208247
</pre>


<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">Bayesian</span>
BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y_tr, X_tr; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
&#946;&#770;_bayes = mean<span style="color: #51afef;">(</span>BETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
y&#770;_bayes = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_bayes
error_bayes = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_bayes<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
0.6012597112455574
</pre>



<div id="org806d6ba" class="figure">
<p><img src="fig/ch9/ex_9-3b.png" alt="ex_9-3b.png" />
</p>
</div>

<p>
From the above results, the least square regression and bayesian regression seem to yield very similar predictions for the test data.
For this time, the bayesian regression predict better than the least square regression, but the gap is very small.
</p>
</div>
</div>
</div>
<div id="outline-container-orge67e6ae" class="outline-4">
<h4 id="orge67e6ae">c)</h4>
<div class="outline-text-4" id="text-orge67e6ae">
</div>
<div id="outline-container-orgc74de86" class="outline-5">
<h5 id="orgc74de86">Answer</h5>
<div class="outline-text-5" id="text-orgc74de86">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">computeMses</span><span style="color: #51afef;">(</span>y, X; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">split data into training and test set</span>
    y_tr, y_te, X_tr, X_te = splitData<span style="color: #51afef;">(</span>y, X<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">OLS</span>
    olsfit = lm<span style="color: #51afef;">(</span>X_tr, y_tr<span style="color: #51afef;">)</span>
    &#946;&#770;_ols = coef<span style="color: #51afef;">(</span>olsfit<span style="color: #51afef;">)</span>
    y&#770;_ols = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_ols
    error_ols = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_ols<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">Bayesian</span>
    BETA, SIGMA&#178; = lmGprior<span style="color: #51afef;">(</span>y_tr, X_tr; g=g, &#957;&#8320;=&#957;&#8320;, &#963;&#8320;&#178;=&#963;&#8320;&#178;, S=S<span style="color: #51afef;">)</span>
    &#946;&#770;_bayes = mean<span style="color: #51afef;">(</span>BETA, dims=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> vec
    y&#770;_bayes = X_te <span style="color: #FCCE7B;">*</span> &#946;&#770;_bayes
    error_bayes = mean<span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>y_te <span style="color: #FCCE7B;">-</span> y&#770;_bayes<span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">.^</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

    <span style="color: #51afef;">return</span> error_ols, error_bayes
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">compute MSEs</span>
n_sim = <span style="color: #e69055; font-weight: bold;">1000</span>
error_ols = zeros<span style="color: #51afef;">(</span>n_sim<span style="color: #51afef;">)</span>
error_bayes = zeros<span style="color: #51afef;">(</span>n_sim<span style="color: #51afef;">)</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:n_sim
    error_ols<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>, error_bayes<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span> = computeMses<span style="color: #51afef;">(</span>y, X<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">average MSEs</span>
mean<span style="color: #51afef;">(</span>error_ols<span style="color: #51afef;">)</span>, mean<span style="color: #51afef;">(</span>error_bayes<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
:RESULTS:
</p>
<pre class="example">
(1.12446194924989, 1.092206057122776)
</pre>



<div id="org0100983" class="figure">
<p><img src="fig/ch9/ex_9-3c.png" alt="ex_9-3c.png" />
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org80b5799" class="outline-2">
<h2 id="org80b5799">Chapter 10</h2>
<div class="outline-text-2" id="text-org80b5799">
</div>
<div id="outline-container-org883b5d5" class="outline-3">
<h3 id="org883b5d5">10.1</h3>
<div class="outline-text-3" id="text-org883b5d5">
</div>
<div id="outline-container-org67a6feb" class="outline-4">
<h4 id="org67a6feb">Answer</h4>
<div class="outline-text-4" id="text-org67a6feb">
<p>
It is obvious that the support of the proposal distribution is positive.
Therefore, it suffices to show \(J(\theta_1|\theta_0) = J(\theta_0 | \theta_1)\).
Let \(\theta_1, \theta_0, \delta \) be arbitrary positive numbers,
and without loss of generality, assume \(\theta_1 \ge \theta_0\).
</p>

<p>
When \(\theta_1 - \theta_0 \ge \delta\), \(J(\theta_1|\theta_0) = J(\theta_0 | \theta_1) = 0\) holds.
Thus, we can only consider the case \(\theta_1 - \theta_0 < \delta \).
</p>

<p>
(i-i) When \(\theta_0 \le \delta \),
and \( \theta_0 - \delta < -\theta_1 \),
\(\theta_1 \) will be proposed when \(\tilde{\theta} \) equals either \(\theta_1\) or \(-\theta_1\).
On the other hand, given \(\theta_1\), \(\theta_0\) will be proposed when \(\tilde{\theta} \) equals either \(\theta_0\) or \(-\theta_0\) because \( \theta_1 - \delta < -\theta_0 < 0 \le \theta_0 \le \theta_1 + \delta \).
</p>

<p>
(i-ii) When \(\theta_0 \le \delta \) and \( -\theta_1 \le \theta_0 - \delta \),
\(\theta_1 \) will be proposed when \(\tilde{\theta} \) equals \(\theta_1\).
Given \(\theta_1\), \(\theta_0\) will be proposed when \(\tilde{\theta} \) equals \(\theta_0\) because \(-\theta_0 \le \theta_1 - \delta < 0 \le \theta_0 \le \theta_1 + \delta \).
Therefore, \(J(\theta_1|\theta_0) = J(\theta_0 | \theta_1)\) holds.
</p>

<p>
(ii) When \(\theta_0 > \delta \),
\((\theta_0 - \delta, \theta_0 + \delta)\) covers only positive numbers.
Thus, \(\theta_1 \) will be proposed when \(\tilde{\theta} \) equals either \(\theta_1\).
Conversely, given \(\theta_1\), \(\theta_0\) will be proposed when \(\tilde{\theta} \) equals \(\theta_0\) because \(\theta_1 - \delta > 0 \).
Therefore, \(J(\theta_1|\theta_0) = J(\theta_0 | \theta_1)\) holds.
</p>

<p>
In conclusion, it holds that the proposal distribution is symmetric.
</p>
</div>
</div>
<div id="outline-container-orgd04d91f" class="outline-4">
<h4 id="orgd04d91f">Answer</h4>
<div class="outline-text-4" id="text-orgd04d91f">
<p>
提案分布が正の値のみをサポートすることは明らか。したがって、\(J(\theta_1|\theta_0) = J(\theta_0 | \theta_1)\)を示せば十分。
</p>

<p>
\(\theta_1, \theta_0, \delta \)を任意の正の数とし、一般性を失わず\(\theta_1 \ge \theta_0\)と仮定する。
</p>

<p>
(i-i) \(\theta_0 \le \delta \)かつ\( \theta_0 - \delta < -\theta_1 \)のとき、
\(\theta_1\)は\(\tilde{\theta} = \theta_1\)または\(\tilde{\theta} =-\theta_1\)のときに提案される。一方、\(\theta_1\)が与えられたとき、\( \theta_1 - \delta < -\theta_0 < 0 \le \theta_0 \le \theta_1 + \delta \)より\(\tilde{\theta} = \theta_0\)または\(\tilde{\theta} =-\theta_0\)のときに\(\theta_0\)が提案される。
</p>

<p>
(i-ii) \(\theta_0 \le \delta\) かつ \( -\theta_1 \le \theta_0 - \delta \)のとき、
\(\theta_1\)は\(\tilde{\theta} = \theta_1\)のときに提案される。一方、\(\theta_1\)が与えられたとき、\(-\theta_0 \le \theta_1 - \delta < 0 \le \theta_0 \le \theta_1 + \delta \)より\(\tilde{\theta} = \theta_0\)のときに\(\theta_0\)が提案される。
</p>

<p>
(ii) \(\theta_0 > \delta \)のとき、\((\theta_0 - \delta, \theta_0 + \delta)\)は正の数のみをカバーする。したがって、\(\theta_1\)は\(\tilde{\theta} = \theta_1\)のときのみに提案される。逆に、\(\theta_1\)が与えられたとき、\(\theta_1 - \delta > 0 \)より\(\tilde{\theta} = \theta_0\)のときに\(\theta_0\)が提案される。
</p>

<p>
提案分布は一様分布であることから、以上の議論により対称性が示された。
</p>
</div>
</div>
</div>
<div id="outline-container-orgfdcee9c" class="outline-3">
<h3 id="orgfdcee9c">10.2</h3>
<div class="outline-text-3" id="text-orgfdcee9c">
</div>
<div id="outline-container-orgd0eab77" class="outline-4">
<h4 id="orgd0eab77">a)</h4>
<div class="outline-text-4" id="text-orgd0eab77">
</div>
<div id="outline-container-org5af8873" class="outline-5">
<h5 id="org5af8873">Answer</h5>
<div class="outline-text-5" id="text-org5af8873">
\begin{align*}
\prod_{i=1}^n p(y_i | \alpha, \beta, x_i)
&= \prod_{i=1}^n \frac{\exp(\alpha + \beta x_i)^{y_i}}{1 + \exp(\alpha + \beta x_i)} \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-org17305f6" class="outline-4">
<h4 id="org17305f6">b)</h4>
<div class="outline-text-4" id="text-org17305f6">
</div>
<div id="outline-container-orgc674d47" class="outline-5">
<h5 id="orgc674d47">Answer</h5>
<div class="outline-text-5" id="text-orgc674d47">
<p>
Let \(p\) be the probability of nesting success.
Then,
</p>
\begin{align*}
\alpha + \beta x_i
&= \text{logit } p \\
&= \log \frac{p}{1-p}. \\
\end{align*}
<p>
Thus, if we have no prior information about the probability of nesting success,
we can set the prior expectation of \(\alpha + \beta x_i\) to 0, \(p = 0.5\).
Also, we have no prior information about the relationship between wingspan and nesting success,
so we can set the prior expectation of \(\beta\) to 0.
Consequently, we can set the prior expectation of \(\alpha\) to 0.
</p>

<p>
Next, we consider the prior variance of \(\alpha\) and \(\beta\).
Suppose temporarily that \(\beta = 0\).
If the prior variance of \(\alpha\) is set to \(2500\),
\(\alpha\) ranges between \(-100\) and \(100\) for 95% probability, and
the odds ratio should be between
\(\exp(-100) \approx 3.7 \times 10^{-44}\) and
\(\exp(100) \approx 2.7 \times 10^{43}\).
This prior can be seen quite uninformative.
Similarly, considering \(x_i\) ranges between 10 and 15,
we can set the prior variance of \(\beta\) to 25.
Thus, we can set the prior distribution of \(\alpha\) and \(\beta\) as follows:
</p>
\begin{align*}
\alpha &\sim \mathcal{N}(0, 2500) \\
\beta &\sim \mathcal{N}(0, 25) \\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orgf6dce08" class="outline-4">
<h4 id="orgf6dce08">c)</h4>
<div class="outline-text-4" id="text-orgf6dce08">
</div>
<div id="outline-container-org1ea7125" class="outline-5">
<h5 id="org1ea7125">Answer</h5>
<div class="outline-text-5" id="text-org1ea7125">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">using</span> BayesPlots
<span style="color: #51afef;">using</span> DelimitedFiles
<span style="color: #51afef;">using</span> Distributions
<span style="color: #51afef;">using</span> LaTeXStrings
<span style="color: #51afef;">using</span> LinearAlgebra
<span style="color: #51afef;">using</span> MCMCChains
<span style="color: #51afef;">using</span> Plots
<span style="color: #51afef;">using</span> Plots.Measures
<span style="color: #51afef;">using</span> Random
<span style="color: #51afef;">using</span> StatsBase
<span style="color: #51afef;">using</span> StatsModels
<span style="color: #51afef;">using</span> StatsPlots
<span style="color: #51afef;">using</span> GLM
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">data = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../Exercises/msparrownest.dat"</span><span style="color: #51afef;">)</span>
y = data<span style="color: #51afef;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
x = data<span style="color: #51afef;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">add intercept</span>
x = hcat<span style="color: #51afef;">(</span>ones<span style="color: #C57BDB;">(</span>length<span style="color: #7bc275;">(</span>x<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, x<span style="color: #51afef;">)</span>

<span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">MetropolisLogit</span><span style="color: #51afef;">(</span>S, y, x, &#946;&#8320;, &#931;&#8320;, var_prop; seed=<span style="color: #e69055; font-weight: bold;">123</span><span style="color: #51afef;">)</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">S: number of samples</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">y: response vector</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">x: predictor vector</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">&#946;&#8320;: prior mean of &#946;</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">&#931;&#8320;: prior covariance of &#946;</span>
    <span style="color: #62686E;"># </span><span style="color: #62686E;">var_prop: proposal variance</span>

    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">logistic</span><span style="color: #51afef;">(</span>&#968;<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">return</span> exp<span style="color: #51afef;">(</span>&#968;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">+</span> exp<span style="color: #C57BDB;">(</span>&#968;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>

    Random.seed!<span style="color: #51afef;">(</span>seed<span style="color: #51afef;">)</span>
    q = length<span style="color: #51afef;">(</span>&#946;&#8320;<span style="color: #51afef;">)</span>
    BETA = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, S, q<span style="color: #51afef;">)</span>
    acs = <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">acceptance rate</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">Initialize</span>
    glmfit = glm<span style="color: #51afef;">(</span>x, y, Binomial<span style="color: #C57BDB;">()</span>, LogitLink<span style="color: #C57BDB;">()</span><span style="color: #51afef;">)</span>
    &#946; = coef<span style="color: #51afef;">(</span>glmfit<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">Metropolis algorithm</span>
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        p = logistic.<span style="color: #51afef;">(</span>x<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #51afef;">)</span>
        <span style="color: #62686E;"># </span><span style="color: #62686E;">Draw &#946;*</span>
        &#946;_star = rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>&#946;, var_prop<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        p_star = logistic.<span style="color: #51afef;">(</span>x<span style="color: #FCCE7B;">*</span>&#946;_star<span style="color: #51afef;">)</span>
        log_r = sum<span style="color: #51afef;">(</span>logpdf.<span style="color: #C57BDB;">(</span>Bernoulli.<span style="color: #7bc275;">(</span>p_star<span style="color: #7bc275;">)</span>, y<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">+</span>
                logpdf<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>&#946;_star, &#931;&#8320;<span style="color: #C57BDB;">)</span>, &#946;<span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">-</span>
                sum<span style="color: #51afef;">(</span>logpdf.<span style="color: #C57BDB;">(</span>Bernoulli.<span style="color: #7bc275;">(</span>p<span style="color: #7bc275;">)</span>, y<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">-</span>
                logpdf<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>&#946;, &#931;&#8320;<span style="color: #C57BDB;">)</span>, &#946;_star<span style="color: #51afef;">)</span>

        <span style="color: #51afef;">if</span> log<span style="color: #51afef;">(</span>rand<span style="color: #C57BDB;">()</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">&lt;</span> log_r
            &#946; = &#946;_star
            acs <span style="color: #FCCE7B;">+=</span> <span style="color: #e69055; font-weight: bold;">1</span>
        <span style="color: #51afef;">end</span>
        BETA<span style="color: #51afef;">[</span>s, :<span style="color: #51afef;">]</span> = &#946;
    <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">return</span> BETA, acs<span style="color: #FCCE7B;">/</span>S
<span style="color: #51afef;">end</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">Prior</span>
&#946;&#8320; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">0</span>, <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">]</span>
&#931;&#8320; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">2500</span> <span style="color: #e69055; font-weight: bold;">0</span>; <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #e69055; font-weight: bold;">25</span><span style="color: #51afef;">]</span>

S = <span style="color: #e69055; font-weight: bold;">10000</span>

<span style="color: #62686E;"># </span><span style="color: #62686E;">search best proposal variance</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">20</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">Proposal variance</span>
    var_prop = i<span style="color: #FCCE7B;">*</span>inv<span style="color: #51afef;">(</span>x'x<span style="color: #51afef;">)</span>
    BETA, acs = MetropolisLogit<span style="color: #51afef;">(</span>S, y, x, &#946;&#8320;, &#931;&#8320;, var_prop<span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"i = "</span>, i<span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"acceptance rate = "</span>, acs<span style="color: #51afef;">)</span>
    ess_&#945; = MCMCDiagnosticTools.ess<span style="color: #51afef;">(</span>BETA<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    ess_&#946; = MCMCDiagnosticTools.ess<span style="color: #51afef;">(</span>BETA<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"ess_&#945; = "</span>, ess_&#945;<span style="color: #51afef;">)</span>
    println<span style="color: #51afef;">(</span><span style="color: #7bc275;">"ess_&#946; = "</span>, ess_&#946;<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">var_prop = <span style="color: #e69055; font-weight: bold;">17</span><span style="color: #FCCE7B;">*</span>inv<span style="color: #51afef;">(</span>x'x<span style="color: #51afef;">)</span>
BETA, acs = MetropolisLogit<span style="color: #51afef;">(</span>S, y, x, &#946;&#8320;, &#931;&#8320;, var_prop<span style="color: #51afef;">)</span>

ess<span style="color: #51afef;">(</span>MCMCChains.Chains<span style="color: #C57BDB;">(</span>BETA<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="orgcc7380a">
ESS
  parameters         ess   ess_per_sec
      Symbol     Float64       Missing

     param_1   1261.2209       missing
     param_2   1248.0384       missing
</pre>


<div id="orgabe26c8" class="figure">
<p><img src="fig/ch10/ex10-2_itr.png" alt="ex10-2_itr.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orga07679e" class="outline-4">
<h4 id="orga07679e">d)</h4>
<div class="outline-text-4" id="text-orga07679e">
</div>
<div id="outline-container-org29c0489" class="outline-5">
<h5 id="org29c0489">Answer</h5>
<div class="outline-text-5" id="text-org29c0489">

<div id="org2ef449c" class="figure">
<p><img src="fig/ch10/ex10-2d.png" alt="ex10-2d.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org93aac45" class="outline-4">
<h4 id="org93aac45">e)</h4>
<div class="outline-text-4" id="text-org93aac45">
</div>
<div id="outline-container-orgfec0d07" class="outline-5">
<h5 id="orgfec0d07">Answer</h5>
<div class="outline-text-5" id="text-orgfec0d07">
<div class="org-src-container">
<pre class="src src-julia">x_grid = <span style="color: #e69055; font-weight: bold;">10</span>:<span style="color: #e69055; font-weight: bold;">0.1</span>:<span style="color: #e69055; font-weight: bold;">15</span>
x_grid = hcat<span style="color: #51afef;">(</span>ones<span style="color: #C57BDB;">(</span>length<span style="color: #7bc275;">(</span>x_grid<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, x_grid<span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
f_post = logistic.<span style="color: #51afef;">(</span>x_grid<span style="color: #FCCE7B;">*</span>BETA<span style="color: #C57BDB;">[</span>burnin:<span style="color: #51afef;">end</span>, :<span style="color: #C57BDB;">]</span>'<span style="color: #51afef;">)</span>

<span style="color: #62686E; text-decoration: overline;"># </span><span style="color: #62686E; text-decoration: overline;">%%</span>
f_post_mean = mean<span style="color: #51afef;">(</span>f_post, dims=<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
f_post_lower = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #e69055; font-weight: bold;">0.025</span><span style="color: #C57BDB;">)</span>, eachrow<span style="color: #C57BDB;">(</span>f_post<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
f_post_upper = map<span style="color: #51afef;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> quantile<span style="color: #C57BDB;">(</span>x, <span style="color: #e69055; font-weight: bold;">0.975</span><span style="color: #C57BDB;">)</span>, eachrow<span style="color: #C57BDB;">(</span>f_post<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>


<div id="org14a4b3f" class="figure">
<p><img src="fig/ch10/ex10-2e.png" alt="ex10-2e.png" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org5d5ee12" class="outline-3">
<h3 id="org5d5ee12">10.3</h3>
<div class="outline-text-3" id="text-org5d5ee12">
</div>
<div id="outline-container-org5389af6" class="outline-4">
<h4 id="org5389af6">a)</h4>
<div class="outline-text-4" id="text-org5389af6">
</div>
<div id="outline-container-org6e7a9e3" class="outline-5">
<h5 id="org6e7a9e3">Answer</h5>
<div class="outline-text-5" id="text-org6e7a9e3">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">import</span> Pkg; Pkg.add<span style="color: #51afef;">(</span>url=<span style="color: #7bc275;">"https://github.com/KaoruBB/BayesPlots.jl"</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">data = readdlm<span style="color: #51afef;">(</span><span style="color: #7bc275;">"Exercises/tplant.dat"</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org47fa7a9">
20×3 Matrix{Float64}:
 11.8   0.0  6.39
 15.34  1.0  6.39
  9.31  0.0  5.58
 13.7   1.0  5.58
 11.2   0.0  4.26
 14.75  1.0  4.26
 10.33  0.0  5.87
 14.38  1.0  5.87
  9.79  0.0  3.91
 13.96  1.0  3.91
  8.39  0.0  3.91
 12.84  1.0  3.91
 10.61  0.0  6.17
 14.87  1.0  6.17
  8.54  0.0  3.36
 12.77  1.0  3.36
  9.25  0.0  3.52
 13.14  1.0  3.52
  8.86  0.0  2.02
 12.24  1.0  2.02
</pre>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">first column: plant height</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">second column: measurement period</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">third column: pH level</span>
y = data<span style="color: #51afef;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>
X = data<span style="color: #51afef;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">]</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">add intercept</span>
X = hcat<span style="color: #51afef;">(</span>ones<span style="color: #C57BDB;">(</span>length<span style="color: #7bc275;">(</span>X<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, X<span style="color: #51afef;">)</span>
df = DataFrame<span style="color: #51afef;">(</span>
    height = y,
    time = X<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>,
    pH = data<span style="color: #C57BDB;">[</span>:, <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span>
<span style="color: #51afef;">)</span>
lmfit = lm<span style="color: #51afef;">(</span><span style="color: #C57BDB; font-weight: bold;">@formula</span><span style="color: #C57BDB;">(</span>height <span style="color: #FCCE7B;">~</span> time <span style="color: #FCCE7B;">+</span> pH<span style="color: #C57BDB;">)</span>, df<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #7bc275;">"StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}</span>

<span style="color: #7bc275;">height ~ 1 + time + pH</span>

<span style="color: #7bc275;">Coefficients:</span>
<span style="color: #7bc275;">&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;</span>
<span style="color: #7bc275;">                Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%</span>
<span style="color: #7bc275;">&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;</span>
<span style="color: #7bc275;">(Intercept)  7.20869     0.589054  12.24    &lt;1e-09   5.9659     8.45149</span>
<span style="color: #7bc275;">time         3.991       0.328003  12.17    &lt;1e-09   3.29897    4.68303</span>
<span style="color: #7bc275;">pH           0.577752    0.120354   4.80    0.0002   0.323828   0.831676</span>
<span style="color: #7bc275;">&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;"</span>
</pre>
</div>

<p>
この結果は、トマトの苗の高さは平均して時間あたり3.99 cmずつ増加し、
pHレベルが1上昇すると、0.58 cm増加することを示唆している。有意水準0.01でも、有意な結果となっている。
</p>
</div>
</div>
</div>
<div id="outline-container-org060c0af" class="outline-4">
<h4 id="org060c0af">b)</h4>
<div class="outline-text-4" id="text-org060c0af">
</div>
<div id="outline-container-orgdb1f858" class="outline-5">
<h5 id="orgdb1f858">Answer</h5>
<div class="outline-text-5" id="text-orgdb1f858">

<div id="orgeeccc64" class="figure">
<p><img src="fig/ch10/ex10-3b.png" alt="ex10-3b.png" />
</p>
</div>
<p>
上は残差の散布図である。同じトマトの苗は同じ色で示されており、同じ苗に関する残差に相関が見られる。これより、このデータは一般的なOLSモデルの仮定である、誤差項が独立同一に分布しているという仮定(random sampling)を満たしていないことが示唆される。この仮定からの逸脱は、回帰係数や標準誤差の妥当性を損なう。
</p>
</div>
</div>
</div>
<div id="outline-container-orgb404c1d" class="outline-4">
<h4 id="orgb404c1d">c)</h4>
<div class="outline-text-4" id="text-orgb404c1d">
</div>
<div id="outline-container-org571c73a" class="outline-5">
<h5 id="org571c73a">Answer</h5>
<div class="outline-text-5" id="text-org571c73a">
<p>
\[
\boldsymbol{Y} = \begin{pmatrix}
Y_{1,1} \\ Y_{1,2} \\
Y_{2,1} \\ Y_{2,2} \\
\vdots \\
Y_{n,1} \\ Y_{n,2}
\end{pmatrix}
\sim \text{multivariate normal} \left( \mathbf{X} \boldsymbol{\beta}, \Sigma \right)
\]
where
\[
\Sigma = \sigma^2 \mathbf{C}_{\rho}
= \sigma^2 \begin{pmatrix}
1 & \rho & 0 & 0 & \cdots & 0 \\
\rho & 1 & 0 & 0 & \cdots & 0 \\
0 & 0 & 1 & \rho & \cdots & 0 \\
0 & 0 & \rho & 1 & \cdots & 0 \\
\vdots & \vdots & \vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & 0 & \cdots & 1
\end{pmatrix}
\]
and \(\rho\) is the correlation between the two measurements of the same plant.
</p>

<p>
Setting the prior distribution of \(\beta, \sigma, \rho\) as follows,
</p>
<ul class="org-ul">
<li>\(\beta\):
\[
  \beta \sim \mathcal{N}(\boldsymbol{\beta}_0, \Sigma_0),
  \]</li>
<li>\(\sigma\):
\[
  \sigma \sim \text{inverse-gamma}( \frac{v_0}{2}, \frac{v_0 \sigma_0^2}{2} ),
  \]</li>
<li>\(\rho\):
\[
  \rho \sim \text{uniform}( 0, 1 ),
  \]</li>
</ul>
<p>
the posterior distributions of \(\beta, \sigma\) are given by
</p>
\begin{align*}
\{\boldsymbol{\beta} | \boldsymbol{y}, \mathbf{X}, \sigma^2, \rho \} &\sim \text{multivariate normal}(\boldsymbol{\beta}_n, \Sigma_n), \text{ where} \\
\Sigma_n &= \left( \mathbf{X}^{\top} \mathbf{C}_{\rho}^{-1} \mathbf{X}/\sigma^2 + \Sigma_0^{-1} \right)^{-1} \\
\boldsymbol{\beta}_n &= \Sigma_n \left( \mathbf{X}^{\top} \mathbf{C}_{\rho}^{-1} \boldsymbol{y}/\sigma^2 + \Sigma_0^{-1} \boldsymbol{\beta}_0 \right), \text{ and} \\
\{\sigma^2 | \boldsymbol{y}, \mathbf{X}, \boldsymbol{\beta}, \rho \} &\sim \text{inverse-gamma} \left( \frac{ \nu_0 + n }{2}, \frac{ \nu_0 + \mathrm{SSR}_{\rho} }{2} \right), \text{ where} \\
\mathrm{SSR}_{\rho} &= \left( \boldsymbol{y} - \mathbf{X} \boldsymbol{\beta} \right)^{\top} \mathbf{C}_{\rho}^{-1} \left( \boldsymbol{y} - \mathbf{X} \boldsymbol{\beta} \right). \\
\end{align*}

<p>
The posterior distribution of \(\rho\) is not analytically tractable, so we use the Metropolis algorithm to sample from the posterior distribution.
</p>

<p>
Given \(\{\boldsymbol{\beta}^{(s)}, \sigma^{2(s)}, \rho^{(s)}\}\), we update the parameters as follows:
</p>
<ol class="org-ol">
<li>Update \(\boldsymbol{\beta}\):
Sample \(\boldsymbol{\beta}^{(s+1)} \sim \text{multivariate normal}(\boldsymbol{\beta}_n, \Sigma_n)\),
where \(\boldsymbol{\beta}_n \) and \(\Sigma_n\) depend on \(\sigma^{2(s)}\) and \(\rho^{(s)}\).</li>
<li>Update \(\sigma^2\):
Sample \(\sigma^{2(s+1)} \sim \text{inverse-gamma}([\nu_0 + n]/2, [\nu_0 \sigma_0^2 + \mathrm{SSR}_{\rho}] / 2)\),
where \(\mathrm{SSR}_{\rho}\) depends on \(\boldsymbol{\beta}^{(s+1)}\) and \(\rho^{(s)}\).</li>
<li>Update \(\rho\):
<ol class="org-ol">
<li>Propose \(\rho^{\ast} \sim \text{uniform}(\rho^{(s)} - \delta, \rho^{(s)} + \delta)\).
If \(\rho^{\ast} \lt 0\) then reassin it to be \(|\rho^{\ast}|\).
If \(\rho^{\ast} > 1\) reassin it to be \(2 - \rho^{\ast}\).</li>
<li>Compute the acceptance ratio
\[ r = \frac{ p(\boldsymbol{y} | \mathbf{X}, \boldsymbol{\beta}^{(s+1)}, \sigma^{2(s+1)}, \rho^{\ast} ) p(\rho^{\ast})}{ p(\boldsymbol{y} | \mathbf{X}, \boldsymbol{\beta}^{(s+1)}, \sigma^{2(s+1)}, \rho^{(s)} ) p(\rho^{(s)})} \]
and sample \(u \sim \text{uniform}(0,1)\).
If \(u \lt r\), set \(\rho^{(s+1)} = \rho^{\ast}\), otherwise set \(\rho^{(s+1)} = \rho^{(s)}\).</li>
</ol></li>
</ol>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">fit_ar1_linear_model_for_repeated_individuals</span><span style="color: #51afef;">(</span>y, X, &#946;&#8320;, &#931;&#8320;, &#957;&#8320;, &#963;&#8320;&#178;; S=<span style="color: #e69055; font-weight: bold;">5000</span>, &#948;=<span style="color: #e69055; font-weight: bold;">1</span>, seed=<span style="color: #e69055; font-weight: bold;">42</span>, thin=<span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

    n, p = size<span style="color: #51afef;">(</span>X<span style="color: #51afef;">)</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">starting values</span>
    lmfit = lm<span style="color: #51afef;">(</span>X, y<span style="color: #51afef;">)</span>
    &#946; = coef<span style="color: #51afef;">(</span>lmfit<span style="color: #51afef;">)</span>
    &#963;&#178; = sum<span style="color: #51afef;">(</span>map<span style="color: #C57BDB;">(</span>x <span style="color: #FCCE7B;">-&gt;</span> x<span style="color: #FCCE7B;">^</span><span style="color: #e69055; font-weight: bold;">2</span>, residuals<span style="color: #7bc275;">(</span>lmfit<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">/</span> <span style="color: #51afef;">(</span>n <span style="color: #FCCE7B;">-</span> p<span style="color: #51afef;">)</span>
    res = residuals<span style="color: #51afef;">(</span>lmfit<span style="color: #51afef;">)</span>
    &#961; = autocor<span style="color: #51afef;">(</span>res, <span style="color: #C57BDB;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>

    Random.seed!<span style="color: #51afef;">(</span>seed<span style="color: #51afef;">)</span>
    OUT = Matrix<span style="color: #51afef;">{</span>Float64<span style="color: #51afef;">}(</span><span style="color: #a991f1;">undef</span>, <span style="color: #e69055; font-weight: bold;">0</span>, p<span style="color: #FCCE7B;">+</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
    ac = <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #62686E;"># </span><span style="color: #62686E;">acceptance count</span>

    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">_create_cor_matrix</span><span style="color: #51afef;">(</span>n<span style="color: #FCCE7B;">::Int</span>, &#961;<span style="color: #FCCE7B;">::Number</span><span style="color: #51afef;">)</span>
        C&#7528; = zeros<span style="color: #51afef;">(</span>n, n<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:n
            <span style="color: #51afef;">for</span> j <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:n
                <span style="color: #51afef;">if</span> i <span style="color: #FCCE7B;">==</span> j
                    C&#7528;<span style="color: #51afef;">[</span>i, j<span style="color: #51afef;">]</span> = <span style="color: #e69055; font-weight: bold;">1</span>
                <span style="color: #51afef;">elseif</span> <span style="color: #51afef;">(</span>i <span style="color: #FCCE7B;">-</span> j <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">&amp;&amp;</span> i <span style="color: #FCCE7B;">%</span> <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">||</span> <span style="color: #51afef;">(</span>j <span style="color: #FCCE7B;">-</span> i <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #FCCE7B;">&amp;&amp;</span> j <span style="color: #FCCE7B;">%</span> <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span>
                    C&#7528;<span style="color: #51afef;">[</span>i, j<span style="color: #51afef;">]</span> = &#961;
                <span style="color: #51afef;">end</span>
            <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">end</span>
        <span style="color: #51afef;">return</span> C&#7528;
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">_update_&#946;</span><span style="color: #51afef;">(</span>y, X, &#963;&#178;, iCor, &#931;&#8320;, &#946;&#8320;<span style="color: #51afef;">)</span>
        V_&#946; = inv<span style="color: #51afef;">(</span>X' <span style="color: #FCCE7B;">*</span> iCor <span style="color: #FCCE7B;">*</span> X<span style="color: #FCCE7B;">/</span>&#963;&#178; <span style="color: #FCCE7B;">+</span> &#931;&#8320;<span style="color: #51afef;">)</span>
        E_&#946; = V_&#946; <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>X' <span style="color: #FCCE7B;">*</span> iCor <span style="color: #FCCE7B;">*</span> y<span style="color: #FCCE7B;">/</span>&#963;&#178; <span style="color: #FCCE7B;">+</span> inv<span style="color: #C57BDB;">(</span>&#931;&#8320;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">*</span> &#946;&#8320;<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">return</span> rand<span style="color: #51afef;">(</span>MvNormal<span style="color: #C57BDB;">(</span>E_&#946;, Symmetric<span style="color: #7bc275;">(</span>V_&#946;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">_update_&#963;&#178;</span><span style="color: #51afef;">(</span>y, X, &#946;, iCor, &#957;&#8320;, &#963;&#8320;&#178;<span style="color: #51afef;">)</span>
        &#957;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">+</span> length<span style="color: #51afef;">(</span>y<span style="color: #51afef;">)</span>
        SSR = <span style="color: #51afef;">(</span>y <span style="color: #FCCE7B;">-</span> X<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #51afef;">)</span>' <span style="color: #FCCE7B;">*</span> iCor <span style="color: #FCCE7B;">*</span> <span style="color: #51afef;">(</span>y <span style="color: #FCCE7B;">-</span> X<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #51afef;">)</span>
        &#957;&#8345;&#963;&#178;&#8345; = &#957;&#8320; <span style="color: #FCCE7B;">*</span> &#963;&#8320;&#178; <span style="color: #FCCE7B;">+</span> SSR
        <span style="color: #51afef;">return</span> rand<span style="color: #51afef;">(</span>InverseGamma<span style="color: #C57BDB;">(</span>&#957;&#8345; <span style="color: #FCCE7B;">/</span> <span style="color: #e69055; font-weight: bold;">2</span>, &#957;&#8345;&#963;&#178;&#8345;<span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">function</span> <span style="color: #5cEfFF;">_update_&#961;</span><span style="color: #51afef;">(</span>&#961;, y, X, &#946;, &#963;&#178;, &#948;<span style="color: #51afef;">)</span>
        &#961;&#8346; = rand<span style="color: #51afef;">(</span>Uniform<span style="color: #C57BDB;">(</span>&#961;<span style="color: #FCCE7B;">-</span>&#948;, &#961;<span style="color: #FCCE7B;">+</span>&#948;<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">|&gt;</span> abs
        &#961;&#8346; = minimum<span style="color: #51afef;">(</span><span style="color: #C57BDB;">[</span>&#961;&#8346;, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #FCCE7B;">-</span>&#961;&#8346;<span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
        Cor = _create_cor_matrix<span style="color: #51afef;">(</span>n, &#961;<span style="color: #51afef;">)</span>
        Cor&#8346; = _create_cor_matrix<span style="color: #51afef;">(</span>n, &#961;&#8346;<span style="color: #51afef;">)</span>
        lr = <span style="color: #FCCE7B;">-</span><span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #FCCE7B;">*</span><span style="color: #51afef;">(</span>
            logdet<span style="color: #C57BDB;">(</span>Cor&#8346;<span style="color: #C57BDB;">)</span> <span style="color: #FCCE7B;">-</span> logdet<span style="color: #C57BDB;">(</span>Cor<span style="color: #C57BDB;">)</span>  <span style="color: #FCCE7B;">+</span>
            tr<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>y<span style="color: #FCCE7B;">-</span>X<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #7bc275;">)</span><span style="color: #FCCE7B;">*</span><span style="color: #7bc275;">(</span>y<span style="color: #FCCE7B;">-</span>X<span style="color: #FCCE7B;">*</span>&#946;<span style="color: #7bc275;">)</span>' <span style="color: #FCCE7B;">*</span> <span style="color: #7bc275;">(</span>inv<span style="color: #a991f1;">(</span>Cor&#8346;<span style="color: #a991f1;">)</span> <span style="color: #FCCE7B;">-</span> inv<span style="color: #a991f1;">(</span>Cor<span style="color: #a991f1;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #FCCE7B;">/</span>&#963;&#178;
        <span style="color: #51afef;">)</span>
        <span style="color: #51afef;">if</span> log<span style="color: #51afef;">(</span>rand<span style="color: #C57BDB;">()</span><span style="color: #51afef;">)</span> <span style="color: #FCCE7B;">&lt;</span> lr
            ac <span style="color: #FCCE7B;">+=</span> <span style="color: #e69055; font-weight: bold;">1</span>
            <span style="color: #51afef;">return</span> &#961;&#8346;
        <span style="color: #51afef;">else</span>
            <span style="color: #51afef;">return</span> &#961;
        <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">end</span>

    <span style="color: #62686E;"># </span><span style="color: #62686E;">MCMC algorithm</span>
    <span style="color: #51afef;">for</span> s <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:S
        Cor = _create_cor_matrix<span style="color: #51afef;">(</span>n, &#961;<span style="color: #51afef;">)</span>
        iCor = inv<span style="color: #51afef;">(</span>Cor<span style="color: #51afef;">)</span>

        &#946; = _update_&#946;<span style="color: #51afef;">(</span>y, X, &#963;&#178;, iCor, &#931;&#8320;, &#946;&#8320;<span style="color: #51afef;">)</span>
        &#963;&#178; = _update_&#963;&#178;<span style="color: #51afef;">(</span>y, X, &#946;, iCor, &#957;&#8320;, &#963;&#8320;&#178;<span style="color: #51afef;">)</span>
        &#961; = _update_&#961;<span style="color: #51afef;">(</span>&#961;, y, X, &#946;, &#963;&#178;, &#948;<span style="color: #51afef;">)</span>

        <span style="color: #62686E;"># </span><span style="color: #62686E;">store</span>
        <span style="color: #51afef;">if</span> s <span style="color: #FCCE7B;">%</span> thin <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">0</span>
            <span style="color: #62686E;"># </span><span style="color: #62686E;">println(s, ac/s, &#946;, &#963;&#178;, &#961;)</span>
            println<span style="color: #51afef;">(</span>join<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span>s, ac<span style="color: #FCCE7B;">/</span>s, &#946;, &#963;&#178;, &#961;<span style="color: #7bc275;">]</span>, <span style="color: #7bc275;">", "</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
            params = vcat<span style="color: #51afef;">(</span>&#946;, &#963;&#178;, &#961;<span style="color: #51afef;">)</span>'
            OUT = vcat<span style="color: #51afef;">(</span>OUT, params<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">end</span>
    <span style="color: #51afef;">end</span>

    <span style="color: #51afef;">return</span> OUT
<span style="color: #51afef;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">set prior parameters</span>
&#957;&#8320; = <span style="color: #e69055; font-weight: bold;">1</span>
&#963;&#8320;&#178; = <span style="color: #e69055; font-weight: bold;">1</span>
&#931;&#8320; = diagm<span style="color: #51afef;">(</span>repeat<span style="color: #C57BDB;">(</span><span style="color: #7bc275;">[</span><span style="color: #e69055; font-weight: bold;">1</span><span style="color: #FCCE7B;">/</span><span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #7bc275;">]</span>, <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
&#946;&#8320; = <span style="color: #51afef;">[</span><span style="color: #e69055; font-weight: bold;">0</span>, <span style="color: #e69055; font-weight: bold;">0</span>, <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">y = df<span style="color: #51afef;">[</span>:, <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">]</span>;
X = hcat<span style="color: #51afef;">(</span>ones<span style="color: #C57BDB;">(</span>length<span style="color: #7bc275;">(</span>y<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>, df<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">]</span>, df<span style="color: #C57BDB;">[</span>:,<span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example" id="org83c028a">

20×3 Matrix{Float64}:
 1.0  0.0  6.39
 1.0  1.0  6.39
 1.0  0.0  5.58
 1.0  1.0  5.58
 1.0  0.0  4.26
 1.0  1.0  4.26
 1.0  0.0  5.87
 1.0  1.0  5.87
 1.0  0.0  3.91
 1.0  1.0  3.91
 1.0  0.0  3.91
 1.0  1.0  3.91
 1.0  0.0  6.17
 1.0  1.0  6.17
 1.0  0.0  3.36
 1.0  1.0  3.36
 1.0  0.0  3.52
 1.0  1.0  3.52
 1.0  0.0  2.02
 1.0  1.0  2.02
</pre>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #62686E;"># </span><span style="color: #62686E;">MCMC</span>
S=<span style="color: #e69055; font-weight: bold;">25000</span>
&#948;=<span style="color: #e69055; font-weight: bold;">0.1</span>
thin=<span style="color: #e69055; font-weight: bold;">25</span>
fitted_sample = fit_ar1_linear_model_for_repeated_individuals<span style="color: #51afef;">(</span>y, X, &#946;&#8320;, &#931;&#8320;, &#957;&#8320;, &#963;&#8320;&#178;, S=S, &#948;=&#948;, thin=thin<span style="color: #51afef;">)</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia">plot<span style="color: #51afef;">(</span>
    map<span style="color: #C57BDB;">(</span>
        <span style="color: #e69055; font-weight: bold;">1</span>:size<span style="color: #7bc275;">(</span>fitted_sample, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">)</span>, <span style="color: #7bc275;">[</span><span style="color: #7bc275;">"intercept"</span>, <span style="color: #7bc275;">"&#946;&#8321;"</span>, <span style="color: #7bc275;">"&#946;&#8322;"</span>, <span style="color: #7bc275;">"&#963;&#178;"</span>, <span style="color: #7bc275;">"&#961;"</span><span style="color: #7bc275;">]</span>
    <span style="color: #C57BDB;">)</span> <span style="color: #51afef;">do</span> i, label
        plot<span style="color: #C57BDB;">(</span>
            fitted_sample<span style="color: #7bc275;">[</span>:, i<span style="color: #7bc275;">]</span>,
            xlabel=<span style="color: #7bc275;">"scan/25"</span>,
            ylabel=label,
            legend=<span style="color: #a991f1;">nothing</span>
        <span style="color: #C57BDB;">)</span>
    <span style="color: #51afef;">end</span>...,
    layout=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">3</span>, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span>, size=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">900</span>, <span style="color: #e69055; font-weight: bold;">900</span><span style="color: #C57BDB;">)</span>
<span style="color: #51afef;">)</span>
savefig<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../fig/ch10/ex10_3_scan.png"</span><span style="color: #51afef;">)</span>
<span style="color: #7bc275;">"../../fig/ch10/ex10_3_scan.png"</span>
</pre>
</div>


<div id="orgd906674" class="figure">
<p><img src="fig/ch10/ex10_3_scan.png" alt="ex10_3_scan.png" />
</p>
<p><span class="figure-number">Figure 5: </span>Sample paths of the parameters</p>
</div>

<div class="org-src-container">
<pre class="src src-julia">plot<span style="color: #51afef;">(</span>
    map<span style="color: #C57BDB;">(</span>
        <span style="color: #e69055; font-weight: bold;">1</span>:size<span style="color: #7bc275;">(</span>fitted_sample, <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">)</span>, <span style="color: #7bc275;">[</span><span style="color: #7bc275;">"intercept"</span>, <span style="color: #7bc275;">"&#946;&#8321;"</span>, <span style="color: #7bc275;">"&#946;&#8322;"</span>, <span style="color: #7bc275;">"&#963;&#178;"</span>, <span style="color: #7bc275;">"&#961;"</span><span style="color: #7bc275;">]</span>
    <span style="color: #C57BDB;">)</span> <span style="color: #51afef;">do</span> i, label
        bar<span style="color: #C57BDB;">(</span>
            <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">30</span>,
            autocor<span style="color: #7bc275;">(</span>fitted_sample<span style="color: #a991f1;">[</span>:, i<span style="color: #a991f1;">]</span>, <span style="color: #e69055; font-weight: bold;">0</span>:<span style="color: #e69055; font-weight: bold;">30</span><span style="color: #7bc275;">)</span>,
            xlabel=<span style="color: #7bc275;">"lag/25 of $label"</span>,
            ylabel=<span style="color: #7bc275;">"ACF"</span>,
            legend=<span style="color: #a991f1;">false</span>
        <span style="color: #C57BDB;">)</span>
    <span style="color: #51afef;">end</span>...,
    layout=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">2</span>, <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">)</span>, size=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">900</span>, <span style="color: #e69055; font-weight: bold;">500</span><span style="color: #C57BDB;">)</span>, margin=<span style="color: #e69055; font-weight: bold;">5</span>mm
<span style="color: #51afef;">)</span>
savefig<span style="color: #51afef;">(</span><span style="color: #7bc275;">"./../../fig/ch10/ex10_3_acf.png"</span><span style="color: #51afef;">)</span>
<span style="color: #7bc275;">"./../../fig/ch10/ex10_3_acf.png"</span>
</pre>
</div>


<div id="orgb1bef71" class="figure">
<p><img src="fig/ch10/ex10_3_acf.png" alt="ex10_3_acf.png" />
</p>
<p><span class="figure-number">Figure 6: </span>Autocorrelation plots of the parameters</p>
</div>
<p>
図<a href="#orgd906674">5</a>、<a href="#orgb1bef71">6</a>はそれぞれ、25,000スキャンのうち25スキャンごとに保存された各パラメーターのサンプルパスと、自己相関のプロットである。これらの結果から、MCMCサンプリングが十分に収束していること確認できる。
</p>
</div>
</div>
</div>
<div id="outline-container-orgb94b2ae" class="outline-4">
<h4 id="orgb94b2ae">d)</h4>
<div class="outline-text-4" id="text-orgb94b2ae">
</div>
<div id="outline-container-orgf85ad71" class="outline-5">
<h5 id="orgf85ad71">Answer</h5>
<div class="outline-text-5" id="text-orgf85ad71">
<div class="org-src-container">
<pre class="src src-julia">figs = <span style="color: #51afef;">[]</span>
<span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> <span style="color: #e69055; font-weight: bold;">1</span>:<span style="color: #e69055; font-weight: bold;">3</span>
    fig = plot_posterior_density<span style="color: #51afef;">(</span>
        fitted_sample<span style="color: #C57BDB;">[</span>:, i<span style="color: #C57BDB;">]</span>, bandwidth=<span style="color: #e69055; font-weight: bold;">0.1</span>, xlabel=<span style="color: #7bc275;">"&#946;"</span> <span style="color: #FCCE7B;">*</span> <span style="color: #7bc275;">"_$i"</span>
    <span style="color: #51afef;">)</span>
    fig = vspan!<span style="color: #51afef;">(</span>
        fig,
        confint<span style="color: #C57BDB;">(</span>lmfit<span style="color: #C57BDB;">)[</span>i, :<span style="color: #C57BDB;">]</span>,
        color = <span style="color: #a991f1;">:blue</span>,
        alpha = <span style="color: #e69055; font-weight: bold;">0.1</span>,
        label = <span style="color: #7bc275;">"95% CI of OLS"</span>,
        legend = i <span style="color: #FCCE7B;">==</span> <span style="color: #e69055; font-weight: bold;">3</span> <span style="color: #51afef;">?</span> <span style="color: #a991f1;">:topright</span> <span style="color: #51afef;">:</span> <span style="color: #a991f1;">nothing</span>,
    <span style="color: #51afef;">)</span>
    fig = vline!<span style="color: #51afef;">(</span>
        fig,
        <span style="color: #C57BDB;">[</span>coef<span style="color: #7bc275;">(</span>lmfit<span style="color: #7bc275;">)[</span>i<span style="color: #7bc275;">]</span><span style="color: #C57BDB;">]</span>,
        color = <span style="color: #a991f1;">:blue</span>,
        linestyle = <span style="color: #a991f1;">:dash</span>,
        label = <span style="color: #7bc275;">"OLS estimate"</span>,
    <span style="color: #51afef;">)</span>
    push!<span style="color: #51afef;">(</span>figs, fig<span style="color: #51afef;">)</span>
<span style="color: #51afef;">end</span>

plot<span style="color: #51afef;">(</span>figs..., layout=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1</span>, <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #C57BDB;">)</span>, size=<span style="color: #C57BDB;">(</span><span style="color: #e69055; font-weight: bold;">1000</span>, <span style="color: #e69055; font-weight: bold;">400</span><span style="color: #C57BDB;">)</span>, margin=<span style="color: #e69055; font-weight: bold;">5</span>mm<span style="color: #51afef;">)</span>
savefig<span style="color: #51afef;">(</span><span style="color: #7bc275;">"../../fig/ch10/ex10_3d.png"</span><span style="color: #51afef;">)</span>
<span style="color: #7bc275;">"../../fig/ch10/ex10_3d.png"</span>
</pre>
</div>


<div id="orgc40595c" class="figure">
<p><img src="fig/ch10/ex10_3d.png" alt="ex10_3d.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Posterior of the coefficients</p>
</div>
<p>
図<a href="#orgc40595c">7</a>は、MCMCサンプリングによる事後分布の分布、事後平均、95%信用区間と、
OLSによる点推定量と95%信頼区間を示している。切片(\(\beta_1\)), timeの係数(\(\beta_2\)), pHの係数(\(\beta_3\))について、MCMCサンプリングによる事後平均とOLS推定量はほぼ一致しているが、95%信用区間とOLSの信頼区間は異なる。もし点推定値のみに関心がある場合、同様な結論が得られるが、推定値の不確実性などを考慮したい場合、今回のベイズモデルとOLSモデルの結論は大きく異なる。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb76b548" class="outline-3">
<h3 id="orgb76b548">10.4</h3>
<div class="outline-text-3" id="text-orgb76b548">
</div>
<div id="outline-container-orgaa5ddb2" class="outline-4">
<h4 id="orgaa5ddb2">Answer</h4>
<div class="outline-text-4" id="text-orgaa5ddb2">
<p>
\(\bm{\phi}\)は\(d\)次元の確率ベクトルとする。
</p>

<p>
\(\bm{\phi}_a\), \(\bm{\phi}_b\)をそれぞれ\(\mathbb{R}^d\)の任意の確率ベクトルとし、
\(\bm{\phi}_a = (a_1, \dots, a_d)\), \(\bm{\phi}_b = (b_1, \dots, b_d)\)とおくと、
</p>
\begin{equation}
\label{eq:10-4-dbc}
\begin{aligned}
& p(\bm{\phi}_a) \mathrm{Pr}( \bm{\phi}^{(t)} = \bm{\phi}_a, \bm{\phi}^{(t+1)} = \bm{\phi}_b ) \\
= & p(a_1, \dots, a_d) p(b_1 | a_2, \dots, a_d) p(b_2 | b_1, a_3, \dots, a_d) \\
& \times p(b_3 | b_1, b_2, a_4, \dots, a_d) \dots p(b_d | b_1, \dots, b_{d-1}) \\
= & p(a_1|a_2, \dots, a_d) p(a_2, \dots, a_d) p(b_1 | a_2, \dots, a_d) p(b_2 | b_1, a_3, \dots, a_d) \\
& \times p(b_3 | b_1, b_2, a_4, \dots, a_d) \dots p(b_d | b_1, \dots, b_{d-1}) \\
= & p(a_1|a_2, \dots, a_d) p(b_1, a_2, \dots, a_d) p(b_2 | b_1, a_3, \dots, a_d) \\
& \times p(b_3 | b_1, b_2, a_4, \dots, a_d) \dots p(b_d | b_1, \dots, b_{d-1}) \\
= & p(a_1|a_2, \dots, a_d) p(a_2 | b_1, a_3, \dots, a_d) p(b_1, a_3, \dots, a_d) p(b_2 | b_1, a_3, \dots, a_d) \\
= & p(b_3 | b_1, b_2, a_4, \dots, a_d) \dots p(b_d | b_1, \dots, b_{d-1}) \\
= & p(a_1|a_2, \dots, a_d) p(a_2 | b_1, a_3, \dots, a_d) p(b_1, b_2, a_3, \dots, a_d) \\
= &  p(b_3 | b_1, b_2, a_4, \dots, a_d) \dots p(b_d | b_1, \dots, b_{d-1}) \\
= & \ldots \\
= &p(a_1 | a_2, \dots, a_d) p(a_2 | b_1, a_3, \dots, a_d) \dots p(a_d | a_1, \dots, a_{d-1}) p(b_1, \dots, b_d) \\
= & p(\bm{\phi}_b) \mathrm{Pr}( \bm{\phi}^{(t)} = \bm{\phi}_b, \bm{\phi}^{(t+1)} = \bm{\phi}_a ) \\
\end{aligned}
\end{equation}
<p>
が成り立つ。
</p>

<p>
よって、
</p>
\begin{equation*}
\begin{aligned}
\text{Pr}(\bm{\phi}^{(s+1)} \in A)
&= \int_A \left[\int_{\mathbb{R}^d} p(\bm{\phi}^{(s)}) \mathrm{Pr}(\bm{\phi}^{(t)} = \bm{\phi}^{(s)}, \bm{\phi}^{(t+1)} = \bm{\phi}^{(s+1)})
d\bm{\phi}^{(s)}\right] d\bm{\phi}^{(s+1)} & (\text{by assumption}) \\
&= \int_A \left[\int_{\mathbb{R}^d} p(\bm{\phi}^{(s+1)}) \mathrm{Pr}(\bm{\phi}^{(t)} = \bm{\phi}^{(s+1)}, \bm{\phi}^{(t+1)} = \bm{\phi}^{(s)})
d\bm{\phi}^{(s)}\right] d\bm{\phi}^{(s+1)} &(\because \eqref{eq:10-4-dbc}) \\
&= \int_A p(\bm{\phi}^{(s+1)}) \left[\int_{\mathbb{R}^d} \mathrm{Pr}(\bm{\phi}^{(t)} = \bm{\phi}^{(s+1)}, \bm{\phi}^{(t+1)} = \bm{\phi}^{(s)})
d\bm{\phi}^{(s)}\right] d\bm{\phi}^{(s+1)} \\
&= \int_A p(\bm{\phi}^{(s+1)}) d\bm{\phi}^{(s+1)} \\
&= \int_A p(\bm{\phi}) d\bm{\phi}
\end{aligned}
\end{equation*}
</div>
</div>
</div>
</div>
<div id="outline-container-org7b23e33" class="outline-2">
<h2 id="org7b23e33">間違いを見つけたら</h2>
<div class="outline-text-2" id="text-org7b23e33">
<p>
本サイトは、<a href="https://kaorubb.org/">筆者</a>が修士課程のときに趣味の一環で作成したものなので、誤植や間違いが多々あるかと思います。
</p>

<p>
また、まだ解いていない問題も多く残っており、少しずつ解いていく予定です。
</p>

<p>
もし、間違い等を見つけた場合は、<a href="https://github.com/KaoruBB/Hoff_AFCBSM">このリポジトリ</a> に Issueを立てていただくか、Pull Requestを送っていただけると幸いです。
</p>

<p>
また、<a href="mailto:bbkaoru1007@keio.jp">メールにてご連絡</a> いただいても構いません。
</p>


<p>
なお、これまで
</p>
<ul class="org-ul">
<li>Okamoto Noriaki さん</li>
<li>Kubota Kohsuke さん</li>
<li>Kondo Daisuke さん</li>
</ul>
<p>
から、誤植・間違いの指摘をいただきました。
</p>

<p>
ありがとうございます。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: 馬場先 薫</p>
<p class="email">Email: <a href="mailto:bbkaoru1007@keio.jp">bbkaoru1007@keio.jp</a></p>
</div>
</body>
</html>
